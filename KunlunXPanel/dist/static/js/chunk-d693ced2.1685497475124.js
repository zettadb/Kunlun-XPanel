(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d693ced2"],{"0ccb":function(t,e,a){var i=a("50c4"),s=a("1148"),l=a("1d80"),r=Math.ceil,n=function(t){return function(e,a,n){var o,c,u=String(l(e)),p=u.length,d=void 0===n?" ":String(n),b=i(a);return b<=p||""==d?u:(o=b-p,c=s.call(d,r(o/d.length)),c.length>o&&(c=c.slice(0,o)),t?u+c:c+u)}};t.exports={start:n(!1),end:n(!0)}},1148:function(t,e,a){"use strict";var i=a("a691"),s=a("1d80");t.exports="".repeat||function(t){var e=String(s(this)),a="",l=i(t);if(l<0||l==1/0)throw RangeError("Wrong number of repetitions");for(;l>0;(l>>>=1)&&(e+=e))1&l&&(a+=e);return a}},"4d90":function(t,e,a){"use strict";var i=a("23e7"),s=a("0ccb").start,l=a("9a0c");i({target:"String",proto:!0,forced:l},{padStart:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})},"7b87":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"icons-container"},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"逻辑备份",name:"first"}},[a("LogicalBackup")],1),a("el-tab-pane",{attrs:{label:"物理备份",name:"second"}},[a("BackUp")],1)],1)],1)},s=[],l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("div",{staticClass:"table-list-search-wrap"},[a("el-select",{staticClass:"list_search_select",attrs:{placeholder:"请选择备份类型"},model:{value:t.listQuery.backup_type,callback:function(e){t.$set(t.listQuery,"backup_type",e)},expression:"listQuery.backup_type"}},[a("el-option",{attrs:{label:"存储",value:"storage"}}),a("el-option",{attrs:{label:"计算",value:"compute"}})],1),a("el-select",{staticClass:"list_search_select",attrs:{placeholder:"请选择状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[a("el-option",{attrs:{label:"not_started",value:"not_started"}}),a("el-option",{attrs:{label:"ongoing",value:"ongoing"}}),a("el-option",{attrs:{label:"done",value:"done"}}),a("el-option",{attrs:{label:"failed",value:"failed"}})],1),a("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("查询")]),a("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v("重置")])],1)]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":""}},[a("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),a("el-table-column",{attrs:{label:"集群名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"link-type",on:{click:function(e){return t.handleDetail(i)}}},[t._v(t._s(i.cluster_name))])]}}])}),a("el-table-column",{attrs:{prop:"nick_name",align:"center",label:"业务名称"}}),a("el-table-column",{attrs:{prop:"shard_name",align:"center",label:"shard名称"}}),a("el-table-column",{attrs:{prop:"comp_name",align:"center",label:"计算节点名称"}}),a("el-table-column",{attrs:{prop:"backup_type",align:"center",label:"备份类型"},scopedSlots:t._u([{key:"default",fn:function(e){return["storage"===e.row.backup_type?a("span",[t._v("存储")]):"compute"===e.row.backup_type?a("span",[t._v("计算")]):a("span")]}}])}),a("el-table-column",{attrs:{prop:"status",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["failed"===e.row.status?a("span",{staticStyle:{color:"red"}},[t._v(t._s(e.row.status))]):a("span",[t._v(t._s(e.row.status))])]}}])}),a("el-table-column",{attrs:{prop:"info",align:"center","show-overflow-tooltip":!0,label:"结果信息"}}),a("el-table-column",{attrs:{prop:"start_ts",align:"center",label:"开始时间"}}),a("el-table-column",{attrs:{prop:"end_ts",align:"center",label:"结束时间"}})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}})],1)},r=[],n=a("82b0"),o=a("333d"),c={name:"Operation",components:{Pagination:o["a"]},data:function(){return{tableKey:0,list:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,username:"",backup_type:"",status:""},dialogFormVisible:!1,dialogEditVisible:!1,dialogStatus:"",textMap:{detail:"详情"},dialogDetail:!1,message_tips:"",message_type:"",row:{}}},created:function(){this.getList()},methods:{handleFilter:function(){this.listQuery.pageNo=1,this.getList()},handleClear:function(){this.listQuery.username="",this.listQuery.backup_type="",this.listQuery.status="",this.listQuery.pageNo=1,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);Object(n["y"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},handleDetail:function(t){this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},t),this.dialogDetail=!0}}},u=c,p=a("2877"),d=Object(p["a"])(u,l,r,!1,null,null,null),b=d.exports,m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("div",{staticClass:"table-list-search-wrap"},[a("el-select",{staticClass:"list_search_select",attrs:{placeholder:"请选择状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[a("el-option",{attrs:{label:"not_started",value:"not_started"}}),a("el-option",{attrs:{label:"ongoing",value:"ongoing"}}),a("el-option",{attrs:{label:"done",value:"done"}}),a("el-option",{attrs:{label:"failed",value:"failed"}})],1),a("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("查询")]),a("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v("重置")])],1)]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":""}},[a("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),a("el-table-column",{attrs:{label:"集群名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"link-type"},[t._v(t._s(i.cluster_name))])]}}])}),a("el-table-column",{attrs:{prop:"nick_name",align:"center",label:"业务名称"}}),a("el-table-column",{attrs:{prop:"job_id",align:"center",label:"任务ID"}}),a("el-table-column",{attrs:{prop:"backup_state",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["failed"===e.row.backup_state?a("span",{staticStyle:{color:"red"}},[t._v(t._s(e.row.backup_state))]):a("span",[t._v(t._s(e.row.backup_state))])]}}])}),a("el-table-column",{attrs:{prop:"backup_info",align:"center","show-overflow-tooltip":!0,label:"结果信息"}}),a("el-table-column",{attrs:{prop:"backup_time",align:"center",label:"备份时间"}}),"super_dba"==t.user_name?a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row,s=e.$index;return["done"===i.backup_state&&"super_dba"==t.user_name?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleRestore(i,s)}}},[t._v("逻辑恢复 ")]):t._e()]}}],null,!1,4081702981)}):t._e()],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}}),a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogRestoreVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogRestoreVisible=e}}},[a("el-form",{ref:"form",attrs:{id:"form",model:t.form,rules:t.rules,"label-width":"140px"}},[a("el-form-item",{attrs:{label:"集群名称"}},[a("span",[t._v(t._s(t.form.name))])]),a("el-form-item",{attrs:{label:"业务名称"}},[a("span",[t._v(t._s(t.form.nick_name))])]),a("el-form-item",{attrs:{label:"恢复类型"}},[a("el-select",{attrs:{placeholder:"选择恢复类型"},on:{change:function(e){return t.setbackupType(e)}},model:{value:t.backup_type,callback:function(e){t.backup_type=e},expression:"backup_type"}},t._l(t.backup_type_items,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"目标表集群:",prop:"dst_cluster_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择目标表集群"},on:{change:t.onDstClusterChange},model:{value:t.form.dst_cluster_id,callback:function(e){t.$set(t.form,"dst_cluster_id",e)},expression:"form.dst_cluster_id"}},t._l(t.clusterOptions,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t._l(t.form.backup,(function(e,i){return a("el-row",{key:e.key,attrs:{gutter:0}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"备份记录:",prop:"backup."+i+".db_table",rules:{required:!0,message:"请选择备份记录",trigger:"blur"}}},[a("el-cascader",{key:"srcTable"+i,staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择 库名/模式/表",options:t.backupList,filterable:""},model:{value:t.form.backup[i].db_table,callback:function(e){t.$set(t.form.backup[i],"db_table",e)},expression:"form.backup[index].db_table"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"开始时间:",prop:"backup."+i,rules:t.rules.time}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"开始时间"},model:{value:t.form.backup[i].startTime,callback:function(e){t.$set(t.form.backup[i],"startTime",e)},expression:"form.backup[index].startTime"}})],1)],1),"table"==t.backup_type||"schema"==t.backup_type?a("el-col",{attrs:{span:2,offset:6}},[a("el-button",0===i?{attrs:{icon:"el-icon-plus",size:"small"},on:{click:function(e){return t.onPush(i)}}}:{attrs:{icon:"el-icon-minus",size:"small"},on:{click:function(e){return t.onRemove(i)}}})],1):t._e()],1)})),a("el-form-item",{staticStyle:{color:"red"},attrs:{label:"温馨提示:"}},[a("p",[t._v("1.开始时间不能大于当前系统时间。")]),a("p",[t._v("2.目标表集群不存在和备份集群相同的table和schema。")])])],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],on:{click:function(e){t.dialogRestoreVisible=!1}}},[t._v("关闭")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("确认")])],1)],1),a("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeRestoreDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[a("div",{staticClass:"block"},[a("el-timeline",t._l(t.activities,(function(e,i){return a("el-timeline-item",{key:i,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)])],1)},f=[],_=a("c7eb"),g=a("1da1"),h=(a("b0c0"),a("e9c4"),a("a434"),a("d81d"),a("578a")),v=a("ed08"),y={name:"Operation",components:{Pagination:o["a"]},props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,a){return""===e.startTime?a(new Error("请选择开始时间")):e.startTime>Object(v["d"])()?a(new Error("开始时间不能大于当前系统时间")):void a()},e=function(t,e,a){e?a():a(new Error("请选择目标表集群"))};return{tableKey:0,list:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,username:"",status:""},dialogFormVisible:!1,dialogEditVisible:!1,dialogStatus:"",textMap:{detail:"详情"},dialogDetail:!1,message_tips:"",message_type:"",row:{},dialogRestoreVisible:!1,backup_type:"table",backup_type_items:[{item:"db",label:"db",value:"db"},{item:"schema",label:"schema",value:"schema"},{item:"table",label:"table",value:"table"}],form:{src_cluster_id:"",dst_cluster_id:"",name:"",nick_name:"",backup:[{db_table:[],backup_time:"",new_db_table:"",startTime:"",endTime:""}],id:""},clusterOptions:[],dialogStatusVisible:!1,activities:[],backupIndex:0,user_name:sessionStorage.getItem("login_username"),rules:{time:[{validator:t,trigger:"blur"}],dst_cluster_id:[{required:!0,validator:e,trigger:"blur"}]},tableOptions:[],backupList:[],backupListStr:null}},created:function(){this.getList()},methods:{handleFilter:function(){this.listQuery.pageNo=1,this.getList()},handleClear:function(){this.listQuery.username="",this.listQuery.status="",this.listQuery.pageNo=1,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);Object(n["Q"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},handleRestore:function(t){this.resetTemp(),this.dialogRestoreVisible=!0,this.form.name=t.cluster_name,this.form.nick_name=t.nick_name,this.form.id=t.cluster_id;var e={cluster_id:t.cluster_id};this.clusterOptions=[],this.clusterOptionsList(e),this.toGetLogicalBackUpRecordList(this.backup_type)},clusterOptionsList:function(t){var e=this;return Object(g["a"])(Object(_["a"])().mark((function a(){return Object(_["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:Object(n["j"])(t).then((function(t){e.clusterOptions=t.list}));case 1:case"end":return a.stop()}}),a)})))()},toGetLogicalBackUpRecordList:function(t){var e=this;Object(n["R"])({cluster_id:this.form.id,type:t}).then((function(a){e.backupListStr=JSON.stringify(a.list);try{e.backupList="db"==t?a.list["db"]:"schema"==t?a.list["schema"]:a.list["table"]}catch(i){}}))},setbackupType:function(t){this.toGetLogicalBackUpRecordList(t)},beforeRestoreDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},onDstClusterChange:function(t){this.dst_cluster_id=t},onPush:function(t){this.form.backup.push({db_table:[],backup_time:"",startTime:"",endTime:""})},onRemove:function(t){this.form.backup.splice(t,1)},onSubmit:function(t){var e=this,a=this;this.$refs["form"].validate((function(t){if(t){var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.version=h["u"][0].ver,i.job_type="logical_restore",i.timestamp=h["s"][0].time+"";var s={},l=e.repeatObject(e.form.backup,"db_table");if(null!==l)return e.message_tips="备份记录不能重复选择",e.message_type="error",void Object(v["g"])(e.message_tips,e.message_type);var r=e.form.backup.map((function(t){return"table"==a.backup_type||"db"==a.backup_type||"schema"==a.backup_type?{db_table:t.db_table[0].substr(0,t.db_table[0].indexOf("(")),restore_time:t.startTime}:void 0}));s.cluster_id=e.form.id,s.restore_type=a.backup_type,s.src_cluster_id=e.form.id,s.dst_cluster_id=a.form.dst_cluster_id,s.restore=r,i.paras=s,Object(n["Db"])(i).then((function(t){if(200===t.code&&(e.form.backup=[{db_table:[],backup_time:"",startTime:"",endTime:""}]),"accept"===t.status){e.dialogRestoreVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var a={content:"逻辑恢复中...",timestamp:Object(v["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a);var i=0;e.timer=null,e.timer=setInterval((function(){e.getStatus(e.timer,t.job_id,i++)}),1e3)}else"ongoing"===t.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(v["g"])(e.message_tips,e.message_type)):(e.message_tips=t.error_info,e.message_type="error",Object(v["g"])(e.message_tips,e.message_type))}))}}))},repeatObject:function(t,e){for(var a=0,i=t.length,s=new Array,l=new Array,r=0,n=0;r<i;r++){var o=t[r][e];s[o]?(l[n]=o,a=1,n++):s[o]=1}return 1==a?l:null},resetTemp:function(){this.form={src_cluster_id:"",dst_cluster_id:"",name:"",nick_name:"",backup:[{db_table:[],backup_time:"",new_db_table:"",startTime:"",endTime:""}],id:"",clusterOptions:[]}},getStatus:function(t,e,a){var i=this;setTimeout((function(){var s={job_type:"get_status"};s.version=h["u"][0].ver,s.job_id=e,s.timestamp=h["s"][0].time+"",s.paras={},Object(n["N"])(s).then((function(e){var a=e.error_info;if("done"===e.status||"failed"===e.status)if(clearInterval(t),"done"===e.status){var s={content:"逻辑恢复成功",timestamp:Object(v["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};i.activities.push(s),i.getList()}else{var l="";if(e.attachment.fail_dts){for(var r=0;r<e.attachment.fail_dts.length;r++)l+=e.attachment.fail_dts[r].host+e.attachment.fail_dts[r].db_table+e.attachment.fail_dts[r].errmsg+";";a=l}var n={content:a,timestamp:Object(v["d"])(),color:"red",icon:"el-icon-circle-close"};i.activities.push(n)}})),a>=86400&&clearInterval(t)}),0)}}},k=y,w=Object(p["a"])(k,m,f,!1,null,null,null),S=w.exports,O={components:{BackUp:b,LogicalBackup:S},data:function(){return{activeName:"first"}},methods:{handleClick:function(t,e){console.log(t,e)}}},L=O,x=(a("7c7f"),Object(p["a"])(L,i,s,!1,null,"6c5b0e92",null));e["default"]=x.exports},"7c7f":function(t,e,a){"use strict";a("ff67")},"9a0c":function(t,e,a){var i=a("342f");t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(i)},e9c4:function(t,e,a){var i=a("23e7"),s=a("d066"),l=a("d039"),r=s("JSON","stringify"),n=/[\uD800-\uDFFF]/g,o=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,u=function(t,e,a){var i=a.charAt(e-1),s=a.charAt(e+1);return o.test(t)&&!c.test(s)||c.test(t)&&!o.test(i)?"\\u"+t.charCodeAt(0).toString(16):t},p=l((function(){return'"\\udf06\\ud834"'!==r("\udf06\ud834")||'"\\udead"'!==r("\udead")}));r&&i({target:"JSON",stat:!0,forced:p},{stringify:function(t,e,a){var i=r.apply(null,arguments);return"string"==typeof i?i.replace(n,u):i}})},ff67:function(t,e,a){}}]);