(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a1e23db","chunk-5cccc9a2"],{"0870":function(t,e,s){},"0a5f":function(t,e,s){"use strict";s("0870")},"161c":function(t,e,s){},"1dd0":function(t,e,s){"use strict";s("43ab")},"26fc":function(t,e,s){t.exports=s.p+"static/img/404_cloud.1685410821547.png"},2905:function(t,e,s){"use strict";s("efdb")},3086:function(t,e,s){},"34a1":function(t,e,s){},3520:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"icons-container set-clus"},[s("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick,"tab-remove":t.removeTab},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"集群列表信息",name:"second"}},[t.tabs.second?s("List",{attrs:{comment:t.clusterTab},on:{updateActiveName:t.updateActiveName}}):t._e()],1),s("el-tab-pane",{attrs:{label:"集群展示",name:"first"}},[t.tabs.first?s("Cshow"):t._e()],1),s("el-tab-pane",{attrs:{label:"异常集群列表",name:"three"}},[t.tabs.three?s("ErrorList"):t._e()],1),t._l(t.editableTabs,(function(e){return s("el-tab-pane",{key:e.name,attrs:{label:e.title,name:e.name,closable:""}},[e.name?s("OneClusterList",{attrs:{"one-list":t.InfoList},on:{getId:t.clusterId}}):t._e()],1)}))],2)],1)},i=[],r=(s("d3b7"),s("159b"),s("b0c0"),s("4de4"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("div",{staticClass:"table-list-search-wrap"},[s("el-input",{staticClass:"list_search_keyword",attrs:{placeholder:"可输入集群名称搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.name,callback:function(e){t.$set(t.listQuery,"name",e)},expression:"listQuery.name"}}),s("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v(" 查询 ")]),s("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v(" 重置 ")]),"Y"===t.cluster_creata_priv?s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleCreate}},[t._v("新增 ")]):t._e(),s("el-popover",{staticStyle:{float:"right"},attrs:{placement:"right",title:"列筛选",trigger:"click",width:"420"}},[s("el-checkbox-group",{attrs:{size:"mini"},model:{value:t.checkedColumns,callback:function(e){t.checkedColumns=e},expression:"checkedColumns"}},t._l(t.checkBoxGroup,(function(t){return s("el-checkbox",{key:t,attrs:{label:t,value:t}})})),1),s("el-button",{attrs:{slot:"reference",type:"primary",size:"small",plain:""},slot:"reference"},[s("i",{staticClass:"el-icon-arrow-down el-icon-menu"}),t._v("列筛选 ")])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.installStatus,expression:"installStatus === true"}],staticClass:"info",domProps:{textContent:t._s(t.info)}})],1)]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":""}},[s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),t.colData[0].istrue?s("el-table-column",{attrs:{label:"集群ID",align:"center",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticClass:"link-type",on:{click:function(e){return t.handleDetail(a)}}},[t._v(t._s(a.id))])]}}],null,!1,1310600360)}):t._e(),t.colData[1].istrue?s("el-table-column",{attrs:{prop:"nick_name",label:"业务名称",align:"center"}}):t._e(),t.colData[2].istrue?s("el-table-column",{attrs:{prop:"status",align:"center",sortable:"","show-overflow-tooltip":!0,label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["运行中"===e.row.status?s("span",{staticStyle:{color:"#00ed37"}},[t._v("运行中")]):s("span",{staticStyle:{color:"red","border-bottom":"1px red solid"},on:{click:function(s){return t.statusDetail(e.row)}}},[t._v(t._s(e.row.status))])]}}],null,!1,1313659262)}):t._e(),t.colData[3].istrue?s("el-table-column",{attrs:{align:"center",label:"计算节点",width:"500"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-table",{attrs:{border:"",data:e.row.compList,"max-height":"200px"}},[s("el-table-column",{attrs:{prop:"hostaddr",label:"ip",align:"center"}}),s("el-table-column",{attrs:{prop:"port",label:"端口",align:"center",width:"70"}}),s("el-table-column",{attrs:{prop:"cpu_cores",label:"cpu个数",align:"center",width:"90"}}),s("el-table-column",{attrs:{prop:"mysql_port",label:"MySQL端口",align:"center",width:"110"}}),s("el-table-column",{attrs:{prop:"status",label:"状态",align:"center",width:"80",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return["active"===e.row.status?s("span",{staticStyle:{color:"#00ed37"}},[t._v("运行中")]):"creating"===e.row.status?s("span",{staticStyle:{color:"#c7c9d1"}},[t._v("安装中")]):"manual_stop"===e.row.status?s("span",{staticStyle:{color:"#c7c9d1"}},[t._v("停止")]):"inactive"===e.row.status?s("span",{staticStyle:{color:"red"}},[t._v("异常")]):s("span")]}}],null,!0)})],1)]}}],null,!1,1081326376)}):t._e(),t.colData[4].istrue?s("el-table-column",{attrs:{prop:"shardtotal",align:"center",label:"shard分配",width:"650"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-table",{attrs:{border:"",data:e.row.shardList,"max-height":"250px"}},[s("el-table-column",{attrs:{prop:"name",label:"名称",align:"center",width:"80"}}),s("el-table-column",{attrs:{prop:"hostaddr",label:"ip",align:"center",width:"130"}}),s("el-table-column",{attrs:{prop:"port",label:"端口",align:"center",width:"70"}}),s("el-table-column",{attrs:{prop:"cpu_cores",label:"cpu个数",align:"center",width:"100"}}),s("el-table-column",{attrs:{prop:"member_state",label:"主/备节点",align:"center",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return["source"===e.row.member_state?s("span",{staticStyle:{color:"#409eff"}},[t._v("主")]):"replica"===e.row.member_state?s("span",[t._v("备")]):s("span")]}}],null,!0)}),s("el-table-column",{attrs:{prop:"status",label:"状态",align:"center",width:"80",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return["active"===e.row.status?s("span",{staticStyle:{color:"#00ed37"}},[t._v("运行中")]):"creating"===e.row.status?s("span",{staticStyle:{color:"#c7c9d1"}},[t._v("安装中")]):"manual_stop"===e.row.status?s("span",{staticStyle:{color:"#c7c9d1"}},[t._v("停止")]):"inactive"===e.row.status?s("span",{staticStyle:{color:"red"}},[t._v("异常")]):s("span")]}}],null,!0)}),s("el-table-column",{attrs:{prop:"replica_delay",label:"延迟时间",align:"center",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.replica_delay+"s"))])]}}],null,!0)}),s("el-table-column",{attrs:{prop:"replica_delay",label:"Proxy",align:"left",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.is_proxysql_nodes?s("div",[s("p",[t._v("host:"+t._s(e.row.res_proxysql_nodes.hostaddr))]),s("p",[t._v("port:"+t._s(e.row.res_proxysql_nodes.port))])]):t._e()]}}],null,!0)})],1)]}}],null,!1,2387116224)}):t._e(),t.colData[5].istrue?s("el-table-column",{attrs:{prop:"back_up",align:"center",label:"最近备份时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[""===e.row.first_backup?s("span",[t._v("无备份")]):""!==e.row.first_backup?s("span",[t._v(t._s(e.row.first_backup))]):t._e()]}}],null,!1,2719071811)}):t._e(),t.colData[6].istrue?s("el-table-column",{attrs:{prop:"ha_mode",align:"center",label:"高可用模式"}}):t._e(),t.colData[7].istrue?s("el-table-column",{attrs:{prop:"name",label:"集群名称",align:"center"}}):t._e(),s("el-table-column",{attrs:{label:"操作",align:"center",width:"100",fixed:"right","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return["Y"===t.restore_priv?s("el-button",{staticStyle:{"margin-left":"10px","margin-bottom":"2px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleRetreated(a)}}},[t._v("回档 ")]):t._e(),"Y"===t.expand_cluster_priv?s("el-button",{staticStyle:{"margin-bottom":"2px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleExpand(a)}}},[t._v("扩容")]):t._e(),"Y"===t.storage_node_create_priv&&"Y"===t.shard_create_priv&&"Y"===t.compute_node_create_priv?s("el-button",{staticStyle:{"margin-bottom":"2px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleUpdate(a)}}},[t._v("+ ")]):t._e(),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleSetUp(a)}}},[t._v("设置")])]}}])})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}}),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"200px"}},[s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"业务名称:",prop:"nick_name"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入业务名称",disabled:"detail"===t.dialogStatus},model:{value:t.temp.nick_name,callback:function(e){t.$set(t.temp,"nick_name",e)},expression:"temp.nick_name"}})],1),"create"===t.dialogStatus?s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-tabs",{attrs:{type:"border-card",id:"data-center"},model:{value:t.createTypes,callback:function(e){t.createTypes=e},expression:"createTypes"}},[s("el-tab-pane",{attrs:{label:"本地集群",name:"local"}},[s("div",{staticStyle:{margin:"30px"}},[t._v(" 存储： "),s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.temp.machinelist,callback:function(e){t.$set(t.temp,"machinelist",e)},expression:"temp.machinelist"}},t._l(t.machines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1),s("div",{staticStyle:{margin:"30px"}},[t._v(" 计算： "),s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.temp.comp_machinelist,callback:function(e){t.$set(t.temp,"comp_machinelist",e)},expression:"temp.comp_machinelist"}},t._l(t.comp_machines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1)]),s("el-tab-pane",{attrs:{label:"数据中心",name:"datacenters"}},[s("div",{staticStyle:{margin:"30px"}},[s("div",[t._v(" 购买类型 "),s("el-select",{attrs:{size:"mini",placeholder:"请选择"},model:{value:t.distribution_value,callback:function(e){t.distribution_value=e},expression:"distribution_value"}},t._l(t.distribution_type,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),s("div",{staticStyle:{"margin-top":"20px"}},[t._v(" 选择城市 "),s("el-cascader",{attrs:{size:"mini",options:t.data_center_city,clearable:""}})],1),s("div",[t._v("存储：")]),s("el-table",{ref:"data_center_nodes",staticStyle:{width:"100%"},attrs:{size:"mini",data:t.data_center_nodes,border:"","tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{label:"省/市",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.province)+"/"+t._s(e.row.city)+" ")]}}],null,!1,2804175266)}),s("el-table-column",{attrs:{prop:"name",label:"idc",width:"100"}}),s("el-table-column",{attrs:{prop:"node_num",label:"主节点",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-checkbox",{model:{value:e.row.master,callback:function(s){t.$set(e.row,"master",s)},expression:"scope.row.master"}},[t._v("主节点")])]}}],null,!1,1533038994)}),s("el-table-column",{attrs:{prop:"node_num",label:"节点数",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-input",{attrs:{size:"mini"},model:{value:e.row.node_num,callback:function(s){t.$set(e.row,"node_num",s)},expression:"scope.row.node_num"}})]}}],null,!1,1273384780)})],1),s("div",[t._v("计算")]),s("el-table",{ref:"data_center_comps",staticStyle:{width:"100%"},attrs:{size:"mini",data:t.data_center_comps,border:"","tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{label:"省/市",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.province)+"/"+t._s(e.row.city)+" ")]}}],null,!1,2804175266)}),s("el-table-column",{attrs:{prop:"name",label:"idc",width:"100"}}),s("el-table-column",{attrs:{prop:"node_num",label:"节点数",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-input",{attrs:{size:"mini"},model:{value:e.row.node_num,callback:function(s){t.$set(e.row,"node_num",s)},expression:"scope.row.node_num"}})]}}],null,!1,1273384780)})],1)],1)])],1)],1):t._e(),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"高可用模式:",prop:"ha_mode"}},[s("el-select",{attrs:{placeholder:"请选择高可用模式",disabled:"detail"===t.dialogStatus},model:{value:t.temp.ha_mode,callback:function(e){t.$set(t.temp,"ha_mode",e)},expression:"temp.ha_mode"}},t._l(t.hamodeData,(function(t){return s("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1)],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus,expression:"dialogStatus === 'create'"}]},[s("el-form-item",{attrs:{prop:"install_proxysql"}},[s("template",{slot:"label"},[s("span",[t._v("是否安装proxysql")]),s("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[s("div",{staticClass:"tips-content text-tips-content",attrs:{slot:"content"},slot:"content"},[s("span",[t._v("如果安装proxysql，则只能是单shard模式")])]),s("i",{staticClass:"el-icon-question",staticStyle:{color:"#2c68ff"}})]),s("span",[t._v(":")])],1),s("el-radio-group",{staticClass:"right_input",attrs:{disabled:"detail"===t.dialogStatus},on:{change:t.installProxySqlChange},model:{value:t.temp.install_proxysql,callback:function(e){t.$set(t.temp,"install_proxysql",e)},expression:"temp.install_proxysql"}},[s("el-radio",{attrs:{label:"1",border:""}},[t._v("是")]),s("el-radio",{attrs:{label:"0",border:""}},[t._v("否")])],1)],2)],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus,expression:"dialogStatus === 'create'"}]},[s("el-form-item",{attrs:{label:"shard个数:",prop:"shards_count"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入shard个数",disabled:"detail"===t.dialogStatus||"1"===t.temp.install_proxysql},model:{value:t.temp.shards_count,callback:function(e){t.$set(t.temp,"shards_count",e)},expression:"temp.shards_count"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1)],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus,expression:"dialogStatus === 'create'"}],attrs:{label:"副本数:",prop:"snode_count"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"副本数至少是3，且不能大于256",disabled:"detail"===t.dialogStatus},model:{value:t.temp.snode_count,callback:function(e){t.$set(t.temp,"snode_count",e)},expression:"temp.snode_count"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"计算节点总个数:",prop:"comp_count"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"输入计算节点总个数",disabled:"detail"===t.dialogStatus},model:{value:t.temp.comp_count,callback:function(e){t.$set(t.temp,"comp_count",e)},expression:"temp.comp_count"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"shard分配:",prop:"shardtotal"}},[s("span",[t._v(t._s(t.temp.shardtotal))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"缓冲池大小:",prop:"buffer_pool"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"缓冲池大小单位为MB",disabled:"detail"===t.dialogStatus},model:{value:t.temp.buffer_pool,callback:function(e){t.$set(t.temp,"buffer_pool",e)},expression:"temp.buffer_pool"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"每shard强同步备机个数:",prop:"fullsync_level"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每shard强同步备机个数",disabled:"detail"===t.dialogStatus},model:{value:t.temp.fullsync_level,callback:function(e){t.$set(t.temp,"fullsync_level",e)},expression:"temp.fullsync_level"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"shard是否退化:",prop:"conf_degrade_state"}},[s("el-radio",{attrs:{label:"ON"},model:{value:t.temp.conf_degrade_state,callback:function(e){t.$set(t.temp,"conf_degrade_state",e)},expression:"temp.conf_degrade_state"}},[t._v("是")]),s("el-radio",{attrs:{label:"OFF"},model:{value:t.temp.conf_degrade_state,callback:function(e){t.$set(t.temp,"conf_degrade_state",e)},expression:"temp.conf_degrade_state"}},[t._v("否")])],1),"ON"==t.temp.conf_degrade_state?s("el-form-item",{attrs:{label:"退化时间:",prop:"conf_degrade_time"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"退化时间范围为5-500s"},model:{value:t.temp.conf_degrade_time,callback:function(e){t.$set(t.temp,"conf_degrade_time",e)},expression:"temp.conf_degrade_time"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("s")])])],1):t._e(),s("el-form-item",{attrs:{label:"数据存储空间:",prop:"per_storage_node_data_storage_MB"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入数据存储空间"},model:{value:t.temp.per_storage_node_data_storage_MB,callback:function(e){t.$set(t.temp,"per_storage_node_data_storage_MB",e)},expression:"temp.per_storage_node_data_storage_MB"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),s("el-form-item",{attrs:{label:"日志存储空间:",prop:"per_storage_node_log_storage_MB"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入日志存储空间"},model:{value:t.temp.per_storage_node_log_storage_MB,callback:function(e){t.$set(t.temp,"per_storage_node_log_storage_MB",e)},expression:"temp.per_storage_node_log_storage_MB"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),"create"===t.dialogStatus?s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}]},[s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"计算节点账号:",prop:"computer_user"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"输入计算节点账号",disabled:"detail"===t.dialogStatus},model:{value:t.temp.computer_user,callback:function(e){t.$set(t.temp,"computer_user",e)},expression:"temp.computer_user"}})],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus === 'create' || 'detail'"}],attrs:{label:"计算节点密码:",prop:"computer_password"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"输入计算节点密码",disabled:"detail"===t.dialogStatus},model:{value:t.temp.computer_password,callback:function(e){t.$set(t.temp,"computer_password",e)},expression:"temp.computer_password"}})],1),s("el-form-item",{attrs:{label:"每个计算节点最大连接数:",prop:"max_connections"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点最大连接数"},model:{value:t.temp.max_connections,callback:function(e){t.$set(t.temp,"max_connections",e)},expression:"temp.max_connections"}})],1),s("el-form-item",{attrs:{label:"每个计算节点的cpu核数:",prop:"per_computing_node_cpu_cores"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点的cpu核数"},model:{value:t.temp.per_computing_node_cpu_cores,callback:function(e){t.$set(t.temp,"per_computing_node_cpu_cores",e)},expression:"temp.per_computing_node_cpu_cores"}})],1),s("el-form-item",{attrs:{label:"每个计算节点的cpu限制模式:",prop:"cpu_limit_mode"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.temp.cpu_limit_mode,callback:function(e){t.$set(t.temp,"cpu_limit_mode",e)},expression:"temp.cpu_limit_mode"}},t._l(t.cpuLimitMode,(function(t){return s("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"每个计算节点最大的存储值:",prop:"per_computing_node_max_mem_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点最大的存储值"},model:{value:t.temp.per_computing_node_max_mem_size,callback:function(e){t.$set(t.temp,"per_computing_node_max_mem_size",e)},expression:"temp.per_computing_node_max_mem_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),s("el-form-item",{attrs:{label:"每个存储节点的cpu核数:",prop:"per_storage_node_cpu_cores"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点的cpu核数"},model:{value:t.temp.per_storage_node_cpu_cores,callback:function(e){t.$set(t.temp,"per_storage_node_cpu_cores",e)},expression:"temp.per_storage_node_cpu_cores"}})],1),s("el-form-item",{attrs:{label:"每个存储节点rocksdb缓冲池大小:",prop:"per_storage_node_rocksdb_buffer_pool_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点rocksdb缓冲池大小"},model:{value:t.temp.per_storage_node_rocksdb_buffer_pool_size,callback:function(e){t.$set(t.temp,"per_storage_node_rocksdb_buffer_pool_size",e)},expression:"temp.per_storage_node_rocksdb_buffer_pool_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),s("el-form-item",{attrs:{label:"每个存储节点初始化存储值:",prop:"per_storage_node_initial_storage_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点初始化存储值"},model:{value:t.temp.per_storage_node_initial_storage_size,callback:function(e){t.$set(t.temp,"per_storage_node_initial_storage_size",e)},expression:"temp.per_storage_node_initial_storage_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("GB")])])],1),s("el-form-item",{attrs:{label:"每个存储节点最大存储值:",prop:"per_storage_node_max_storage_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点最大存储值"},model:{value:t.temp.per_storage_node_max_storage_size,callback:function(e){t.$set(t.temp,"per_storage_node_max_storage_size",e)},expression:"temp.per_storage_node_max_storage_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("GB")])])],1)],1):t._e(),"create"===t.dialogStatus?s("div",{class:!1===t.isShow?"ro-90":"ro90",on:{click:t.toggle}},[s("i",{staticClass:"el-icon-d-arrow-left"})]):t._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("关闭")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData(t.row)}}},[t._v(" 确认 ")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogNodeVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogNodeVisible=e}}},[s("el-form",{ref:"nodeForm",attrs:{model:t.nodetemp,rules:t.rules,"label-position":"left","label-width":"110px"}},["update"===t.dialogStatus?s("el-form-item",{attrs:{label:"集群名称:",prop:"name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.nodetemp.name,callback:function(e){t.$set(t.nodetemp,"name",e)},expression:"nodetemp.name"}})],1):t._e(),"update"===t.dialogStatus?s("el-form-item",{attrs:{label:"类型:",prop:"node_type"}},["update"===t.dialogStatus?s("el-select",{attrs:{placeholder:"请选择类型"},on:{change:t.ChangeSaler},model:{value:t.nodetemp.node_type,callback:function(e){t.$set(t.nodetemp,"node_type",e)},expression:"nodetemp.node_type"}},t._l(t.node_types,(function(t){return s("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1):t._e()],1):t._e(),"update"===t.dialogStatus?s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.nodetemp.machinelist,callback:function(e){t.$set(t.nodetemp,"machinelist",e)},expression:"nodetemp.machinelist"}},t._l(t.strogemachines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1):t._e(),"add_nodes"==t.nodetemp.node_type&&"update"===t.dialogStatus?s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},["update"===t.dialogStatus?s("el-select",{attrs:{placeholder:"请选择shard名称"},model:{value:t.nodetemp.shard_name,callback:function(e){t.$set(t.nodetemp,"shard_name",e)},expression:"nodetemp.shard_name"}},t._l(t.shardList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1):t._e()],1):t._e(),"add_shards"==t.nodetemp.node_type?s("el-form-item",{attrs:{label:"shard个数:",prop:"shards"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入shard个数",disabled:"detail"===t.dialogStatus},model:{value:t.nodetemp.shards,callback:function(e){t.$set(t.nodetemp,"shards",e)},expression:"nodetemp.shards"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1):t._e(),s("el-form-item",{attrs:{label:"节点个数:",prop:"nodes"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入节点个数",disabled:"detail"===t.dialogStatus},model:{value:t.nodetemp.nodes,callback:function(e){t.$set(t.nodetemp,"nodes",e)},expression:"nodetemp.nodes"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogNodeVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateData(t.row)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogRestoreVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogRestoreVisible=e}}},[s("el-form",{ref:"restoreForm",attrs:{model:t.restoretemp,rules:t.rules,"label-position":"left","label-width":"110px"}},["restore"===t.dialogStatus?s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-checkbox-group",{attrs:{min:t.minMachine,max:t.machineTotal},model:{value:t.restoretemp.machinelist,callback:function(e){t.$set(t.restoretemp,"machinelist",e)},expression:"restoretemp.machinelist"}},t._l(t.machines,(function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.hostaddr}},[t._v(t._s(e.hostaddr)+" ")])})),1)],1):t._e(),s("el-form-item",{attrs:{label:"原集群名称:",prop:"old_cluster_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.restoretemp.old_cluster_name,callback:function(e){t.$set(t.restoretemp,"old_cluster_name",e)},expression:"restoretemp.old_cluster_name"}})],1),s("el-form-item",{attrs:{label:"新集群名称:",prop:"nick_name"}},[s("el-input",{attrs:{placeholder:"请输入新集群名称"},model:{value:t.restoretemp.nick_name,callback:function(e){t.$set(t.restoretemp,"nick_name",e)},expression:"restoretemp.nick_name"}})],1),s("el-form-item",{attrs:{label:"回档时间:",prop:"now"}},[s("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择回档时间"},model:{value:t.restoretemp.now,callback:function(e){t.$set(t.restoretemp,"now",e)},expression:"restoretemp.now"}})],1),s("el-form-item",{attrs:{label:"最早备份时间:",prop:"end_ts"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.restoretemp.end_ts,callback:function(e){t.$set(t.restoretemp,"end_ts",e)},expression:"restoretemp.end_ts"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogRestoreVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.restoreData(t.restoretemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogRetreatedVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogRetreatedVisible=e}}},[s("el-form",{ref:"retreatedForm",attrs:{model:t.retreatedtemp,rules:t.rules,"label-position":"left","label-width":"120px"}},[s("el-form-item",{attrs:{label:"原集群名称:",prop:"old_cluster_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择原集群名称"},model:{value:t.retreatedtemp.old_cluster_id,callback:function(e){t.$set(t.retreatedtemp,"old_cluster_id",e)},expression:"retreatedtemp.old_cluster_id"}},t._l(t.oldClusterList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"回档集群名称:",prop:"nick_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.retreatedtemp.nick_name,callback:function(e){t.$set(t.retreatedtemp,"nick_name",e)},expression:"retreatedtemp.nick_name"}})],1),s("el-form-item",{attrs:{label:"回档时间:",prop:"retreated_time"}},[s("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择回档时间"},model:{value:t.retreatedtemp.retreated_time,callback:function(e){t.$set(t.retreatedtemp,"retreated_time",e)},expression:"retreatedtemp.retreated_time"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogRetreatedVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.retreatedData(t.retreatedtemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogExpandVisible,"custom-class":"single_dal_view expand","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogExpandVisible=e}}},[s("el-form",{ref:"expandForm",attrs:{model:t.expandtemp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("div",{staticClass:"icons-container"},[s("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.shardNameList,(function(e,a){return s("el-tab-pane",{key:a,attrs:{label:e.name,name:e.name,value:e.id+"_"+e.cluster_id}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.shardTable,"max-height":"240",border:"","highlight-current-row":""},on:{"selection-change":t.selectionChangeHandle}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{prop:"TABLE_SCHEMA",label:"数据库名称",align:"center"}}),s("el-table-column",{attrs:{prop:"TABLE_NAME",label:"表名称",align:"center"}})],1),s("el-form-item",{attrs:{label:"原shard:",prop:"shard_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandtemp.shard_name,callback:function(e){t.$set(t.expandtemp,"shard_name",e)},expression:"expandtemp.shard_name"}})],1),s("el-form-item",{attrs:{label:"是否保留原表:",prop:"if_save"}},[s("el-radio",{attrs:{label:"0"},model:{value:t.expandtemp.if_save,callback:function(e){t.$set(t.expandtemp,"if_save",e)},expression:"expandtemp.if_save"}},[t._v("是")]),s("el-radio",{attrs:{label:"1"},model:{value:t.expandtemp.if_save,callback:function(e){t.$set(t.expandtemp,"if_save",e)},expression:"expandtemp.if_save"}},[t._v("否")])],1),t.expandtemp.table_list.length?s("el-form-item",{attrs:{label:"已选原shard表:",prop:"table_list"}},[[s("ul",{staticClass:"infinite-list",staticStyle:{"max-height":"200px",overflow:"auto"}},t._l(t.expandtemp.table_list,(function(e,a){return s("li",{key:a,staticClass:"infinite-list-item"},[t._v(" "+t._s(e.TABLE_SCHEMA+"."+e.TABLE_NAME)+" ")])})),0)]],2):t._e(),t.expandtemp.dsc_flag?s("el-form-item",{attrs:{label:"目标shard:",prop:"dst_shard_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择目标shard"},on:{change:t.ChangeShardName},model:{value:t.expandtemp.dst_shard_id,callback:function(e){t.$set(t.expandtemp,"dst_shard_id",e)},expression:"expandtemp.dst_shard_id"}},t._l(t.shardsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e()],1)})),1)],1)]),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogExpandVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.showExpandInfo(t.expandtemp)}}},[t._v(t._s(t.expandtemp.title))])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogExpandInfoVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogExpandInfoVisible=e}}},[s("el-form",{ref:"expandInfoForm",attrs:{model:t.expandInfoTemp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("el-form-item",{attrs:{label:"原shard:",prop:"shard_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandInfoTemp.shard_name,callback:function(e){t.$set(t.expandInfoTemp,"shard_name",e)},expression:"expandInfoTemp.shard_name"}})],1),s("el-form-item",{attrs:{label:"已选原shard表:",prop:"table_list"}},[[s("ul",{staticClass:"infinite-list",staticStyle:{"max-height":"200px",overflow:"auto"}},t._l(t.expandInfoTemp.table_list,(function(e,a){return s("li",{key:a,staticClass:"infinite-list-item"},[t._v(" "+t._s(e.TABLE_SCHEMA+"."+e.TABLE_NAME)+" ")])})),0)]],2),t.expandInfoTemp.policy?s("el-form-item",{attrs:{label:"排序方式:",prop:"policy_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandInfoTemp.policy_name,callback:function(e){t.$set(t.expandInfoTemp,"policy_name",e)},expression:"expandInfoTemp.policy_name"}})],1):t._e(),s("el-form-item",{attrs:{label:"目标shard:",prop:"dst_shard_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandInfoTemp.dst_shard_name,callback:function(e){t.$set(t.expandInfoTemp,"dst_shard_name",e)},expression:"expandInfoTemp.dst_shard_name"}})],1),s("el-form-item",{attrs:{label:"是否保留原表:",prop:"if_save"}},[["0"==t.expandInfoTemp.if_save?s("span",[t._v("是")]):s("span",[t._v("否")])]],2)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:t.expandClose}},[t._v("返回")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.expandData(t.expandInfoTemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.outoExpandInfoVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.outoExpandInfoVisible=e}}},[s("el-form",{ref:"autoExpandForm",attrs:{model:t.autoexpandtemp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("el-form-item",{attrs:{label:"原shard:",prop:"auto_shard_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择原shard"},on:{change:t.autoChangeShardName},model:{value:t.autoexpandtemp.auto_shard_id,callback:function(e){t.$set(t.autoexpandtemp,"auto_shard_id",e)},expression:"autoexpandtemp.auto_shard_id"}},t._l(t.srcShardsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"排序方式:",prop:"policy"}},[s("el-select",{attrs:{placeholder:"请选择排序方式"},on:{change:t.autoChangePolicy},model:{value:t.autoexpandtemp.policy,callback:function(e){t.$set(t.autoexpandtemp,"policy",e)},expression:"autoexpandtemp.policy"}},t._l(t.policys,(function(t){return s("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,ref:"dataTable",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.autoexpandtemp.tables,"max-height":"240",border:"","highlight-current-row":""},on:{"selection-change":t.selAutoChangeHandle}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{prop:"TABLE_SCHEMA",label:"数据库名称",align:"center"}}),s("el-table-column",{attrs:{prop:"TABLE_NAME",label:"表名称",align:"center"}})],1),s("el-form-item",{attrs:{label:"已选原shard表:",prop:"table_list"}},[[s("ul",{staticClass:"infinite-list",staticStyle:{"max-height":"200px",overflow:"auto"}},t._l(t.autoexpandtemp.table_list,(function(e,a){return s("li",{key:a,staticClass:"infinite-list-item"},[t._v(" "+t._s(e.TABLE_SCHEMA+"."+e.TABLE_NAME)+" ")])})),0)]],2),s("el-form-item",{attrs:{label:"是否保留原表:",prop:"if_save"}},[s("el-radio",{attrs:{label:"0"},model:{value:t.autoexpandtemp.if_save,callback:function(e){t.$set(t.autoexpandtemp,"if_save",e)},expression:"autoexpandtemp.if_save"}},[t._v("是")]),s("el-radio",{attrs:{label:"1"},model:{value:t.autoexpandtemp.if_save,callback:function(e){t.$set(t.autoexpandtemp,"if_save",e)},expression:"autoexpandtemp.if_save"}},[t._v("否")])],1),t.autoexpandtemp.dsc_flag?s("el-form-item",{attrs:{label:"目标shard:",prop:"dst_shard_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择目标shard"},on:{change:t.autoChangeDscShardName},model:{value:t.autoexpandtemp.dst_shard_id,callback:function(e){t.$set(t.autoexpandtemp,"dst_shard_id",e)},expression:"autoexpandtemp.dst_shard_id"}},t._l(t.shardsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.outoExpandInfoVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.autoExpandInfo(t.autoexpandtemp)}}},[t._v("提交")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.expandSelectDBVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.expandSelectDBVisible=e}}},[s("el-form",{ref:"selectExpandForm",attrs:{model:t.selectdbtemp,rules:t.rules,"label-position":"left","label-width":"100px"}},[s("el-form-item",{attrs:{label:"集群ID:"}},[s("span",[t._v(t._s(t.selectdbtemp.cluster_id))])]),s("el-form-item",{attrs:{label:"选择数据库:",prop:"database"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.selectdbtemp.database,callback:function(e){t.$set(t.selectdbtemp,"database",e)},expression:"selectdbtemp.database"}},t._l(t.databases,(function(t){return s("el-option",{key:t.id,attrs:{label:t.datname,value:t.datname}})})),1)],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.expandSelectDBVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.expandTable(t.selectdbtemp)}}},[t._v("确定")])],1)],1),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeSyncDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)]),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusShowVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeDestory},on:{"update:visible":function(e){t.dialogStatusShowVisible=e}}},[s("div",{staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:t.percentage,status:t.progress_status,format:t.setText}}),s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},[t.init_show?s("el-step",{attrs:{title:t.init_title,icon:"el-icon-more"}}):t._e(),t.computer_show?s("el-step",{attrs:{title:t.computer_title,status:t.computer_state,icon:t.computer_icon,description:t.computer_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.computer_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.comp_active}},t._l(t.computer,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2):t._e(),t.shard_show?s("el-step",{attrs:{title:t.shard_title,status:t.storage_state,icon:t.shard_icon,description:t.shard_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.shard_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.shard_active}},t._l(t.shard,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(s){return t.thisDetail(e.shard_id)}}})})),1)],1)])],2):t._e(),t.finish_show?s("el-step",{attrs:{title:t.finish_title,icon:t.finish_icon,description:t.finish_description,status:t.finish_state}}):t._e()],1)],1)]),s("el-dialog",{attrs:{title:t.dialogStatus,visible:t.dialogShardInfo,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogShardInfo=e}}},[s("json-viewer",{attrs:{value:t.shardInfo}})],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogExpondInfo,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeExpandDestory},on:{"update:visible":function(e){t.dialogExpondInfo=e}}},[t.expondInit?s("span",[t._v(t._s(t.expand_init))]):t._e(),t.expondSatus?s("json-viewer",{attrs:{value:t.expondInfo}}):t._e(),t.expondResult?s("span",[t._v(t._s(t.expand_end))]):t._e()],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.statusDetailVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.statusDetailVisible=e}}},[s("div",{staticStyle:{color:"red"},domProps:{innerHTML:t._s(t.abnormal)}})])],1)}),o=[],n=s("ade3"),l=(s("ac1f"),s("00b4"),s("caad"),s("2532"),s("e9c4"),s("d81d"),s("5319"),s("ed08")),c=s("333d"),d=s("578a"),p=s("82b0"),u=s("349e"),m=s.n(u),_={name:"List",components:{Pagination:c["a"],JsonViewer:m.a},props:{comment:{type:Object}},data:function(){var t,e=this,s=function(t,e,s){e?s():s(new Error("请选择高可用模式"))},a=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("shard个数不能大于256")):s():s(new Error("shard个数只能输入数字")):s(new Error("请输入shard个数"))},i=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("只能输入数字")):s(new Error("请输入数据存储空间"))},r=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("只能输入数字")):s(new Error("请输入日志存储空间"))},o=function(t,e,s){e?/^[0-9]+$/.test(e)?e<3?s(new Error("副本数不能小于3")):e>256?s(new Error("副本数不能大于256")):s():s(new Error("副本数只能输入数字")):s(new Error("请输入副本数"))},c=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("计算节点总个数只能输入数字")):s(new Error("请输入计算节点总个数"))},p=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("缓冲池大小只能输入数字")):s(new Error("请输入缓冲池大小"))},u=function(t,s,a){var i=Object(l["d"])(),r=Object(l["c"])(i);e.restoretemp.now?e.restoretemp.now<e.restoretemp.end_ts?a(new Error("回档时间不能早于最早备份时间")):e.restoretemp.now>r?a(new Error("回档时间选择范围应在当前系统时间开始一个月之内")):a():a(new Error("请选择回档时间"))},m=function(t,e,s){var a=Object(l["d"])();e?e>a?s(new Error("回档时间不能晚于当前时间")):s():s(new Error("请选择回档时间"))},_=function(t,e,s){e?s():s(new Error("请选择类型"))},h=function(t,s,a){"add_nodes"===e.nodetemp.node_type?s?a():a(new Error("请选择shard名称")):a()},f=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("shard个数不能大于256")):s():s(new Error("shard个数只能输入数字")):s(new Error("请输入shard个数"))},g=function(t,e,s){e?s():s(new Error("请输入业务名称"))},v=function(t,s,a){s?/^[0-9]+$/.test(s)?s>=e.temp.snode_count?a(new Error("每shard中强同步备机应当个数应小于副本数")):a():a(new Error("每shard中强同步备机应当个数只能输入数字")):a(new Error("请输入每shard中强同步备机应当个数"))},b=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("节点个数不能大于256")):s():s(new Error("节点个数只能输入数字")):s(new Error("请输入节点个数"))},y=function(t,e,s){e?s():s(new Error("请选择原集群名称"))},x=function(t,e,s){e?s():s(new Error("请选择目标shard"))},w=function(t,e,s){e?s():s(new Error("请选择排序方式"))},k=function(t,e,s){e?s():s(new Error("请选择原shard"))},S=function(t,e,s){0==e.length?s(new Error("请选择需要扩容的表")):s()},j=function(t,e,s){0==e.length?s(new Error("请选择数据库")):s()},O=function(t,e,s){0==e.length?s(new Error("请输入退化时间")):/^[0-9]+$/.test(e)?e>500?s(new Error("退化时间不能大于500")):e<5?s(new Error("退化时间不能小于5")):s():s(new Error("退化时间只能输入数字"))};return t={tableKey:0,list:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,name:"",user_name:sessionStorage.getItem("login_username")},temp:{ha_mode:"enterprise"==sessionStorage.getItem("work_mode")?"rbr":"mgr",shards_count:"1",snode_count:"3",comp_count:"1",buffer_pool:"1024",max_connections:"6",per_computing_node_cpu_cores:"8",cpu_limit_mode:"quota",per_computing_node_max_mem_size:"",per_storage_node_cpu_cores:"8",per_storage_node_innodb_buffer_pool_size:"",per_storage_node_rocksdb_buffer_pool_size:"",per_storage_node_initial_storage_size:"20",per_storage_node_max_storage_size:"20",per_storage_node_data_storage_MB:"1024",per_storage_node_log_storage_MB:"1024",nick_name:"",machinelist:[],comp_machinelist:[],node_type:"",shard_name:"",shards:"",computer_user:"",computer_password:"",fullsync_level:"1",install_proxysql:"0",conf_degrade_state:"OFF",conf_degrade_time:"25"},restoretemp:{old_cluster_name:"",now:"",end_ts:"",machinelist:[],backup_cluster_name:"",nick_name:""},retreatedtemp:{old_cluster_name:"",retreated_time:"",nick_name:"",old_cluster_id:"",new_cluster_id:""},expandtemp:{shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],dst_shard_id:"",dst_shard_name:"",title:"自动扩容",dsc_flag:!1,if_save:"0"},autoexpandtemp:{shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],policy:"",auto_shard_id:"",tables:[],policy_name:"",dst_shard_id:"",dst_shard_name:"",dsc_flag:!1,if_save:"0"},expandInfoTemp:{shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],dst_shard_id:"",dst_shard_name:"",policy:"",policy_name:""},nodetemp:{machinelist:[],node_type:"",shard_name:"",shards:"",name:"",nick_name:"",nodes:""},dialogFormVisible:!1,dialogRestoreVisible:!1,dialogRetreatedVisible:!1,dialogNodeVisible:!1,dialogStatusVisible:!1,dialogExpandVisible:!1,dialogExpandInfoVisible:!1,dialogExpondInfo:!1,expondSatus:!0,expondResult:!1,dialogStatus:"",textMap:{update:"添加",create:"新增集群",detail:"详情",restore:"恢复集群",retreated:"回档集群",expand:"集群扩容",expandInfo:"集群扩容确认信息",outoExpand:"自动扩容",statusDetail:"异常详情"},dialogDetail:!1,message_tips:"",message_type:"",user_add_priv:"",user_drop_priv:"",user_edit_priv:"",row:{},hamodeData:"enterprise"==sessionStorage.getItem("work_mode")?d["g"]:d["c"],cpuLimitMode:d["e"],shardsDate:d["q"],norepshardsDate:d["l"],pershardDate:d["m"],isShow:!1,machinelist:[],machines:[],minMachine:0,machineTotal:0,comp_machines:[],comp_minMachine:0,comp_machineTotal:0,node_types:"enterprise"==sessionStorage.getItem("work_mode")?d["k"]:d["d"],shardList:[],backup_priv:JSON.parse(sessionStorage.getItem("priv")).backup_priv,restore_priv:JSON.parse(sessionStorage.getItem("priv")).restore_priv,cluster_creata_priv:JSON.parse(sessionStorage.getItem("priv")).cluster_creata_priv,cluster_drop_priv:JSON.parse(sessionStorage.getItem("priv")).cluster_drop_priv,shard_create_priv:JSON.parse(sessionStorage.getItem("priv")).shard_create_priv,storage_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_create_priv,compute_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_create_priv,expand_cluster_priv:JSON.parse(sessionStorage.getItem("priv")).expand_cluster_priv,timer:null,installStatus:!1,info:"",activities:[],dialogStatusShowVisible:!1,active:0,computer:[],shard:[],computer_state:"",storage_state:"",finish_state:"",computer_title:"",computer_icon:"",shard_icon:"",shard_title:"",comp_active:0,shard_active:0,strogemachines:[],init_title:"",init_show:!0,finish_show:!1,computer_show:!0,shard_show:!0,init_active:0,finish_title:"",finish_icon:"",finish_description:"",computer_description:"",shard_description:"",shardInfo:"",dialogShardInfo:!1,job_id:"",oldClusterList:[],shardNameList:[],activeName:"",shardTable:[],shardsList:[],srcShardsList:[],expondInfo:""},Object(n["a"])(t,"expondSatus",!0),Object(n["a"])(t,"expand_init",""),Object(n["a"])(t,"expand_end",""),Object(n["a"])(t,"expondInit",!0),Object(n["a"])(t,"expondResult",!1),Object(n["a"])(t,"outoExpandInfoVisible",!1),Object(n["a"])(t,"policys",d["n"]),Object(n["a"])(t,"editableTabs",[]),Object(n["a"])(t,"colData",[{title:"集群ID",istrue:!0},{title:"业务名称",istrue:!0},{title:"状态",istrue:!0},{title:"计算节点",istrue:!0},{title:"shard分配",istrue:!0},{title:"最近备份时间",istrue:!1},{title:"高可用模式",istrue:!1},{title:"集群名称",istrue:!1}]),Object(n["a"])(t,"checkBoxGroup",[]),Object(n["a"])(t,"checkedColumns",["集群ID","业务名称","状态","计算节点","shard分配"]),Object(n["a"])(t,"statusDetailVisible",!1),Object(n["a"])(t,"abnormal",""),Object(n["a"])(t,"databases",[]),Object(n["a"])(t,"selectdbtemp",{database:"",cluster_id:"",ip:"",port:"",name:""}),Object(n["a"])(t,"expandSelectDBVisible",!1),Object(n["a"])(t,"expandTableList",null),Object(n["a"])(t,"createTypes","local"),Object(n["a"])(t,"distribution_type",[{label:"同城购买",value:"same_city"},{label:"跨城购买",value:"cross_city"}]),Object(n["a"])(t,"distribution_value","same_city"),Object(n["a"])(t,"data_center_city",[{name:"guangdong",label:"guangdong",value:"guangdong",children:[{name:"guangzhou",label:"guangzhou",value:"guangzhou"},{name:"shenzhen",label:"shenzhen",value:"shenzhen"}]}]),Object(n["a"])(t,"data_center_nodes",[]),Object(n["a"])(t,"data_center_comps",[]),Object(n["a"])(t,"percentage",0),Object(n["a"])(t,"progress_status",null),Object(n["a"])(t,"progress_format",""),Object(n["a"])(t,"user_name",sessionStorage.getItem("login_username")),Object(n["a"])(t,"rules",{ha_mode:[{required:!0,trigger:"blur",validator:s}],shards_count:[{required:!0,trigger:"blur",validator:a}],install_proxysql:[{required:!0,trigger:"blur",message:"是否安装proxysql必选"}],conf_degrade_state:[{required:!0,trigger:"blur",message:"shard是否退化必选"}],conf_degrade_time:[{required:!0,trigger:"blur",validator:O}],snode_count:[{required:!0,trigger:"blur",validator:o}],comp_count:[{required:!0,trigger:"blur",validator:c}],buffer_pool:[{required:!0,trigger:"blur",validator:p}],now:[{required:!0,trigger:"blur",validator:u}],node_type:[{required:!0,trigger:"blur",validator:_}],shard_name:[{required:!0,trigger:"blur",validator:h}],shards:[{required:!0,trigger:"blur",validator:f}],nodes:[{required:!0,trigger:"blur",validator:b}],nick_name:[{required:!0,trigger:"blur",validator:g}],fullsync_level:[{required:!0,trigger:"blur",validator:v}],per_storage_node_data_storage_MB:[{required:!0,trigger:"blur",validator:i}],per_storage_node_log_storage_MB:[{required:!0,trigger:"blur",validator:r}],retreated_time:[{required:!0,trigger:"blur",validator:m}],old_cluster_id:[{required:!0,trigger:"blur",validator:y}],dst_shard_id:[{required:!0,trigger:"blur",validator:x}],policy:[{required:!0,trigger:"blur",validator:w}],auto_shard_id:[{required:!0,trigger:"blur",validator:k}],table_list:[{required:!0,trigger:"blur",validator:S}],database:[{required:!0,trigger:"blur",validator:j}]}),t},watch:{"expandtemp.table_list":{handler:function(t){t.length>0?(this.expandtemp.dsc_flag=!0,this.expandtemp.title="提交"):(this.expandtemp.dsc_flag=!1,this.expandtemp.title="自动扩容",this.expandtemp.shard_name="")}},"autoexpandtemp.table_list":{handler:function(t){t.length>0?this.autoexpandtemp.dsc_flag=!0:this.autoexpandtemp.dsc_flag=!1}},checkedColumns:function(t){var e=this.checkBoxGroup.filter((function(e){return!t.includes(e)}));localStorage.setItem(this.colTable,JSON.stringify(e)),this.colData.filter((function(t){-1!=e.indexOf(t.title)?t.istrue=!1:t.istrue=!0}))}},created:function(){var t=this;console.log("production"),this.getList(),this.getDataCents(),this.colData.forEach((function(e){t.checkBoxGroup.push(e.title)})),this.checkedColumns=this.checkedColumns;var e=localStorage.getItem(this.colTable);e=JSON.parse(e),null!=e&&(this.checkedColumns=this.checkedColumns.filter((function(t){return!e.includes(t)})))},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{setText:function(t){return this.progress_format+t+"%"},installProxySqlChange:function(t){"1"===t&&(this.temp.shards_count=1)},expandTable:function(t){var e=this;this.$refs["selectExpandForm"].validate((function(s){if(s){var a={database:t.database,ip:t.ip,port:t.port,name:t.name};Object(p["G"])(a).then((function(s){if(200==s.code){var a=s.list.arr;if(a.length>0)for(var i=0;i<a.length;i++){var r=a[i];e.$set(r,"nspname",t.database+"_$$_"+r.nspname)}var o=a.map((function(t){return{TABLE_SCHEMA:t.nspname,TABLE_NAME:t.relname,relshardid:t.relshardid}}));e.expandTableList=o,e.shardTable=o.filter((function(t){return t.relshardid==e.expandtemp.list.shard_id})),e.dialogExpandVisible=!0,e.expandSelectDBVisible=!1}else e.message_tips=s.message,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},statusDetail:function(t){this.dialogStatus="statusDetail",this.statusDetailVisible=!0;for(var e="",s=t.abnormal.substring(0,t.abnormal.length-1).split(";"),a=0;a<s.length;a++)e+="<div>"+s[a]+"</div>";this.abnormal=e},beforeSyncDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},beforeExpandDestory:function(){clearInterval(this.timer),this.dialogExpondInfo=!1,this.timer=null},autoChangeDscShardName:function(t){for(var e=0;e<this.shardsList.length;e++)this.shardsList[e].id==t&&(this.autoexpandtemp.dst_shard_name=this.shardsList[e].name)},selAutoChangeHandle:function(t){this.autoexpandtemp.table_list=t},autoChangeShardName:function(t){for(var e=this,s=0;s<this.srcShardsList.length;s++)this.srcShardsList[s].id==t&&(this.autoexpandtemp.shard_name=this.srcShardsList[s].name,this.autoexpandtemp.list.shard_id=this.srcShardsList[s].id,this.autoexpandtemp.list.shard_name=this.srcShardsList[s].name);if(this.autoexpandtemp.shard_name){this.shardsList=[];var a={cluster_id:this.autoexpandtemp.list.cluster_id,shard_id:this.autoexpandtemp.list.shard_id};Object(p["ab"])(a).then((function(t){e.shardsList=t.list}))}var i={job_id:""};i.version=d["u"][0].ver,i.user_name=sessionStorage.getItem("login_username"),i.job_type="get_expand_table_list",i.timestamp=d["s"][0].time+"";var r={};r.cluster_id=this.autoexpandtemp.list.cluster_id,r.shard_id=t,r.policy=this.autoexpandtemp.policy,r.compute_ip=this.selectdbtemp.ip,r.compute_port=this.selectdbtemp.port,r.compute_database=this.selectdbtemp.database,i.paras=r,this.autoexpandtemp.policy&&(this.autoexpandtemp.tables=[],Object(p["O"])(i).then((function(t){if("0"==t.error_code)if(""!==t.attachment.table_list){for(var s=t.attachment.table_list.split(","),a=[],i=0;i<s.length;i++){var r=s[i].split("."),o={TABLE_SCHEMA:r[1],TABLE_NAME:r[2]};a.push(o)}e.autoexpandtemp.tables=a,e.autoexpandtemp.tables&&e.$nextTick((function(){e.autoexpandtemp.tables.forEach((function(t){e.$refs.dataTable.toggleAllSelection(t,!0)}))}))}else e.autoexpandtemp.tables=!1;else e.message_tips=t.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})))},autoChangePolicy:function(t){for(var e=this,s=0;s<this.policys.length;s++)this.policys[s].id==t&&(this.autoexpandtemp.policy_name=this.policys[s].label,this.autoexpandtemp.list.policy=this.policys[s].id);var a={job_id:""};a.version=d["u"][0].ver,a.user_name=sessionStorage.getItem("login_username"),a.job_type="get_expand_table_list",a.timestamp=d["s"][0].time+"";var i={};i.cluster_id=this.autoexpandtemp.list.cluster_id,i.shard_id=this.autoexpandtemp.auto_shard_id,i.policy=t,i.compute_ip=this.selectdbtemp.ip,i.compute_port=this.selectdbtemp.port,i.compute_database=this.selectdbtemp.database,a.paras=i,this.autoexpandtemp.auto_shard_id&&(this.autoexpandtemp.tables=[],Object(p["O"])(a).then((function(t){if("0"==t.error_code)if(""!==t.attachment.table_list){for(var s=t.attachment.table_list.split(","),a=[],i=0;i<s.length;i++){var r=s[i].split("."),o={TABLE_SCHEMA:r[1],TABLE_NAME:r[2]};a.push(o)}e.autoexpandtemp.tables=a,e.autoexpandtemp.tables&&e.$nextTick((function(){e.autoexpandtemp.tables.forEach((function(t){e.$refs.dataTable.toggleAllSelection(t,!0)}))}))}else e.autoexpandtemp.tables=!1;else e.message_tips=t.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})))},ChangeShardName:function(t){for(var e=0;e<this.shardsList.length;e++)this.shardsList[e].id==t&&(this.expandtemp.dst_shard_name=this.shardsList[e].name)},selectionChangeHandle:function(t){var e=this;if(this.expandtemp.shard_name=this.expandtemp.list.shard_name,this.expandtemp.table_list=t,this.expandtemp.shard_name){var s={cluster_id:this.expandtemp.list.cluster_id,shard_id:this.expandtemp.list.shard_id};Object(p["ab"])(s).then((function(t){e.shardsList=t.list})),this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))}},handleClick:function(t){var e=this;if(t.$attrs.value){var s=t.$attrs.value.split("_");if(this.expandtemp.list.cluster_id=s[1],this.expandtemp.list.shard_id=s[0],this.expandtemp.list.shard_name=t.name,this.expandtemp.dst_shard_id="",this.shardTable=[],this.shardTable=this.expandTableList.filter((function(t){return t.relshardid==e.expandtemp.list.shard_id})),this.expandtemp.shard_name){this.shardsList=[];var a={cluster_id:this.expandtemp.list.cluster_id,shard_id:this.expandtemp.list.shard_id};Object(p["ab"])(a).then((function(t){e.shardsList=t.list})),this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))}}},beforeDestory:function(){clearInterval(this.timer),this.dialogStatusShowVisible=!1},thisDetail:function(t){var e=this,s={id:t};Object(p["gb"])(s).then((function(s){e.dialogStatus="shard_"+t+"详细信息",e.dialogShardInfo=!0,e.shardInfo=s.shard_nodes}))},handleStatus:function(){this.dialogStatusShowVisible=!0},ChangeSaler:function(t){var e=this;"add_shards"==t?(Object(p["jb"])().then((function(t){e.strogemachines=[],e.strogemachines=t.list})),this.nodetemp.nodes="3",this.nodetemp.shards="1"):"add_nodes"==t?(Object(p["jb"])().then((function(t){e.strogemachines=[],e.strogemachines=t.list})),this.nodetemp.nodes="1"):"add_comps"==t&&(Object(p["H"])().then((function(t){e.strogemachines=[],e.strogemachines=t.list})),this.nodetemp.nodes="1")},toggle:function(){this.isShow=!this.isShow},handleFilter:function(){this.listQuery.pageNo=1,this.listQuery.user_name=sessionStorage.getItem("login_username"),this.getList()},handleClear:function(){this.listQuery.name="",this.listQuery.pageNo=1,this.listQuery.user_name=sessionStorage.getItem("login_username"),this.getList()},getDataCents:function(){var t=this;Object(p["J"])({}).then((function(e){t.data_center_nodes=[],t.data_center_comps=[],t.data_center_nodes=e.list.res,t.data_center_comps=e.list.res}))},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);e.effectCluster=sessionStorage.getItem("affected_clusters"),e.apply_all_cluster=sessionStorage.getItem("apply_all_cluster"),Object(p["C"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},resetTemp:function(){this.temp={ha_mode:"enterprise"==sessionStorage.getItem("work_mode")?"rbr":"mgr",shards_count:"1",install_proxysql:"0",snode_count:"3",comp_count:"1",buffer_pool:"1024",max_connections:"6",per_computing_node_cpu_cores:"8",cpu_limit_mode:"quota",per_computing_node_max_mem_size:"",per_storage_node_cpu_cores:"8",per_storage_node_innodb_buffer_pool_size:"",per_storage_node_rocksdb_buffer_pool_size:"",per_storage_node_initial_storage_size:"20",per_storage_node_max_storage_size:"20",per_storage_node_data_storage_MB:"1024",per_storage_node_log_storage_MB:"1024",nick_name:"",machinelist:[],comp_machinelist:[],node_type:"",shard_name:"",shards:"",computer_user:"",computer_password:"",fullsync_level:"1",conf_degrade_state:"OFF",conf_degrade_time:"25"}},autoExpandTemp:function(){this.autoexpandtemp={shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],policy:"",auto_shard_id:"",tables:[],policy_name:"",dst_shard_id:"",dst_shard_name:"",dsc_flag:!1,if_save:"0"}},resetNodeTemp:function(){this.nodetemp={machinelist:[],node_type:"",shard_name:"",shards:"",name:"",nick_name:"",nodes:""}},resetSelectDBTemp:function(){this.selectdbtemp={database:"",cluster_id:"",ip:"",port:"",name:""}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",Object(p["jb"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total;var s=!1,a=!1,i=null===t.machines||0===t.machines.length||!1===t.machines;i?Object(l["g"])("请先添加计算机再新增集群!","error"):(s=!0,Object(p["H"])().then((function(e){t.comp_machines=e.list,t.comp_minMachine=0,t.comp_machineTotal=e.total,i=null===t.comp_machines||0===t.comp_machines.length||!1===t.comp_machines,i?Object(l["g"])("请先添加计算机再新增集群!","error"):(a=!0,!0===s&&!0===a?(t.dialogFormVisible=!0,t.dialogDetail=!1):(t.dialogFormVisible=!1,t.dialogDetail=!1))})))}))},createData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var s=Object.assign({},t.temp),a=[],i=[],r={},o={};if(r.user_name=sessionStorage.getItem("login_username"),r.job_id="",r.version=d["u"][0].ver,r.timestamp=d["s"][0].time+"",r.job_type="create_cluster",o.comps=s.comp_count+"",o.shards=s.shards_count+"",o.nodes=s.snode_count,o.innodb_size=s.buffer_pool,o.install_proxysql=s.install_proxysql,o.cpu_limit_mode=s.cpu_limit_mode,o.ha_mode=s.ha_mode,o.nick_name=s.nick_name,o.fullsync_level=s.fullsync_level,o.data_storage_MB=s.per_storage_node_data_storage_MB,o.log_storage_MB=s.per_storage_node_log_storage_MB,o.conf_degrade_state=s.conf_degrade_state,o.conf_degrade_time=s.conf_degrade_time,"ON"==s.conf_degrade_state&&(s.conf_degrade_time="0"),s.per_storage_node_max_storage_size&&(o.max_storage_size=s.per_storage_node_max_storage_size),s.max_connections&&(o.max_connections=s.max_connections),s.per_computing_node_cpu_cores&&(o.cpu_cores=s.per_computing_node_cpu_cores),"datacenters"==t.createTypes){console.log(t.$refs.data_center_nodes.selection),console.log(t.$refs.data_center_comps.selection);var n=t.$refs.data_center_nodes.selection,c=t.$refs.data_center_comps.selection;if(0==c.length)return t.message_tips="选择计算节点",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type),!1;if(0==n.length)return t.message_tips="选择计算节点",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type),!1;if(n.length!=c.length)return t.message_tips="计算节点的数量和存储节点数量不一致",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type),!1;var u=null;if(n.forEach((function(t){t.master&&(u={idc:t.name,node_num:"1"})})),"same_city"==t.distribution_value)if(null!=u){var m={distribution_type:"same_city",master_idc:u,slave_idc:[]};n.forEach((function(t){t.master||m.slave_idc.push({idc:t.name,node_num:"2"})})),o.node_distribution=m}else{var _={distribution_type:"same_city",idcs:[]};n.forEach((function(t){_.idcs.push({idc:t.name,node_num:t.node_num+""})})),o.node_distribution=_}else if(null!=u);else;var h=[];c.forEach((function(t){h.push({idc:t.name,node_num:t.node_num+""})})),o.comp_distribution=h}else s.machinelist.forEach((function(t){a.push(t)})),s.comp_machinelist.forEach((function(t){i.push(t)})),a.length>0&&(o.storage_iplists=a),i.length>0&&(o.computer_iplists=i);s.computer_user&&(o.computer_user=s.computer_user),s.computer_password&&(o.computer_password=s.computer_password),o.dbcfg="0",r.paras=o,Object(p["m"])(r).then((function(e){var s=e;if("accept"==s.status){t.dialogFormVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null;var a="新增";t.init_show=!0,t.finish_show=!1,t.finish_state="",t.percentage=0,t.progress_status=null,t.progress_format="";var i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},handleDetail:function(t){this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},t),this.dialogDetail=!0},handleUpdate:function(t){var e=this;this.resetNodeTemp(),this.temp=Object.assign({},t),this.nodetemp.nick_name=this.temp.nick_name,this.nodetemp.name=this.temp.name,this.nodetemp.id=this.temp.id,this.dialogStatus="update",this.dialogNodeVisible=!0,this.dialogDetail=!1,Object(p["eb"])(t.id).then((function(t){var s=t;200==s.code&&(e.shardList=s.list)})),this.$nextTick((function(){e.$refs["nodeForm"].clearValidate()}))},updateData:function(){var t=this;this.$refs["nodeForm"].validate((function(e){if(e){var s=Object.assign({},t.nodetemp),a=[];s.machinelist.forEach((function(t){a.push(t)})),s.job_id="",s.version=d["u"][0].ver,s.user_name=sessionStorage.getItem("login_username"),s.job_type=s.node_type,s.timestamp=d["s"][0].time+"";var i={};i.cluster_id=s.id,i.nick_name=s.nick_name,t.$delete(s,"node_type"),t.$delete(s,"name"),t.$delete(s,"nick_name"),t.$delete(s,"machinelist"),"add_shards"==s.job_type?(i.shards=s.shards,i.nodes=s.nodes,a.length>0&&(i.storage_iplists=a),t.$delete(s,"shard_name"),t.$delete(s,"shards"),t.$delete(s,"nodes"),t.$delete(s,"id"),s.paras=i,Object(p["f"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0,t.finish_show=!1,t.finish_state="";var a="添加shard";t.percentage=0,t.progress_status=null,t.progress_format="";var i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))):"add_comps"==s.job_type?(i.comps=s.nodes,a.length>0&&(i.computer_iplists=a),s.paras=i,t.$delete(s,"shards"),t.$delete(s,"shard_name"),t.$delete(s,"nodes"),t.$delete(s,"id"),Object(p["c"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0,t.finish_show=!1,t.finish_state="";var a="添加计算节点";t.percentage=0,t.progress_status=null,t.progress_format="";var i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))):"add_nodes"==s.job_type&&(i.nodes=s.nodes,i.shard_id=s.shard_name,a.length>0&&(i.storage_iplists=a),s.paras=i,t.$delete(s,"shards"),t.$delete(s,"shard_name"),t.$delete(s,"nodes"),t.$delete(s,"id"),Object(p["e"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0,t.finish_show=!1,t.finish_state="";var a="添加存储节点";t.percentage=0,t.progress_status=null,t.progress_format="";var i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))})))}}))},handleDelete:function(t){var e=this,s=Object(l["a"])(),a="此操作将永久删除该数据, 是否继续?code="+s;Object(l["e"])(a).then((function(a){if(a.value)if(a.value==s){var i=sessionStorage.getItem("apply_all_cluster");if(2==i){var r={};r.effectCluster=sessionStorage.getItem("affected_clusters"),r.cluster_name=t.name,r.username=sessionStorage.getItem("login_username"),r.type="del",Object(p["Eb"])(r).then((function(t){var s=t;200==s.code&&(e.dialogFormVisible=!1,sessionStorage.setItem("affected_clusters",s.effectCluster))}))}var o={};o.user_name=sessionStorage.getItem("login_username"),o.job_id="",o.version=d["u"][0].ver,o.job_type="delete_cluster",o.timestamp=d["s"][0].time+"",o.paras={cluster_id:t.id,nick_name:t.nick_name},Object(p["n"])(o).then((function(t){var s=t;if("accept"==s.status){e.dialogFormVisible=!1,e.dialogStatusShowVisible=!0,e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null,e.shard_show=!0,e.finish_show=!1,e.computer_show=!0,e.finish_state="";var a="删除";e.init_show=!0,e.percentage=0,e.progress_status=null,e.progress_format="";var i=0;e.getFStatus(e.timer,s.job_id,i++,a),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))},handleBackUp:function(t){var e=this;Object(l["f"])("确定要对集群"+t.nick_name+"进行全量备份么?").then((function(){var s=Object.assign({},t),a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.paras={cluster_id:s.id,nick_name:s.nick_name},a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"",a.job_type="manual_backup_cluster",Object(p["h"])(a).then((function(t){var s=t;"accept"==s.status?(e.dialogFormVisible=!1,e.message_tips="全量备份下发成功",e.message_type="success",Object(l["g"])(e.message_tips,e.message_type)):"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))})).catch((function(){Object(l["g"])("已取消全量备份","info")}))},handleSelectionChange:function(t){console.log(t)},handleRestore:function(t){var e=this;this.restoretempDate=Object.assign({},t),this.dialogStatus="restore",this.dialogFormVisible=!1,this.dialogDetail=!1,Object(p["pb"])(t.id).then((function(s){var a=s;200==a.code?(e.dialogRestoreVisible=!0,e.restoretemp.end_ts=s.list[0].end_ts,e.restoretemp.old_cluster_name=t.nick_name,e.restoretemp.backup_cluster_name=t.name,e.restoretemp.now=Object(l["d"])(),Object(p["w"])().then((function(t){e.machines=t.list,e.minMachine=0,e.machineTotal=t.total}))):(e.message_tips=a.message,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))})),this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))},restoreData:function(){var t=this;this.$refs["restoreForm"].validate((function(e){if(e){var s=Object.assign({},t.restoretemp),a=[];s.machinelist.forEach((function(t){var e={hostaddr:t};a.push(e)}));var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.version=d["u"][0].ver,i.job_type="restore_new_cluster",i.timestamp=d["s"][0].time+"";var r={};r.nick_name=s.nick_name,r.backup_cluster_name=s.backup_cluster_name,r.timestamp=s.now,r.machinelist=a,i.paras=r,Object(p["tb"])(i).then((function(e){var s=e;if("accept"==s.status){t.dialogRestoreVisible=!1,t.dialogStatusVisible=!0,t.activities=[];var a={content:"正在恢复集群...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(a);var i=0;t.timer=setInterval((function(){t.getStatus(t.timer,s.job_id,i++)}),1e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},handleRetreated:function(t){var e=this;this.dialogStatus="retreated",this.dialogFormVisible=!1,this.dialogDetail=!1,this.dialogRetreatedVisible=!0,this.retreatedtemp.old_cluster_id="",this.retreatedtemp.retreated_time="",this.retreatedtemp.nick_name=t.name,this.retreatedtemp.old_cluster_id=this.retreatedtemp.old_cluster_id,this.retreatedtemp.new_cluster_id=t.id;var s={cluster_id:t.id};Object(p["Y"])(s).then((function(t){e.oldClusterList=t.list})),this.$nextTick((function(){e.$refs["retreatedForm"]&&e.$refs["retreatedForm"].clearValidate()}))},retreatedData:function(){var t=this;this.$refs["retreatedForm"].validate((function(e){if(e){var s=Object.assign({},t.retreatedtemp),a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.version=d["u"][0].ver,a.job_type="cluster_restore",a.timestamp=d["s"][0].time+"";var i={};i.src_cluster_id=s.old_cluster_id,i.dst_cluster_id=s.new_cluster_id,i.restore_time=s.retreated_time,a.paras=i,Object(l["f"])(s.nick_name+"集群的数据将被覆盖，确定要进行回档操作么?").then((function(){Object(p["tb"])(a).then((function(e){var s=e;if("accept"==s.status){t.dialogRetreatedVisible=!1,t.dialogStatusVisible=!0,t.activities=[];var a={content:"正在回档集群...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(a);var i=0;t.timer=null,t.timer=setInterval((function(){t.getStatus(t.timer,s.job_id,i++)}),1e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))})).catch((function(){Object(l["g"])("已取消回档","info")}))}}))},handleSwitchOver:function(t){this.$router.push({path:"/cluster/switchover",query:{id:t.id}})},handleSetUp:function(t){console.log(t),"delcluster"==this.comment.active&&this.handleClear(),this.editableTabs=this.comment.editableTabs;var e=t.id+"",s=this.editableTabs;if(s.length>0){var a=!1;s.forEach((function(t){t.name===e&&(a=!0)})),a||this.editableTabs.push({title:t.id+"集群设置",name:e})}else this.editableTabs.push({title:t.id+"集群设置",name:e});var i={list:t,activeName:"four",tab:this.editableTabs};this.$emit("updateActiveName",i)},handleExpand:function(t){var e=this;this.resetSelectDBTemp(),this.databases=[],this.dialogStatus="expand",this.dialogFormVisible=!1,this.dialogDetail=!1,this.expandtemp.list.cluster_id=t.id;var s={id:t.id};Object(p["hb"])(s).then((function(a){a.list.length<2?(e.message_tips="集群扩容必须在同一集群不同shard下操作！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(Object(p["F"])(s).then((function(s){200==s.code?(e.databases=s.list,e.expandSelectDBVisible=!0,e.selectdbtemp.cluster_id=t.id,e.selectdbtemp.ip=s.ip,e.selectdbtemp.port=s.port,e.selectdbtemp.name=s.name):(e.message_tips=s.message,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))})),e.shardNameList=a.list,e.activeName=a.list[0].name,e.expandtemp.list.shard_id=a.list[0].id,e.expandtemp.list.shard_name=a.list[0].name)}))},showExpandInfo:function(t){var e=this;if("自动扩容"==this.expandtemp.title){this.autoExpandTemp(),this.dialogExpandVisible=!1,this.dialogDetail=!1,this.dialogStatus="outoExpand",this.dialogExpandInfoVisible=!1,this.expandSelectDBVisible=!1,this.outoExpandInfoVisible=!0,this.autoexpandtemp.list.cluster_id=t.list.cluster_id;var s={id:t.list.cluster_id};Object(p["hb"])(s).then((function(t){t.list.length<2?(e.message_tips="集群扩容必须在同一集群不同shard下操作！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):e.srcShardsList=t.list}))}else this.$refs["expandForm"].validate((function(s){s&&(e.dialogExpandVisible=!1,e.dialogDetail=!1,e.dialogStatus="expandInfo",e.dialogExpandInfoVisible=!0,e.expandSelectDBVisible=!1,e.expandInfoTemp.shard_name=t.shard_name,e.expandInfoTemp.list=t.list,e.expandInfoTemp.table_list=t.table_list,e.expandInfoTemp.dst_shard_id=t.dst_shard_id,e.expandInfoTemp.dst_shard_name=t.dst_shard_name,e.expandInfoTemp.if_save=t.if_save)}))},expandClose:function(){this.dialogStatus="expand",this.dialogExpandVisible=!0,this.dialogExpandInfoVisible=!1,this.expandSelectDBVisible=!1},autoExpandInfo:function(t){var e=this;this.$refs["autoExpandForm"].validate((function(s){s&&(e.dialogStatus="expandInfo",e.outoExpandInfoVisible=!1,e.dialogExpandInfoVisible=!0,e.expandSelectDBVisible=!1,e.expandInfoTemp.shard_name=t.shard_name,e.expandInfoTemp.table_list=t.table_list,e.expandInfoTemp.list=t.list,e.expandInfoTemp.policy=t.policy,e.expandInfoTemp.policy_name=t.policy_name,e.expandInfoTemp.dst_shard_id=t.dst_shard_id,e.expandInfoTemp.dst_shard_name=t.dst_shard_name,e.expandInfoTemp.if_save=t.if_save)}))},expandData:function(t){for(var e=this,s=[],a=0;a<t.table_list.length;a++){var i=t.table_list[a].TABLE_SCHEMA.replace("_$$_",".")+"."+t.table_list[a].TABLE_NAME;s.push(i)}var r={};r.user_name=sessionStorage.getItem("login_username"),r.job_id="",r.version=d["u"][0].ver,r.job_type="expand_cluster",r.timestamp=d["s"][0].time+"";var o={};o.cluster_id=t.list.cluster_id,o.src_shard_id=t.list.shard_id,o.table_list=s,o.dst_shard_id=t.dst_shard_id,o.drop_old_table=t.if_save,t.policy&&(o.policy=t.policy),r.paras=o,Object(p["v"])(r).then((function(t){var s=t;if("accept"==s.status){e.dialogExpondInfo=!0,e.dialogExpandVisible=!1,e.dialogExpandInfoVisible=!1,e.expandSelectDBVisible=!1,e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null,e.expondSatus=!1,e.expondResult=!1,e.expondInit=!0,e.expand_init="",e.expand_end="",e.expondInfo=[],e.finish_show=!1,e.finish_state="";var a="扩容",i=0;e.getFStatus(e.timer,s.job_id,i++,a),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,i++,a)}),2e3)}else"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))},getFStatus:function(t,e,s,a){var i=this;setTimeout((function(){var r={job_type:"get_status"};r.version=d["u"][0].ver,r.job_id=e,r.timestamp=d["s"][0].time+"",r.paras={},i.job_id="任务ID:"+e,Object(p["N"])(r).then((function(e){if("新增"==a||"删除"==a){var r="";if(r="新增"==a?"安装":"删除",null!==e.attachment){var o=e.attachment.job_steps.split(",");if("ongoing"==e.attachment.computer_state)i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+o[1];else if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+o[1]+"成功",i.computer.length>0){for(var n=0;n<e.attachment.computer_step.length;n++)if("done"==e.attachment.computer_step[n].computer_state)for(var l=0;l<i.computer.length;l++)for(var c=e.attachment.computer_step[n].computer_hosts.substr(0,e.attachment.computer_step[n].computer_hosts.length-1),d=c.split(";"),u=0;u<d.length;u++)i.computer[l].title==d[u]&&(i.computer[l].icon="el-icon-circle-check",i.computer[l].status="success")}else if(i.shard.length>0)for(var m=0;m<i.shard.length;m++)if(e.attachment.hasOwnProperty("shard_step")){for(var _=0;_<e.attachment.shard_step.length;_++)if("新增"==a)for(var h=e.attachment.shard_step[_].shard_ids,f=0;f<h.length;f++)for(var g in h[f]){var v=h[f][g];i.shard[m].shard_id,i.shard[m].icon="el-icon-circle-check",i.shard[m].status="success"}else if("删除"==a)for(var y=e.attachment.shard_step[_].storage_hosts.substr(0,e.attachment.shard_step[_].storage_hosts.length-1),x=y.split(","),w=0;w<x.length;w++)i.shard[m].shard_id==x[w]&&(i.shard[m].icon="el-icon-circle-check",i.shard[m].status="success")}else i.shard[m].icon="el-icon-circle-check",i.shard[m].status="success"}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+o[1]+"失败",i.computer.length>0)for(var k=0;k<e.attachment.computer_step.length;k++)if("failed"==e.attachment.computer_step[k].computer_state){for(var S=0;S<i.computer.length;S++)for(var j=e.attachment.computer_step[k].computer_hosts.substr(0,e.attachment.computer_step[k].computer_hosts.length-1),O=j.split(";"),L=0;L<O.length;L++)i.computer[S].title==O[L]&&(i.computer[S].icon="el-icon-circle-close",i.computer[S].status="error");i.computer_description=e.attachment.computer_step[k].error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+o[1];if("ongoing"==e.attachment.storage_state)i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+o[0];else if("done"==e.attachment.storage_state){if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+o[0]+"成功",i.shard.length>0)for(var I=0;I<i.shard.length;I++)if(e.attachment.hasOwnProperty("shard_step")){for(var C=0;C<e.attachment.shard_step.length;C++)if("新增"==a)for(var $=e.attachment.shard_step[C].shard_ids,N=0;N<$.length;N++)for(var g in $[N]){v=$[N][g];i.shard[I].shard_id,i.shard[I].icon="el-icon-circle-check",i.shard[I].status="success"}else if("删除"==a)for(var V=e.attachment.shard_step[C].storage_hosts.substr(0,e.attachment.shard_step[C].storage_hosts.length-1),E=V.split(","),T=0;T<E.length;T++)i.shard[I].shard_id==E[T]&&(i.shard[I].icon="el-icon-circle-check",i.shard[I].status="success")}else i.shard[I].icon="el-icon-circle-check",i.shard[I].status="success"}else if("failed"==e.attachment.storage_state){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+o[0]+"失败",i.shard.length>0)for(var D=0;D<i.shard.length;D++)if(e.attachment.hasOwnProperty("shard_step"))for(var F=0;F<e.attachment.shard_step.length;F++){if("新增"==a)for(var P=e.attachment.shard_step[F].shard_ids,M=0;M<P.length;M++)for(var g in P[M]){v=P[M][g];i.shard[D].shard_id,i.shard[D].icon="el-icon-circle-close",i.shard[D].status="error"}else if("删除"==a)for(var R=e.attachment.shard_step[F].storage_hosts.substr(0,e.attachment.shard_step[F].storage_hosts.length-1),q=R.split(","),z=0;z<q.length;z++)i.shard[D].shard_id==q[z]&&(i.shard[D].icon="el-icon-circle-close",i.shard[D].status="error");i.shard_description=e.attachment.shard_step[F].error_info}else i.shard[D].icon="el-icon-circle-check",i.shard[D].status="success",i.shard_description=e.error_info}else i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+o[0];if(i.init_title="正在"+a+"集群",i.init_active=3,0==i.computer.length&&0==i.shard.length){if(e.attachment.hasOwnProperty("computer_step"))for(var B=0;B<e.attachment.computer_step.length;B++)if(e.attachment.computer_step[B].hasOwnProperty("computer_hosts")){var Q=e.attachment.computer_step[B].computer_hosts.substr(0,e.attachment.computer_step[B].computer_hosts.length-1),A=Q.split(";");if("done"==e.attachment.computer_state)for(var J=0;J<A.length;J++){var H={};H.title=A[J],H.icon="el-icon-circle-check",H.status="success",H.description="",H.computer_id=e.attachment.computer_step[B].computer_id,i.computer.push(H)}else if("failed"==e.attachment.computer_state)for(var G=0;G<A.length;G++){var Y={};Y.title=A[G],Y.icon="el-icon-circle-close",Y.status="error",Y.description=e.attachment.comp_error_info,Y.computer_id=e.attachment.computer_step[B].computer_id,i.computer.push(Y)}else for(var U=0;U<A.length;U++){var K={};K.title=A[U],K.icon="el-icon-loading",K.status="process",K.description="",K.computer_id=e.attachment.computer_step[B].computer_id,i.computer.push(K)}}if(e.attachment.hasOwnProperty("shard_step"))for(var X=0;X<e.attachment.shard_step.length;X++)if("done"==e.attachment.storage_state){if("删除"==a)for(var W=e.attachment.shard_step[X].storage_hosts.substr(0,e.attachment.shard_step[X].storage_hosts.length-1),Z=W.split(";"),tt=0;tt<Z.length;tt++){var et={};et.title=""!==Z?Z[tt]:"正在"+a+o[0],et.icon="el-icon-circle-check",et.status="success",et.description="",et.shard_id=Z[tt],i.shard.push(et)}if("新增"==a)for(var st=e.attachment.shard_step[X].shard_ids,at=0;at<st.length;at++)for(var g in st[at]){var it={},rt=(v=st[at][g],g+":"+v);it.title=""!==v?rt:"正在"+a+o[0],it.icon="el-icon-circle-check",it.status="success",it.description="",it.shard_id=v,i.shard.push(it)}}else if("failed"==e.attachment.storage_state){if("删除"==a)for(var ot=e.attachment.shard_step[X].storage_hosts.substr(0,e.attachment.shard_step[X].storage_hosts.length-1),nt=ot.split(";"),lt=0;lt<nt.length;lt++){var ct={};ct.title=""!==nt?nt[lt]:"正在"+a+o[0],ct.icon="el-icon-circle-close",ct.status="error",ct.description=e.attachment.shard_error_info,ct.shard_id=nt[lt],i.shard.push(ct)}if("新增"==a)for(var dt=e.attachment.shard_step[X].shard_ids,pt=0;pt<dt.length;pt++)for(var g in dt[pt]){var ut={},mt=(v=dt[pt][g],g+":"+v);ut.title=""!==v?mt:"正在"+a+o[0],ut.icon="el-icon-circle-close",ut.status="error",ut.description=e.attachment.shard_error_info,ut.shard_id=v,i.shard.push(ut)}}else{if("删除"==a&&e.attachment.shard_step[X].hasOwnProperty("storage_hosts"))for(var _t=e.attachment.shard_step[X].storage_hosts.substr(0,e.attachment.shard_step[X].storage_hosts.length-1),ht=_t.split(";"),ft=0;ft<ht.length;ft++){var gt={};gt.title=""!==ht?ht[ft]:"正在"+a+o[0],gt.icon="el-icon-loading",gt.status="process",gt.description="",gt.shard_id=ht[ft],i.shard.push(gt)}if("新增"==a)for(var vt=e.attachment.shard_step[X].shard_ids,bt=0;bt<vt.length;bt++)for(var g in vt[bt]){var yt={},xt=(v=vt[bt][g],g+":"+v);yt.title=""!==v?xt:"正在"+a+o[0],yt.icon="el-icon-loading",yt.status="process",yt.description="",yt.shard_id=v,i.shard.push(yt)}}if("failed"==e.status){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+o[0]+"失败",i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+o[1]+"失败",i.finish_title=a+"集群失败",i.finish_icon="el-icon-circle-close",i.finish_state="error",i.finish_show=!0,i.init_active=4,i.finish_description=e.error_info,i.computer.length>0)for(var wt=0;wt<e.attachment.computer_step.length;wt++)if("failed"==e.attachment.computer_step[wt].computer_state){for(var kt=0;kt<i.computer.length;kt++)for(var St=e.attachment.computer_step[wt].computer_hosts.substr(0,e.attachment.computer_step[wt].computer_hosts.length-1),jt=St.split(";"),Ot=0;Ot<jt.length;Ot++)i.computer[kt].title==jt[Ot]&&(i.computer[kt].icon="el-icon-circle-close",i.computer[kt].status="error");i.computer_description=e.attachment.computer_step[wt].error_info}if(i.shard.length>0)for(var Lt=0;Lt<e.attachment.shard_step.length;Lt++){for(var It=0;It<i.shard.length;It++)if("新增"==a)for(var Ct=e.attachment.shard_step[Lt].shard_ids,$t=0;$t<Ct.length;$t++)for(var g in Ct[$t]){v=Ct[$t][g];i.shard[It].shard_id,i.shard[It].icon="el-icon-circle-close",i.shard[It].status="error"}else if("删除"==a)for(var Nt=e.attachment.shard_step[Lt].storage_hosts.substr(0,e.attachment.shard_step[Lt].storage_hosts.length-1),Vt=Nt.split(";"),Et=0;Et<Vt.length;Et++)i.shard[It].shard_id==Vt[Et]&&(i.shard[It].icon="el-icon-circle-close",i.shard[It].status="error");i.shard_description=e.attachment.shard_step[Lt].error_info}clearInterval(t)}else"done"==e.status&&(i.init_active=4,i.finish_icon="el-icon-circle-check",i.finish_state="success",i.init_show=!1,i.finish_show=!0,clearInterval(t))}else if("ongoing"==e.status){for(var Tt=0;Tt<i.computer.length;Tt++){i.comp_active=Tt;for(var Dt=0;Dt<e.attachment.computer_step.length;Dt++)if("ongoing"==e.attachment.computer_step[Dt].computer_state){for(var Ft=e.attachment.computer_step[Dt].computer_hosts.substr(0,e.attachment.computer_step[Dt].computer_hosts.length-1),Pt=Ft.split(";"),Mt=0;Mt<Pt.length;Mt++)if(console.log(22),Pt[Mt]==i.computer[Tt].title&&(i.comp_active=Tt-1,i.computer[Tt].icon="el-icon-loading",i.computer[Tt].status="process",Tt>0&&Tt<i.comp_active+1))for(var Rt=0;Rt<Tt;Rt++)i.computer[Rt].icon="el-icon-circle-check",i.computer[Rt].status="success"}else if("failed"==e.attachment.computer_step[Dt].computer_state){console.log(23);for(var qt=e.attachment.computer_step[Dt].computer_hosts.substr(0,e.attachment.computer_step[Dt].computer_hosts.length-1),zt=qt.split(";"),Bt=0;Bt<zt.length;Bt++)zt[Bt]==i.computer[Tt].title&&(i.computer[Tt].icon="el-icon-circle-close",i.computer[Tt].status="error");i.computer_description=e.attachment.computer_step[Dt].error_info}else if("done"==e.attachment.computer_step[Dt].computer_state){console.log(24);for(var Qt=e.attachment.computer_step[Dt].computer_hosts.substr(0,e.attachment.computer_step[Dt].computer_hosts.length-1),At=Qt.split(";"),Jt=0;Jt<At.length;Jt++)At[Jt]==i.computer[Tt].title&&(i.computer[Tt].status="success",i.computer[Tt].icon="el-icon-circle-check")}}if(i.shard.length>0)for(var Ht=0;Ht<i.shard.length;Ht++)for(var Gt=0;Gt<e.attachment.shard_step.length;Gt++)if("ongoing"==e.attachment.shard_step[Gt].storage_state){if(e.attachment.shard_step[Gt].shard_hosts==i.shard[Ht].title&&(i.shard_active=Ht-1,i.shard[Ht].icon="el-icon-loading",i.shard[Ht].status="process",Ht>0&&Ht<i.shard_active+1))for(var Yt=0;Yt<Ht;Yt++)i.shard[Yt].icon="el-icon-circle-check",i.shard[Yt].status="success"}else"failed"==e.attachment.shard_step[Gt].storage_state?(i.shard_active=Ht,i.shard[Ht].icon="el-icon-circle-close",i.shard[Ht].status="error",i.shard_description=e.attachment.shard_step[Gt].error_info):"done"==e.attachment.shard_step[Gt].storage_state&&(i.shard_active=Ht,i.shard[Ht].status="success",i.shard[Ht].icon="el-icon-circle-check");else if(e.attachment.shard_step[0].hasOwnProperty("storage_hosts")&&"删除"==a)if("ongoing"==e.attachment.storage_state)for(var Ut=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),Kt=Ut.split(";"),Xt=0;Xt<Kt.length;Xt++){var Wt={};Wt.title=""!==Kt?Kt[Xt]:"正在"+a+o[0],Wt.icon="el-icon-loading",Wt.status="process",Wt.description="",Wt.shard_id=Kt[Xt],i.shard.push(Wt)}else if("failed"==e.attachment.storage_state)for(var Zt=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),te=Zt.split(";"),ee=0;ee<te.length;ee++){var se={};se.title=""!==te?te[ee]:"正在"+a+o[0],se.icon="el-icon-circle-close",se.status="error",se.description="",se.shard_id=te[ee],i.shard.push(se)}else if("done"==e.attachment.storage_state)for(var ae=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),ie=ae.split(";"),re=0;re<ie.length;re++){var oe={};oe.title=""!==ie?ie[re]:"正在"+a+o[0],oe.icon="el-icon-circle-check",oe.status="success",oe.description="",oe.shard_id=ie[re],i.shard.push(oe)}}else if("done"==e.status){if(i.init_show=!1,"done"==e.attachment.computer_state){console.log(51),i.computer_title=a+o[1]+"成功",i.computer_state="success",i.computer_icon="el-icon-circle-check",i.comp_active=i.computer.length-1;for(var ne=0;ne<i.computer.length;ne++)i.computer[ne].status="success",i.computer[ne].icon="el-icon-circle-check"}if("done"==e.attachment.storage_state)if(console.log(52),i.shard_title=a+o[0]+"成功",i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_active=i.shard.length-1,i.shard.length>0)for(var le=0;le<i.shard.length;le++)console.log(53),i.shard[le].status="success",i.shard[le].icon="el-icon-circle-check";else if(e.attachment.shard_step[0].hasOwnProperty("storage_hosts")&&"删除"==a)for(var ce=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),de=ce.split(";"),pe=0;pe<de.length;pe++){var ue={};ue.title=""!==de?de[pe]:"正在"+a+o[0],ue.icon="el-icon-circle-check",ue.status="success",ue.description="",ue.shard_id=de[pe],i.shard.push(ue)}if(i.init_active=4,i.finish_title=a+"集群成功",i.finish_icon="el-icon-circle-check",i.finish_state="success",i.finish_show=!0,clearInterval(t),"新增"==a){var me=sessionStorage.getItem("apply_all_cluster");if(2==me){var _e={};_e.effectCluster=sessionStorage.getItem("affected_clusters"),_e.cluster_name=e.attachment.cluster_name,_e.username=sessionStorage.getItem("login_username"),_e.type="add",Object(p["Eb"])(_e).then((function(t){var e=t;200==e.code&&(i.dialogFormVisible=!1,sessionStorage.setItem("affected_clusters",e.effectCluster))}))}setTimeout((function(){i.getList()}),3e3)}else i.getList()}else if("failed"==e.status){if(i.finish_title=a+"集群失败",i.finish_icon="el-icon-circle-close",i.finish_state="error",i.init_active=4,i.finish_description=e.error_info,i.finish_show=!0,i.init_show=!1,clearInterval(t),e.attachment.hasOwnProperty("computer_state")){if("failed"==e.attachment.computer_state){i.computer_state="error",i.computer_icon="el-icon-circle-close";for(var he=0;he<e.attachment.computer_step.length;he++){var fe=e.attachment.computer_step[he].computer_hosts.substr(0,e.attachment.computer_step[he].computer_hosts.length-1),ge=fe.split(";");if("done"==e.attachment.computer_step[he].computer_state){i.comp_active=he;for(var ve=0;ve<i.computer.length;ve++)for(var be=0;be<ge.length;be++)i.computer[ve].title==ge[be]&&(i.computer[ve].icon="el-icon-circle-check",i.computer[ve].status="success")}else if("failed"==e.attachment.computer_step[he].computer_state)for(var ye=0;ye<i.computer.length;ye++)for(var xe=0;xe<ge.length;xe++)i.computer[ye].title==ge[xe]&&(i.computer[ye].icon="el-icon-circle-close",i.computer[ye].status="error");i.computer_description=e.attachment.computer_step[he].error_info}}else if("done"==e.attachment.computer_state)for(var we=0;we<e.attachment.computer_step.length;we++){var ke=e.attachment.computer_step[we].computer_hosts.substr(0,e.attachment.computer_step[we].computer_hosts.length-1),Se=ke.split(";");if("done"==e.attachment.computer_step[we].computer_state){i.comp_active=we;for(var je=0;je<i.computer.length;je++)for(var Oe=0;Oe<Se.length;Oe++)(i.computer[je].title=Se[Oe])&&(i.computer[je].icon="el-icon-circle-check",i.computer[je].status="success")}else if("failed"==e.attachment.computer_step[we].computer_state){for(var Le=0;Le<i.computer.length;Le++)for(var Ie=0;Ie<Se.length;Ie++)i.computer[Le].title==Se[Ie]&&(i.computer[Le].icon="el-icon-circle-close",i.computer[Le].status="error");i.computer_description=e.attachment.computer_step[we].error_info}}}else i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+o[0]+"失败";if(e.attachment.hasOwnProperty("storage_state"))if("failed"==e.attachment.storage_state){i.storage_state="error",i.shard_icon="el-icon-circle-close";for(var Ce=0;Ce<e.attachment.shard_step.length;Ce++)if("done"==e.attachment.shard_step[Ce].storage_state){i.shard_active=Ce;for(var $e=0;$e<i.shard.length;$e++)if("新增"==a)for(var Ne=e.attachment.shard_step[Ce].shard_ids,Ve=0;Ve<Ne.length;Ve++)for(var g in Ne[Ve]){v=Ne[Ve][g];i.shard[$e].shard_id,i.shard[$e].icon="el-icon-circle-check",i.shard[$e].status="success"}else if("删除"==a)for(var Ee=e.attachment.shard_step[Ce].storage_hosts.substr(0,e.attachment.shard_step[Ce].storage_hosts.length-1),Te=Ee.split(","),De=0;De<Te.length;De++)i.shard[$e].shard_id==Te[De]&&(i.shard[$e].icon="el-icon-circle-check",i.shard[$e].status="success")}else if("failed"==e.attachment.shard_step[Ce].storage_state){for(var Fe=0;Fe<i.shard.length;Fe++)if("新增"==a)for(var Pe=e.attachment.shard_step[Ce].shard_ids,Me=0;Me<Pe.length;Me++)for(var g in Pe[Me]){v=Pe[Me][g];i.shard[Fe].shard_id,i.shard[Fe].icon="el-icon-circle-close",i.shard[Fe].status="error"}else if("删除"==a)for(var Re=e.attachment.shard_step[Ce].storage_hosts.substr(0,e.attachment.shard_step[Ce].storage_hosts.length-1),qe=Re.split(","),ze=0;ze<qe.length;ze++)i.shard[Fe].shard_id==qe[ze]&&(i.shard[Fe].icon="el-icon-circle-close",i.shard[Fe].status="error");i.shard_description=e.attachment.shard_step[Ce].error_info}}else if("done"==e.attachment.storage_state){for(var Be=0;Be<e.attachment.shard_step.length;Be++)if("done"==e.attachment.shard_step[Be].storage_state){i.shard_active=Be;for(var Qe=0;Qe<i.shard.length;Qe++)i.shard[Qe].title==e.attachment.shard_step[Be].shard_hosts&&(i.shard[Qe].icon="el-icon-circle-check",i.shard[Qe].status="success")}else if("failed"==e.attachment.shard_step[Be].storage_state)for(var Ae=0;Ae<i.shard.length;Ae++)i.shard[Ae].title==e.attachment.shard_step[Be].shard_hosts&&(i.shard[Ae].icon="el-icon-circle-close",i.shard[Ae].status="error")}else{for(var Je=0;Je<i.shard.length;Je++)if("新增"==a)for(var He=e.attachment.shard_step[b].shard_ids,Ge=0;Ge<He.length;Ge++)for(var g in He[Ge]){v=He[Ge][g];i.shard[Je].shard_id,i.shard[Je].icon="el-icon-circle-close",i.shard[Je].status="error"}else if("删除"==a)for(var Ye=e.attachment.shard_step[b].storage_hosts.substr(0,e.attachment.shard_step[b].storage_hosts.length-1),Ue=Ye.split(","),Ke=0;Ke<Ue.length;Ke++)i.shard[Je].shard_id==Ue[Ke]&&(i.shard[Je].icon="el-icon-circle-close",i.shard[Je].status="error");i.shard_description=e.error_info}else i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+o[0]+"失败"}"ongoing"==e.status?"ongoing"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"ongoing"==e.attachment.computer_state||"dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?(i.percentage=75,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+r:i.progress_format="未完成计算"+r):"failed"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"failed"==e.attachment.computer_state||"dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?i.percentage<=50&&(i.percentage=50,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+r:i.progress_format="未完成计算"+r):(i.percentage=45,i.progress_format="未完成存储和计算"+r):"failed"==e.status?(i.progress_status="exception","ongoing"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"ongoing"==e.attachment.computer_state||"dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?(i.percentage=75,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+r:i.progress_format="未完成计算"+r):"failed"==e.attachment.storage_state&&"ongoing"==e.attachment.computer_state||("ongoing"==e.attachment.storage_state&&"failed"==e.attachment.computer_state)("dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state)||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?i.percentage<=50&&(i.percentage=50,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+r:i.progress_format="未完成计算"+r):(i.percentage=45,i.progress_format="未完成存储和计算"+r)):(i.progress_status="success",i.percentage=100,i.progress_format=r+"完成")}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?(i.init_title="正在"+a+"集群",i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+"computer",i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+"shard",s>5&&(i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"computer失败",i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"shard失败",i.percentage=0,i.progress_format="未完成存储和计算"+r,clearInterval(t))):null==e.attachment&&"ongoing"==e.status?(i.init_title="正在"+a+"集群",i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+"computer",i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+"shard"):null==e.attachment&&"done"==e.status?(i.init_show=!1,i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"computer成功",i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"shard成功",i.percentage=100,i.progress_format=r+"完成",clearInterval(t)):(i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"computer失败",i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"shard失败",i.percentage=0,i.progress_format="未完成存储和计算"+r,clearInterval(t))}else if("添加shard"==a||"添加计算节点"==a||"添加存储节点"==a)if(null!==e.attachment){if("添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0),e.attachment.hasOwnProperty("computer_state"))if("ongoing"==e.attachment.computer_state)i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a;else if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.computer.length>0)for(var Xe=0;Xe<i.computer.length;Xe++)for(var We=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Ze=We.split(";"),ts=0;ts<Ze.length;ts++)i.computer[Xe].title==Ze[ts]&&(i.computer[Xe].icon="el-icon-circle-check",i.computer[Xe].status="success")}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.computer.length>0){for(var es=0;es<i.computer.length;es++)for(var ss=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),as=ss.split(";"),is=0;is<as.length;is++)i.computer[es].title==as[is]&&(i.computer[es].icon="el-icon-circle-close",i.computer[es].status="error");i.computer_description=e.error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a;if(e.attachment.hasOwnProperty("storage_state"))if("ongoing"==e.attachment.storage_state||"dispatch"==e.attachment.storage_state)i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a;else if("done"==e.attachment.storage_state)if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"成功",i.shard.length>0){var rs="";rs="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var os=0;os<i.shard.length;os++)for(var ns=0;ns<rs.length;ns++)for(var g in rs[ns]){v=rs[ns][g];i.shard[os].shard_id,i.shard[os].icon="el-icon-circle-check",i.shard[os].status="success"}}else{var ls="";if("添加shard"==a?e.attachment.hasOwnProperty("shard_ids")&&(ls=e.attachment.shard_ids):e.attachment.hasOwnProperty("shard_hosts")&&(ls=e.attachment.shard_hosts),ls.length>0)for(var cs=0;cs<ls.length;cs++)for(var g in ls[cs]){var ds={};v=ls[cs][g];console.log(v);var ps=g+":"+v;console.log(ps),ds.title=""!==v?ps:a+"成功",ds.icon="el-icon-circle-check",ds.status="success",ds.description="",ds.shard_id=v,i.shard.push(ds)}}else if("failed"==e.attachment.storage_state){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",i.shard.length>0){for(var us=0;us<i.shard.length;us++){var ms="";ms="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var _s=0;_s<ms.length;_s++)for(var g in ms[_s]){v=ms[_s][g];i.shard[us].shard_id,i.shard[us].icon="el-icon-circle-close",i.shard[us].status="error"}}i.shard_description=e.error_info}}else i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a;if(i.init_title="正在"+a,i.init_active=1,0==i.computer.length||0==i.shard.length){if("添加计算节点"==a){if(0==i.computer.length){if(e.attachment.hasOwnProperty("computer_hosts")){var hs=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),fs=hs.split(";");if("done"==e.attachment.computer_state)for(var gs=0;gs<fs.length;gs++){var vs={};vs.title=fs[gs],vs.icon="el-icon-circle-check",vs.status="success",vs.description="",vs.computer_id=e.attachment.computer_id,i.computer.push(vs)}else for(var bs=0;bs<fs.length;bs++){var ys={};ys.title=fs[bs],ys.icon="el-icon-loading",ys.status="process",ys.description="",ys.computer_id=e.attachment.computer_id,i.computer.push(ys)}}}else if(e.attachment.hasOwnProperty("computer_state"))if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.computer.length>0)for(var xs=0;xs<i.computer.length;xs++)for(var ws=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),ks=ws.split(";"),Ss=0;Ss<ks.length;Ss++)i.computer[xs].title==ks[Ss]&&(i.computer[xs].icon="el-icon-circle-check",i.computer[xs].status="success")}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.computer.length>0){for(var js=0;js<i.computer.length;js++)for(var Os=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Ls=Os.split(";"),Is=0;Is<Ls.length;Is++)i.computer[js].title==Ls[Is]&&(i.computer[js].icon="el-icon-circle-close",i.computer[js].status="error");i.computer_description=e.error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a}else if(0==i.shard.length){var Cs="";if("添加shard"==a?e.attachment.hasOwnProperty("shard_ids")&&(Cs=e.attachment.shard_ids):e.attachment.hasOwnProperty("shard_ids")&&(Cs=e.attachment.shard_hosts),Cs.length>0)for(var $s=0;$s<Cs.length;$s++)for(var g in Cs[$s]){var Ns={};v=Cs[$s][g];console.log(v);var Vs=g+":"+v;console.log(Vs),Ns.title=""!==v?Vs:"正在"+a,Ns.icon="done"==e.attachment.storage_state?"el-icon-circle-check":"el-icon-loading",Ns.status="done"==e.attachment.storage_state?"success":"process",Ns.description="",Ns.shard_id=v,i.shard.push(Ns)}}else if(e.attachment.hasOwnProperty("storage_state"))if("done"==e.attachment.storage_state){if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"成功",i.shard.length>0)for(var Es=0;Es<i.shard.length;Es++){var Ts="";Ts="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var Ds=0;Ds<Ts.length;Ds++)for(var g in Ts[Ds]){v=Ts[Ds][g];i.shard[Es].shard_id,i.shard[Es].icon="el-icon-circle-check",i.shard[Es].status="success"}}}else if("failed"==e.attachment.storage_state){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",i.shard.length>0){for(var Fs=0;Fs<i.shard.length;Fs++){var Ps="";Ps="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var Ms=0;Ms<Ps.length;Ms++)for(var g in Ps[Ms]){v=Ps[Ms][g];i.shard[Fs].shard_id,i.shard[Fs].icon="el-icon-circle-close",i.shard[Fs].status="error"}}i.shard_description=e.error_info}}else i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a;if("failed"==e.status){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.finish_title=a+"失败",i.finish_icon="el-icon-circle-close",i.finish_state="error",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0){for(var Rs=0;Rs<i.computer.length;Rs++)if(e.attachment.hasOwnProperty("computer_hosts"))for(var qs=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),zs=qs.split(";"),Bs=0;Bs<zs.length;Bs++)i.computer[Rs].title==zs[Bs]&&(i.computer[Rs].icon="el-icon-circle-close",i.computer[Rs].status="error");i.computer_description=e.error_info}if(i.shard.length>0){for(var Qs=0;Qs<i.shard.length;Qs++){var As="";if(e.attachment.hasOwnProperty("shard_hosts")){As="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var Js=0;Js<As.length;Js++)for(var g in As[Js]){v=As[Js][g];i.shard[Qs].shard_id,i.shard[Qs].icon="el-icon-circle-close",i.shard[Qs].status="error"}}}i.shard_description=e.error_info}clearInterval(t)}else if("done"==e.status){if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"成功",i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.finish_title=a+"成功",i.finish_icon="el-icon-circle-check",i.finish_state="success",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0)for(var Hs=0;Hs<i.computer.length;Hs++)if(e.attachment.hasOwnProperty("computer_hosts"))for(var Gs=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Ys=Gs.split(";"),Us=0;Us<Ys.length;Us++)i.computer[Hs].title==Ys[Us]&&(i.computer[Hs].icon="el-icon-circle-check",i.computer[Hs].status="success");if(i.shard.length>0)for(var Ks=0;Ks<i.shard.length;Ks++){var Xs="";if(e.attachment.hasOwnProperty("shard_hosts")){Xs="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var Ws=0;Ws<Xs.length;Ws++)for(var g in Xs[Ws]){v=Xs[Ws][g];i.shard[Ks].shard_id,i.shard[Ks].icon="el-icon-circle-check",i.shard[Ks].status="success"}}}clearInterval(t),i.getList()}}"ongoing"==e.status?"prepare"==e.attachment.storage_state?(i.percentage=20,i.progress_format="正在"+a):"failed"==e.attachment.storage_state?i.progress_format=a+"失败":"done"==e.attachment.storage_state?(i.percentage=100,i.progress_format=a+"完成"):(i.percentage<70&&i.percentage>=30?i.percentage+=10:i.percentage<30&&i.percentage>=0&&(i.percentage=30),i.progress_format="正在"+a):"failed"==e.status?(i.progress_status="exception","prepare"==e.attachment.storage_state?(i.percentage=20,i.progress_format="正在"+a):"failed"==e.attachment.storage_state?i.progress_format=a+"失败":"done"==e.attachment.storage_state?(i.percentage=100,i.progress_format=a+"完成"):(i.percentage<70&&i.percentage>=30?i.percentage+=10:i.percentage<30&&i.percentage>=0&&(i.percentage=30),i.progress_format="正在"+a)):(i.progress_status="success",i.percentage=100,i.progress_format=a+"完成")}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?"添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a,s>5&&(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",i.percentage<30&&(i.percentage+=10),i.progress_format=a+"失败",clearInterval(t))):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a,i.percentage<30&&(i.percentage+=10),i.progress_format="正在"+a,s>5&&(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.progress_format=a+"失败",clearInterval(t))):null==e.attachment&&"ongoing"==e.status?"添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a,i.percentage<30&&(i.percentage+=10),i.progress_format="正在"+a):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a,i.percentage<30&&(i.percentage+=10),i.progress_format="正在"+a):null==e.attachment&&"done"==e.status?("添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"成功",i.percentage=100,i.progress_format=a+"完成"):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.percentage=100,i.progress_format=a+"完成"),clearInterval(t)):("添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",i.progress_format=a+"失败"):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.progress_format=a+"失败"),clearInterval(t));else"扩容"==a&&(null!==e.attachment?"failed"==e.status?(i.expand_end="集群扩容失败",i.expondInit=!1,i.expondSatus=!0,i.expondResult=!0,i.expondInfo=e.attachment.memo_info,console.log(e.attachment.memo_info),clearInterval(t)):"done"==e.status?(i.expand_end="集群扩容成功",i.expondInit=!1,i.expondSatus=!0,i.expondResult=!0,i.expondInfo=e.attachment.memo_info,clearInterval(t)):(i.expand_init="正在进行集群扩容",i.expondInit=!0,i.expondSatus=!1,i.expondResult=!1,i.expondInfo=e.attachment.memo_info):null==e.attachment&&"failed"==e.status&&(i.expondInit=!1,i.expondSatus=!1,i.expondResult=!0,i.expand_end="集群扩容失败",clearInterval(t)))})),s>=86400&&clearInterval(t)}),0)},getStatus:function(t,e,s){var a=this;setTimeout((function(){var i={job_type:"get_status"};i.version=d["u"][0].ver,i.job_id=e,i.timestamp=d["s"][0].time+"",i.paras={},Object(p["N"])(i).then((function(e){var s="";if(null!==e.attachment&&(s=""!==e.attachment.memo_info.error_info?e.attachment.memo_info.error_info:e.error_info),"done"==e.status||"failed"==e.status)if(clearInterval(t),"done"==e.status){var i={content:"集群回档成功",timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};a.activities.push(i),a.getList()}else{var r={content:s,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(r)}else if(s){var o={content:s,timestamp:Object(l["d"])(),color:"#0bbd87"};a.activities.push(o)}})),s>=86400&&clearInterval(t)}),0)}}},h=_,f=s("2877"),g=Object(f["a"])(h,r,o,!1,null,null,null),v=g.exports,y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.g_loading,expression:"g_loading"}],attrs:{size:"small"},on:{change:t.agreeChange},model:{value:t.currentCase,callback:function(e){t.currentCase=e},expression:"currentCase"}},t._l(t.clusters,(function(e){return s("el-radio",{key:e.id,attrs:{label:e.id}},[t._v(t._s(e.nick_name+"("+e.id+")"))])})),1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.nodataShow,expression:"nodataShow"}],staticClass:"nodata"},[t._v("暂无数据")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.g_loading,expression:"g_loading"}],ref:"myPage",staticStyle:{"margin-top":"0px",width:"calc(100(100% - 10px)",height:"calc(100vh - 160px)"},on:{click:function(e){t.isShowNodeMenuPanel=!1}}},[s("SeeksRelationGraph",{ref:"seeksRelationGraph",attrs:{options:t.graphOptions,"on-node-click":t.onNodeClick,"on-line-click":t.onLineClick,"on-node-expand":t.onNodeExpand,"on-node-collapse":t.onNodeCollapse},scopedSlots:t._u([{key:"node",fn:function(e){var a=e.node;return s("div",{on:{click:function(e){return t.showNodeMenus(a,e)}}},[s("div",[s("i",{class:a.data.icon,style:{color:a.data.color,fontSize:"40px"}}),s("p",{staticStyle:{"word-wrap":"break-word","word-break":"break-all"},domProps:{textContent:t._s(a.text)}})])])}}])})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowNodeMenuPanel&&t.g_loading,expression:"isShowNodeMenuPanel && g_loading"}],staticStyle:{"z-index":"999",padding:"10px","background-color":"#ffffff",border:"#eeeeee solid 1px","box-shadow":"0px 0px 8px #cccccc",position:"absolute"},style:{left:t.nodeMenuPanelPosition.x+"px",top:t.nodeMenuPanelPosition.y+"px"}},[s("div",{staticStyle:{"line-height":"25px","padding-left":"10px",color:"#888888","font-size":"10px"}},[t._v("对"+t._s(t.nodeName)+"进行操作：")]),"cluster"===t.type&&"Y"===t.shard_create_priv?s("div",{staticClass:"c-node-menu-item",on:{click:function(e){return e.stopPropagation(),t.doAction("新增存储集群")}}},[t._v(" 新增存储集群")]):t._e(),"cluster"===t.type&&"Y"===t.compute_node_create_priv?s("div",{staticClass:"c-node-menu-item",on:{click:function(e){return e.stopPropagation(),t.doAction("新增计算节点")}}},[t._v("新增计算节点")]):t._e(),"snode"===t.type?s("div",{staticClass:"c-node-menu-item",on:{click:function(e){return e.stopPropagation(),t.doAction("详情")}}},[t._v("详情")]):t._e(),"cnode"!==t.type&&"snode"!==t.type||"active"!=t.node_status?t._e():s("div",{staticClass:"c-node-menu-item",on:{click:function(e){return e.stopPropagation(),t.doAction("节点监控")}}},[t._v("节点监控")])]),t.isShowNodeTipsPanel?s("div",{staticStyle:{"z-index":"999",padding:"10px","background-color":"#ffffff",border:"#eeeeee solid 1px","box-shadow":"0px 0px 8px #cccccc",position:"absolute"},style:{left:t.nodeMenuPanelPosition.x+"px",top:t.nodeMenuPanelPosition.y+"px"}},[s("div",{staticClass:"c-node-menu-item"},[t._v("ip:"+t._s(t.currentNode.data.ip))]),s("div",{staticClass:"c-node-menu-item"},[t._v("port:"+t._s(t.currentNode.text))]),t.shardName?s("div",{staticClass:"c-node-menu-item"},[t._v("shard名称:"+t._s(t.currentNode.data.shard_name))]):t._e(),s("div",{staticClass:"c-node-menu-item"},[t._v("集群名称:"+t._s(t.currentNode.data.cluster_name))])]):t._e(),s("el-dialog",{attrs:{title:"新增存储集群",visible:t.dialogShardVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogShardVisible=e}}},[s("el-form",{ref:"restoreForm",attrs:{model:t.shardtemp,rules:t.rules,"label-position":"left","label-width":"110px"}},[s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-checkbox-group",{attrs:{min:t.minMachine,max:t.machineTotal},model:{value:t.shardtemp.machinelist,callback:function(e){t.$set(t.shardtemp,"machinelist",e)},expression:"shardtemp.machinelist"}},t._l(t.machines,(function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.hostaddr}},[t._v(t._s(e.hostaddr))])})),1)],1),s("el-form-item",{attrs:{label:"集群名称:",prop:"old_cluster_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.shardtemp.old_cluster_name,callback:function(e){t.$set(t.shardtemp,"old_cluster_name",e)},expression:"shardtemp.old_cluster_name"}})],1),s("el-form-item",{attrs:{label:"副本数:",prop:"snode_count"}},[s("el-input",{attrs:{placeholder:"副本数至少是3，且不能大于所选计算机数",disabled:"detail"===t.dialogStatus},model:{value:t.shardtemp.snode_count,callback:function(e){t.$set(t.shardtemp,"snode_count",e)},expression:"shardtemp.snode_count"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogShardVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.shardData(t.shardtemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"新增计算节点",visible:t.dialogCompVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogCompVisible=e}}},[s("el-form",{ref:"compForm",attrs:{model:t.comptemp,rules:t.rules,"label-position":"left","label-width":"110px"}},[s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-checkbox-group",{attrs:{min:t.minMachine,max:t.machineTotal},model:{value:t.comptemp.machinelist,callback:function(e){t.$set(t.comptemp,"machinelist",e)},expression:"comptemp.machinelist"}},t._l(t.machines,(function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.hostaddr}},[t._v(t._s(e.hostaddr))])})),1)],1),s("el-form-item",{attrs:{label:"集群名称:",prop:"old_cluster_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.comptemp.old_cluster_name,callback:function(e){t.$set(t.comptemp,"old_cluster_name",e)},expression:"comptemp.old_cluster_name"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogCompVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.compData(t.comptemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"新增存储节点",visible:t.dialogSnodeVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogSnodeVisible=e}}},[s("el-form",{ref:"compForm",attrs:{model:t.comptemp,rules:t.rules,"label-position":"left","label-width":"110px"}},[s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-checkbox-group",{attrs:{min:t.minMachine,max:t.machineTotal},model:{value:t.snodetemp.machinelist,callback:function(e){t.$set(t.snodetemp,"machinelist",e)},expression:"snodetemp.machinelist"}},t._l(t.machines,(function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.hostaddr}},[t._v(t._s(e.hostaddr))])})),1)],1),s("el-form-item",{attrs:{label:"集群名称:",prop:"old_cluster_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.snodetemp.old_cluster_name,callback:function(e){t.$set(t.snodetemp,"old_cluster_name",e)},expression:"snodetemp.old_cluster_name"}})],1),s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.snodetemp.shard_name,callback:function(e){t.$set(t.snodetemp,"shard_name",e)},expression:"snodetemp.shard_name"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogSnodeVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.snodeData(t.snodetemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"重做备机节点",visible:t.dialogRedoVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogRedoVisible=e}}},[s("el-form",{ref:"redoForm",attrs:{model:t.redotemp,rules:t.rules,"label-position":"left","label-width":"180px"}},[s("el-form-item",{attrs:{label:"需重做的备机节点:",prop:"redolist"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},on:{change:t.change},model:{value:t.redotemp.redolist,callback:function(e){t.$set(t.redotemp,"redolist",e)},expression:"redotemp.redolist"}},t._l(t.options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1),s("el-form-item",{attrs:{label:"是否从主节点上拉取数据:",prop:"allow_pull_from_master"}},[s("el-radio",{attrs:{label:"1"},model:{value:t.redotemp.allow_pull_from_master,callback:function(e){t.$set(t.redotemp,"allow_pull_from_master",e)},expression:"redotemp.allow_pull_from_master"}},[t._v("是")]),s("el-radio",{attrs:{label:"0"},model:{value:t.redotemp.allow_pull_from_master,callback:function(e){t.$set(t.redotemp,"allow_pull_from_master",e)},expression:"redotemp.allow_pull_from_master"}},[t._v("否")])],1),"0"==t.redotemp.allow_pull_from_master?s("el-form-item",{attrs:{label:"主备延迟:",prop:"allow_replica_delay"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"主备延迟"},model:{value:t.redotemp.allow_replica_delay,callback:function(e){t.$set(t.redotemp,"allow_replica_delay",e)},expression:"redotemp.allow_replica_delay"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("s")])])],1):t._e(),s("el-form-item",{attrs:{label:"是否备份:",prop:"need_backup"}},[s("el-radio",{attrs:{label:"1"},model:{value:t.redotemp.need_backup,callback:function(e){t.$set(t.redotemp,"need_backup",e)},expression:"redotemp.need_backup"}},[t._v("是")]),s("el-radio",{attrs:{label:"0"},model:{value:t.redotemp.need_backup,callback:function(e){t.$set(t.redotemp,"need_backup",e)},expression:"redotemp.need_backup"}},[t._v("否")])],1),"1"==t.redotemp.need_backup?s("el-form-item",{attrs:{label:"备份存储目标:",prop:"hdfs_host"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.redotemp.hdfs_host,callback:function(e){t.$set(t.redotemp,"hdfs_host",e)},expression:"redotemp.hdfs_host"}},t._l(t.hdfs_options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1):t._e(),s("el-form-item",{attrs:{label:"限速:",prop:"pv_limit"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"限速"},model:{value:t.redotemp.pv_limit,callback:function(e){t.$set(t.redotemp,"pv_limit",e)},expression:"redotemp.pv_limit"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("KB/s")])])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogRedoVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.redoData(t.redotemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"主备切换",visible:t.dialogSwitchOVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogSwitchOVisible=e}}},[s("el-form",{ref:"switchForm",attrs:{model:t.switchtemp,rules:t.rules,"label-position":"left","label-width":"100px"}},[s("el-form-item",{attrs:{label:"主节点:",prop:"primary_node"}},[s("span",[t._v(t._s(t.switchtemp.primary_node))])]),s("el-form-item",{attrs:{label:"备机节点:",prop:"replica"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择备机节点"},model:{value:t.switchtemp.replica,callback:function(e){t.$set(t.switchtemp,"replica",e)},expression:"switchtemp.replica"}},t._l(t.options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogSwitchOVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.switchData(t.switchtemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"设置延迟告警时间",visible:t.dialogDalayVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogDalayVisible=e}}},[s("el-form",{ref:"dalayForm",attrs:{model:t.dalaytemp,rules:t.rules,"label-position":"left","label-width":"120px"}},[s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},[s("span",[t._v(t._s(t.dalaytemp.shard_name))])]),s("el-form-item",{attrs:{label:"最大延迟时间:",prop:"maxtime"}},[s("el-input",{attrs:{placeholder:"请输入最大延迟时间"},model:{value:t.dalaytemp.maxtime,callback:function(e){t.$set(t.dalaytemp,"maxtime",e)},expression:"dalaytemp.maxtime"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("s")])])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogDalayVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.dalayData(t.dalaytemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"存储节点详情",visible:t.dialogDetailVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogDetailVisible=e}}},[s("div",{staticClass:"box"},[s("div",{attrs:{title:""}},[s("el-form",{ref:"detailForm",attrs:{model:t.detailtemp,rules:t.rules,"label-position":"left","label-width":"120px"}},[s("el-form-item",{attrs:{label:"集群id:",prop:"cluster_id"}},[s("span",[t._v(t._s(t.detailtemp.cluster_id))])]),s("el-form-item",{attrs:{label:"shard_id:",prop:"shard_id"}},[s("span",[t._v(t._s(t.detailtemp.shard_id))])]),s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},[s("span",[t._v(t._s(t.detailtemp.shard_name))])]),s("el-form-item",{attrs:{label:"ip:",prop:"ip"}},[s("span",[t._v(t._s(t.detailtemp.ip))])]),s("el-form-item",{attrs:{label:"port:",prop:"port"}},[s("span",[t._v(t._s(t.detailtemp.port))])]),s("el-form-item",{attrs:{label:"状态:",prop:"master"}},["true"==t.detailtemp.master||"false"==t.detailtemp.master?s("span",[t._v(t._s(t._f("nodeStatus")(t.detailtemp)))]):t._e()]),s("el-form-item",{attrs:{label:"节点类型:",prop:"sync_state"}},["async"==t.detailtemp.sync_state?s("span",[t._v("异步")]):"fsync"==t.detailtemp.sync_state?s("span",[t._v("强同步")]):s("span",[t._v(t._s(t.detailtemp.sync_state))])])],1)],1),s("div",{attrs:{title:""}},[s("el-form",{ref:"detailForm",attrs:{model:t.detailtemp,rules:t.rules,"label-position":"left","label-width":"150px"}},[s("el-form-item",{attrs:{label:"延迟时间:",prop:"replica_delay"}},[s("span",[t._v(t._s(t.detailtemp.replica_delay+"s"))])]),s("el-form-item",{attrs:{label:"cpu核数:",prop:"cpu_cores"}},[s("span",[t._v(t._s(t.detailtemp.cpu_cores))])]),s("el-form-item",{attrs:{label:"初始化存储值:",prop:"initial_storage_GB"}},[s("span",[t._v(t._s(t.detailtemp.initial_storage_GB+"GB"))])]),s("el-form-item",{attrs:{label:"最大存储值:",prop:"max_storage_GB"}},[s("span",[t._v(t._s(t.detailtemp.max_storage_GB+"GB"))])]),s("el-form-item",{attrs:{label:"innodb缓冲池大小:",prop:"innodb_buffer_pool_MB"}},[s("span",[t._v(t._s(t.detailtemp.innodb_buffer_pool_MB+"MB"))])]),s("el-form-item",{attrs:{label:"rocksdb缓冲池大小:",prop:"rocksdb_buffer_pool_MB"}},[s("span",[t._v(t._s(t.detailtemp.rocksdb_buffer_pool_MB+"MB"))])])],1)],1)])]),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.variableVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.variableVisible=e}}},[s("el-form",{ref:"variableForm",attrs:{model:t.variabletemp,rules:t.rules,"label-position":"left","label-width":"120px"}},[s("el-form-item",{attrs:{label:"IP:",prop:"ip"}},[s("span",[t._v(t._s(t.variabletemp.ip))])]),s("el-form-item",{attrs:{label:"端口:",prop:"port"}},[s("span",[t._v(t._s(t.variabletemp.port))])]),"setVariable"===t.dialogStatus?s("el-form-item",{attrs:{label:"变量类型:",prop:"vartype"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.variabletemp.vartype,callback:function(e){t.$set(t.variabletemp,"vartype",e)},expression:"variabletemp.vartype"}},t._l(t.typeOptions,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e(),s("el-form-item",{attrs:{label:"变量名:",prop:"variable"}},[s("el-input",{attrs:{placeholder:"请输入变量名"},model:{value:t.variabletemp.variable,callback:function(e){t.$set(t.variabletemp,"variable",e)},expression:"variabletemp.variable"}})],1),"setVariable"===t.dialogStatus?s("el-form-item",{attrs:{label:"变量值:",prop:"varvalue"}},[s("el-input",{attrs:{placeholder:"请输入变量值"},model:{value:t.variabletemp.varvalue,callback:function(e){t.$set(t.variabletemp,"varvalue",e)},expression:"variabletemp.varvalue"}})],1):t._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.variableVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){"setVariable"===t.dialogStatus?t.setVariable(t.variabletemp):t.getVariable(t.variabletemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeSyncDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)]),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusFVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeSwitchDestory},on:{"update:visible":function(e){t.dialogStatusFVisible=e}}},[s("div",{staticStyle:{height:"400px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.active,"finish-status":"success"}},t._l(t.stepParams,(function(e,a){return s("el-step",{key:a,class:t.stepSuc.includes(a)?"stepSuc":"stepErr",attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(e){return t.handleStep(a)}}})})),1)],1)]),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusRedoVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeRedoDestory},on:{"update:visible":function(e){t.dialogStatusRedoVisible=e}}},[s("div",{staticClass:"block",staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},t._l(t.statusList,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(e.description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.second_active}},t._l(t.statusList[a].second,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2)})),1)],1)]),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusShowVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeDelDestory},on:{"update:visible":function(e){t.dialogStatusShowVisible=e}}},[s("div",{staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},[t.init_show?s("el-step",{attrs:{title:t.init_title,icon:"el-icon-more"}}):t._e(),t.computer_show?s("el-step",{attrs:{title:t.computer_title,status:t.computer_state,icon:t.computer_icon,description:t.computer_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.computer_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.comp_active}},t._l(t.computer,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2):t._e(),t.shard_show?s("el-step",{attrs:{title:t.shard_title,status:t.storage_state,icon:t.shard_icon,description:t.shard_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.shard_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.shard_active}},t._l(t.shard,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(s){return t.thisDetail(e.shard_id)}}})})),1)],1)])],2):t._e()],1)],1)])],1)},x=[],w=s("c7eb"),k=s("1da1"),S=(s("466d"),s("a4d3"),s("e01a"),s("9aee")),j=s("0491"),O=s.n(j),L={name:"Demo",components:{SeeksRelationGraph:O.a},data:function(){var t,e=this,s=function(t,s,a){0===s.length?a(new Error("请选择需重做的备机节点")):s.length==e.options.length?(e.redotemp.allow_pull_from_master="1",a()):a()},a=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("主备延迟只能输入数字")):s(new Error("主备延迟不能为空"))},i=function(t,e,s){0===e.length?s(new Error("请选择备份存储目标")):s()},r=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("最大延迟时间只能输入数字")):s(new Error("最大延迟时间不能为空"))},o=function(t,e,s){0===e.length?s(new Error("请选择变量类型")):s()},l=function(t,e,s){e?s():s(new Error("变量名不能为空"))},c=function(t,e,s){e?s():s(new Error("变量值不能为空"))};return t={currentCase:1,clusters:[],nodeName:"",type:"",master:"",ha_mode:"",message_tips:"",message_type:"",nodataShow:!1,timer:null,installStatus:!1,info:"",row:{},snode:{},shard_create_priv:JSON.parse(sessionStorage.getItem("priv")).shard_create_priv,shard_drop_priv:JSON.parse(sessionStorage.getItem("priv")).shard_drop_priv,storage_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_create_priv,storage_node_drop_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_drop_priv,compute_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_create_priv,compute_node_drop_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_drop_priv,storage_enable_priv:JSON.parse(sessionStorage.getItem("priv")).storage_enable_priv,storage_disable_priv:JSON.parse(sessionStorage.getItem("priv")).storage_disable_priv,compute_enable_priv:JSON.parse(sessionStorage.getItem("priv")).compute_enable_priv,compute_disable_priv:JSON.parse(sessionStorage.getItem("priv")).compute_disable_priv,user_name:sessionStorage.getItem("login_username"),isShowCodePanel:!1,isShowNodeTipsPanel:!1,isShowNodeMenuPanel:!1,nodeMenuPanelPosition:{x:0,y:0},currentNode:{},dialogShardVisible:!1,dialogCompVisible:!1,dialogSnodeVisible:!1,dialogRedoVisible:!1,dialogSwitchOVisible:!1,dialogStatusFVisible:!1,dialogDalayVisible:!1,dialogDetailVisible:!1,variableVisible:!1,shardtemp:{old_cluster_name:"",cluster_name:"",snode_count:"",machinelist:[]},comptemp:{old_cluster_name:"",machinelist:[]},snodetemp:{old_cluster_name:"",shard_name:"",machinelist:[]},redotemp:{redolist:[],allow_pull_from_master:"0",allow_replica_delay:"30",need_backup:"0",pv_limit:"10",hdfs_host:""},switchtemp:{replica:"",primary_node:"",shard_id:"",cluster_id:""},dalaytemp:{shard_name:"",maxtime:"100",shard_id:"",cluster_id:""},variabletemp:{ip:"",port:"",vartype:"",variable:"",varvalue:""},detailtemp:{shard_name:"",ip:"",port:"",shard_id:"",cluster_id:"",sync_state:"",status:"",master:"",replica_delay:"",cpu_cores:"",initial_storage_GB:"",max_storage_GB:"",innodb_buffer_pool_MB:"",rocksdb_buffer_pool_MB:""},machinelist:[],machines:[],minMachine:0,machineTotal:0,rules:{},options:[],hdfs_options:[],typeOptions:[{value:"int",label:"int"},{value:"string",label:"string"}],status:[],dialogStatus:"",textMap:{update:"新增计算节点",create:"新增存储集群",detail:"新增存储节点",restore:"重做备机节点",setVariable:"设置实例变量",getVariable:"获取实例变量"},delpriv:""},Object(n["a"])(t,"user_name",sessionStorage.getItem("login_username")),Object(n["a"])(t,"g_loading",!1),Object(n["a"])(t,"dialogStatusVisible",!1),Object(n["a"])(t,"active",0),Object(n["a"])(t,"stepSuc",[0]),Object(n["a"])(t,"stepParams",[]),Object(n["a"])(t,"job_id",""),Object(n["a"])(t,"init_active",0),Object(n["a"])(t,"second_active",0),Object(n["a"])(t,"statusList",[]),Object(n["a"])(t,"ipList",[]),Object(n["a"])(t,"dialogStatusRedoVisible",!1),Object(n["a"])(t,"dialogStatusShowVisible",!1),Object(n["a"])(t,"computer",[]),Object(n["a"])(t,"shard",[]),Object(n["a"])(t,"computer_state",""),Object(n["a"])(t,"storage_state",""),Object(n["a"])(t,"computer_title",""),Object(n["a"])(t,"computer_icon",""),Object(n["a"])(t,"shard_icon",""),Object(n["a"])(t,"shard_title",""),Object(n["a"])(t,"comp_active",0),Object(n["a"])(t,"shard_active",0),Object(n["a"])(t,"strogemachines",[]),Object(n["a"])(t,"init_title",""),Object(n["a"])(t,"init_show",!0),Object(n["a"])(t,"computer_show",!0),Object(n["a"])(t,"shard_show",!0),Object(n["a"])(t,"init_active",0),Object(n["a"])(t,"finish_title",""),Object(n["a"])(t,"finish_icon",""),Object(n["a"])(t,"finish_description",""),Object(n["a"])(t,"computer_description",""),Object(n["a"])(t,"shard_description",""),Object(n["a"])(t,"shardInfo",""),Object(n["a"])(t,"dialogShardInfo",!1),Object(n["a"])(t,"node_status",""),Object(n["a"])(t,"temp_cluster",{}),Object(n["a"])(t,"demoname","---"),Object(n["a"])(t,"range_horizontal",[100,300]),Object(n["a"])(t,"range_vertical",[20,100]),Object(n["a"])(t,"activities",[]),Object(n["a"])(t,"graphOptions",{debug:!0,disableDragNode:!0,backgrounImageNoRepeat:!0,allowShowZoomMenu:!0,layouts:[{label:"中心",layoutName:"tree",layoutClassName:"seeks-layout-center",defaultJunctionPoint:"border",defaultNodeShape:0,defaultLineShape:1,from:"left",min_per_width:"300",max_per_width:"320",min_per_height:"120",max_per_height:"140",levelDistance:""}],defaultLineMarker:{markerWidth:12,markerHeight:12,refX:6,refY:6,data:"M2,2 L10,6 L2,10 L6,6 L2,2"},defaultExpandHolderPosition:"right",defaultNodeShape:1,defaultNodeWidth:"125",defaultLineShape:4,defaultJunctionPoint:"lr",defaultNodeBorderWidth:0,defaultLineColor:"rgba(149, 195, 243, 1)",defaultNodeColor:"rgba(176, 210, 237, 1)",defaultNodeFontColor:"rgba(0, 0, 0, 1)",defaultNodeBorderColor:"rgba(255, 255, 255, 1)"}),Object(n["a"])(t,"rules",{redolist:[{required:!0,trigger:"blur",validator:s}],allow_replica_delay:[{required:!0,trigger:"blur",validator:a}],hdfs_host:[{required:!0,trigger:"blur",validator:i}],maxtime:[{required:!0,trigger:"blur",validator:r}],vartype:[{required:!0,trigger:"blur",validator:o}],variable:[{required:!0,trigger:"blur",validator:l}],varvalue:[{required:!0,trigger:"blur",validator:c}]}),t},created:function(){this.getCluster()},mounted:function(){var t=this,e=setInterval((function(){t.getAllMetaCluster()}),2e4);this.$once("hook:beforeDestroy",(function(){clearInterval(e)}))},destroyed:function(){clearInterval(this.timer),this.timer=null},filters:{nodeStatus:function(t){var e="",s="";return"active"==t.status?(e="在线","true"==t.master?s="主节点":"false"==t.master&&(s="备机节点"),s+"("+e+")"):"inactive"==t.status?(e="异常","true"==t.master?s="主节点":"false"==t.master&&(s="备机节点"),s+"("+e+")"):"manual_stop"==t.status?(e="停止","true"==t.master?s="主节点":"false"==t.master&&(s="备机节点"),s+"("+e+")"):"creating"==t.status?(e="安装中","true"==t.master?s="主节点":"false"==t.master&&(s="备机节点"),s+"("+e+")"):void 0}},methods:{getAllMetaCluster:function(){var t=this,e={user_name:sessionStorage.getItem("login_username")};Object(p["T"])(e).then((function(e){if(e.length>0)for(var s=0;s<e.length;s++)t.open4(e[s])}))},dalayData:function(t){var e=this;this.$refs["dalayForm"].validate((function(s){if(s){var a=t;a.user_name=sessionStorage.getItem("login_username"),Object(p["ub"])(a).then((function(t){var s=t;200==s.code?(e.dialogDalayVisible=!1,e.message_tips=s.message,e.message_type="success",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.message,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},change:function(){this.options.length==this.redotemp.redolist.length?this.redotemp.allow_pull_from_master="1":this.redotemp.allow_pull_from_master="0"},beforeSyncDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},beforeSwitchDestory:function(){clearInterval(this.timer),this.dialogStatusFVisible=!1,this.timer=null},beforeRedoDestory:function(){clearInterval(this.timer),this.dialogStatusRedoVisible=!1,this.timer=null},beforeDelDestory:function(){clearInterval(this.timer),this.dialogStatusShowVisible=!1},resetredotemp:function(){this.redotemp={redolist:[],allow_pull_from_master:"0",allow_replica_delay:"30",need_backup:"0",pv_limit:"10",hdfs_host:""}},resetVariableTemp:function(){this.variabletemp={ip:"",port:"",vartype:"",variable:"",varvalue:""}},getVariable:function(t){var e=this;this.$refs["variableForm"].validate((function(s){if(s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="get_variable",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i={};i.hostaddr=t.ip,i.port=t.port,i.variable=t.variable,a.paras=i,Object(p["nb"])(a).then((function(t){e.isShowNodeMenuPanel=!1;var s=t;e.message_tips="正在获取实例变量...",e.message_type="success",Object(l["g"])(e.message_tips,e.message_type),"0"==s.error_code&&"done"==s.status?(e.message_tips="获取实例变量成功,value="+s.attachment.value,e.message_type="success",e.variableVisible=!1,Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},setVariable:function(t){var e=this;this.$refs["variableForm"].validate((function(s){if(s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="set_variable",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i={};i.hostaddr=t.ip,i.port=t.port,i.type=t.vartype,i.variable=t.variable,i.value=t.varvalue,a.paras=i,Object(p["wb"])(a).then((function(t){e.isShowNodeMenuPanel=!1;var s=t;e.message_tips="正在设置实例变量...",e.message_type="success",Object(l["g"])(e.message_tips,e.message_type),"0"==s.error_code&&"done"==s.status?(e.message_tips="设置实例变量成功",e.message_type="success",e.variableVisible=!1,Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},redoData:function(t){var e=this;this.$refs["redoForm"].validate((function(t){if(t){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="rebuild_node",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";for(var a=[],i=[],r=0;r<e.redotemp.redolist.length;r++){var o=e.redotemp.redolist[r].substring(0,e.redotemp.redolist[r].length-1).split("("),n="";n=e.redotemp.pv_limit?e.redotemp.pv_limit:"10";var c={};if("1"==e.redotemp.need_backup){var u=e.redotemp.hdfs_host.substring(0,e.redotemp.hdfs_host.length-1).replace("(",":");c.hostaddr=o[0],c.port=o[1],c.need_backup=e.redotemp.need_backup,c.hdfs_host=u,c.pv_limit=n}else c.hostaddr=o[0],c.port=o[1],c.need_backup=e.redotemp.need_backup,c.pv_limit=n;a.push(c),i.push({title:o[0]+"_"+o[1],error_code:"0",error_info:"",status:"no_start",step:""})}var m={};"1"==e.redotemp.allow_pull_from_master?(m.shard_id=e.redotemp.shard_id,m.cluster_id=e.redotemp.cluster_id,m.allow_pull_from_master=e.redotemp.allow_pull_from_master,m.rb_nodes=a):(m.shard_id=e.redotemp.shard_id,m.cluster_id=e.redotemp.cluster_id,m.allow_pull_from_master=e.redotemp.allow_pull_from_master,m.allow_replica_delay=e.redotemp.allow_replica_delay,m.rb_nodes=a),s.paras=m,e.dialogStatusRedoVisible=!0,e.dialogRedoVisible=!1,Object(p["qb"])(s).then((function(t){var s=t;if("accept"==s.status){e.dialogRedoVisible=!1,e.stepParams=[];var a=0,r="重做备机节点";e.statusList=[],e.timer=null,e.init_active=0,e.second_active=0,e.getFStatus(e.timer,s.job_id,a++,r,i),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,r,i)}),5e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},switchData:function(t){var e=this;this.$refs["switchForm"].validate((function(t){if(t){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="manual_switch",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";var a=e.switchtemp.primary_node.substring(0,e.switchtemp.primary_node.length-1).replace("(","_"),i={};if(e.switchtemp.replica.length){var r=e.switchtemp.replica.substring(0,e.switchtemp.replica.length-1).replace("(","_");i.shard_id=e.switchtemp.shard_id,i.cluster_id=e.switchtemp.cluster_id,i.master_hostaddr=a,i.assign_hostaddr=r}else i.shard_id=e.switchtemp.shard_id,i.cluster_id=e.switchtemp.cluster_id,i.master_hostaddr=a;s.paras=i,Object(p["Cb"])(s).then((function(t){var s=t;if("accept"==s.status){e.dialogSwitchOVisible=!1,e.stepParams=[];var a=0,i="主备切换";e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null,e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},matchState:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;return!!String(t).match(e)},onNodeCollapse:function(t,e){this.$refs.seeksRelationGraph.refresh()},onNodeExpand:function(t,e){var s=this;if(!t.data.isNeedLoadDataFromRemoteServer)return console.log("这个节点的子节点已经加载过了"),void this.$refs.seeksRelationGraph.refresh();if(t.data.childrenLoaded)return console.log("这个节点的子节点已经加载过了"),void this.$refs.seeksRelationGraph.refresh();t.data.childrenLoaded=!0;var a={};a.shard_id=t.data.shard_id,a.cluster_id=t.data.cluster_id,a.tree_id=t.id,a.ha_mode=t.data.ha_mode,Object(p["W"])(a).then((function(t){var e=t;if(200==e.code){for(var a=t.list,i=0;i<a.nodes.length;i++){var r=a.nodes[i];-1!=r.id.indexOf("snode")&&(s.$set(r.data,"icon","iconfont icon-snode"),"true"==r.data.master?"active"==r.data.status?(s.$set(r.data,"color","#1196db"),s.$set(r,"text",r.data.port+"(主-正常)")):"inactive"==r.data.status?(s.$set(r.data,"color","#e15050"),s.$set(r,"text",r.data.port+"(主-异常)")):"creating"==r.data.status?(s.$set(r.data,"color","#2c2d2d"),s.$set(r,"text",r.data.port+"(主-安装中)")):"manual_stop"==r.data.status?(s.$set(r.data,"color","#acacac"),s.$set(r,"text",r.data.port+"(主-停止)")):(s.$set(r.data,"color","#e15050"),s.$set(r,"text",r.data.port+"(主-异常)")):"false"==r.data.master?"active"==r.data.status?(s.$set(r.data,"color","#e98f36"),s.$set(r,"text",r.data.port+"(备-正常)")):"inactive"==r.data.status?(s.$set(r.data,"color","#e15050"),s.$set(r,"text",r.data.port+"(备-异常)")):"creating"==r.data.status?(s.$set(r.data,"color","#2c2d2d"),s.$set(r,"text",r.data.port+"(备-安装中)")):"manual_stop"==r.data.status?(s.$set(r.data,"color","#acacac"),s.$set(r,"text",r.data.port+"(备-停止)")):(s.$set(r.data,"color","#e15050"),s.$set(r,"text",r.data.port+"(备-异常)")):s.$set(r.data,"color","#e15050"))}s.snode=a,s.g_loading=!0,s.$refs.seeksRelationGraph.appendJsonData(s.snode,(function(t){}))}else s.message_tips=e.message,s.message_type="error",Object(l["g"])(s.message_tips,s.message_type)}))},agreeChange:function(t){var e={id:t};this.temp_cluster={id:t},this.getOneCluster(e)},getCluster:function(){var t=this;return Object(k["a"])(Object(w["a"])().mark((function e(){var s,a,i;return Object(w["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={},s.effectCluster=sessionStorage.getItem("affected_clusters"),s.apply_all_cluster=sessionStorage.getItem("apply_all_cluster"),e.next=5,Object(p["L"])(s);case 5:a=e.sent,a.total>0?(t.currentCase=a.list[0].id,t.clusters=a.list,i={id:a.list[0].id},t.temp_cluster={id:a.list[0].id},t.getOneCluster(i),t.nodataShow=!1,t.g_loading=!0):(t.g_loading=!1,t.nodataShow=!0);case 7:case"end":return e.stop()}}),e)})))()},getOneCluster:function(t){var e=this;Object(p["E"])(t).then((function(t){for(var s=t.list,a=0;a<s.nodes.length;a++){var i=s.nodes[a];"cluster"==i.id&&e.$set(i,"data",{icon:"iconfont  icon-cluster",color:"#533ade"}),-1!=i.id.indexOf("shard")&&(e.$set(i,"expandHolderPosition","right"),e.$set(i,"expanded",!1),e.$set(i.data,"isNeedLoadDataFromRemoteServer",!0),e.$set(i.data,"childrenLoaded",!1),e.$set(i.data,"icon","iconfont icon-shard"),e.$set(i.data,"color","#e98f36")),-1!=i.id.indexOf("cnode")&&(e.$set(i.data,"icon","iconfont icon-compnode"),"manual_stop"==i.data.status?(e.$set(i.data,"color","#acacac"),e.$set(i,"text",i.data.port+"(停止)")):"creating"==i.data.status?(e.$set(i.data,"color","#2c2d2d"),e.$set(i,"text",i.data.port+"(安装中)")):"active"==i.data.status?(e.$set(i.data,"color","#1196db"),e.$set(i,"text",i.data.port+"(正常)")):"inactive"==i.data.status?(e.$set(i.data,"color","#e15050"),e.$set(i,"text",i.data.port+"(异常)")):e.$set(i.data,"color","#e15050"))}e.list=s,e.showSeeksGraph(e.list),setTimeout((function(){e.listLoading=!1}),500)}))},open4:function(t){this.$notify({title:"告警",message:t,type:"warning"})},showSeeksGraph:function(t){var e=this,s=t;this.$refs.seeksRelationGraph.setJsonData(s,(function(t){e.graphOptions.layouts[0].levelDistance=e.levelDistance,e.$refs.seeksRelationGraph.setOptions(e.graphOptions,(function(t){console.log("setOptions:callback:",t)}))}))},onNodeClick:function(t,e){this.currentNode=t;var s=this.$refs.myPage.getBoundingClientRect();"cluster"!=this.currentNode.id&&-1==this.currentNode.text.indexOf("shard")||("shard"==this.currentNode.data.name&&"Y"!==this.shard_drop_priv&&this.currentNode.data.ha_mode||"cluster"==this.currentNode.id||-1!=this.currentNode.text.indexOf("shard")?this.isShowNodeMenuPanel=!1:(this.isShowNodeMenuPanel=!0,this.nodeName=this.currentNode.text,this.node_status=this.currentNode.data.status,-1!=this.currentNode.text.indexOf("shard")?(this.type="shard",this.ha_mode=this.currentNode.data.ha_mode):"cluster"==this.currentNode.id&&(this.type="cluster"),this.nodeMenuPanelPosition.x=e.clientX-s.x,this.nodeMenuPanelPosition.y=e.clientY-s.y))},onLineClick:function(t,e){console.log("onLineClick:",t)},showNodeTips:function(t,e){this.currentNode=t;var s=this.$refs.myPage.getBoundingClientRect();this.isShowNodeTipsPanel=!0,this.nodeMenuPanelPosition.x=e.clientX-s.x+10,this.nodeMenuPanelPosition.y=e.clientY-s.y+10},hideNodeTips:function(t,e){this.isShowNodeMenuPanel=!1},showNodeMenus:function(t,e){this.currentNode=t;var s=this.$refs.myPage.getBoundingClientRect();-1==this.currentNode.id.indexOf("cnode")&&-1==this.currentNode.id.indexOf("snode")||(this.isShowNodeMenuPanel=!0,this.nodeName=this.currentNode.text,this.node_status=this.currentNode.data.status,-1!=this.currentNode.id.indexOf("cnode")?this.type="cnode":-1!=this.currentNode.id.indexOf("snode")&&(this.type="snode",this.master=this.currentNode.data.master)),this.nodeMenuPanelPosition.x=e.clientX-s.x,this.nodeMenuPanelPosition.y=e.clientY-s.y},doAction:function(t){var e=this;if("节点监控"===t)if("pgsql"===this.currentNode.data.name){var s={};s["cluster_id"]=this.currentNode.data.cluster_id,s["hostaddr"]=this.currentNode.data.hostaddr,s["port"]=this.currentNode.data.port,s["user_name"]=sessionStorage.getItem("login_username"),Object(S["c"])(s).then((function(t){"200"==t.code&&window.open(d["h"][0].ip+t.url+"?orgId=1&refresh=5s")}))}else if("mysql"===this.currentNode.data.name){var a={};a["cluster_id"]=this.currentNode.data.cluster_id,a["hostaddr"]=this.currentNode.data.hostaddr,a["port"]=this.currentNode.data.port,a["user_name"]=sessionStorage.getItem("login_username"),Object(S["a"])(a).then((function(t){"200"==t.code&&window.open(d["h"][0].ip+t.url+"?orgId=1&refresh=5s")}))}if("删除"===t)if("shard"===this.currentNode.data.name){var i={id:this.currentNode.data.cluster_id};Object(p["fb"])(i).then((function(t){if(1==t.total)Object(l["g"])("该集群当前有且仅有一个shard,不能进行删除操作","error");else if(t.total>1){var s=Object(l["a"])(),a="此操作将永久删除"+e.currentNode.text+",是否继续?code="+s;Object(l["e"])(a).then((function(t){if(t.value)if(t.value==s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="delete_shard",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i={};i.cluster_id=e.currentNode.data.cluster_id,i.shard_id=e.currentNode.data.shard_id,a.paras=i,Object(p["q"])(a).then((function(t){var s=t;if(s.status="accept"){e.isShowNodeMenuPanel=!1,e.dialogStatusShowVisible=!0;var a=0;e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null;var i="删除shard";e.getFStatus(e.timer,s.job_id,a++,i,""),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))}}))}else if("pgsql"===this.currentNode.data.name){var r={id:this.currentNode.data.cluster_id};Object(p["I"])(r).then((function(t){if(1==t.total)Object(l["g"])("该集群当前有且仅有一个计算节点,不能进行删除操作","error");else if(t.total>1){var s=Object(l["a"])(),a="此操作将永久删除计算节点"+e.currentNode.data.hostaddr+"("+e.currentNode.text+"), 是否继续?code="+s;Object(l["e"])(a).then((function(t){if(t.value)if(t.value==s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="delete_comp",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i={};i.cluster_id=e.currentNode.data.cluster_id,i.nick_name=e.currentNode.data.nick_name,i.comp_id=e.currentNode.data.comp_id,a.paras=i,Object(p["o"])(a).then((function(t){var s=t;if("accept"==s.status){e.isShowNodeMenuPanel=!1,e.dialogStatusShowVisible=!0;var a=0;e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null;var i="删除计算节点";e.getFStatus(e.timer,s.job_id,a++,i,""),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))}}))}else if("mysql"===this.currentNode.data.name){var o={id:this.currentNode.data.cluster_id,shard_id:this.currentNode.data.shard_id};Object(p["X"])(o).then((function(t){if(1==t.total)Object(l["g"])("该集群当前有且仅有一个存储节点,不能进行删除操作","error");else if(t.total>1){var s=Object(l["a"])(),a="此操作将永久删除存储节点"+e.currentNode.data.hostaddr+"("+e.currentNode.text+"),是否继续?code="+s;Object(l["e"])(a).then((function(t){if(t.value)if(t.value==s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="delete_node",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i={};i.cluster_id=e.currentNode.data.cluster_id,i.shard_id=e.currentNode.data.shard_id,i.hostaddr=e.currentNode.data.hostaddr,i.port=e.currentNode.data.port,i.nick_name=e.currentNode.data.nick_name,a.paras=i,Object(p["r"])(a).then((function(t){var s=t;if("accept"==s.status){e.isShowNodeMenuPanel=!1,e.dialogStatusShowVisible=!0;var a=0;e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null;var i="删除存储节点";e.getFStatus(e.timer,s.job_id,a++,i,""),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))}}))}if("启用"===t&&("pgsql"===this.currentNode.data.name&&Object(l["f"])("是否继续启用"+this.currentNode.text+"该计算节点?").then((function(){var t={};t.user_name=sessionStorage.getItem("login_username"),t.job_id="",t.job_type="control_instance",t.version=d["u"][0].ver,t.timestamp=d["s"][0].time+"";var s={control:"start"};s.hostaddr=e.currentNode.data.hostaddr,s.port=e.currentNode.data.port,s.cluster_id=e.currentNode.data.cluster_id,s.machine_type="computer",t.paras=s;var a={list:t,type:"pgsql"};Object(p["yb"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在启动计算节点"+e.currentNode.text,timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a);var i=0;e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),5e3),e.isShowNodeMenuPanel=!1}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")})),"mysql"===this.currentNode.data.name&&Object(l["f"])("是否继续启用"+this.currentNode.text+"该存储节点?").then((function(){var t={};t.user_name=sessionStorage.getItem("login_username"),t.job_id="",t.job_type="control_instance",t.version=d["u"][0].ver,t.timestamp=d["s"][0].time+"";var s={control:"start"};s.hostaddr=e.currentNode.data.hostaddr,s.port=e.currentNode.data.port,s.cluster_id=e.currentNode.data.cluster_id,s.shard_id=e.currentNode.data.shard_id,s.machine_type="storage",t.paras=s;var a={list:t,type:"mysql"};Object(p["zb"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在启动存储节点"+e.currentNode.text,timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a);var i=0;e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),5e3),e.isShowNodeMenuPanel=!1}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))),"禁用"===t&&("pgsql"===this.currentNode.data.name&&Object(l["f"])("是否继续禁用"+this.currentNode.text+"该计算节点?").then((function(){var t={};t.user_name=sessionStorage.getItem("login_username"),t.job_id="",t.job_type="control_instance",t.version=d["u"][0].ver,t.timestamp=d["s"][0].time+"";var s={control:"stop"};s.hostaddr=e.currentNode.data.hostaddr,s.port=e.currentNode.data.port,s.cluster_id=e.currentNode.data.cluster_id,s.machine_type="computer",t.paras=s;var a={list:t,type:"pgsql"};Object(p["Ab"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在禁用计算节点"+e.currentNode.text,timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a);var i=0;e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),5e3),e.isShowNodeMenuPanel=!1}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")})),"mysql"===this.currentNode.data.name&&Object(l["f"])("是否继续禁用"+this.currentNode.text+"该存储节点?").then((function(){var t={};t.user_name=sessionStorage.getItem("login_username"),t.job_id="",t.job_type="control_instance",t.version=d["u"][0].ver,t.timestamp=d["s"][0].time+"";var s={control:"stop"};s.hostaddr=e.currentNode.data.hostaddr,s.port=e.currentNode.data.port,s.cluster_id=e.currentNode.data.cluster_id,s.shard_id=e.currentNode.data.shard_id,s.machine_type="storage",t.paras=s;var a={list:t,type:"mysql"};Object(p["Bb"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在禁用存储节点"+e.currentNode.text,timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a),e.isShowNodeMenuPanel=!1;var i=0;e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),5e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))),"重启"===t&&("pgsql"===this.currentNode.data.name&&Object(l["f"])("是否继续重启"+this.currentNode.text+"该计算节点?").then((function(){var t={};t.user_name=sessionStorage.getItem("login_username"),t.job_id="",t.job_type="control_instance",t.version=d["u"][0].ver,t.timestamp=d["s"][0].time+"";var s={control:"restart"};s.hostaddr=e.currentNode.data.hostaddr,s.port=e.currentNode.data.port,s.cluster_id=e.currentNode.data.cluster_id,s.machine_type="computer",t.paras=s;var a={list:t,type:"pgsql"};Object(p["rb"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在重启计算节点"+e.currentNode.text,timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a);var i=0;e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),5e3),e.isShowNodeMenuPanel=!1}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")})),"mysql"===this.currentNode.data.name&&Object(l["f"])("是否继续重启"+this.currentNode.text+"该存储节点?").then((function(){var t={};t.user_name=sessionStorage.getItem("login_username"),t.job_id="",t.job_type="control_instance",t.version=d["u"][0].ver,t.timestamp=d["s"][0].time+"";var s={control:"restart"};s.hostaddr=e.currentNode.data.hostaddr,s.port=e.currentNode.data.port,s.cluster_id=e.currentNode.data.cluster_id,s.shard_id=e.currentNode.data.shard_id,s.machine_type="storage",t.paras=s;var a={list:t,type:"mysql"};Object(p["sb"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在重启存储节点"+e.currentNode.text,timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a),e.isShowNodeMenuPanel=!1;var i=0;e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),5e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))),"新增存储集群"===t&&(this.shardtemp.old_cluster_name=this.currentNode.text,this.shardtemp.cluster_name=this.currentNode.data.cluster_name,this.dialogShardVisible=!0,Object(p["w"])().then((function(t){e.machines=t.list,e.minMachine=0,e.machineTotal=t.total}))),"新增计算节点"===t&&(this.comptemp.old_cluster_name=this.currentNode.text,this.dialogCompVisible=!0,Object(p["w"])().then((function(t){e.machines=t.list,e.minMachine=0,e.machineTotal=t.total}))),"新增存储节点"===t&&(this.snodetemp.shard_name=this.currentNode.text,this.snodetemp.old_cluster_name=this.currentNode.data.cluster_name,this.dialogSnodeVisible=!0,Object(p["w"])().then((function(t){e.machines=t.list,e.minMachine=0,e.machineTotal=t.total}))),"重做备机节点"===t){this.resetredotemp(),this.redotemp.shard_id=this.currentNode.data.shard_id,this.redotemp.cluster_id=this.currentNode.data.cluster_id,this.dialogRedoVisible=!0,Object(p["A"])().then((function(t){if(e.hdfs_options=[],null!==t.list)for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].hostaddr+"("+t.list[s].port+")"};e.hdfs_options.push(a)}}));var n={};n.cluster_id=this.currentNode.data.cluster_id,n.shard_id=this.currentNode.data.shard_id,n.ha_mode=this.currentNode.data.ha_mode,Object(p["ib"])(n).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))}if("主备切换"===t){this.redotemp.shard_name=this.currentNode.text,this.dialogSwitchOVisible=!0;var c={};c.cluster_id=this.currentNode.data.cluster_id,c.shard_id=this.currentNode.data.shard_id,c.ha_mode=this.currentNode.data.ha_mode,this.switchtemp.shard_id=this.currentNode.data.shard_id,this.switchtemp.cluster_id=this.currentNode.data.cluster_id,Object(p["cb"])(c).then((function(t){t.list.length>0&&(e.switchtemp.primary_node=t.list[0].ip+"("+t.list[0].port+")")}));var u={};u.cluster_id=this.currentNode.data.cluster_id,u.shard_id=this.currentNode.data.shard_id,u.ha_mode=this.currentNode.data.ha_mode,Object(p["ib"])(u).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))}"设置延迟告警时间"===t&&(this.dalaytemp.shard_name=this.currentNode.text,this.dalaytemp.cluster_id=this.currentNode.data.cluster_id,this.dalaytemp.shard_id=this.currentNode.data.shard_id,this.dialogDalayVisible=!0),"详情"===t&&(this.isShowNodeMenuPanel=!1,this.detailtemp.cluster_id=this.currentNode.data.cluster_id,this.detailtemp.cpu_cores=this.currentNode.data.cpu_cores,this.detailtemp.replica_delay=this.currentNode.data.delay,this.detailtemp.ip=this.currentNode.data.hostaddr,this.detailtemp.port=this.currentNode.data.port,this.detailtemp.initial_storage_GB=this.currentNode.data.initial_storage_GB,this.detailtemp.innodb_buffer_pool_MB=this.currentNode.data.innodb_buffer_pool_MB,this.detailtemp.master=this.currentNode.data.master,this.detailtemp.max_storage_GB=this.currentNode.data.max_storage_GB,this.detailtemp.rocksdb_buffer_pool_MB=this.currentNode.data.rocksdb_buffer_pool_MB,this.detailtemp.shard_id=this.currentNode.data.shard_id,this.detailtemp.shard_name=this.currentNode.data.shard_name,this.detailtemp.sync_state=this.currentNode.data.sync_status,this.detailtemp.status=this.currentNode.data.status,this.dialogDetailVisible=!0),"设置实例变量"===t&&(this.resetVariableTemp(),this.dialogStatus="setVariable",this.variabletemp.ip=this.currentNode.data.hostaddr,this.variabletemp.port=this.currentNode.data.port,this.variableVisible=!0),"获取实例变量"===t&&(this.resetVariableTemp(),this.dialogStatus="getVariable",this.variabletemp.ip=this.currentNode.data.hostaddr,this.variabletemp.port=this.currentNode.data.port,this.variableVisible=!0)},getFStatus:function(t,e,s,a,i){var r=this;setTimeout((function(){var o={job_type:"get_status"};o.version=d["u"][0].ver,o.timestamp=d["s"][0].time+"",o.job_id=e,o.paras={},r.job_id="任务ID:"+e,Object(p["N"])(o).then((function(e){if("主备切换"==a)if(null!==e.attachment){r.dialogStatusFVisible=!0;var o=e.attachment.job_step.replace(/\s+/g,"").split(",");if(0==r.stepParams.length)for(var n=0;n<o.length;n++){var c={};if(0==n?(c.title=o[n],c.icon="el-icon-loading",c.status="process",c.description=""):(c.title=o[n],c.icon="",c.status="wait",c.description=""),e.attachment.step==o[n]){if(n>r.active)for(var d=0;d<r.stepParams.length;d++)if(d==n&&"wait"==r.stepParams[d].status&&(r.stepParams[d].icon="el-icon-loading",r.stepParams[d].status="process"),d>0&&d<n)for(var p=0;p<d;p++)r.stepParams[p].icon="el-icon-circle-check",r.stepParams[p].status="success";r.active=n}r.stepParams.push(c)}else if("ongoing"==e.status){for(var u=0;u<r.stepParams.length;u++)if(e.attachment.step==r.stepParams[u].title&&(r.active=u,r.stepParams[u].icon="el-icon-loading",r.stepParams[u].status="process",u>0&&u<r.active+1))for(var m=0;m<u;m++)r.stepParams[m].icon="el-icon-circle-check",r.stepParams[m].status="success"}else if("done"==e.status){for(var _=0;_<r.stepParams.length;_++)r.active=r.stepParams.length,r.stepParams[_].icon="el-icon-circle-check",r.stepParams[_].status="success";clearInterval(t),r.getOneCluster(r.temp_cluster)}else if("failed"==e.status){for(var h=0;h<r.stepParams.length;h++)"process"==r.stepParams[h].status&&(r.active=h,r.stepParams[h].icon="el-icon-circle-close",r.stepParams[h].status="error",r.stepParams[h].description=e.error_info);clearInterval(t)}}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status&&s>5&&clearInterval(t);else if("重做备机节点"==a)if(null!==e.attachment)if(0==r.statusList.length){var f={};if("failed"==e.status)f={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_info,second:[]},r.statusList.push(f),clearInterval(t);else for(var g=0;g<i.length;g++){for(var v=e.attachment.job_step.replace(/\s+/g,"").split(","),b={},y=[],x=0;x<v.length;x++)b={title:v[x],icon:"",status:"wait",description:""},y.push(b);if(0==g){if(f={title:i[g].title,icon:"el-icon-loading",status:"process",description:"",second:y},r.statusList.push(f),"done"==i[g].status){r.init_active=g+1,r.statusList[g].icon="el-icon-circle-check",r.statusList[g].status="success";for(var w=0;w<r.statusList[g].second.length;w++)r.statusList[g].second[w].icon="el-icon-circle-check",r.statusList[g].second[w].status="success"}else if("ongoing"==i[g].status){r.init_active=g,r.statusList[g].icon="el-icon-loading",r.statusList[g].status="process";for(var k=0;k<r.statusList[g].second.length;k++)if(i[g].step==r.statusList[g].second[k].title){r.statusList[g].second[k].icon="el-icon-loading",r.statusList[g].second[k].status="process";for(var S=0;S<k;S++)r.statusList[g].second[S].icon="el-icon-circle-check",r.statusList[g].second[S].status="success"}}else if("failed"==i[g].status){r.statusList[g].icon="el-icon-circle-close",r.statusList[g].status="error";for(var j=0;j<r.statusList[g].second.length;j++)if(i[g].step==r.statusList[g].second[j].title){r.statusList[g].second[j].icon="el-icon-circle-close",r.statusList[g].second[j].status="error";for(var O=0;O<j;O++)r.statusList[g].second[O].icon="el-icon-circle-check",r.statusList[g].second[O].status="success"}r.statusList[g].description=i[g].error_info}}else{for(var L=e.attachment.job_step.replace(/\s+/g,"").split(","),I={},C=[],$=0;$<L.length;$++)I={title:L[$],icon:"",status:"wait",description:""},C.push(I);if(0==r.init_active?(f={title:i[g].title,icon:"",status:"wait",description:"",second:C},r.statusList.push(f)):(f={title:i[g].title,icon:"el-icon-loading",status:"process",description:"",second:C},r.statusList.push(f)),"done"==i[g].status){r.init_active=g+1,r.statusList[g].icon="el-icon-circle-check",r.statusList[g].status="success";for(var N=0;N<r.statusList[g].second.length;N++)r.statusList[g].second[N].icon="el-icon-circle-check",r.statusList[g].second[N].status="success"}else if("ongoing"==i[g].status){r.init_active=g,r.statusList[g].icon="el-icon-loading",r.statusList[g].status="process";for(var V=0;V<r.statusList[g].second.length;V++)if(i[g].step==r.statusList[g].second[V].title){r.statusList[g].second[V].icon="el-icon-loading",r.statusList[g].second[V].status="process";for(var E=0;E<V;E++)r.statusList[g].second[E].icon="el-icon-circle-check",r.statusList[g].second[E].status="success"}}else if("failed"==i[g].status){r.statusList[g].icon="el-icon-circle-close",r.statusList[g].status="error";for(var T=0;T<r.statusList[g].second.length;T++)if(i[g].step==r.statusList[g].second[T].title){r.statusList[g].second[T].icon="el-icon-circle-close",r.statusList[g].second[T].status="error";for(var D=0;D<T;D++)r.statusList[g].second[D].icon="el-icon-circle-check",r.statusList[g].second[D].status="success"}r.statusList[g].description=i[g].error_info}}}}else if("ongoing"==e.status){var F=[];for(var P in e.attachment)if("job_step"!==P){var M=e.attachment[P];r.$set(M,"title",P),F.push(M)}for(var R=0;R<F.length;R++)if(0==R){if("done"==F[R].status){r.init_active=R+1,r.statusList[R].icon="el-icon-circle-check",r.statusList[R].status="success";for(var q=0;q<r.statusList[R].second.length;q++)r.statusList[R].second[q].icon="el-icon-circle-check",r.statusList[R].second[q].status="success"}else if("ongoing"==F[R].status){r.init_active=R,r.statusList[R].icon="el-icon-loading",r.statusList[R].status="process";for(var z=0;z<r.statusList[R].second.length;z++)if(F[R].step==r.statusList[R].second[z].title){r.statusList[R].second[z].icon="el-icon-loading",r.statusList[R].second[z].status="process";for(var B=0;B<z;B++)r.statusList[R].second[B].icon="el-icon-circle-check",r.statusList[R].second[B].status="success"}}else if("failed"==F[R].status){r.statusList[R].icon="el-icon-circle-close",r.statusList[R].status="error";for(var Q=0;Q<r.statusList[R].second.length;Q++)if(F[R].step==r.statusList[R].second[Q].title){r.statusList[R].second[Q].icon="el-icon-circle-close",r.statusList[R].second[Q].status="error";for(var A=0;A<Q;A++)r.statusList[R].second[A].icon="el-icon-circle-check",r.statusList[R].second[A].status="success"}r.statusList[R].description=F[R].error_info}}else if("done"==F[R].status){r.init_active=R+1,r.statusList[R].icon="el-icon-circle-check",r.statusList[R].status="success";for(var J=0;J<r.statusList[R].second.length;J++)r.statusList[R].second[J].icon="el-icon-circle-check",r.statusList[R].second[J].status="success"}else if("ongoing"==F[R].status){r.init_active=R,r.statusList[R].icon="el-icon-loading",r.statusList[R].status="process";for(var H=0;H<r.statusList[R].second.length;H++)if(F[R].step==r.statusList[R].second[H].title){r.statusList[R].second[H].icon="el-icon-loading",r.statusList[R].second[H].status="process";for(var G=0;G<H;G++)r.statusList[R].second[G].icon="el-icon-circle-check",r.statusList[R].second[G].status="success"}}else if("failed"==F[R].status){r.statusList[R].icon="el-icon-circle-close",r.statusList[R].status="error";for(var Y=0;Y<r.statusList[R].second.length;Y++)if(F[R].step==r.statusList[R].second[Y].title){r.statusList[R].second[Y].icon="el-icon-circle-close",r.statusList[R].second[Y].status="error";for(var U=0;U<Y;U++)r.statusList[R].second[U].icon="el-icon-circle-check",r.statusList[R].second[U].status="success"}r.statusList[R].description=F[R].error_info}}else if("failed"==e.status){var K=[];for(var X in e.attachment)if("job_step"!==X){var W=e.attachment[X];r.$set(W,"title",X),K.push(W)}for(var Z=0;Z<K.length;Z++)if(0==Z){if("done"==K[Z].status){r.init_active=Z+1,r.statusList[Z].icon="el-icon-circle-check",r.statusList[Z].status="success";for(var tt=0;tt<r.statusList[Z].second.length;tt++)r.statusList[Z].second[tt].icon="el-icon-circle-check",r.statusList[Z].second[tt].status="success"}else if("ongoing"==K[Z].status){r.init_active=Z,r.statusList[Z].icon="el-icon-loading",r.statusList[Z].status="process";for(var et=0;et<r.statusList[Z].second.length;et++)if(K[Z].step==r.statusList[Z].second[et].title){r.statusList[Z].second[et].icon="el-icon-loading",r.statusList[Z].second[et].status="process";for(var st=0;st<et;st++)r.statusList[Z].second[st].icon="el-icon-circle-check",r.statusList[Z].second[st].status="success"}}else if("failed"==K[Z].status){r.statusList[Z].icon="el-icon-circle-close",r.statusList[Z].status="error";for(var at=0;at<r.statusList[Z].second.length;at++)if(K[Z].step==r.statusList[Z].second[at].title){r.statusList[Z].second[at].icon="el-icon-circle-close",r.statusList[Z].second[at].status="error";for(var it=0;it<at;it++)r.statusList[Z].second[it].icon="el-icon-circle-check",r.statusList[Z].second[it].status="success"}r.statusList[Z].description=K[Z].error_info}}else if("done"==K[Z].status){r.init_active=Z+1,r.statusList[Z].icon="el-icon-circle-check",r.statusList[Z].status="success";for(var rt=0;rt<r.statusList[Z].second.length;rt++)r.statusList[Z].second[rt].icon="el-icon-circle-check",r.statusList[Z].second[rt].status="success"}else if("ongoing"==K[Z].status){r.init_active=Z,r.statusList[Z].icon="el-icon-loading",r.statusList[Z].status="process";for(var ot=0;ot<r.statusList[Z].second.length;ot++)if(K[Z].step==r.statusList[Z].second[ot].title){r.statusList[Z].second[ot].icon="el-icon-loading",r.statusList[Z].second[ot].status="process";for(var nt=0;nt<ot;nt++)r.statusList[Z].second[nt].icon="el-icon-circle-check",r.statusList[Z].second[nt].status="success"}}else if("failed"==K[Z].status){r.statusList[Z].icon="el-icon-circle-close",r.statusList[Z].status="error";for(var lt=0;lt<r.statusList[Z].second.length;lt++)if(K[Z].step==r.statusList[Z].second[lt].title){r.statusList[Z].second[lt].icon="el-icon-circle-close",r.statusList[Z].second[lt].status="error";for(var ct=0;ct<lt;ct++)r.statusList[Z].second[ct].icon="el-icon-circle-check",r.statusList[Z].second[ct].status="success"}r.statusList[Z].description=K[Z].error_info}var dt={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_info,second:""};r.statusList.push(dt),clearInterval(t)}else if("done"==e.status){var pt=[];for(var ut in e.attachment)if("job_step"!==ut){var mt=e.attachment[ut];r.$set(mt,"title",ut),pt.push(mt)}for(var _t=0;_t<pt.length;_t++)if(0==_t){if("done"==pt[_t].status){r.init_active=_t+1,r.statusList[_t].icon="el-icon-circle-check",r.statusList[_t].status="success";for(var ht=0;ht<r.statusList[_t].second.length;ht++)r.statusList[_t].second[ht].icon="el-icon-circle-check",r.statusList[_t].second[ht].status="success"}else if("ongoing"==pt[_t].status){r.init_active=_t,r.statusList[_t].icon="el-icon-loading",r.statusList[_t].status="process";for(var ft=0;ft<r.statusList[_t].second.length;ft++)if(pt[_t].step==r.statusList[_t].second[ft].title){r.statusList[_t].second[ft].icon="el-icon-loading",r.statusList[_t].second[ft].status="process";for(var gt=0;gt<ft;gt++)r.statusList[_t].second[gt].icon="el-icon-circle-check",r.statusList[_t].second[gt].status="success"}}else if("failed"==pt[_t].status){r.statusList[_t].icon="el-icon-circle-close",r.statusList[_t].status="error";for(var vt=0;vt<r.statusList[_t].second.length;vt++)if(pt[_t].step==r.statusList[_t].second[vt].title){r.statusList[_t].second[vt].icon="el-icon-circle-close",r.statusList[_t].second[vt].status="error";for(var bt=0;bt<vt;bt++)r.statusList[_t].second[bt].icon="el-icon-circle-check",r.statusList[_t].second[bt].status="success"}r.statusList[_t].description=pt[_t].error_info}}else if("done"==pt[_t].status){r.init_active=_t+1,r.statusList[_t].icon="el-icon-circle-check",r.statusList[_t].status="success";for(var yt=0;yt<r.statusList[_t].second.length;yt++)r.statusList[_t].second[yt].icon="el-icon-circle-check",r.statusList[_t].second[yt].status="success"}else if("ongoing"==pt[_t].status){r.init_active=_t,r.statusList[_t].icon="el-icon-loading",r.statusList[_t].status="process";for(var xt=0;xt<r.statusList[_t].second.length;xt++)if(pt[_t].step==r.statusList[_t].second[xt].title){r.statusList[_t].second[xt].icon="el-icon-loading",r.statusList[_t].second[xt].status="process";for(var wt=0;wt<xt;wt++)r.statusList[_t].second[wt].icon="el-icon-circle-check",r.statusList[_t].second[wt].status="success"}}else if("failed"==pt[_t].status){r.statusList[_t].icon="el-icon-circle-close",r.statusList[_t].status="error";for(var kt=0;kt<r.statusList[_t].second.length;kt++)if(pt[_t].step==r.statusList[_t].second[kt].title){r.statusList[_t].second[kt].icon="el-icon-circle-close",r.statusList[_t].second[kt].status="error";for(var St=0;St<kt;St++)r.statusList[_t].second[St].icon="el-icon-circle-check",r.statusList[_t].second[St].status="success"}r.statusList[_t].description=pt[_t].error_info}var jt={title:a+"成功",icon:"el-icon-circle-check",status:"success",description:"",second:""};r.statusList.push(jt),clearInterval(t)}else r.message_tips=e.error_info,r.message_type="error",Object(l["g"])(r.message_tips,r.message_type);else if(null==e.attachment&&"70001"==e.error_code&&"failed"==e.status){if(s>5){var Ot={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_code,second:[]};r.statusList.push(Ot),clearInterval(t)}}else if(null==e.attachment&&"ongoing"==e.status){r.statusList=[];var Lt={};Lt={title:"正在"+a,icon:"el-icon-loading",status:"process",description:"",second:[]},r.statusList.push(Lt)}else if(null==e.attachment&&"done"==e.status){r.statusList=[];var It={};It={title:a+"成功",icon:"el-icon-circle-check",status:"success",description:"",second:[]},r.statusList.push(It),clearInterval(t)}else{r.statusList=[];var Ct={};Ct={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_code,second:[]},r.statusList.push(Ct),clearInterval(t)}else if("删除shard"==a||"删除计算节点"==a||"删除存储节点"==a)if(null!==e.attachment){if("删除shard"==a||"删除存储节点"==a?(r.shard_show=!0,r.init_show=!1,r.computer_show=!1):"删除计算节点"==a&&(r.shard_show=!1,r.init_show=!1,r.computer_show=!0),"ongoing"==e.attachment.computer_state?(console.log(11),r.computer_state="process",r.computer_icon="el-icon-loading",r.computer_title="正在"+a):"done"==e.attachment.computer_state?(r.computer_state="success",r.computer_icon="el-icon-circle-check",r.computer_title=a+"成功",console.log(12)):"failed"==e.attachment.computer_state?(r.computer_state="error",r.computer_icon="el-icon-circle-close",r.computer_title=a+"失败",console.log(13)):(r.computer_state="process",r.computer_icon="el-icon-loading",r.computer_title="正在"+a,console.log(14)),"ongoing"==e.attachment.storage_state?(r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a):"done"==e.attachment.storage_state?(console.log(4),r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功"):"failed"==e.attachment.storage_state?(console.log(5),r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败"):(console.log(6),r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a),r.init_title="正在"+a,r.init_active=1,0==r.computer.length||0==r.shard.length){if(1==r.computer_show&&0==r.computer.length){var $t={};if(e.attachment.hasOwnProperty("computer_hosts"))for(var Nt=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Vt=Nt.split(";"),Et=0;Et<Vt.length;Et++)"done"==e.attachment.computer_state?($t.title=!0===e.attachment.hasOwnProperty("computer_hosts")?Vt[Et]:"正在"+a,$t.icon="el-icon-circle-check",$t.status="success",$t.description="",$t.computer_id=e.attachment.computer_id,r.computer.push($t)):"failed"==e.attachment.computer_state?($t.title=!0===e.attachment.hasOwnProperty("computer_hosts")?Vt[Et]:"正在"+a,$t.icon="el-icon-circle-close",$t.status="error",$t.description=e.error_info,$t.computer_id=e.attachment.computer_id,r.computer.push($t)):($t.title=!0===e.attachment.hasOwnProperty("computer_hosts")?Vt[Et]:"正在"+a,$t.icon="el-icon-loading",$t.status="process",$t.description="",$t.computer_id=e.attachment.computer_id,r.computer.push($t))}if(1==r.shard_show&&0==r.shard.length&&(console.log(2),e.attachment.hasOwnProperty("storage_state")))if("done"==e.attachment.storage_state){var Tt="";if("新增shard"==a){Tt=e.attachment.shard_ids;for(var Dt={},Ft=0;Ft<Tt.length;Ft++)for(var Pt in Tt[Ft]){var Mt=Tt[Ft][Pt],Rt=Pt+":"+Mt;Dt.title=""!==Mt?Rt:"正在"+a,Dt.icon="el-icon-circle-check",Dt.status="success",Dt.description="",Dt.shard_id=Mt,r.shard.push(Dt)}}else{Tt=e.attachment.shard_id;var qt={};qt.title=""!==Tt?Tt:"正在"+a,qt.icon="el-icon-circle-check",qt.status="success",qt.description="",qt.shard_id=Mt,r.shard.push(qt)}}else if("failed"==e.attachment.storage_state){var zt="";if("新增shard"==a){zt=e.attachment.shard_ids;for(var Bt={},Qt=0;Qt<zt.length;Qt++)for(var Pt in zt[Qt]){Mt=zt[Qt][Pt];var At=Pt+":"+Mt;Bt.title=""!==Mt?At:"正在"+a,Bt.icon="el-icon-circle-close",Bt.status="error",Bt.description=e.error_info,Bt.shard_id=Mt,r.shard.push(Bt)}}else{zt=e.attachment.shard_id;var Jt={};Jt.title=""!==zt?zt:"正在"+a,Jt.icon="el-icon-circle-close",Jt.status="error",Jt.description=e.error_info,Jt.shard_id=Mt,r.shard.push(Jt)}}else{var Ht="";if("新增shard"==a){Ht=e.attachment.shard_ids;for(var Gt={},Yt=0;Yt<Ht.length;Yt++)for(var Pt in Ht[Yt]){Mt=Ht[Yt][Pt];var Ut=Pt+":"+Mt;Gt.title=""!==Mt?Ut:"正在"+a,Gt.icon="el-icon-loading",Gt.status="process",Gt.description="",Gt.shard_id=Mt,r.shard.push(Gt)}}else{Ht=e.attachment.shard_id;var Kt={};Kt.title=""!==Ht?Ht:"正在"+a,Kt.icon="el-icon-loading",Kt.status="process",Kt.description="",Kt.shard_id=Ht,r.shard.push(Kt)}}if("failed"==e.status){if(r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",r.init_show=!1,r.computer_state="error",r.computer_icon="el-icon-circle-close",r.computer_title=a+"失败",r.finish_title=a+"失败",r.finish_icon="el-icon-circle-close",r.init_active=1,r.finish_description=e.error_info,r.computer.length>0){for(var Xt=0;Xt<r.computer.length;Xt++)for(var Wt=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Zt=Wt.split(";"),te=0;te<Zt.length;te++)r.computer[Xt].title==Zt[te]&&(r.computer[Xt].icon="el-icon-circle-close",r.computer[Xt].status="error");r.computer_description=e.error_info}if(r.shard.length>0){for(var ee=0;ee<r.shard.length;ee++){var se="";if("新增shard"==a){se=e.attachment.shard_ids;for(var ae=0;ae<se.length;ae++)for(var Pt in se[ae]){Mt=se[ae][Pt];r.shard[ee].shard_id==Mt&&(r.shard[ee].icon="el-icon-circle-close",r.shard[ee].status="error")}}else se=e.attachment.shard_id,r.shard[ee].shard_id==se&&(r.shard[ee].icon="el-icon-circle-close",r.shard[ee].status="error")}r.shard_description=e.error_info}clearInterval(t)}else if("done"==e.status){if(r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功",r.computer_state="success",r.computer_icon="el-icon-circle-check",r.computer_title=a+"成功",r.finish_title=a+"成功",r.finish_icon="el-icon-circle-check",r.init_active=1,r.finish_description=e.error_info,r.computer.length>0)for(var ie=0;ie<r.computer.length;ie++)for(var re=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),oe=re.split(";"),ne=0;ne<oe.length;ne++)r.computer[ie].title==oe[ne]&&(r.computer[ie].icon="el-icon-circle-check",r.computer[ie].status="success");if(r.shard.length>0)for(var le=0;le<r.shard.length;le++){var ce="";if("新增shard"==a){ce=e.attachment.shard_ids;for(var de=0;de<ce.length;de++)for(var Pt in ce[de]){Mt=ce[de][Pt];r.shard[le].shard_id==Mt&&(r.shard[le].icon="el-icon-circle-check",r.shard[le].status="success")}}else ce=e.attachment.shard_id,r.shard[le].shard_id==ce&&(r.shard[le].icon="el-icon-circle-check",r.shard[le].status="success")}clearInterval(t),r.getOneCluster(r.temp_cluster)}}}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?"删除shard"==a||"删除存储节点"==a?(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a,s>5&&(r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",clearInterval(t))):"删除计算节点"==a&&(r.shard_show=!1,r.init_show=!1,r.computer_show=!0,r.computer_state="process",r.computer_icon="el-icon-loading",r.computer_title="正在"+a,s>5&&(r.computer_state="error",r.computer_icon="el-icon-circle-close",r.computer_title=a+"失败",clearInterval(t))):null==e.attachment&&"ongoing"==e.status?"删除shard"==a||"删除存储节点"==a?(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a):"删除计算节点"==a&&(r.shard_show=!1,r.init_show=!1,r.computer_show=!0,r.computer_state="process",r.computer_icon="el-icon-loading",r.computer_title="正在"+a):null==e.attachment&&"done"==e.status?("删除shard"==a||"删除存储节点"==a?(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功"):"删除计算节点"==a&&(r.shard_show=!1,r.init_show=!1,r.computer_show=!0,r.computer_state="success",r.computer_icon="el-icon-circle-check",r.computer_title=a+"成功"),clearInterval(t)):("删除shard"==a||"删除存储节点"==a?(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败"):"删除计算节点"==a&&(r.shard_show=!1,r.init_show=!1,r.computer_show=!0,r.computer_state="error",r.computer_icon="el-icon-circle-close",r.computer_title=a+"失败"),clearInterval(t))})),s>=86400&&clearInterval(t)}),0)},getStatus:function(t,e,s){var a=this;setTimeout((function(){var i={job_type:"get_status"};i.version=d["u"][0].ver,i.job_id=e,i.timestamp=d["s"][0].time+"",i.paras={},Object(p["N"])(i).then((function(e){if("done"==e.status||"failed"==e.status)if("done"==e.status){var i={content:e.error_info,timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};a.activities.push(i),a.getOneCluster(a.temp_cluster),clearInterval(t)}else if(null==e.attachment&&"70001"==e.error_code&&"failed"==e.status){if(s>5){var r={content:e.error_info,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(r),clearInterval(t)}}else{var o={content:e.error_info,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(o),clearInterval(t)}else{var n={content:e.error_info,timestamp:Object(l["d"])(),color:"#0bbd87"};a.activities.push(n),a.info=e.error_info,a.installStatus=!0}})),s>=86400&&clearInterval(t)}),0)}}},I=L,C=(s("9c15"),s("a1fa"),Object(f["a"])(I,y,x,!1,null,"63c597d3",null)),$=C.exports,N=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("div",{staticClass:"table-list-search-wrap"},[s("el-input",{staticClass:"list_search_keyword",attrs:{placeholder:"可输入集群名称搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.name,callback:function(e){t.$set(t.listQuery,"name",e)},expression:"listQuery.name"}}),s("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v(" 查询 ")]),s("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v(" 重置 ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.installStatus,expression:"installStatus===true"}],staticClass:"info",domProps:{textContent:t._s(t.info)}})],1)]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":""}},[s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{label:"集群ID",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticClass:"link-type",on:{click:function(e){return t.handleDetail(a)}}},[t._v(t._s(a.id))])]}}])}),s("el-table-column",{attrs:{prop:"name",label:"集群名称",align:"center"}}),s("el-table-column",{attrs:{prop:"nick_name",label:"业务名称",align:"center"}}),s("el-table-column",{attrs:{prop:"ha_mode",align:"center",label:"高可用模式"}}),s("el-table-column",{attrs:{prop:"comptotal",align:"center",label:"计算节点总数"}}),s("el-table-column",{attrs:{prop:"shardtotal",align:"center",label:"shard分配","show-overflow-tooltip":!0}}),s("el-table-column",{attrs:{prop:"back_up",align:"center",label:"最近备份时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[""===e.row.first_backup?s("span",[t._v("无备份")]):""!==e.row.first_backup?s("span",[t._v(t._s(e.row.first_backup))]):t._e()]}}])}),"Y"===t.storage_node_create_priv||"Y"===t.shard_create_priv||"Y"===t.compute_node_create_priv||"Y"===t.restore_priv||"Y"===t.backup_priv||"Y"===t.cluster_drop_priv||"rbr"===t.row.ha_mode?s("el-table-column",{attrs:{label:"操作",align:"center",width:"150",fixed:"right","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,i=e.$index;return["Y"===t.cluster_drop_priv?s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(a,i)}}},[t._v("删除 ")]):t._e()]}}],null,!1,408696279)}):t._e()],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}}),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"250px"}},[s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"业务名称:",prop:"nick_name"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入业务名称",disabled:"detail"===t.dialogStatus},model:{value:t.temp.nick_name,callback:function(e){t.$set(t.temp,"nick_name",e)},expression:"temp.nick_name"}})],1),"create"===t.dialogStatus?s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("div",{staticStyle:{"margin-bottom":"10px"}},[t._v("存储： "),s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.temp.machinelist,callback:function(e){t.$set(t.temp,"machinelist",e)},expression:"temp.machinelist"}},t._l(t.machines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1),s("div",[t._v("计算： "),s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.temp.comp_machinelist,callback:function(e){t.$set(t.temp,"comp_machinelist",e)},expression:"temp.comp_machinelist"}},t._l(t.comp_machines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1)]):t._e(),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"高可用模式:",prop:"ha_mode"}},[s("el-select",{attrs:{placeholder:"请选择高可用模式",disabled:"detail"===t.dialogStatus},model:{value:t.temp.ha_mode,callback:function(e){t.$set(t.temp,"ha_mode",e)},expression:"temp.ha_mode"}},t._l(t.hamodeData,(function(t){return s("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1)],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}]},[s("el-form-item",{attrs:{label:"shard个数:",prop:"shards_count"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入shard个数",disabled:"detail"===t.dialogStatus},model:{value:t.temp.shards_count,callback:function(e){t.$set(t.temp,"shards_count",e)},expression:"temp.shards_count"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1)],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"副本数:",prop:"snode_count"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"副本数至少是3，且不能大于256",disabled:"detail"===t.dialogStatus},model:{value:t.temp.snode_count,callback:function(e){t.$set(t.temp,"snode_count",e)},expression:"temp.snode_count"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"计算节点总个数:",prop:"comp_count"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"输入计算节点总个数",disabled:"detail"===t.dialogStatus},model:{value:t.temp.comp_count,callback:function(e){t.$set(t.temp,"comp_count",e)},expression:"temp.comp_count"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"缓冲池大小:",prop:"buffer_pool"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"缓冲池大小单位为GB",disabled:"detail"===t.dialogStatus},model:{value:t.temp.buffer_pool,callback:function(e){t.$set(t.temp,"buffer_pool",e)},expression:"temp.buffer_pool"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("GB")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"每shard中强同步备机应当个数:",prop:"fullsync_level"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每shard中强同步备机应当个数",disabled:"detail"===t.dialogStatus},model:{value:t.temp.fullsync_level,callback:function(e){t.$set(t.temp,"fullsync_level",e)},expression:"temp.fullsync_level"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),"create"===t.dialogStatus?s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}]},[s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"计算节点账号:",prop:"computer_user"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"输入计算节点账号",disabled:"detail"===t.dialogStatus},model:{value:t.temp.computer_user,callback:function(e){t.$set(t.temp,"computer_user",e)},expression:"temp.computer_user"}})],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===t.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"计算节点密码:",prop:"computer_password"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"输入计算节点密码",disabled:"detail"===t.dialogStatus},model:{value:t.temp.computer_password,callback:function(e){t.$set(t.temp,"computer_password",e)},expression:"temp.computer_password"}})],1),s("el-form-item",{attrs:{label:"每个计算节点最大连接数:",prop:"max_connections"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点最大连接数"},model:{value:t.temp.max_connections,callback:function(e){t.$set(t.temp,"max_connections",e)},expression:"temp.max_connections"}})],1),s("el-form-item",{attrs:{label:"每个计算节点的cpu核数:",prop:"per_computing_node_cpu_cores"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点的cpu核数"},model:{value:t.temp.per_computing_node_cpu_cores,callback:function(e){t.$set(t.temp,"per_computing_node_cpu_cores",e)},expression:"temp.per_computing_node_cpu_cores"}})],1),s("el-form-item",{attrs:{label:"每个计算节点最大的存储值:",prop:"per_computing_node_max_mem_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点最大的存储值"},model:{value:t.temp.per_computing_node_max_mem_size,callback:function(e){t.$set(t.temp,"per_computing_node_max_mem_size",e)},expression:"temp.per_computing_node_max_mem_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),s("el-form-item",{attrs:{label:"每个存储节点的cpu核数:",prop:"per_storage_node_cpu_cores"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点的cpu核数"},model:{value:t.temp.per_storage_node_cpu_cores,callback:function(e){t.$set(t.temp,"per_storage_node_cpu_cores",e)},expression:"temp.per_storage_node_cpu_cores"}})],1),s("el-form-item",{attrs:{label:"每个存储节点innodb缓冲池大小:",prop:"per_storage_node_innodb_buffer_pool_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点innodb缓冲池大小"},model:{value:t.temp.per_storage_node_innodb_buffer_pool_size,callback:function(e){t.$set(t.temp,"per_storage_node_innodb_buffer_pool_size",e)},expression:"temp.per_storage_node_innodb_buffer_pool_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),s("el-form-item",{attrs:{label:"每个存储节点rocksdb缓冲池大小:",prop:"per_storage_node_rocksdb_buffer_pool_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点rocksdb缓冲池大小"},model:{value:t.temp.per_storage_node_rocksdb_buffer_pool_size,callback:function(e){t.$set(t.temp,"per_storage_node_rocksdb_buffer_pool_size",e)},expression:"temp.per_storage_node_rocksdb_buffer_pool_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("MB")])])],1),s("el-form-item",{attrs:{label:"每个存储节点初始化存储值:",prop:"per_storage_node_initial_storage_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点初始化存储值"},model:{value:t.temp.per_storage_node_initial_storage_size,callback:function(e){t.$set(t.temp,"per_storage_node_initial_storage_size",e)},expression:"temp.per_storage_node_initial_storage_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("GB")])])],1),s("el-form-item",{attrs:{label:"每个存储节点最大存储值:",prop:"per_storage_node_max_storage_size"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点最大存储值"},model:{value:t.temp.per_storage_node_max_storage_size,callback:function(e){t.$set(t.temp,"per_storage_node_max_storage_size",e)},expression:"temp.per_storage_node_max_storage_size"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("GB")])])],1)],1):t._e(),"create"===t.dialogStatus?s("div",{class:!1===t.isShow?"ro-90":"ro90",on:{click:t.toggle}},[s("i",{staticClass:"el-icon-d-arrow-left"})]):t._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("关闭")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData(t.row)}}},[t._v(" 确认 ")])],1)],1),s("el-dialog",{attrs:{title:"添加",visible:t.dialogNodeVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogNodeVisible=e}}},[s("el-form",{ref:"nodeForm",attrs:{model:t.nodetemp,rules:t.rules,"label-position":"left","label-width":"110px"}},["update"===t.dialogStatus?s("el-form-item",{attrs:{label:"集群名称:",prop:"name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.nodetemp.name,callback:function(e){t.$set(t.nodetemp,"name",e)},expression:"nodetemp.name"}})],1):t._e(),"update"===t.dialogStatus?s("el-form-item",{attrs:{label:"类型:",prop:"node_type"}},["update"===t.dialogStatus?s("el-select",{attrs:{placeholder:"请选择类型"},on:{change:t.ChangeSaler},model:{value:t.nodetemp.node_type,callback:function(e){t.$set(t.nodetemp,"node_type",e)},expression:"nodetemp.node_type"}},t._l(t.node_types,(function(t){return s("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1):t._e()],1):t._e(),"update"===t.dialogStatus?s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.nodetemp.machinelist,callback:function(e){t.$set(t.nodetemp,"machinelist",e)},expression:"nodetemp.machinelist"}},t._l(t.strogemachines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1):t._e(),"add_nodes"==t.nodetemp.node_type&&"update"===t.dialogStatus?s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},["update"===t.dialogStatus?s("el-select",{attrs:{placeholder:"请选择shard名称"},model:{value:t.nodetemp.shard_name,callback:function(e){t.$set(t.nodetemp,"shard_name",e)},expression:"nodetemp.shard_name"}},t._l(t.shardList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1):t._e()],1):t._e(),"add_shards"==t.nodetemp.node_type?s("el-form-item",{attrs:{label:"shard个数:",prop:"shards"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入shard个数",disabled:"detail"===t.dialogStatus},model:{value:t.nodetemp.shards,callback:function(e){t.$set(t.nodetemp,"shards",e)},expression:"nodetemp.shards"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1):t._e(),s("el-form-item",{attrs:{label:"节点个数:",prop:"nodes"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入节点个数",disabled:"detail"===t.dialogStatus},model:{value:t.nodetemp.nodes,callback:function(e){t.$set(t.nodetemp,"nodes",e)},expression:"nodetemp.nodes"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogNodeVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateData(t.row)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"恢复集群",visible:t.dialogRestoreVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogRestoreVisible=e}}},[s("el-form",{ref:"restoreForm",attrs:{model:t.restoretemp,rules:t.rules,"label-position":"left","label-width":"110px"}},["restore"===t.dialogStatus?s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-checkbox-group",{attrs:{min:t.minMachine,max:t.machineTotal},model:{value:t.restoretemp.machinelist,callback:function(e){t.$set(t.restoretemp,"machinelist",e)},expression:"restoretemp.machinelist"}},t._l(t.machines,(function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.hostaddr}},[t._v(" "+t._s(e.hostaddr)+" ")])})),1)],1):t._e(),s("el-form-item",{attrs:{label:"原集群名称:",prop:"old_cluster_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.restoretemp.old_cluster_name,callback:function(e){t.$set(t.restoretemp,"old_cluster_name",e)},expression:"restoretemp.old_cluster_name"}})],1),s("el-form-item",{attrs:{label:"新集群名称:",prop:"nick_name"}},[s("el-input",{attrs:{placeholder:"请输入新集群名称"},model:{value:t.restoretemp.nick_name,callback:function(e){t.$set(t.restoretemp,"nick_name",e)},expression:"restoretemp.nick_name"}})],1),s("el-form-item",{attrs:{label:"回档时间:",prop:"now"}},[s("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择回档时间"},model:{value:t.restoretemp.now,callback:function(e){t.$set(t.restoretemp,"now",e)},expression:"restoretemp.now"}})],1),s("el-form-item",{attrs:{label:"最早备份时间:",prop:"end_ts"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.restoretemp.end_ts,callback:function(e){t.$set(t.restoretemp,"end_ts",e)},expression:"restoretemp.end_ts"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogRestoreVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.restoreData(t.restoretemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogRetreatedVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogRetreatedVisible=e}}},[s("el-form",{ref:"retreatedForm",attrs:{model:t.retreatedtemp,rules:t.rules,"label-position":"left","label-width":"120px"}},[s("el-form-item",{attrs:{label:"原集群名称:",prop:"old_cluster_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择原集群名称"},model:{value:t.retreatedtemp.old_cluster_id,callback:function(e){t.$set(t.retreatedtemp,"old_cluster_id",e)},expression:"retreatedtemp.old_cluster_id"}},t._l(t.oldClusterList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"回档集群名称:",prop:"nick_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.retreatedtemp.nick_name,callback:function(e){t.$set(t.retreatedtemp,"nick_name",e)},expression:"retreatedtemp.nick_name"}})],1),s("el-form-item",{attrs:{label:"回档时间:",prop:"retreated_time"}},[s("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择回档时间"},model:{value:t.retreatedtemp.retreated_time,callback:function(e){t.$set(t.retreatedtemp,"retreated_time",e)},expression:"retreatedtemp.retreated_time"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogRetreatedVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.retreatedData(t.retreatedtemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)]),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusShowVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeDestory},on:{"update:visible":function(e){t.dialogStatusShowVisible=e}}},[s("div",{staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},[t.init_show?s("el-step",{attrs:{title:t.init_title,icon:"el-icon-more"}}):t._e(),t.computer_show?s("el-step",{attrs:{title:t.computer_title,status:t.computer_state,icon:t.computer_icon,description:t.computer_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.computer_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.comp_active}},t._l(t.computer,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2):t._e(),t.shard_show?s("el-step",{attrs:{title:t.shard_title,status:t.storage_state,icon:t.shard_icon,description:t.shard_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.shard_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.shard_active}},t._l(t.shard,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(s){return t.thisDetail(e.shard_id)}}})})),1)],1)])],2):t._e()],1)],1)]),s("el-dialog",{attrs:{title:t.dialogStatus,visible:t.dialogShardInfo,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogShardInfo=e}}},[s("json-viewer",{attrs:{value:t.shardInfo}})],1)],1)},V=[],E={name:"List",components:{Pagination:c["a"],JsonViewer:m.a},props:["data","defaultActive"],data:function(){var t=this,e=function(t,e,s){e?s():s(new Error("请选择高可用模式"))},s=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("shard个数不能大于256")):s():s(new Error("shard个数只能输入数字")):s(new Error("请输入shard个数"))},a=function(t,e,s){e?/^[0-9]+$/.test(e)?e<3?s(new Error("副本数不能小于3")):e>256?s(new Error("副本数不能大于256")):s():s(new Error("副本数只能输入数字")):s(new Error("请输入副本数"))},i=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("计算节点总个数只能输入数字")):s(new Error("请输入计算节点总个数"))},r=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("缓冲池大小只能输入数字")):s(new Error("请输入缓冲池大小"))},o=function(e,s,a){var i=Object(l["d"])(),r=Object(l["c"])(i);t.restoretemp.now?t.restoretemp.now<t.restoretemp.end_ts?a(new Error("回档时间不能早于最早备份时间")):t.restoretemp.now>r?a(new Error("回档时间选择范围应在当前系统时间开始一个月之内")):a():a(new Error("请选择回档时间"))},n=function(t,e,s){var a=Object(l["d"])();e?e>a?s(new Error("回档时间不能晚于当前时间")):s():s(new Error("请选择回档时间"))},c=function(t,e,s){e?s():s(new Error("请选择类型"))},p=function(e,s,a){"add_nodes"===t.nodetemp.node_type?s?a():a(new Error("请选择shard名称")):a()},u=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("shard个数不能大于256")):s():s(new Error("shard个数只能输入数字")):s(new Error("请输入shard个数"))},m=function(t,e,s){e?s():s(new Error("请输入业务名称"))},_=function(e,s,a){s?/^[0-9]+$/.test(s)?s>=t.temp.snode_count?a(new Error("每shard中强同步备机应当个数应小于副本数")):a():a(new Error("每shard中强同步备机应当个数只能输入数字")):a(new Error("请输入每shard中强同步备机应当个数"))},h=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("节点个数不能大于256")):s():s(new Error("节点个数只能输入数字")):s(new Error("请输入节点个数"))},f=function(t,e,s){e?s():s(new Error("请选择原集群名称"))};return{tableKey:0,list:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,name:"",user_name:sessionStorage.getItem("login_username")},temp:{ha_mode:"",shards_count:"1",snode_count:"3",comp_count:"1",buffer_pool:"1",max_connections:"6",per_computing_node_cpu_cores:"8",per_computing_node_max_mem_size:"",per_storage_node_cpu_cores:"8",per_storage_node_innodb_buffer_pool_size:"",per_storage_node_rocksdb_buffer_pool_size:"",per_storage_node_initial_storage_size:"20",per_storage_node_max_storage_size:"20",nick_name:"",machinelist:[],comp_machinelist:[],node_type:"",shard_name:"",shards:"",computer_user:"",computer_password:"",fullsync_level:"1"},restoretemp:{old_cluster_name:"",now:"",end_ts:"",machinelist:[],backup_cluster_name:"",nick_name:""},retreatedtemp:{old_cluster_name:"",retreated_time:"",nick_name:"",old_cluster_id:"",new_cluster_id:""},nodetemp:{machinelist:[],node_type:"",shard_name:"",shards:"",name:"",nick_name:"",nodes:""},dialogFormVisible:!1,dialogRestoreVisible:!1,dialogRetreatedVisible:!1,dialogNodeVisible:!1,dialogStatusVisible:!1,dialogStatus:"",textMap:{update:"添加",create:"新增集群",detail:"详情",restore:"恢复集群",retreated:"回档集群"},dialogDetail:!1,message_tips:"",message_type:"",user_add_priv:"",user_drop_priv:"",user_edit_priv:"",row:{},hamodeData:d["g"],shardsDate:d["q"],norepshardsDate:d["l"],pershardDate:d["m"],isShow:!1,machinelist:[],machines:[],minMachine:0,machineTotal:0,comp_machines:[],comp_minMachine:0,comp_machineTotal:0,node_types:d["k"],shardList:[],backup_priv:JSON.parse(sessionStorage.getItem("priv")).backup_priv,restore_priv:JSON.parse(sessionStorage.getItem("priv")).restore_priv,cluster_creata_priv:JSON.parse(sessionStorage.getItem("priv")).cluster_creata_priv,cluster_drop_priv:JSON.parse(sessionStorage.getItem("priv")).cluster_drop_priv,shard_create_priv:JSON.parse(sessionStorage.getItem("priv")).shard_create_priv,storage_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_create_priv,compute_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_create_priv,timer:null,installStatus:!1,info:"",activities:[],dialogStatusShowVisible:!1,active:0,stepSuc:[0],stepParams:[],computer:[],shard:[],computer_state:"",storage_state:"",computer_title:"",computer_icon:"",shard_icon:"",shard_title:"",comp_active:0,shard_active:0,strogemachines:[],init_title:"",init_show:!0,computer_show:!0,shard_show:!0,init_active:0,finish_title:"",finish_icon:"",finish_description:"",computer_description:"",shard_description:"",shardInfo:"",dialogShardInfo:!1,job_id:"",oldClusterList:[],rules:{ha_mode:[{required:!0,trigger:"blur",validator:e}],shards_count:[{required:!0,trigger:"blur",validator:s}],snode_count:[{required:!0,trigger:"blur",validator:a}],comp_count:[{required:!0,trigger:"blur",validator:i}],buffer_pool:[{required:!0,trigger:"blur",validator:r}],now:[{required:!0,trigger:"blur",validator:o}],node_type:[{required:!0,trigger:"blur",validator:c}],shard_name:[{required:!0,trigger:"blur",validator:p}],shards:[{required:!0,trigger:"blur",validator:u}],nodes:[{required:!0,trigger:"blur",validator:h}],nick_name:[{required:!0,trigger:"blur",validator:m}],fullsync_level:[{required:!0,trigger:"blur",validator:_}],retreated_time:[{required:!0,trigger:"blur",validator:n}],old_cluster_id:[{required:!0,trigger:"blur",validator:f}]}}},watch:{"temp.machinelist":{handler:function(t,e){}}},created:function(){this.getList()},methods:{beforeDestory:function(){clearInterval(this.timer),this.dialogStatusShowVisible=!1},thisDetail:function(t){var e=this,s={id:t};Object(p["gb"])(s).then((function(s){e.dialogStatus="shard_"+t+"详细信息",e.dialogShardInfo=!0,e.shardInfo=s.shard_nodes}))},handleStatus:function(){this.dialogStatusShowVisible=!0},ChangeSaler:function(t){var e=this;"add_shards"==t?(Object(p["jb"])().then((function(t){e.strogemachines=[],e.strogemachines=t.list})),this.nodetemp.nodes="3",this.nodetemp.shards="1"):"add_nodes"==t?(Object(p["jb"])().then((function(t){e.strogemachines=[],e.strogemachines=t.list})),this.nodetemp.nodes="1"):"add_comps"==t&&(Object(p["H"])().then((function(t){e.strogemachines=[],e.strogemachines=t.list})),this.nodetemp.nodes="1")},toggle:function(){this.isShow=!this.isShow},handleFilter:function(){this.listQuery.pageNo=1,this.listQuery.user_name=sessionStorage.getItem("login_username"),this.getList()},handleClear:function(){this.listQuery.name="",this.listQuery.pageNo=1,this.listQuery.user_name=sessionStorage.getItem("login_username"),this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);e.effectCluster=sessionStorage.getItem("affected_clusters"),e.apply_all_cluster=sessionStorage.getItem("apply_all_cluster"),Object(p["i"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},resetTemp:function(){this.temp={ha_mode:"",shards_count:"1",snode_count:"3",comp_count:"1",buffer_pool:"1",max_connections:"6",per_computing_node_cpu_cores:"8",per_computing_node_max_mem_size:"",per_storage_node_cpu_cores:"8",per_storage_node_innodb_buffer_pool_size:"",per_storage_node_rocksdb_buffer_pool_size:"",per_storage_node_initial_storage_size:"20",per_storage_node_max_storage_size:"20",nick_name:"",machinelist:[],comp_machinelist:[],node_type:"",shard_name:"",shards:"",computer_user:"",computer_password:"",fullsync_level:"1"}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",Object(p["jb"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total,null!=t.machines&&0!=t.machines.length||Object(l["g"])("请先添加存储类型的计算机!","error")})),Object(p["H"])().then((function(e){t.comp_machines=e.list,t.comp_minMachine=0,t.comp_machineTotal=e.total,null!=t.comp_machines&&0!=t.comp_machines.length||Object(l["g"])("请先添加计算类型的计算机!","error")})),this.dialogFormVisible=!0,this.dialogDetail=!1,this.$nextTick((function(){t.$refs.dataForm.clearValidate()}))},createData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var s=Object.assign({},t.temp),a=[];s.machinelist.forEach((function(t){a.push(t)}));var i=[];s.comp_machinelist.forEach((function(t){i.push(t)}));var r={},o={};r.user_name=sessionStorage.getItem("login_username"),r.job_id="",r.version=d["u"][0].ver,r.timestamp=d["s"][0].time+"",r.job_type="create_cluster",o.comps=s.comp_count+"",o.shards=s.shards_count+"",o.nodes=s.snode_count,o.innodb_size=s.buffer_pool,o.ha_mode=s.ha_mode,o.nick_name=s.nick_name,o.fullsync_level=s.fullsync_level,s.per_storage_node_max_storage_size&&(o.max_storage_size=s.per_storage_node_max_storage_size),s.max_connections&&(o.max_connections=s.max_connections),s.per_computing_node_cpu_cores&&(o.cpu_cores=s.per_computing_node_cpu_cores),a.length>0&&(o.storage_iplists=a),i.length>0&&(o.computer_iplists=i),s.computer_user&&(o.computer_user=s.computer_user),s.computer_password&&(o.computer_password=s.computer_password),o.dbcfg="1",r.paras=o,Object(p["m"])(r).then((function(e){var s=e;if("accept"==s.status){t.dialogFormVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null;var a="新增";t.init_show=!0;var i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},handleDetail:function(t){this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},t),this.dialogDetail=!0},handleUpdate:function(t){var e=this;this.temp=Object.assign({},t),this.nodetemp.nick_name=this.temp.nick_name,this.nodetemp.name=this.temp.name,this.nodetemp.id=this.temp.id,this.dialogStatus="update",this.dialogNodeVisible=!0,this.dialogDetail=!1,Object(p["eb"])(t.id).then((function(t){var s=t;200==s.code&&(e.shardList=s.list)})),this.$nextTick((function(){e.$refs["nodeForm"].clearValidate()}))},updateData:function(){var t=this;this.$refs["nodeForm"].validate((function(e){if(e){var s=Object.assign({},t.nodetemp),a=[];s.machinelist.forEach((function(t){a.push(t)})),s.job_id="",s.version=d["u"][0].ver,s.user_name=sessionStorage.getItem("login_username"),s.job_type=s.node_type,s.timestamp=d["s"][0].time+"";var i={};i.cluster_id=s.id,i.nick_name=s.nick_name,t.$delete(s,"node_type"),t.$delete(s,"name"),t.$delete(s,"nick_name"),t.$delete(s,"machinelist"),"add_shards"==s.job_type?(i.shards=s.shards,i.nodes=s.nodes,a.length>0&&(i.storage_iplists=a),t.$delete(s,"shard_name"),t.$delete(s,"shards"),t.$delete(s,"nodes"),t.$delete(s,"id"),s.paras=i,Object(p["f"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0;var a="添加shard",i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))):"add_comps"==s.job_type?(i.comps=s.nodes,a.length>0&&(i.computer_iplists=a),s.paras=i,t.$delete(s,"shards"),t.$delete(s,"shard_name"),t.$delete(s,"nodes"),t.$delete(s,"id"),Object(p["c"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0;var a="添加计算节点",i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))):"add_nodes"==s.job_type&&(i.nodes=s.nodes,i.shard_id=s.shard_name,a.length>0&&(i.storage_iplists=a),s.paras=i,t.$delete(s,"shards"),t.$delete(s,"shard_name"),t.$delete(s,"nodes"),t.$delete(s,"id"),Object(p["e"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.shard=[],t.computer_state="",t.storage_state="",t.computer_title="",t.computer_icon="",t.shard_icon="",t.shard_title="",t.comp_active=0,t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0;var a="添加存储节点",i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))})))}}))},handleDelete:function(t){var e=this,s=Object(l["a"])(),a="此操作将永久删除该数据, 是否继续?code="+s;Object(l["e"])(a).then((function(a){if(a.value)if(a.value==s){var i={};i.effectCluster=sessionStorage.getItem("affected_clusters"),i.cluster_name=t.name,i.username=sessionStorage.getItem("login_username"),i.type="del",Object(p["Eb"])(i).then((function(t){var s=t;200==s.code&&(e.dialogFormVisible=!1,sessionStorage.setItem("affected_clusters",s.effectCluster))}));var r={};r.user_name=sessionStorage.getItem("login_username"),r.job_id="",r.version=d["u"][0].ver,r.job_type="delete_cluster",r.timestamp=d["s"][0].time+"",r.paras={cluster_id:t.id,nick_name:t.nick_name},Object(p["n"])(r).then((function(t){var s=t;if("accept"==s.status){e.dialogFormVisible=!1,e.dialogStatusShowVisible=!0,e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null;var a="删除";e.init_show=!0;var i=0;e.getFStatus(e.timer,s.job_id,i++,a),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))},handleBackUp:function(t){var e=this,s={};s.version=d["u"][0].ver,s.job_id="",s.job_type="get_backup_storage",s.timestamp=d["s"][0].time+"",s.paras={},Object(p["z"])(s).then((function(s){null!==s.attachment.list_backup_storage?Object(l["f"])("确定要备份"+t.nick_name+"这个集群么?").then((function(){var s=Object.assign({},t),a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.paras={backup_cluster_name:s.name,nick_name:s.nick_name},a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"",a.job_type="backup_cluster",Object(p["h"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogFormVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在备份集群...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a);var i=0;e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),1e3)}else"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))})).catch((function(){Object(l["g"])("已取消备份","info")})):Object(l["g"])("请先添加备份存储目标!","error")}))},handleRestore:function(t){var e=this;this.restoretempDate=Object.assign({},t),this.dialogStatus="restore",this.dialogFormVisible=!1,this.dialogDetail=!1,Object(p["pb"])(t.id).then((function(s){var a=s;200==a.code?(e.dialogRestoreVisible=!0,e.restoretemp.end_ts=s.list[0].end_ts,e.restoretemp.old_cluster_name=t.nick_name,e.restoretemp.backup_cluster_name=t.name,e.restoretemp.now=Object(l["d"])(),Object(p["w"])().then((function(t){e.machines=t.list,e.minMachine=0,e.machineTotal=t.total}))):(e.message_tips=a.message,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))})),this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))},restoreData:function(){var t=this;this.$refs["restoreForm"].validate((function(e){if(e){var s=Object.assign({},t.restoretemp),a=[];s.machinelist.forEach((function(t){var e={hostaddr:t};a.push(e)}));var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.version=d["u"][0].ver,i.job_type="restore_new_cluster",i.timestamp=d["s"][0].time+"";var r={};r.nick_name=s.nick_name,r.backup_cluster_name=s.backup_cluster_name,r.timestamp=s.now,r.machinelist=a,i.paras=r,Object(p["tb"])(i).then((function(e){var s=e;if("accept"==s.status){t.dialogRestoreVisible=!1,t.dialogStatusVisible=!0,t.activities=[];var a={content:"正在恢复集群...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(a);var i=0;t.timer=setInterval((function(){t.getStatus(t.timer,s.job_id,i++)}),1e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},handleRetreated:function(t){var e=this;this.dialogStatus="retreated",this.dialogFormVisible=!1,this.dialogDetail=!1,this.dialogRetreatedVisible=!0,this.retreatedtemp.nick_name=t.name,this.retreatedtemp.old_cluster_id=this.retreatedtemp.old_cluster_id,this.retreatedtemp.new_cluster_id=t.id;var s={cluster_id:t.id};Object(p["Y"])(s).then((function(t){e.oldClusterList=t.list})),this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))},retreatedData:function(){var t=this;this.$refs["retreatedForm"].validate((function(e){if(e){var s=Object.assign({},t.retreatedtemp),a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.version=d["u"][0].ver,a.job_type="cluster_restore",a.timestamp=d["s"][0].time+"";var i={};i.src_cluster_id=s.old_cluster_id,i.dst_cluster_id=s.new_cluster_id,i.restore_time=s.retreated_time,a.paras=i,Object(l["f"])(s.nick_name+"集群的数据将被覆盖，确定要进行回档操作么?").then((function(){Object(p["tb"])(a).then((function(e){var s=e;if("accept"==s.status){t.dialogRestoreVisible=!1,t.dialogStatusVisible=!0,t.activities=[];var a={content:"正在恢复集群...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(a);var i=0;t.timer=setInterval((function(){t.getStatus(t.timer,s.job_id,i++)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))})).catch((function(){Object(l["g"])("已取消回档","info")}))}}))},handleSwitchOver:function(t){this.$router.push({path:"/cluster/switchover",query:{id:t.id}})},getFStatus:function(t,e,s,a){var i=this;setTimeout((function(){var r={job_type:"get_status"};r.version=d["u"][0].ver,r.job_id=e,r.timestamp=d["s"][0].time+"",r.paras={},i.job_id="任务ID:"+e,Object(p["N"])(r).then((function(e){if("新增"==a||"删除"==a)if(null!==e.attachment){var r=e.attachment.job_steps.split(",");if("ongoing"==e.attachment.computer_state)i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+r[1];else if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+r[1]+"成功",i.computer.length>0)for(var o=0;o<e.attachment.computer_step.length;o++)if("done"==e.attachment.computer_step[o].computer_state)for(var n=0;n<i.computer.length;n++)for(var l=e.attachment.computer_step[o].computer_hosts.substr(0,e.attachment.computer_step[o].computer_hosts.length-1),c=l.split(";"),d=0;d<c.length;d++)i.computer[n].title==c[d]&&(i.computer[n].icon="el-icon-circle-check",i.computer[n].status="success")}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+r[1]+"失败",i.computer.length>0)for(var u=0;u<e.attachment.computer_step.length;u++)if("failed"==e.attachment.computer_step[u].computer_state){for(var m=0;m<i.computer.length;m++)for(var _=e.attachment.computer_step[u].computer_hosts.substr(0,e.attachment.computer_step[u].computer_hosts.length-1),h=_.split(";"),f=0;f<h.length;f++)i.computer[m].title==h[f]&&(i.computer[m].icon="el-icon-circle-close",i.computer[m].status="error");i.computer_description=e.attachment.computer_step[u].error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+r[1];if("ongoing"==e.attachment.storage_state)i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+r[0];else if("done"==e.attachment.storage_state){if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+r[0]+"成功",i.shard.length>0)for(var g=0;g<i.shard.length;g++)if(e.attachment.hasOwnProperty("shard_step")){for(var v=0;v<e.attachment.shard_step.length;v++)if("新增"==a)for(var b=e.attachment.shard_step[v].shard_ids,y=0;y<b.length;y++)for(var x in b[y]){var w=b[y][x];i.shard[g].shard_id==w&&(i.shard[g].icon="el-icon-circle-check",i.shard[g].status="success")}else if("删除"==a)for(var k=e.attachment.shard_step[v].shard_ids.substr(0,e.attachment.shard_step[v].shard_ids.length-1),S=k.split(","),j=0;j<S.length;j++)i.shard[g].shard_id==S[j]&&(i.shard[g].icon="el-icon-circle-check",i.shard[g].status="success")}else i.shard[g].icon="el-icon-circle-check",i.shard[g].status="success"}else if("failed"==e.attachment.storage_state){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+r[0]+"失败",i.shard.length>0)for(var O=0;O<i.shard.length;O++)if(e.attachment.hasOwnProperty("shard_step"))for(var L=0;L<e.attachment.shard_step.length;L++){if("新增"==a)for(var I=e.attachment.shard_step[L].shard_ids,C=0;C<I.length;C++)for(var x in I[C]){w=I[C][x];i.shard[O].shard_id==w&&(i.shard[O].icon="el-icon-circle-close",i.shard[O].status="error")}else if("删除"==a)for(var $=e.attachment.shard_step[L].shard_ids.substr(0,e.attachment.shard_step[L].shard_ids.length-1),N=$.split(","),V=0;V<N.length;V++)i.shard[O].shard_id==N[V]&&(i.shard[O].icon="el-icon-circle-close",i.shard[O].status="error");i.shard_description=e.attachment.shard_step[L].error_info}else i.shard[O].icon="el-icon-circle-check",i.shard[O].status="success",i.shard_description=e.error_info}else i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+r[0];if(i.init_title="正在"+a+"集群",i.init_active=3,0==i.computer.length&&0==i.shard.length){if(e.attachment.hasOwnProperty("computer_step"))for(var E=0;E<e.attachment.computer_step.length;E++){var T={};if(e.attachment.computer_step[E].hasOwnProperty("computer_hosts"))for(var D=e.attachment.computer_step[E].computer_hosts.substr(0,e.attachment.computer_step[E].computer_hosts.length-1),F=D.split(";"),P=0;P<F.length;P++)"done"==e.attachment.computer_state?(T.title=!0===e.attachment.computer_step[E].hasOwnProperty("computer_hosts")?F[P]:"正在"+a+r[1],T.icon="el-icon-circle-check",T.status="success",T.description="",T.computer_id=e.attachment.computer_step[E].computer_id,i.computer.push(T)):"failed"==e.attachment.computer_state?(T.title=!0===e.attachment.computer_step[E].hasOwnProperty("computer_hosts")?F[P]:"正在"+a+r[1],T.icon="el-icon-circle-close",T.status="error",T.description=e.attachment.comp_error_info,T.computer_id=e.attachment.computer_step[E].computer_id,i.computer.push(T)):(T.title=!0===e.attachment.computer_step[E].hasOwnProperty("computer_hosts")?F[P]:"正在"+a+r[1],T.icon="el-icon-loading",T.status="process",T.description="",T.computer_id=e.attachment.computer_step[E].computer_id,i.computer.push(T))}if(e.attachment.hasOwnProperty("shard_step"))for(var M=0;M<e.attachment.shard_step.length;M++){var R={};if("done"==e.attachment.storage_state){if("删除"==a)for(var q=e.attachment.shard_step[M].shard_ids.substr(0,e.attachment.shard_step[M].shard_ids.length-1),z=q.split(","),B=0;B<z.length;B++)R.title=""!==z?z[B]:"正在"+a+r[0],R.icon="el-icon-circle-check",R.status="success",R.description="",R.shard_id=z[B],i.shard.push(R);if("新增"==a)for(var Q=e.attachment.shard_step[M].shard_ids,A=0;A<Q.length;A++)for(var x in Q[A]){w=Q[A][x];var J=x+":"+w;R.title=""!==w?J:"正在"+a+r[0],R.icon="el-icon-circle-check",R.status="success",R.description="",R.shard_id=w,i.shard.push(R)}}else if("failed"==e.attachment.storage_state){if("删除"==a)for(var H=e.attachment.shard_step[M].shard_ids.substr(0,e.attachment.shard_step[M].shard_ids.length-1),G=H.split(","),Y=0;Y<G.length;Y++)R.title=""!==G?G[Y]:"正在"+a+r[0],R.icon="el-icon-circle-close",R.status="error",R.description=e.attachment.shard_error_info,R.shard_id=G[Y],i.shard.push(R);if("新增"==a)for(var U=e.attachment.shard_step[M].shard_ids,K=0;K<U.length;K++)for(var x in U[K]){w=U[K][x];var X=x+":"+w;R.title=""!==w?X:"正在"+a+r[0],R.icon="el-icon-circle-close",R.status="error",R.description=e.attachment.shard_error_info,R.shard_id=w,i.shard.push(R)}}else{if("删除"==a)for(var W=e.attachment.shard_step[M].shard_ids.substr(0,e.attachment.shard_step[M].shard_ids.length-1),Z=W.split(","),tt=0;tt<Z.length;tt++)R.title=""!==Z?Z[tt]:"正在"+a+r[0],R.icon="el-icon-loading",R.status="process",R.description="",R.shard_id=Z[tt],i.shard.push(R);if("新增"==a)for(var et=e.attachment.shard_step[M].shard_ids,st=0;st<et.length;st++)for(var x in et[st]){w=et[st][x];var at=x+":"+w;R.title=""!==w?at:"正在"+a+r[0],R.icon="el-icon-loading",R.status="process",R.description="",R.shard_id=w,i.shard.push(R)}}}if("failed"==e.status){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+r[0]+"失败",i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+r[1]+"失败",i.finish_title=a+"集群失败",i.finish_icon="el-icon-circle-close",i.init_active=4,i.finish_description=e.error_info,i.computer.length>0)for(var it=0;it<e.attachment.computer_step.length;it++)if("failed"==e.attachment.computer_step[it].computer_state){for(var rt=0;rt<i.computer.length;rt++)for(var ot=e.attachment.computer_step[it].computer_hosts.substr(0,e.attachment.computer_step[it].computer_hosts.length-1),nt=ot.split(";"),lt=0;lt<nt.length;lt++)i.computer[rt].title==nt[lt]&&(i.computer[rt].icon="el-icon-circle-close",i.computer[rt].status="error");i.computer_description=e.attachment.computer_step[it].error_info}if(i.shard.length>0)for(var ct=0;ct<e.attachment.shard_step.length;ct++){for(var dt=0;dt<i.shard.length;dt++)if("新增"==a)for(var pt=e.attachment.shard_step[ct].shard_ids,ut=0;ut<pt.length;ut++)for(var x in pt[ut]){w=pt[ut][x];i.shard[dt].shard_id==w&&(i.shard[dt].icon="el-icon-circle-close",i.shard[dt].status="error")}else if("删除"==a)for(var mt=e.attachment.shard_step[ct].shard_ids.substr(0,e.attachment.shard_step[ct].shard_ids.length-1),_t=mt.split(","),ht=0;ht<_t.length;ht++)i.shard[dt].shard_id==_t[ht]&&(i.shard[dt].icon="el-icon-circle-close",i.shard[dt].status="error");i.shard_description=e.attachment.shard_step[ct].error_info}clearInterval(t)}else"done"==e.status&&(i.init_active=4,i.finish_icon="el-icon-circle-check",i.init_show=!1,clearInterval(t))}else if("ongoing"==e.status){for(var ft=0;ft<i.computer.length;ft++){i.comp_active=ft;for(var gt=0;gt<e.attachment.computer_step.length;gt++)if("ongoing"==e.attachment.computer_step[gt].computer_state){for(var vt=e.attachment.computer_step[gt].computer_hosts.substr(0,e.attachment.computer_step[gt].computer_hosts.length-1),bt=vt.split(";"),yt=0;yt<bt.length;yt++)if(bt[yt]==i.computer[ft].title&&(i.comp_active=ft-1,i.computer[ft].icon="el-icon-loading",i.computer[ft].status="process",ft>0&&ft<i.comp_active+1))for(var xt=0;xt<ft;xt++)i.computer[xt].icon="el-icon-circle-check",i.computer[xt].status="success"}else if("failed"==e.attachment.computer_step[gt].computer_state){console.log(23);for(var wt=e.attachment.computer_step[gt].computer_hosts.substr(0,e.attachment.computer_step[gt].computer_hosts.length-1),kt=wt.split(";"),St=0;St<kt.length;St++)kt[St]==i.computer[ft].title&&(i.computer[ft].icon="el-icon-circle-close",i.computer[ft].status="error");i.computer_description=e.attachment.computer_step[gt].error_info}else if("done"==e.attachment.computer_step[gt].computer_state){console.log(24);for(var jt=e.attachment.computer_step[gt].computer_hosts.substr(0,e.attachment.computer_step[gt].computer_hosts.length-1),Ot=jt.split(";"),Lt=0;Lt<Ot.length;Lt++)Ot[Lt]==i.computer[ft].title&&(i.computer[ft].status="success",i.computer[ft].icon="el-icon-circle-check")}}for(var It=0;It<i.shard.length;It++)for(var Ct=0;Ct<e.attachment.shard_step.length;Ct++)if("ongoing"==e.attachment.shard_step[Ct].storage_state){if(e.attachment.shard_step[Ct].shard_hosts==i.shard[It].title&&(i.shard_active=It-1,i.shard[It].icon="el-icon-loading",i.shard[It].status="process",It>0&&It<i.shard_active+1))for(var $t=0;$t<It;$t++)i.shard[$t].icon="el-icon-circle-check",i.shard[$t].status="success"}else"failed"==e.attachment.shard_step[Ct].storage_state?(i.shard_active=It,i.shard[It].icon="el-icon-circle-close",i.shard[It].status="error",i.shard_description=e.attachment.shard_step[Ct].error_info):"done"==e.attachment.shard_step[Ct].storage_state&&(i.shard_active=It,i.shard[It].status="success",i.shard[It].icon="el-icon-circle-check")}else if("done"==e.status){if(i.init_show=!1,"done"==e.attachment.computer_state&&(console.log(51),i.computer_title=a+r[1]+"成功",i.computer_state="success",i.computer_icon="el-icon-circle-check"),"done"==e.attachment.storage_state){console.log(52),i.shard_title=a+r[0]+"成功",i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_active=i.shard.length-1;for(var Nt=0;Nt<i.shard.length;Nt++)console.log(53),i.shard[Nt].status="success",i.shard[Nt].icon="el-icon-circle-check","删除"==a&&(console.log(e.attachment.shard_step[0].storage_hosts),i.shard[Nt].title=e.attachment.shard_step[0].storage_hosts)}i.comp_active=i.computer.length-1;for(var Vt=0;Vt<i.computer.length;Vt++)i.computer[Vt].status="success",i.computer[Vt].icon="el-icon-circle-check";if(i.init_active=4,i.finish_icon="el-icon-circle-check",clearInterval(t),"新增"==a){var Et=sessionStorage.getItem("apply_all_cluster");if(2==Et){var Tt={};Tt.effectCluster=sessionStorage.getItem("affected_clusters"),Tt.cluster_name=e.attachment.cluster_name,Tt.username=sessionStorage.getItem("login_username"),Tt.type="add",Object(p["Eb"])(Tt).then((function(t){var e=t;200==e.code&&(i.dialogFormVisible=!1,sessionStorage.setItem("affected_clusters",e.effectCluster))}))}setTimeout((function(){i.getList()}),3e3)}else i.getList()}else if("failed"==e.status){if(i.finish_title=a+"集群失败",i.finish_icon="el-icon-circle-close",i.init_active=4,i.finish_description=e.error_info,i.init_show=!1,clearInterval(t),e.attachment.hasOwnProperty("computer_state"))if("failed"==e.attachment.computer_state){i.computer_state="error",i.computer_icon="el-icon-circle-close";for(var Dt=0;Dt<e.attachment.computer_step.length;Dt++){var Ft=e.attachment.computer_step[Dt].computer_hosts.substr(0,e.attachment.computer_step[Dt].computer_hosts.length-1),Pt=Ft.split(";");if("done"==e.attachment.computer_step[Dt].computer_state){i.comp_active=Dt;for(var Mt=0;Mt<i.computer.length;Mt++)for(var Rt=0;Rt<Pt.length;Rt++)i.computer[Mt].title==Pt[Rt]&&(i.computer[Mt].icon="el-icon-circle-check",i.computer[Mt].status="success")}else if("failed"==e.attachment.computer_step[Dt].computer_state)for(var qt=0;qt<i.computer.length;qt++)for(var zt=0;zt<Pt.length;zt++)i.computer[qt].title==Pt[zt]&&(i.computer[qt].icon="el-icon-circle-close",i.computer[qt].status="error");i.shard_description=e.attachment.computer_step[Dt].error_info}}else if("done"==e.attachment.computer_state)for(var Bt=0;Bt<e.attachment.computer_step.length;Bt++){var Qt=e.attachment.computer_step[Bt].computer_hosts.substr(0,e.attachment.computer_step[Bt].computer_hosts.length-1),At=Qt.split(";");if("done"==e.attachment.computer_step[Bt].computer_state){i.comp_active=Bt;for(var Jt=0;Jt<i.computer.length;Jt++)for(var Ht=0;Ht<At.length;Ht++)(i.computer[Jt].title=At[Ht])&&(i.computer[Jt].icon="el-icon-circle-check",i.computer[Jt].status="success")}else if("failed"==e.attachment.computer_step[Bt].computer_state){for(var Gt=0;Gt<i.computer.length;Gt++)for(var Yt=0;Yt<At.length;Yt++)i.computer[Gt].title==At[Yt]&&(i.computer[Gt].icon="el-icon-circle-close",i.computer[Gt].status="error");i.shard_description=e.attachment.computer_step[Bt].error_info}}if(e.attachment.hasOwnProperty("storage_state"))if("failed"==e.attachment.storage_state){i.storage_state="error",i.shard_icon="el-icon-circle-close";for(var Ut=0;Ut<e.attachment.shard_step.length;Ut++)if("done"==e.attachment.shard_step[Ut].storage_state){i.shard_active=Ut;for(var Kt=0;Kt<i.shard.length;Kt++)for(var Xt=e.attachment.shard_step[Ut].shard_ids,Wt=0;Wt<Xt.length;Wt++)for(var x in Xt[Wt]){w=Xt[Wt][x];i.shard[Kt].shard_id==w&&(i.shard[Kt].icon="el-icon-circle-check",i.shard[Kt].status="success")}}else if("failed"==e.attachment.shard_step[Ut].storage_state){for(var Zt=0;Zt<i.shard.length;Zt++)if("新增"==a)for(var te=e.attachment.shard_step[Ut].shard_ids,ee=0;ee<te.length;ee++)for(var x in te[ee]){w=te[ee][x];i.shard[Zt].shard_id==w&&(i.shard[Zt].icon="el-icon-circle-close",i.shard[Zt].status="error")}else if("删除"==a)for(var se=e.attachment.shard_step[Ut].shard_ids.substr(0,e.attachment.shard_step[Ut].shard_ids.length-1),ae=se.split(","),ie=0;ie<ae.length;ie++)i.shard[Zt].shard_id==ae[ie]&&(i.shard[Zt].icon="el-icon-circle-close",i.shard[Zt].status="error");i.shard_description=e.attachment.shard_step[Ut].error_info}}else if("done"==e.attachment.storage_state)for(var re=0;re<e.attachment.shard_step.length;re++)if("done"==e.attachment.shard_step[re].storage_state){i.shard_active=re;for(var oe=0;oe<i.shard.length;oe++)i.shard[oe].title==e.attachment.shard_step[re].shard_hosts&&(i.shard[oe].icon="el-icon-circle-check",i.shard[oe].status="success")}else if("failed"==e.attachment.shard_step[re].storage_state)for(var ne=0;ne<i.shard.length;ne++)i.shard[ne].title==e.attachment.shard_step[re].shard_hosts&&(i.shard[ne].icon="el-icon-circle-close",i.shard[ne].status="error")}}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?(i.init_title="正在"+a+"集群",i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+"computer",i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+"shard",s>5&&(i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"computer失败",i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"shard失败",clearInterval(t))):null==e.attachment&&"ongoing"==e.status?(i.init_title="正在"+a+"集群",i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+"computer",i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+"shard"):null==e.attachment&&"done"==e.status?(i.init_show=!1,i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"computer成功",i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"shard成功",clearInterval(t)):(i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"computer失败",i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"shard失败",clearInterval(t));else if("添加shard"==a||"添加计算节点"==a||"添加存储节点"==a)if(null!==e.attachment){if("添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0),"ongoing"==e.attachment.computer_state)i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a;else if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.computer.length>0)for(var le=0;le<i.computer.length;le++)for(var ce=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),de=ce.split(";"),pe=0;pe<de.length;pe++)i.computer[le].title==de[pe]&&(i.computer[le].icon="el-icon-circle-check",i.computer[le].status="success")}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.computer.length>0){for(var ue=0;ue<i.computer.length;ue++)for(var me=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),_e=me.split(";"),he=0;he<_e.length;he++)i.computer[ue].title==_e[he]&&(i.computer[ue].icon="el-icon-circle-close",i.computer[ue].status="error");i.computer_description=e.error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a;if("ongoing"==e.attachment.storage_state)i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a;else if("done"==e.attachment.storage_state){if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"成功",i.shard.length>0)for(var fe=0;fe<i.shard.length;fe++){var ge="";ge="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var ve=0;ve<ge.length;ve++)for(var x in ge[ve]){w=ge[ve][x];i.shard[fe].shard_id==w&&(i.shard[fe].icon="el-icon-circle-check",i.shard[fe].status="success")}}}else if("failed"==e.attachment.storage_state){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",i.shard.length>0){for(var be=0;be<i.shard.length;be++){var ye="";ye="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var xe=0;xe<ye.length;xe++)for(var x in ye[xe]){w=ye[xe][x];i.shard[be].shard_id==w&&(i.shard[be].icon="el-icon-circle-close",i.shard[be].status="error")}}i.shard_description=e.error_info}}else i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a;if(i.init_title="正在"+a,i.init_active=1,0==i.computer.length||0==i.shard.length){if(0==i.computer.length){var we={};if(e.attachment.hasOwnProperty("computer_hosts"))for(var ke=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Se=ke.split(";"),je=0;je<Se.length;je++)"done"==e.attachment.computer_state?(we.title=!0===e.attachment.hasOwnProperty("computer_hosts")?Se[je]:"正在"+a,we.icon="el-icon-circle-check",we.status="success",we.description="",we.computer_id=e.attachment.computer_id,i.computer.push(we)):(we.title=!0===e.attachment.hasOwnProperty("computer_hosts")?Se[je]:"正在"+a,we.icon="el-icon-loading",we.status="process",we.description="",we.computer_id=e.attachment.computer_id,i.computer.push(we))}if(0==i.shard.length&&e.attachment.hasOwnProperty("shard_hosts")){var Oe="";Oe="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var Le={},Ie=0;Ie<Oe.length;Ie++)for(var x in Oe[Ie]){w=Oe[Ie][x];console.log(w);var Ce=x+":"+w;Le.title=""!==w?Ce:"正在"+a,Le.icon="el-icon-loading",Le.status="process",Le.description="",Le.shard_id=w,i.shard.push(Le)}}if("failed"==e.status){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.finish_title=a+"失败",i.finish_icon="el-icon-circle-close",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0){for(var $e=0;$e<i.computer.length;$e++)for(var Ne=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Ve=Ne.split(";"),Ee=0;Ee<Ve.length;Ee++)i.computer[$e].title==Ve[Ee]&&(i.computer[$e].icon="el-icon-circle-close",i.computer[$e].status="error");i.computer_description=e.error_info}if(i.shard.length>0){for(var Te=0;Te<i.shard.length;Te++){var De="";De="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var Fe=0;Fe<De.length;Fe++)for(var x in De[Fe]){w=De[Fe][x];i.shard[Te].shard_id==w&&(i.shard[Te].icon="el-icon-circle-close",i.shard[Te].status="error")}}i.shard_description=e.error_info}clearInterval(t)}else if("done"==e.status){if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"成功",i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.finish_title=a+"成功",i.finish_icon="el-icon-circle-check",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0)for(var Pe=0;Pe<i.computer.length;Pe++)for(var Me=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),Re=Me.split(";"),qe=0;qe<Re.length;qe++)i.computer[Pe].title==Re[qe]&&(i.computer[Pe].icon="el-icon-circle-check",i.computer[Pe].status="success");if(i.shard.length>0)for(var ze=0;ze<i.shard.length;ze++){var Be="";Be="添加shard"==a?e.attachment.shard_ids:e.attachment.shard_hosts;for(var Qe=0;Qe<Be.length;Qe++)for(var x in Be[Qe]){w=Be[Qe][x];i.shard[ze].shard_id==w&&(i.shard[ze].icon="el-icon-circle-check",i.shard[ze].status="success")}}clearInterval(t)}}}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?"添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a,s>5&&(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败",clearInterval(t))):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a,s>5&&(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",clearInterval(t))):null==e.attachment&&"ongoing"==e.status?"添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a):null==e.attachment&&"done"==e.status?("添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"成功"):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功"),clearInterval(t)):("添加shard"==a||"添加存储节点"==a?(i.shard_show=!0,i.init_show=!1,i.computer_show=!1,i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"失败"):"添加计算节点"==a&&(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败"),clearInterval(t))})),s>=86400&&clearInterval(t)}),0)},getStatus:function(t,e,s){var a=this;setTimeout((function(){var i={job_type:"get_status"};i.version=d["u"][0].ver,i.job_id=e,i.timestamp=d["s"][0].time+"",i.paras={},Object(p["N"])(i).then((function(e){if("done"==e.status||"failed"==e.status)if(clearInterval(t),"done"==e.status){var s={content:e.error_info,timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};a.activities.push(s),a.getList(),a.dialogStatusVisible=!1}else{var i={content:e.error_info,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(i)}else{var r={content:e.error_info,timestamp:Object(l["d"])(),color:"#0bbd87"};a.activities.push(r)}})),s>=86400&&clearInterval(t)}),0)}}},T=E,D=(s("40e9"),s("1dd0"),Object(f["a"])(T,N,V,!1,null,"13273b35",null)),F=D.exports,P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"all"},[s("div",{staticClass:"leftmenu"},[s("el-col",{attrs:{span:3}},[s("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"1"},on:{select:t.selected}},[s("el-menu-item",{attrs:{index:"1"}},[s("i",{staticClass:"el-icon-setting"}),s("span",[t._v("基础设置")])]),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"2"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("全量备份")])]):t._e(),s("el-menu-item",{attrs:{index:"3"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("全量备份记录")])]),"Y"===t.restore_priv?s("el-menu-item",{attrs:{index:"4"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("集群回档")])]):t._e(),"Y"===t.expand_cluster_priv?s("el-menu-item",{attrs:{index:"5"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("集群扩容")])]):t._e(),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"6"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("主备切换")])]):t._e(),s("el-menu-item",{attrs:{index:"7"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("主备切换记录")])]),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"8"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("重做备机节点")])]):t._e(),s("el-menu-item",{attrs:{index:"9"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("shard列表")])]),s("el-menu-item",{attrs:{index:"10"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("计算节点列表")])]),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"11"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("设置延迟告警时间")])]):t._e(),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"12"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("设置实例变量")])]):t._e(),s("el-menu-item",{attrs:{index:"13"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("获取实例变量")])]),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"14"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("表重分布")])]):t._e(),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"15"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("逻辑备份")])]):t._e(),"super_dba"==t.user_name?s("el-menu-item",{attrs:{index:"16"}},[s("i",{staticClass:"el-icon-setting"}),s("span",{attrs:{slot:"title"},slot:"title"},[t._v("逻辑恢复")])]):t._e()],1)],1)],1),s("div",{staticClass:"rightmenu"},[s(t.componted,{tag:"component",attrs:{listsent:t.listsent},on:{clusterId:t.clusterId}})],1)])},M=[],R=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("div",{staticClass:"table-list-search-wrap"},[s("el-input",{staticClass:"list_search_keyword",attrs:{placeholder:"可输入ip搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.hostaddr,callback:function(e){t.$set(t.listQuery,"hostaddr",e)},expression:"listQuery.hostaddr"}}),s("el-select",{staticClass:"list_search_select",staticStyle:{width:"150px"},attrs:{placeholder:"请选择状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[s("el-option",{attrs:{label:"运行中",value:"active"}}),s("el-option",{attrs:{label:"安装中",value:"creating"}}),s("el-option",{attrs:{label:"停止",value:"manual_stop"}}),s("el-option",{attrs:{label:"异常",value:"inactive"}})],1),s("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v(" 查询")]),s("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v(" 重置")]),"Y"===t.compute_node_create_priv?s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleCreate}},[t._v("添加计算节点 ")]):t._e()],1)]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,ref:"multipleTable",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":""}},[s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{prop:"hostaddr",align:"center",label:"IP地址"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticClass:"link-type click_btn",on:{click:function(e){return t.handleDetail(a)}}},[t._v(t._s(a.hostaddr))])]}}])}),s("el-table-column",{attrs:{prop:"port",align:"center",label:" 端口"}}),s("el-table-column",{attrs:{prop:"name",align:"center",label:"计算节点名称"}}),s("el-table-column",{attrs:{prop:"status",align:"center",label:"状态",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return["active"===e.row.status?s("span",{staticStyle:{color:"#00ed37"}},[t._v("运行中")]):"inactive"===e.row.status?s("span",{staticStyle:{color:"red"}},[t._v("异常")]):"creating"===e.row.status?s("span",[t._v("安装中")]):"manual_stop"===e.row.status?s("span",{staticStyle:{color:"#c7c9d1"}},[t._v("停止")]):s("span")]}}])}),s("el-table-column",{attrs:{prop:"cpu_cores",align:"center",label:"cpu个数"}}),s("el-table-column",{attrs:{prop:"mysql_port",align:"center",label:"MySQL端口"}}),s("el-table-column",{attrs:{label:"操作",align:"center",width:"400","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,i=e.$index;return["active"==a.status?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.nodeMonitor(a)}}},[t._v("节点监控 ")]):t._e(),"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleSetCpu(a)}}},[t._v("设置 ")]):t._e(),"active"!==a.status&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleControlNode(a,"start")}}},[t._v(" 启用 ")]):t._e(),"manual_stop"!==a.status&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleControlNode(a,"stop")}}},[t._v("禁用 ")]):t._e(),"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleControlNode(a,"restart")}}},[t._v("重启")]):t._e(),"Y"===t.compute_node_drop_priv?s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(a,i)}}},[t._v("删除 ")]):t._e()]}}])})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}}),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogNodeVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogNodeVisible=e}}},[s("el-form",{ref:"dataForm",attrs:{model:t.temp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("el-form-item",{attrs:{label:"集群名称:",prop:"name"}},[s("span",[t._v(t._s(t.temp.name))])]),s("el-form-item",{attrs:{label:"业务名称:",prop:"nick_name"}},[s("span",[t._v(t._s(t.temp.nick_name))])]),s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.temp.machinelist,callback:function(e){t.$set(t.temp,"machinelist",e)},expression:"temp.machinelist"}},t._l(t.compmachines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1),s("el-form-item",{attrs:{label:"计算节点个数:",prop:"nodes"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入计算节点个数"},model:{value:t.temp.nodes,callback:function(e){t.$set(t.temp,"nodes",e)},expression:"temp.nodes"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogNodeVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.createData()}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusShowVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeDestory},on:{"update:visible":function(e){t.dialogStatusShowVisible=e}}},[s("div",{staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:t.percentage,status:t.progress_status,format:t.setText}}),s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},[t.init_show?s("el-step",{attrs:{title:t.init_title,icon:"el-icon-more"}}):t._e(),t.computer_show?s("el-step",{attrs:{title:t.computer_title,status:t.computer_state,icon:t.computer_icon,description:t.computer_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.computer_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.comp_active}},t._l(t.computer,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2):t._e(),t.finish_show?s("el-step",{attrs:{title:t.finish_title,icon:t.finish_icon,description:t.finish_description,status:t.finish_state}}):t._e()],1)],1)]),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeSyncDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)]),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("div",{staticClass:"box"},[s("div",{attrs:{title:""}},[s("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"120px"}},[s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"计算节点ID:",prop:"id"}},[s("span",[t._v(t._s(t.temp.id))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"集群ID:",prop:"db_cluster_id"}},[s("span",[t._v(t._s(t.temp.db_cluster_id))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"IP地址:",prop:"hostaddr"}},[s("span",[t._v(t._s(t.temp.hostaddr))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"端口:",prop:"port"}},[s("span",[t._v(t._s(t.temp.port))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"cpu个数:",prop:"cpu_cores"}},[s("span",[t._v(t._s(t.temp.cpu_cores))])])],1)],1),s("div",{attrs:{title:""}},[s("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"150px"}},[s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"状态:",prop:"status"}},[s("span",[t._v(t._s(t._f("statusString")(t.temp.status)))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"计算节点名称:",prop:"name"}},[s("span",[t._v(t._s(t.temp.name))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"最大内存（MB）:",prop:"max_mem_MB"}},[s("span",[t._v(t._s(t.temp.max_mem_MB))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"detail"===t.dialogStatus,expression:"dialogStatus === 'detail'"}],attrs:{label:"最大连接数:",prop:"max_conns"}},[s("span",[t._v(t._s(t.temp.max_conns))])])],1)],1)])]),s("el-dialog",{attrs:{title:"CPU资源设置",visible:t.dialogCpuVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogCpuVisible=e}}},[s("el-form",{ref:"cpuForm",attrs:{model:t.cpu_paras,rules:t.rules,"label-position":"left","label-width":"100px"}},[s("el-form-item",{attrs:{label:"节点IP:",prop:"cpu_paras.hostaddr"}},[s("span",[t._v(t._s(t.cpu_paras.hostaddr))])]),s("el-form-item",{attrs:{label:"端口:",prop:"cpu_paras.port"}},[s("span",[t._v(t._s(t.cpu_paras.port))])]),s("el-form-item",{attrs:{label:"cpu 个数:",prop:"cpu_paras.cpu_cores"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入cpu个数"},model:{value:t.cpu_paras.cpu_cores,callback:function(e){t.$set(t.cpu_paras,"cpu_cores",e)},expression:"cpu_paras.cpu_cores"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{attrs:{label:"cpu模式:",prop:"cpu_paras.cgroup_mode"}},[s("el-select",{attrs:{clearable:"",placeholder:"资源限制模式"},model:{value:t.cpu_paras.cgroup_mode,callback:function(e){t.$set(t.cpu_paras,"cgroup_mode",e)},expression:"cpu_paras.cgroup_mode"}},t._l(t.cpu_paras_option,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogCpuVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.SaveCpuSetData(t.cpu_paras)}}},[t._v("确认")])],1)],1)],1)},q=[],z={name:"Complist",components:{Pagination:c["a"]},filters:{statusString:function(t){return"active"==t?"运行中":"creating"==t?"安装中":"inactive"==t?"异常":"offline"==t?"停止":void 0}},props:{listsent:{typeof:Object}},data:function(){var t,e=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("计算节点个数不能大于256")):s():s(new Error("计算节点个数只能输入数字")):s(new Error("请输入计算节点个数"))};return t={tableKey:0,list:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,hostaddr:"",id:"",status:""},temp:{nodes:"",name:"",nick_name:"",machinelist:"",cluster_id:""},cpu_paras:{hostaddr:"",port:"",type:"pg",cpu_cores:"5",cgroup_mode:"quota"},cpu_paras_option:[{value:"share",label:"share"},{value:"quota",label:"quota"}],dialogCpuVisible:!1,dialogFormVisible:!1,dialogEditVisible:!1,dialogUploadVisible:!1,dialogStatus:"",textMap:{create:"添加计算节点",detail:"详情"},dialogDetail:!1,dialogNodeVisible:!1,message_tips:"",message_type:"",installStatus:!1,info:"",row:{},compute_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_create_priv,compute_node_drop_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_drop_priv,storage_status:!1,comp_status:!1,comp_active:1,job_id:null,timer:null,compmachines:[],computer:[],computer_state:"",finish_state:"",computer_title:"",computer_icon:""},Object(n["a"])(t,"comp_active",0),Object(n["a"])(t,"init_title",""),Object(n["a"])(t,"init_show",!0),Object(n["a"])(t,"finish_show",!1),Object(n["a"])(t,"computer_show",!0),Object(n["a"])(t,"shard_show",!0),Object(n["a"])(t,"init_active",0),Object(n["a"])(t,"finish_title",""),Object(n["a"])(t,"finish_icon",""),Object(n["a"])(t,"finish_description",""),Object(n["a"])(t,"computer_description",""),Object(n["a"])(t,"job_id",""),Object(n["a"])(t,"dialogStatusShowVisible",!1),Object(n["a"])(t,"dialogStatusVisible",!1),Object(n["a"])(t,"activities",[]),Object(n["a"])(t,"percentage",0),Object(n["a"])(t,"progress_status",null),Object(n["a"])(t,"progress_format",""),Object(n["a"])(t,"rules",{nodes:[{required:!0,trigger:"blur",validator:e}]}),t},created:function(){this.listQuery.id=this.listsent.id,this.getList()},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{setText:function(t){return this.progress_format+t+"%"},nodeMonitor:function(t){var e={};e["cluster_id"]=t.db_cluster_id,e["hostaddr"]=t.hostaddr,e["port"]=t.port,e["user_name"]=sessionStorage.getItem("login_username"),Object(S["c"])(e).then((function(t){"200"==t.code&&window.open(d["h"][0].ip+t.url+"?orgId=1&refresh=5s")}))},handleSetCpu:function(t){console.log(t),this.dialogCpuVisible=!0,this.cpu_paras=Object.assign(this.cpu_paras,t),console.log(this.cpu_paras)},beforeSyncDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},beforeDestory:function(){clearInterval(this.timer),this.dialogStatusShowVisible=!1,this.timer=null},handleFilter:function(){this.listQuery.pageNo=1,this.getList()},handleClear:function(){this.listQuery.hostaddr="",this.listQuery.status="",this.listQuery.pageNo=1,this.listQuery.id=this.listsent.id,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);Object(p["k"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},resetTemp:function(){this.temp={nodes:"1",name:"",nick_name:"",machinelist:"",cluster_id:""}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",this.dialogNodeVisible=!0,this.temp.name=this.listsent.name,this.temp.nick_name=this.listsent.nick_name,this.temp.cluster_id=this.listsent.id,Object(p["H"])().then((function(e){t.compmachines=e.list})),this.$nextTick((function(){t.$refs.dataForm.clearValidate()}))},SaveCpuSetData:function(t){var e=this;this.$refs["cpuForm"].validate((function(s){if(s){console.log(s);var a={version:"1.0",job_id:"",job_type:"update_instance_cgroup",timestamp:d["s"][0].time+"",user_name:sessionStorage.getItem("login_username"),paras:{ip:t.hostaddr,port:t.port,type:"pg",cpu_cores:t.cpu_cores,cgroup_mode:t.cgroup_mode}};Object(p["b"])(a).then((function(t){var s=t;if("accept"==s.status){var a=0;e.dialogSwitchOVisible=!1,e.job_id="",e.timer=null;var i="重做备机节点";e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3),setTimeout((function(){e.dialogCpuVisible=!1,e.message_type="success",e.message_tips="修改成功",Object(l["g"])(e.message_tips,e.message_type),e.getList()}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},createData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="add_comps",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";var a=[];t.temp.machinelist.forEach((function(t){a.push(t)}));var i={};i.comps=t.temp.nodes,i.cluster_id=t.temp.cluster_id,i.nick_name=t.listsent.nick_name,a.length>0&&(i.computer_iplists=a),s.paras=i,Object(p["c"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.computer=[],t.computer_state="",t.computer_title="",t.computer_icon="",t.comp_active=0,t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.computer_description="",t.job_id="",t.timer=null,t.init_show=!0,t.finish_show=!1,t.finish_state="";var a="添加计算节点";t.percentage=0,t.progress_status=null,t.progress_format="";var i=0;t.getFStatus(t.timer,s.job_id,i++,a),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},handleDetail:function(t){this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},t),this.dialogDetail=!0},handleDelete:function(t){var e=this,s={id:t.db_cluster_id};Object(p["I"])(s).then((function(s){if(1==s.total)Object(l["g"])("该集群当前有且仅有一个计算节点,不能进行删除操作","error");else if(s.total>1){var a=Object(l["a"])(),i="此操作将永久删除计算节点"+t.hostaddr+"("+t.port+"), 是否继续?code="+a;Object(l["e"])(i).then((function(s){if(s.value)if(s.value==a){var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.job_type="delete_comp",i.version=d["u"][0].ver,i.timestamp=d["s"][0].time+"";var r={};r.cluster_id=t.db_cluster_id,r.nick_name=e.listsent.nick_name,r.comp_id=t.id,i.paras=r,Object(p["o"])(i).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusShowVisible=!0;var a=0;e.computer=[],e.computer_state="",e.computer_title="",e.computer_icon="",e.comp_active=0,e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.job_id="",e.timer=null;var i="删除计算节点";e.percentage=0,e.progress_status=null,e.progress_format="",e.getFStatus(e.timer,s.job_id,a++,i,""),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))}}))},handleControlNode:function(t,e){var s=this,a="";"start"==e?a="启用":"stop"==e?a="禁用":"restart"==e&&(a="重启");var i=Object(l["a"])(),r="将对该计算节点"+t.hostaddr+"("+t.port+")进行"+a+"操作,是否继续?code="+i;Object(l["e"])(r).then((function(r){if(r.value)if(r.value==i){var o={};o.user_name=sessionStorage.getItem("login_username"),o.job_id="",o.job_type="control_instance",o.version=d["u"][0].ver,o.timestamp=d["s"][0].time+"";var n={};n.control=e,n.hostaddr=t.hostaddr,n.port=t.port,n.cluster_id=s.listsent.id,n.machine_type="computer",o.paras=n;var c={list:o,type:"pgsql"};Object(p["l"])(c).then((function(e){var i=e;if("accept"==i.status){s.dialogStatusVisible=!0,s.activities=[];var r={content:"正在"+a+"计算节点"+t.hostaddr+"("+t.port+")",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};s.activities.push(r);var o=0;s.timer=setInterval((function(){s.getStatus(s.timer,i.job_id,o++,a)}),5e3)}else s.message_tips=i.error_info,s.message_type="error",Object(l["g"])(s.message_tips,s.message_type)}))}else s.message_tips="code输入有误",s.message_type="error",Object(l["g"])(s.message_tips,s.message_type);else s.message_tips="code不能为空！",s.message_type="error",Object(l["g"])(s.message_tips,s.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))},getFStatus:function(t,e,s,a){var i=this;setTimeout((function(){var r={job_type:"get_status"};r.version=d["u"][0].ver,r.job_id=e,r.timestamp=d["s"][0].time+"",r.paras={},i.job_id="任务ID:"+e,Object(p["N"])(r).then((function(e){if(null!==e.attachment){if(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,e.attachment.hasOwnProperty("computer_state"))if("ongoing"==e.attachment.computer_state)i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a;else if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.computer.length>0)for(var r=0;r<i.computer.length;r++)for(var o=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),n=o.split(";"),l=0;l<n.length;l++)i.computer[r].title==n[l]&&(i.computer[r].icon="el-icon-circle-check",i.computer[r].status="success")}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.computer.length>0){for(var c=0;c<i.computer.length;c++)for(var d=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),p=d.split(";"),u=0;u<p.length;u++)i.computer[c].title==p[u]&&(i.computer[c].icon="el-icon-circle-close",i.computer[c].status="error");i.computer_description=e.error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a;if(i.init_title="正在"+a,i.init_active=1,0==i.computer.length){if("ongoing"==e.status){if(e.attachment.hasOwnProperty("computer_hosts")){var m=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),_=m.split(";");if("done"==e.attachment.computer_state)for(var h=0;h<_.length;h++){var f={};f.title=_[h],f.icon="el-icon-circle-check",f.status="success",f.description="",f.computer_id=e.attachment.computer_id,i.computer.push(f)}else for(var g=0;g<_.length;g++){var v={};v.title=_[g],v.icon="el-icon-loading",v.status="process",v.description="",v.computer_id=e.attachment.computer_id,i.computer.push(v)}}}else if("failed"==e.status){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.finish_title=a+"失败",i.finish_icon="el-icon-circle-close",i.finish_state="error",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0){for(var b=0;b<i.computer.length;b++)if(e.attachment.hasOwnProperty("computer_hosts"))for(var y=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),x=y.split(";"),w=0;w<x.length;w++)i.computer[b].title==x[w]&&(i.computer[b].icon="el-icon-circle-close",i.computer[b].status="error");i.computer_description=e.error_info}clearInterval(t)}else if("done"==e.status){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.finish_title=a+"成功",i.finish_icon="el-icon-circle-check",i.finish_state="success",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0)for(var k=0;k<i.computer.length;k++)if(e.attachment.hasOwnProperty("computer_hosts"))for(var S=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),j=S.split(";"),O=0;O<j.length;O++)i.computer[k].title==j[O]&&(i.computer[k].icon="el-icon-circle-check",i.computer[k].status="success");clearInterval(t),i.getList()}}else if("ongoing"==e.status){if(e.attachment.hasOwnProperty("computer_state"))if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.computer.length>0)for(var L=0;L<i.computer.length;L++)for(var I=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),C=I.split(";"),$=0;$<C.length;$++)i.computer[L].title==C[$]&&(i.computer[L].icon="el-icon-circle-check",i.computer[L].status="success")}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.computer.length>0){for(var N=0;N<i.computer.length;N++)for(var V=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),E=V.split(";"),T=0;T<E.length;T++)i.computer[N].title==E[T]&&(i.computer[N].icon="el-icon-circle-close",i.computer[N].status="error");i.computer_description=e.error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a}else if("failed"==e.status){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",i.finish_title=a+"失败",i.finish_icon="el-icon-circle-close",i.finish_state="error",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0){for(var D=0;D<i.computer.length;D++)if(e.attachment.hasOwnProperty("computer_hosts"))for(var F=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),P=F.split(";"),M=0;M<P.length;M++)i.computer[D].title==P[M]&&(i.computer[D].icon="el-icon-circle-close",i.computer[D].status="error");i.computer_description=e.error_info}clearInterval(t)}else if("done"==e.status){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",i.finish_title=a+"成功",i.finish_icon="el-icon-circle-check",i.finish_state="success",i.init_active=1,i.finish_description=e.error_info,i.computer.length>0)for(var R=0;R<i.computer.length;R++)if(e.attachment.hasOwnProperty("computer_hosts"))for(var q=e.attachment.computer_hosts.substr(0,e.attachment.computer_hosts.length-1),z=q.split(";"),B=0;B<z.length;B++)i.computer[R].title==z[B]&&(i.computer[R].icon="el-icon-circle-check",i.computer[R].status="success");clearInterval(t),i.getList()}"ongoing"==e.status?"prepare"==e.attachment.storage_state?(i.percentage=20,i.progress_format="正在"+a):"failed"==e.attachment.storage_state?i.progress_format=a+"失败":"done"==e.attachment.storage_state?(i.percentage=100,i.progress_format=a+"完成"):(i.percentage<70&&i.percentage>=30?i.percentage+=10:i.percentage<30&&i.percentage>=0&&(i.percentage=30),i.progress_format="正在"+a):"failed"==e.status?(i.progress_status="exception","prepare"==e.attachment.storage_state?(i.percentage=20,i.progress_format="正在"+a):"failed"==e.attachment.storage_state?i.progress_format=a+"失败":"done"==e.attachment.storage_state?(i.percentage=100,i.progress_format=a+"完成"):(i.percentage<70&&i.percentage>=30?i.percentage+=10:i.percentage<30&&i.percentage>=0&&(i.percentage=30),i.progress_format="正在"+a)):(i.progress_status="success",i.percentage=100,i.progress_format=a+"完成")}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a,s>5&&(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",clearInterval(t))):null==e.attachment&&"ongoing"==e.status?(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a):null==e.attachment&&"done"==e.status?(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"成功",clearInterval(t)):(i.shard_show=!1,i.init_show=!1,i.computer_show=!0,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"失败",clearInterval(t))})),s>=86400&&clearInterval(t)}),0)},getStatus:function(t,e,s,a){var i=this;setTimeout((function(){var r={job_type:"get_status"};r.version=d["u"][0].ver,r.job_id=e,r.timestamp=d["s"][0].time+"",r.paras={},Object(p["N"])(r).then((function(e){if("done"==e.status||"failed"==e.status)if("done"==e.status){var r={content:a+"成功",timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};i.activities.push(r),i.getList(),clearInterval(t)}else if(null==e.attachment&&"70001"==e.error_code&&"failed"==e.status){if(s>5){var o={content:e.error_info,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};i.activities.push(o),clearInterval(t)}}else{var n={content:e.error_info,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};i.activities.push(n),clearInterval(t)}})),s>=86400&&clearInterval(t)}),0)}}},B=z,Q=(s("d026"),s("f828"),s("2905"),Object(f["a"])(B,R,q,!1,null,"122ab168",null)),A=Q.exports,J=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"240px"}},[s("el-form-item",{attrs:{label:"集群ID:"}},[s("span",[t._v(t._s(t.form.id))])]),s("el-form-item",{attrs:{label:"集群名称:"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称:"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"高可用模式:"}},[s("span",[t._v(t._s(t.form.ha_mode))])]),s("el-form-item",{attrs:{label:"shard分配:"}},[s("span",[t._v(t._s(t.form.shardtotal))])]),s("el-form-item",{attrs:{label:"计算节点总个数:"}},[s("span",[t._v(t._s(t.form.comptotal+"个"))])]),s("el-form-item",{attrs:{label:"缓冲池大小:"}},[s("span",[t._v(t._s(t.form.buffer_pool+"MB"))])]),s("el-form-item",{attrs:{label:"每shard中强同步备机应当个数:"}},[s("span",[t._v(t._s(t.form.fullsync_level+"个"))])]),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"true"===t.if_show,expression:"if_show==='true'"}],staticStyle:{color:"red"},attrs:{label:"温馨提示:"}},[s("p",[t._v("该集群已建立RCR关系")])]),s("el-form-item",[t.delflag&&"Y"===t.cluster_drop_priv?s("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("删除集群")]):t._e()],1)],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusShowVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeDestory},on:{"update:visible":function(e){t.dialogStatusShowVisible=e}}},[s("div",{staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:t.percentage,status:t.progress_status,format:t.setText}}),s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},[t.init_show?s("el-step",{attrs:{title:t.init_title,icon:"el-icon-more"}}):t._e(),t.computer_show?s("el-step",{attrs:{title:t.computer_title,status:t.computer_state,icon:t.computer_icon,description:t.computer_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.computer_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.comp_active}},t._l(t.computer,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2):t._e(),t.shard_show?s("el-step",{attrs:{title:t.shard_title,status:t.storage_state,icon:t.shard_icon,description:t.shard_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.shard_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.shard_active}},t._l(t.shard,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(s){return t.thisDetail(e.shard_id)}}})})),1)],1)])],2):t._e(),t.finish_show?s("el-step",{attrs:{title:t.finish_title,icon:t.finish_icon,description:t.finish_description,status:t.finish_state}}):t._e()],1)],1)])],1)},H=[],G=s("de65"),Y={name:"Commonset",props:{listsent:{typeof:Object}},data:function(){var t;return t={form:{name:"",nick_name:"",id:"",ha_mode:""},dialogStatusShowVisible:!1,timer:null,installStatus:!1,info:"",activities:[]},Object(n["a"])(t,"dialogStatusShowVisible",!1),Object(n["a"])(t,"active",0),Object(n["a"])(t,"stepSuc",[0]),Object(n["a"])(t,"stepParams",[]),Object(n["a"])(t,"computer",[]),Object(n["a"])(t,"shard",[]),Object(n["a"])(t,"computer_state",""),Object(n["a"])(t,"storage_state",""),Object(n["a"])(t,"finish_state",""),Object(n["a"])(t,"computer_title",""),Object(n["a"])(t,"computer_icon",""),Object(n["a"])(t,"shard_icon",""),Object(n["a"])(t,"shard_title",""),Object(n["a"])(t,"comp_active",0),Object(n["a"])(t,"shard_active",0),Object(n["a"])(t,"strogemachines",[]),Object(n["a"])(t,"init_title",""),Object(n["a"])(t,"init_show",!0),Object(n["a"])(t,"finish_show",!1),Object(n["a"])(t,"computer_show",!0),Object(n["a"])(t,"shard_show",!0),Object(n["a"])(t,"init_active",0),Object(n["a"])(t,"finish_title",""),Object(n["a"])(t,"finish_icon",""),Object(n["a"])(t,"finish_description",""),Object(n["a"])(t,"computer_description",""),Object(n["a"])(t,"shard_description",""),Object(n["a"])(t,"shardInfo",""),Object(n["a"])(t,"dialogShardInfo",!1),Object(n["a"])(t,"job_id",""),Object(n["a"])(t,"delflag",!0),Object(n["a"])(t,"cluster_drop_priv",JSON.parse(sessionStorage.getItem("priv")).cluster_drop_priv),Object(n["a"])(t,"percentage",0),Object(n["a"])(t,"if_show","false"),Object(n["a"])(t,"progress_status",null),Object(n["a"])(t,"progress_format","未完成存储和计算删除"),t},mounted:function(){var t=this;this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id,this.form.ha_mode=this.listsent.ha_mode,this.form.fullsync_level=this.listsent.fullsync_level,this.form.buffer_pool=this.listsent.buffer_pool,this.form.comptotal=this.listsent.comp_count,this.form.shardtotal=this.listsent.shardtotal;var e={cluster_id:this.listsent.id};Object(G["o"])(e).then((function(e){0==e.total?t.if_show="false":t.if_show="true"}))},methods:{setText:function(t){return this.progress_format+t+"%"},onSubmit:function(t){var e=this,s=Object(l["a"])(),a={cluster_id:this.listsent.id};Object(G["o"])(a).then((function(a){if(a.total>0)Object(l["g"])("该集群已建立rcr关系,请先前往RCR服务页面解除关系再进行删除操作","error");else{var i="此操作将永久删除该数据, 是否继续?code="+s;Object(l["e"])(i).then((function(a){if(a.value)if(a.value==s){var i=sessionStorage.getItem("apply_all_cluster");if(2==i){var r={};r.effectCluster=sessionStorage.getItem("affected_clusters"),r.cluster_name=t.name,r.username=sessionStorage.getItem("login_username"),r.type="del",Object(p["Eb"])(r).then((function(t){var e=t;200==e.code&&sessionStorage.setItem("affected_clusters",e.effectCluster)}))}var o={};o.user_name=sessionStorage.getItem("login_username"),o.job_id="",o.version=d["u"][0].ver,o.job_type="delete_cluster",o.timestamp=d["s"][0].time+"",o.paras={cluster_id:t.id,nick_name:t.nick_name},Object(p["n"])(o).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusShowVisible=!0,e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null,e.shard_show=!0,e.finish_show=!1,e.computer_show=!0,e.finish_state="";var a="删除";e.init_show=!0;var i=0;e.getFStatus(e.timer,s.job_id,i++,a),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,i++,a)}),5e3)}else"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))}}))},onDel:function(){this.$emit("clusterId",this.listsent.id)},beforeDestory:function(){clearInterval(this.timer),this.dialogStatusShowVisible=!1,this.delflag=!1,this.$emit("clusterId",this.listsent.id)},getFStatus:function(t,e,s,a){var i=this;setTimeout((function(){var r={job_type:"get_status"};r.version=d["u"][0].ver,r.job_id=e,r.timestamp=d["s"][0].time+"",r.paras={},i.job_id="任务ID:"+e,Object(p["N"])(r).then((function(e){if("新增"==a||"删除"==a)if(null!==e.attachment){var r=e.attachment.job_steps.split(",");if("ongoing"==e.attachment.computer_state)i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+r[1];else if("done"==e.attachment.computer_state){if(i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+r[1]+"成功",i.computer.length>0)for(var o=0;o<e.attachment.computer_step.length;o++)if("done"==e.attachment.computer_step[o].computer_state)for(var n=0;n<i.computer.length;n++)for(var l=e.attachment.computer_step[o].computer_hosts.substr(0,e.attachment.computer_step[o].computer_hosts.length-1),c=l.split(";"),d=0;d<c.length;d++)i.computer[n].title==c[d]&&(i.computer[n].icon="el-icon-circle-check",i.computer[n].status="success")}else if("failed"==e.attachment.computer_state){if(i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+r[1]+"失败",i.computer.length>0)for(var u=0;u<e.attachment.computer_step.length;u++)if("failed"==e.attachment.computer_step[u].computer_state){for(var m=0;m<i.computer.length;m++)for(var _=e.attachment.computer_step[u].computer_hosts.substr(0,e.attachment.computer_step[u].computer_hosts.length-1),h=_.split(";"),f=0;f<h.length;f++)i.computer[m].title==h[f]&&(i.computer[m].icon="el-icon-circle-close",i.computer[m].status="error");i.computer_description=e.attachment.computer_step[u].error_info}}else i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+r[1];if("ongoing"==e.attachment.storage_state)i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+r[0];else if("done"==e.attachment.storage_state){if(i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+r[0]+"成功",i.shard.length>0)for(var g=0;g<i.shard.length;g++)if(e.attachment.hasOwnProperty("shard_step")){for(var v=0;v<e.attachment.shard_step.length;v++)if("新增"==a)for(var y=e.attachment.shard_step[v].shard_ids,x=0;x<y.length;x++)for(var w in y[x]){var k=y[x][w];i.shard[g].shard_id==k&&(i.shard[g].icon="el-icon-circle-check",i.shard[g].status="success")}else if("删除"==a)for(var S=e.attachment.shard_step[v].storage_hosts.substr(0,e.attachment.shard_step[v].storage_hosts.length-1),j=S.split(","),O=0;O<j.length;O++)i.shard[g].shard_id==j[O]&&(i.shard[g].icon="el-icon-circle-check",i.shard[g].status="success")}else i.shard[g].icon="el-icon-circle-check",i.shard[g].status="success"}else if("failed"==e.attachment.storage_state){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+r[0]+"失败",i.shard.length>0)for(var L=0;L<i.shard.length;L++)if(e.attachment.hasOwnProperty("shard_step"))for(var I=0;I<e.attachment.shard_step.length;I++){if("新增"==a)for(var C=e.attachment.shard_step[I].shard_ids,$=0;$<C.length;$++)for(var w in C[$]){k=C[$][w];i.shard[L].shard_id==k&&(i.shard[L].icon="el-icon-circle-close",i.shard[L].status="error")}else if("删除"==a)for(var N=e.attachment.shard_step[I].storage_hosts.substr(0,e.attachment.shard_step[I].storage_hosts.length-1),V=N.split(","),E=0;E<V.length;E++)i.shard[L].shard_id==V[E]&&(i.shard[L].icon="el-icon-circle-close",i.shard[L].status="error");i.shard_description=e.attachment.shard_step[I].error_info}else i.shard[L].icon="el-icon-circle-check",i.shard[L].status="success",i.shard_description=e.error_info}else i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+r[0];if(i.init_title="正在"+a+"集群",i.init_active=3,0==i.computer.length&&0==i.shard.length){if(e.attachment.hasOwnProperty("computer_step"))for(var T=0;T<e.attachment.computer_step.length;T++)if(e.attachment.computer_step[T].hasOwnProperty("computer_hosts")){var D=e.attachment.computer_step[T].computer_hosts.substr(0,e.attachment.computer_step[T].computer_hosts.length-1),F=D.split(";");if("done"==e.attachment.computer_state)for(var P=0;P<F.length;P++){var M={};M.title=F[P],M.icon="el-icon-circle-check",M.status="success",M.description="",M.computer_id=e.attachment.computer_step[T].computer_id,i.computer.push(M)}else if("failed"==e.attachment.computer_state)for(var R=0;R<F.length;R++){var q={};q.title=F[R],q.icon="el-icon-circle-close",q.status="error",q.description=e.attachment.comp_error_info,q.computer_id=e.attachment.computer_step[T].computer_id,i.computer.push(q)}else for(var z=0;z<F.length;z++){var B={};B.title=F[z],B.icon="el-icon-loading",B.status="process",B.description="",B.computer_id=e.attachment.computer_step[T].computer_id,i.computer.push(B)}}if(e.attachment.hasOwnProperty("shard_step"))for(var Q=0;Q<e.attachment.shard_step.length;Q++)if("done"==e.attachment.storage_state){if("删除"==a)for(var A=e.attachment.shard_step[Q].storage_hosts.substr(0,e.attachment.shard_step[Q].storage_hosts.length-1),J=A.split(";"),H=0;H<J.length;H++){var G={};G.title=""!==J?J[H]:"正在"+a+r[0],G.icon="el-icon-circle-check",G.status="success",G.description="",G.shard_id=J[H],i.shard.push(G)}if("新增"==a)for(var Y=e.attachment.shard_step[Q].shard_ids,U=0;U<Y.length;U++)for(var w in Y[U]){var K={},X=(k=Y[U][w],w+":"+k);K.title=""!==k?X:"正在"+a+r[0],K.icon="el-icon-circle-check",K.status="success",K.description="",K.shard_id=k,i.shard.push(K)}}else if("failed"==e.attachment.storage_state){if("删除"==a)for(var W=e.attachment.shard_step[Q].storage_hosts.substr(0,e.attachment.shard_step[Q].storage_hosts.length-1),Z=W.split(";"),tt=0;tt<Z.length;tt++){var et={};et.title=""!==Z?Z[tt]:"正在"+a+r[0],et.icon="el-icon-circle-close",et.status="error",et.description=e.attachment.shard_error_info,et.shard_id=Z[tt],i.shard.push(et)}if("新增"==a)for(var st=e.attachment.shard_step[Q].shard_ids,at=0;at<st.length;at++)for(var w in st[at]){var it={},rt=(k=st[at][w],w+":"+k);it.title=""!==k?rt:"正在"+a+r[0],it.icon="el-icon-circle-close",it.status="error",it.description=e.attachment.shard_error_info,it.shard_id=k,i.shard.push(it)}}else{if("删除"==a&&e.attachment.shard_step[Q].hasOwnProperty("storage_hosts"))for(var ot=e.attachment.shard_step[Q].storage_hosts.substr(0,e.attachment.shard_step[Q].storage_hosts.length-1),nt=ot.split(";"),lt=0;lt<nt.length;lt++){var ct={};ct.title=""!==nt?nt[lt]:"正在"+a+r[0],ct.icon="el-icon-loading",ct.status="process",ct.description="",ct.shard_id=nt[lt],i.shard.push(ct)}if("新增"==a)for(var dt=e.attachment.shard_step[Q].shard_ids,pt=0;pt<dt.length;pt++)for(var w in dt[pt]){var ut={},mt=(k=dt[pt][w],w+":"+k);ut.title=""!==k?mt:"正在"+a+r[0],ut.icon="el-icon-loading",ut.status="process",ut.description="",ut.shard_id=k,i.shard.push(ut)}}if("failed"==e.status){if(i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+r[0]+"失败",i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+r[1]+"失败",i.finish_title=a+"集群失败",i.finish_icon="el-icon-circle-close",i.finish_state="error",i.finish_show=!0,i.init_active=4,i.finish_description=e.error_info,i.computer.length>0)for(var _t=0;_t<e.attachment.computer_step.length;_t++)if("failed"==e.attachment.computer_step[_t].computer_state){for(var ht=0;ht<i.computer.length;ht++)for(var ft=e.attachment.computer_step[_t].computer_hosts.substr(0,e.attachment.computer_step[_t].computer_hosts.length-1),gt=ft.split(";"),vt=0;vt<gt.length;vt++)i.computer[ht].title==gt[vt]&&(i.computer[ht].icon="el-icon-circle-close",i.computer[ht].status="error");i.computer_description=e.attachment.computer_step[_t].error_info}if(i.shard.length>0)for(var bt=0;bt<e.attachment.shard_step.length;bt++){for(var yt=0;yt<i.shard.length;yt++)if("新增"==a)for(var xt=e.attachment.shard_step[bt].shard_ids,wt=0;wt<xt.length;wt++)for(var w in xt[wt]){k=xt[wt][w];i.shard[yt].shard_id==k&&(i.shard[yt].icon="el-icon-circle-close",i.shard[yt].status="error")}else if("删除"==a)for(var kt=e.attachment.shard_step[bt].storage_hosts.substr(0,e.attachment.shard_step[bt].storage_hosts.length-1),St=kt.split(";"),jt=0;jt<St.length;jt++)i.shard[yt].shard_id==St[jt]&&(i.shard[yt].icon="el-icon-circle-close",i.shard[yt].status="error");i.shard_description=e.attachment.shard_step[bt].error_info}clearInterval(t)}else"done"==e.status&&(i.init_active=4,i.finish_icon="el-icon-circle-check",i.finish_state="success",i.init_show=!1,i.finish_show=!0,clearInterval(t))}else if("ongoing"==e.status){for(var Ot=0;Ot<i.computer.length;Ot++){i.comp_active=Ot;for(var Lt=0;Lt<e.attachment.computer_step.length;Lt++)if("ongoing"==e.attachment.computer_step[Lt].computer_state){for(var It=e.attachment.computer_step[Lt].computer_hosts.substr(0,e.attachment.computer_step[Lt].computer_hosts.length-1),Ct=It.split(";"),$t=0;$t<Ct.length;$t++)if(console.log(22),Ct[$t]==i.computer[Ot].title&&(i.comp_active=Ot-1,i.computer[Ot].icon="el-icon-loading",i.computer[Ot].status="process",Ot>0&&Ot<i.comp_active+1))for(var Nt=0;Nt<Ot;Nt++)i.computer[Nt].icon="el-icon-circle-check",i.computer[Nt].status="success"}else if("failed"==e.attachment.computer_step[Lt].computer_state){console.log(23);for(var Vt=e.attachment.computer_step[Lt].computer_hosts.substr(0,e.attachment.computer_step[Lt].computer_hosts.length-1),Et=Vt.split(";"),Tt=0;Tt<Et.length;Tt++)Et[Tt]==i.computer[Ot].title&&(i.computer[Ot].icon="el-icon-circle-close",i.computer[Ot].status="error");i.computer_description=e.attachment.computer_step[Lt].error_info}else if("done"==e.attachment.computer_step[Lt].computer_state){console.log(24);for(var Dt=e.attachment.computer_step[Lt].computer_hosts.substr(0,e.attachment.computer_step[Lt].computer_hosts.length-1),Ft=Dt.split(";"),Pt=0;Pt<Ft.length;Pt++)Ft[Pt]==i.computer[Ot].title&&(i.computer[Ot].status="success",i.computer[Ot].icon="el-icon-circle-check")}}if(i.shard.length>0)for(var Mt=0;Mt<i.shard.length;Mt++)for(var Rt=0;Rt<e.attachment.shard_step.length;Rt++)if("ongoing"==e.attachment.shard_step[Rt].storage_state){if(e.attachment.shard_step[Rt].shard_hosts==i.shard[Mt].title&&(i.shard_active=Mt-1,i.shard[Mt].icon="el-icon-loading",i.shard[Mt].status="process",Mt>0&&Mt<i.shard_active+1))for(var qt=0;qt<Mt;qt++)i.shard[qt].icon="el-icon-circle-check",i.shard[qt].status="success"}else"failed"==e.attachment.shard_step[Rt].storage_state?(i.shard_active=Mt,i.shard[Mt].icon="el-icon-circle-close",i.shard[Mt].status="error",i.shard_description=e.attachment.shard_step[Rt].error_info):"done"==e.attachment.shard_step[Rt].storage_state&&(i.shard_active=Mt,i.shard[Mt].status="success",i.shard[Mt].icon="el-icon-circle-check");else if(e.attachment.shard_step[0].hasOwnProperty("storage_hosts")&&"删除"==a)if("ongoing"==e.attachment.storage_state)for(var zt=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),Bt=zt.split(";"),Qt=0;Qt<Bt.length;Qt++){var At={};At.title=""!==Bt?Bt[Qt]:"正在"+a+r[0],At.icon="el-icon-loading",At.status="process",At.description="",At.shard_id=Bt[Qt],i.shard.push(At)}else if("failed"==e.attachment.storage_state)for(var Jt=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),Ht=Jt.split(";"),Gt=0;Gt<Ht.length;Gt++){var Yt={};Yt.title=""!==Ht?Ht[Gt]:"正在"+a+r[0],Yt.icon="el-icon-circle-close",Yt.status="error",Yt.description="",Yt.shard_id=Ht[Gt],i.shard.push(Yt)}else if("done"==e.attachment.storage_state)for(var Ut=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),Kt=Ut.split(";"),Xt=0;Xt<Kt.length;Xt++){var Wt={};Wt.title=""!==Kt?Kt[Xt]:"正在"+a+r[0],Wt.icon="el-icon-circle-check",Wt.status="success",Wt.description="",Wt.shard_id=Kt[Xt],i.shard.push(Wt)}}else if("done"==e.status){if(i.init_show=!1,"done"==e.attachment.computer_state){console.log(51),i.computer_title=a+r[1]+"成功",i.computer_state="success",i.computer_icon="el-icon-circle-check",i.comp_active=i.computer.length-1;for(var Zt=0;Zt<i.computer.length;Zt++)i.computer[Zt].status="success",i.computer[Zt].icon="el-icon-circle-check"}if("done"==e.attachment.storage_state)if(console.log(52),i.shard_title=a+r[0]+"成功",i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_active=i.shard.length-1,i.shard.length>0)for(var te=0;te<i.shard.length;te++)console.log(53),i.shard[te].status="success",i.shard[te].icon="el-icon-circle-check";else if(e.attachment.shard_step[0].hasOwnProperty("storage_hosts")&&"删除"==a)for(var ee=e.attachment.shard_step[0].storage_hosts.substr(0,e.attachment.shard_step[0].storage_hosts.length-1),se=ee.split(";"),ae=0;ae<se.length;ae++){var ie={};ie.title=""!==se?se[ae]:"正在"+a+r[0],ie.icon="el-icon-circle-check",ie.status="success",ie.description="",ie.shard_id=se[ae],i.shard.push(ie)}if(i.init_active=4,i.finish_title=a+"集群成功",i.finish_icon="el-icon-circle-check",i.finish_state="success",i.finish_show=!0,clearInterval(t),"新增"==a){var re=sessionStorage.getItem("apply_all_cluster");if(2==re){var oe={};oe.effectCluster=sessionStorage.getItem("affected_clusters"),oe.cluster_name=e.attachment.cluster_name,oe.username=sessionStorage.getItem("login_username"),oe.type="add",Object(p["Eb"])(oe).then((function(t){var e=t;200==e.code&&sessionStorage.setItem("affected_clusters",e.effectCluster)}))}setTimeout((function(){}),3e3)}}else if("failed"==e.status){if(i.finish_title=a+"集群失败",i.finish_icon="el-icon-circle-close",i.finish_state="error",i.init_active=4,i.finish_description=e.error_info,i.finish_show=!0,i.init_show=!1,clearInterval(t),e.attachment.hasOwnProperty("computer_state")){if("failed"==e.attachment.computer_state){i.computer_state="error",i.computer_icon="el-icon-circle-close";for(var ne=0;ne<e.attachment.computer_step.length;ne++){var le=e.attachment.computer_step[ne].computer_hosts.substr(0,e.attachment.computer_step[ne].computer_hosts.length-1),ce=le.split(";");if("done"==e.attachment.computer_step[ne].computer_state){i.comp_active=ne;for(var de=0;de<i.computer.length;de++)for(var pe=0;pe<ce.length;pe++)i.computer[de].title==ce[pe]&&(i.computer[de].icon="el-icon-circle-check",i.computer[de].status="success")}else if("failed"==e.attachment.computer_step[ne].computer_state)for(var ue=0;ue<i.computer.length;ue++)for(var me=0;me<ce.length;me++)i.computer[ue].title==ce[me]&&(i.computer[ue].icon="el-icon-circle-close",i.computer[ue].status="error");i.computer_description=e.attachment.computer_step[ne].error_info}}else if("done"==e.attachment.computer_state)for(var _e=0;_e<e.attachment.computer_step.length;_e++){var he=e.attachment.computer_step[_e].computer_hosts.substr(0,e.attachment.computer_step[_e].computer_hosts.length-1),fe=he.split(";");if("done"==e.attachment.computer_step[_e].computer_state){i.comp_active=_e;for(var ge=0;ge<i.computer.length;ge++)for(var ve=0;ve<fe.length;ve++)(i.computer[ge].title=fe[ve])&&(i.computer[ge].icon="el-icon-circle-check",i.computer[ge].status="success")}else if("failed"==e.attachment.computer_step[_e].computer_state){for(var be=0;be<i.computer.length;be++)for(var ye=0;ye<fe.length;ye++)i.computer[be].title==fe[ye]&&(i.computer[be].icon="el-icon-circle-close",i.computer[be].status="error");i.computer_description=e.attachment.computer_step[_e].error_info}}}else i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+r[0]+"失败";if(e.attachment.hasOwnProperty("storage_state"))if("failed"==e.attachment.storage_state){i.storage_state="error",i.shard_icon="el-icon-circle-close";for(var xe=0;xe<e.attachment.shard_step.length;xe++)if("done"==e.attachment.shard_step[xe].storage_state){i.shard_active=xe;for(var we=0;we<i.shard.length;we++)if("新增"==a)for(var ke=e.attachment.shard_step[xe].shard_ids,Se=0;Se<ke.length;Se++)for(var w in ke[Se]){k=ke[Se][w];i.shard[we].shard_id==k&&(i.shard[we].icon="el-icon-circle-check",i.shard[we].status="success")}else if("删除"==a)for(var je=e.attachment.shard_step[xe].storage_hosts.substr(0,e.attachment.shard_step[xe].storage_hosts.length-1),Oe=je.split(","),Le=0;Le<Oe.length;Le++)i.shard[we].shard_id==Oe[Le]&&(i.shard[we].icon="el-icon-circle-check",i.shard[we].status="success")}else if("failed"==e.attachment.shard_step[xe].storage_state){for(var Ie=0;Ie<i.shard.length;Ie++)if("新增"==a)for(var Ce=e.attachment.shard_step[xe].shard_ids,$e=0;$e<Ce.length;$e++)for(var w in Ce[$e]){k=Ce[$e][w];i.shard[Ie].shard_id==k&&(i.shard[Ie].icon="el-icon-circle-close",i.shard[Ie].status="error")}else if("删除"==a)for(var Ne=e.attachment.shard_step[xe].storage_hosts.substr(0,e.attachment.shard_step[xe].storage_hosts.length-1),Ve=Ne.split(","),Ee=0;Ee<Ve.length;Ee++)i.shard[Ie].shard_id==Ve[Ee]&&(i.shard[Ie].icon="el-icon-circle-close",i.shard[Ie].status="error");i.shard_description=e.attachment.shard_step[xe].error_info}}else if("done"==e.attachment.storage_state){for(var Te=0;Te<e.attachment.shard_step.length;Te++)if("done"==e.attachment.shard_step[Te].storage_state){i.shard_active=Te;for(var De=0;De<i.shard.length;De++)i.shard[De].title==e.attachment.shard_step[Te].shard_hosts&&(i.shard[De].icon="el-icon-circle-check",i.shard[De].status="success")}else if("failed"==e.attachment.shard_step[Te].storage_state)for(var Fe=0;Fe<i.shard.length;Fe++)i.shard[Fe].title==e.attachment.shard_step[Te].shard_hosts&&(i.shard[Fe].icon="el-icon-circle-close",i.shard[Fe].status="error")}else{for(var Pe=0;Pe<i.shard.length;Pe++)if("新增"==a)for(var Me=e.attachment.shard_step[b].shard_ids,Re=0;Re<Me.length;Re++)for(var w in Me[Re]){k=Me[Re][w];i.shard[Pe].shard_id==k&&(i.shard[Pe].icon="el-icon-circle-close",i.shard[Pe].status="error")}else if("删除"==a)for(var qe=e.attachment.shard_step[b].storage_hosts.substr(0,e.attachment.shard_step[b].storage_hosts.length-1),ze=qe.split(","),Be=0;Be<ze.length;Be++)i.shard[Pe].shard_id==ze[Be]&&(i.shard[Pe].icon="el-icon-circle-close",i.shard[Pe].status="error");i.shard_description=e.error_info}else i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+r[0]+"失败"}var Qe="";Qe="新增"==a?"安装":"删除","ongoing"==e.status?"ongoing"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"ongoing"==e.attachment.computer_state||"dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?(i.percentage=75,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+Qe:i.progress_format="未完成计算"+Qe):"failed"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"failed"==e.attachment.computer_state||"dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?i.percentage<=50&&(i.percentage=50,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+Qe:i.progress_format="未完成计算"+Qe):(i.percentage=45,i.progress_format="未完成存储和计算"+Qe):"failed"==e.status?(i.progress_status="exception","ongoing"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"ongoing"==e.attachment.computer_state||"dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?(i.percentage=75,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+Qe:i.progress_format="未完成计算"+Qe):"failed"==e.attachment.storage_state&&"ongoing"==e.attachment.computer_state||"ongoing"==e.attachment.storage_state&&"failed"==e.attachment.computer_state||"dispatch"==e.attachment.storage_state&&"done"==e.attachment.computer_state||"done"==e.attachment.storage_state&&"dispatch"==e.attachment.computer_state?i.percentage<=50&&(i.percentage=50,"done"==e.attachment.computer_state?i.progress_format="未完成存储"+Qe:i.progress_format="未完成计算"+Qe):(i.percentage=45,i.progress_format="未完成存储和计算"+Qe)):(i.progress_status="success",i.percentage=100,i.progress_format=Qe+"完成")}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?(i.init_title="正在"+a+"集群",i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+"computer",i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+"shard",s>5&&(i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"computer失败",i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"shard失败",i.percentage=45,clearInterval(t))):null==e.attachment&&"ongoing"==e.status?(i.init_title="正在"+a+"集群",i.computer_state="process",i.computer_icon="el-icon-loading",i.computer_title="正在"+a+"computer",i.storage_state="process",i.shard_icon="el-icon-loading",i.shard_title="正在"+a+"shard",i.percentage=45):null==e.attachment&&"done"==e.status?(i.init_show=!1,i.computer_state="success",i.computer_icon="el-icon-circle-check",i.computer_title=a+"computer成功",i.storage_state="success",i.shard_icon="el-icon-circle-check",i.shard_title=a+"shard成功",i.percentage=100,clearInterval(t)):(i.init_show=!1,i.computer_state="error",i.computer_icon="el-icon-circle-close",i.computer_title=a+"computer失败",i.storage_state="error",i.shard_icon="el-icon-circle-close",i.shard_title=a+"shard失败",i.percentage=45,clearInterval(t))})),s>=86400&&clearInterval(t)}),0)}}},U=Y,K=Object(f["a"])(U,J,H,!1,null,"5341426e",null),X=K.exports,W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("发起全量备份")])],1)],1)],1)},Z=[],tt={name:"list",props:{listsent:{typeof:Object}},data:function(){return{form:{name:"",nick_name:"",id:""}}},mounted:function(){this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id},methods:{onSubmit:function(t){var e=this;Object(l["f"])("确定要对集群"+t.nick_name+"进行全量备份么?").then((function(){var s=Object.assign({},t),a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.paras={cluster_id:s.id,nick_name:s.nick_name},a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"",a.job_type="manual_backup_cluster",Object(p["h"])(a).then((function(t){var s=t;"accept"==s.status?(e.dialogFormVisible=!1,e.message_tips="全量备份下发成功",e.message_type="success",Object(l["g"])(e.message_tips,e.message_type)):"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))})).catch((function(){Object(l["g"])("已取消全量备份","info")}))}}},et=tt,st=Object(f["a"])(et,W,Z,!1,null,"0787fc28",null),at=st.exports,it=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"selectExpandForm",attrs:{model:t.selectdbtemp,"label-width":"120px",rules:t.rules}},[s("el-form-item",{attrs:{label:"集群ID:"}},[s("span",[t._v(t._s(t.selectdbtemp.cluster_id))])]),s("el-form-item",{attrs:{label:"选择数据库:",prop:"database"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.selectdbtemp.database,callback:function(e){t.$set(t.selectdbtemp,"database",e)},expression:"selectdbtemp.database"}},t._l(t.databases,(function(t){return s("el-option",{key:t.id,attrs:{label:t.datname,value:t.datname}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.expandTable(t.selectdbtemp)}}},[t._v("扩容")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogExpandVisible,"custom-class":"single_dal_view expand","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogExpandVisible=e}}},[s("el-form",{ref:"expandForm",attrs:{model:t.expandtemp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("div",{staticClass:"icons-container"},[s("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.shardNameList,(function(e,a){return s("el-tab-pane",{key:a,attrs:{label:e.name,name:e.name,value:e.id+"_"+e.cluster_id}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.shardTable,"max-height":"240",border:"","highlight-current-row":""},on:{"selection-change":t.selectionChangeHandle}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{prop:"TABLE_SCHEMA",label:"数据库名称",align:"center"}}),s("el-table-column",{attrs:{prop:"TABLE_NAME",label:"表名称",align:"center"}})],1),s("el-form-item",{attrs:{label:"原shard:",prop:"shard_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandtemp.shard_name,callback:function(e){t.$set(t.expandtemp,"shard_name",e)},expression:"expandtemp.shard_name"}})],1),s("el-form-item",{attrs:{label:"是否保留原表:",prop:"if_save"}},[s("el-radio",{attrs:{label:"0"},model:{value:t.expandtemp.if_save,callback:function(e){t.$set(t.expandtemp,"if_save",e)},expression:"expandtemp.if_save"}},[t._v("是")]),s("el-radio",{attrs:{label:"1"},model:{value:t.expandtemp.if_save,callback:function(e){t.$set(t.expandtemp,"if_save",e)},expression:"expandtemp.if_save"}},[t._v("否")])],1),t.expandtemp.table_list.length?s("el-form-item",{attrs:{label:"已选原shard表:",prop:"table_list"}},[[s("ul",{staticClass:"infinite-list",staticStyle:{"max-height":"200px",overflow:"auto"}},t._l(t.expandtemp.table_list,(function(e,a){return s("li",{key:a,staticClass:"infinite-list-item"},[t._v(" "+t._s(e.TABLE_SCHEMA+"."+e.TABLE_NAME)+" ")])})),0)]],2):t._e(),t.expandtemp.dsc_flag?s("el-form-item",{attrs:{label:"目标shard:",prop:"dst_shard_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择目标shard"},on:{change:t.ChangeShardName},model:{value:t.expandtemp.dst_shard_id,callback:function(e){t.$set(t.expandtemp,"dst_shard_id",e)},expression:"expandtemp.dst_shard_id"}},t._l(t.shardsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e()],1)})),1)],1)]),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogExpandVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.showExpandInfo(t.expandtemp)}}},[t._v(t._s(t.expandtemp.title))])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.outoExpandInfoVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.outoExpandInfoVisible=e}}},[s("el-form",{ref:"autoExpandForm",attrs:{model:t.autoexpandtemp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("el-form-item",{attrs:{label:"原shard:",prop:"auto_shard_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择原shard"},on:{change:t.autoChangeShardName},model:{value:t.autoexpandtemp.auto_shard_id,callback:function(e){t.$set(t.autoexpandtemp,"auto_shard_id",e)},expression:"autoexpandtemp.auto_shard_id"}},t._l(t.srcShardsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"排序方式:",prop:"policy"}},[s("el-select",{attrs:{placeholder:"请选择排序方式"},on:{change:t.autoChangePolicy},model:{value:t.autoexpandtemp.policy,callback:function(e){t.$set(t.autoexpandtemp,"policy",e)},expression:"autoexpandtemp.policy"}},t._l(t.policys,(function(t){return s("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,ref:"dataTable",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.autoexpandtemp.tables,"max-height":"240",border:"","highlight-current-row":""},on:{"selection-change":t.selAutoChangeHandle}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{prop:"TABLE_SCHEMA",label:"数据库名称",align:"center"}}),s("el-table-column",{attrs:{prop:"TABLE_NAME",label:"表名称",align:"center"}})],1),s("el-form-item",{attrs:{label:"已选原shard表:",prop:"table_list"}},[[s("ul",{staticClass:"infinite-list",staticStyle:{"max-height":"200px",overflow:"auto"}},t._l(t.autoexpandtemp.table_list,(function(e,a){return s("li",{key:a,staticClass:"infinite-list-item"},[t._v(" "+t._s(e.TABLE_SCHEMA+"."+e.TABLE_NAME)+" ")])})),0)]],2),s("el-form-item",{attrs:{label:"是否保留原表:",prop:"if_save"}},[s("el-radio",{attrs:{label:"0"},model:{value:t.autoexpandtemp.if_save,callback:function(e){t.$set(t.autoexpandtemp,"if_save",e)},expression:"autoexpandtemp.if_save"}},[t._v("是")]),s("el-radio",{attrs:{label:"1"},model:{value:t.autoexpandtemp.if_save,callback:function(e){t.$set(t.autoexpandtemp,"if_save",e)},expression:"autoexpandtemp.if_save"}},[t._v("否")])],1),t.autoexpandtemp.dsc_flag?s("el-form-item",{attrs:{label:"目标shard:",prop:"dst_shard_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择目标shard"},on:{change:t.autoChangeDscShardName},model:{value:t.autoexpandtemp.dst_shard_id,callback:function(e){t.$set(t.autoexpandtemp,"dst_shard_id",e)},expression:"autoexpandtemp.dst_shard_id"}},t._l(t.shardsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.outoExpandInfoVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.autoExpandInfo(t.autoexpandtemp)}}},[t._v("提交")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogExpandInfoVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogExpandInfoVisible=e}}},[s("el-form",{ref:"expandInfoForm",attrs:{model:t.expandInfoTemp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("el-form-item",{attrs:{label:"原shard:",prop:"shard_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandInfoTemp.shard_name,callback:function(e){t.$set(t.expandInfoTemp,"shard_name",e)},expression:"expandInfoTemp.shard_name"}})],1),s("el-form-item",{attrs:{label:"已选原shard表:",prop:"table_list"}},[[s("ul",{staticClass:"infinite-list",staticStyle:{"max-height":"200px",overflow:"auto"}},t._l(t.expandInfoTemp.table_list,(function(e,a){return s("li",{key:a,staticClass:"infinite-list-item"},[t._v(" "+t._s(e.TABLE_SCHEMA+"."+e.TABLE_NAME)+" ")])})),0)]],2),t.expandInfoTemp.policy?s("el-form-item",{attrs:{label:"排序方式:",prop:"policy_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandInfoTemp.policy_name,callback:function(e){t.$set(t.expandInfoTemp,"policy_name",e)},expression:"expandInfoTemp.policy_name"}})],1):t._e(),s("el-form-item",{attrs:{label:"目标shard:",prop:"dst_shard_name"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.expandInfoTemp.dst_shard_name,callback:function(e){t.$set(t.expandInfoTemp,"dst_shard_name",e)},expression:"expandInfoTemp.dst_shard_name"}})],1),s("el-form-item",{attrs:{label:"是否保留原表:",prop:"if_save"}},[["0"==t.expandInfoTemp.if_save?s("span",[t._v("是")]):s("span",[t._v("否")])]],2)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:t.expandClose}},[t._v("返回")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.expandData(t.expandInfoTemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogExpondInfo,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeExpandDestory},on:{"update:visible":function(e){t.dialogExpondInfo=e}}},[t.expondInit?s("span",[t._v(t._s(t.expand_init))]):t._e(),t.expondSatus?s("json-viewer",{attrs:{value:t.expondInfo}}):t._e(),t.expondResult?s("span",[t._v(t._s(t.expand_end))]):t._e()],1)],1)},rt=[],ot={name:"List",components:{JsonViewer:m.a},props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){e?s():s(new Error("请选择shard名称"))},e=function(t,e,s){e?s():s(new Error("请选择目标shard"))},s=function(t,e,s){e?s():s(new Error("请选择排序方式"))},a=function(t,e,s){e?s():s(new Error("请选择原shard"))},i=function(t,e,s){0==e.length?s(new Error("请选择需要扩容的表")):s()},r=function(t,e,s){0==e.length?s(new Error("请选择数据库")):s()};return{form:{name:"",nick_name:"",id:""},activeName:"",shardNameList:[],expandtemp:{shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],dst_shard_id:"",dst_shard_name:"",title:"自动扩容",dsc_flag:!1,if_save:"0"},listLoading:!0,tableKey:0,shardTable:[],shardsList:[],autoexpandtemp:{shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],policy:"",auto_shard_id:"",tables:[],policy_name:"",dst_shard_id:"",dst_shard_name:"",dsc_flag:!1,if_save:"0"},expandInfoTemp:{shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],dst_shard_id:"",dst_shard_name:"",policy:"",policy_name:""},dialogStatus:"",textMap:{expand:"集群扩容",expandInfo:"集群扩容确认信息",outoExpand:"自动扩容"},outoExpandInfoVisible:!1,srcShardsList:[],policys:d["n"],dialogExpandVisible:!1,dialogExpandInfoVisible:!1,dialogExpondInfo:!1,expondSatus:!0,expand_init:"",expand_end:"",job_id:"",timer:null,expondInit:!0,expondResult:!1,expondInfo:"",databases:[],selectdbtemp:{database:"",cluster_id:"",ip:"",port:"",name:""},expandTableList:null,rules:{shard_name:[{required:!0,trigger:"blur",validator:t}],dst_shard_id:[{required:!0,trigger:"blur",validator:e}],policy:[{required:!0,trigger:"blur",validator:s}],auto_shard_id:[{required:!0,trigger:"blur",validator:a}],table_list:[{required:!0,trigger:"blur",validator:i}],database:[{required:!0,trigger:"blur",validator:r}]}}},watch:{"expandtemp.table_list":{handler:function(t,e){t.length>0?(this.expandtemp.dsc_flag=!0,this.expandtemp.title="提交"):(this.expandtemp.dsc_flag=!1,this.expandtemp.title="自动扩容",this.expandtemp.shard_name="")}},"autoexpandtemp.table_list":{handler:function(t,e){t.length>0?this.autoexpandtemp.dsc_flag=!0:this.autoexpandtemp.dsc_flag=!1}}},mounted:function(){var t=this;this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id;var e={id:this.listsent.id};Object(p["hb"])(e).then((function(s){s.list.length<2?(t.message_tips="集群扩容必须在同一集群不同shard下操作！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.shardNameList=s.list,t.activeName=s.list[0].name,t.expandtemp.list.cluster_id=t.listsent.id,t.expandtemp.list.shard_id=s.list[0].id,t.expandtemp.list.shard_name=s.list[0].name,Object(p["F"])(e).then((function(e){200===e.code?(t.databases=e.list,t.selectdbtemp.cluster_id=t.listsent.id,t.selectdbtemp.ip=e.ip,t.selectdbtemp.port=e.port,t.selectdbtemp.name=e.name,setTimeout((function(){t.listLoading=!1}),500)):(t.message_tips=e.message,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))})))}))},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{expandTable:function(t){var e=this;this.$refs["selectExpandForm"].validate((function(s){if(s){var a={database:t.database,ip:t.ip,port:t.port,name:t.name};Object(p["G"])(a).then((function(s){if(200===s.code){var a=s.list.arr;if(a.length>0)for(var i=0;i<a.length;i++){var r=a[i];e.$set(r,"nspname",t.database+"_$$_"+r.nspname)}var o=a.map((function(t){return{TABLE_SCHEMA:t.nspname,TABLE_NAME:t.relname,relshardid:t.relshardid}}));e.expandTableList=o,e.shardTable=o.filter((function(t,s){return t.relshardid==e.expandtemp.list.shard_id})),e.dialogExpandVisible=!0}else e.message_tips=s.message,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},onSubmit:function(t){console.log(t)},handleClick:function(t){var e=this;if(t.$attrs.value){var s=t.$attrs.value.split("_");if(this.expandtemp.list.cluster_id=s[1],this.expandtemp.list.shard_id=s[0],this.expandtemp.list.shard_name=t.name,this.expandtemp.dst_shard_id="",this.shardTable=[],this.shardTable=this.expandTableList.filter((function(t,s){return t.relshardid==e.expandtemp.list.shard_id})),this.expandtemp.shard_name){this.shardsList=[];var a={cluster_id:this.expandtemp.list.cluster_id,shard_id:this.expandtemp.list.shard_id};Object(p["ab"])(a).then((function(t){e.shardsList=t.list})),this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))}}},selectionChangeHandle:function(t){var e=this;if(this.expandtemp.shard_name=this.expandtemp.list.shard_name,this.expandtemp.table_list=t,this.expandtemp.shard_name){var s={cluster_id:this.expandtemp.list.cluster_id,shard_id:this.expandtemp.list.shard_id};Object(p["ab"])(s).then((function(t){e.shardsList=t.list})),this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))}},showExpandInfo:function(t){var e=this;if(console.log(t),"自动扩容"==this.expandtemp.title){this.autoExpandTemp(),this.dialogExpandVisible=!1,this.dialogDetail=!1,this.dialogStatus="outoExpand",this.dialogExpandInfoVisible=!1,this.outoExpandInfoVisible=!0,this.autoexpandtemp.list.cluster_id=t.list.cluster_id;var s={id:t.list.cluster_id};Object(p["hb"])(s).then((function(t){t.list.length<2?(e.message_tips="集群扩容必须在同一集群不同shard下操作！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):e.srcShardsList=t.list}))}else this.$refs["expandForm"].validate((function(s){s&&(e.dialogExpandVisible=!1,e.dialogDetail=!1,e.dialogStatus="expandInfo",e.dialogExpandInfoVisible=!0,e.expandInfoTemp.shard_name=t.shard_name,e.expandInfoTemp.list=t.list,e.expandInfoTemp.table_list=t.table_list,e.expandInfoTemp.dst_shard_id=t.dst_shard_id,e.expandInfoTemp.dst_shard_name=t.dst_shard_name,e.expandInfoTemp.if_save=t.if_save)}))},autoExpandTemp:function(){this.autoexpandtemp={shard_name:"",list:{cluster_id:"",shard_id:"",shard_name:""},table_list:[],policy:"",auto_shard_id:"",tables:[],policy_name:"",dst_shard_id:"",dst_shard_name:"",dsc_flag:!1,if_save:"0"}},expandClose:function(){this.dialogExpandVisible=!0,this.dialogExpandInfoVisible=!1},autoExpandInfo:function(t){var e=this;this.$refs["autoExpandForm"].validate((function(s){s&&(e.dialogStatus="expandInfo",e.outoExpandInfoVisible=!1,e.dialogExpandInfoVisible=!0,e.expandInfoTemp.shard_name=t.shard_name,e.expandInfoTemp.table_list=t.table_list,e.expandInfoTemp.list=t.list,e.expandInfoTemp.policy=t.policy,e.expandInfoTemp.policy_name=t.policy_name,e.expandInfoTemp.dst_shard_id=t.dst_shard_id,e.expandInfoTemp.dst_shard_name=t.dst_shard_name,e.expandInfoTemp.if_save=t.if_save)}))},expandData:function(t){for(var e=this,s=[],a=0;a<t.table_list.length;a++){var i=t.table_list[a].TABLE_SCHEMA.replace("_$$_",".")+"."+t.table_list[a].TABLE_NAME;s.push(i)}var r={};r.user_name=sessionStorage.getItem("login_username"),r.job_id="",r.version=d["u"][0].ver,r.job_type="expand_cluster",r.timestamp=d["s"][0].time+"";var o={};o.cluster_id=t.list.cluster_id,o.src_shard_id=t.list.shard_id,o.table_list=s,o.dst_shard_id=t.dst_shard_id,o.drop_old_table=t.if_save,t.policy&&(o.policy=t.policy),r.paras=o,Object(p["v"])(r).then((function(t){var s=t;if("accept"==s.status){e.dialogExpondInfo=!0,e.dialogExpandVisible=!1,e.dialogExpandInfoVisible=!1,e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null,e.expondSatus=!1,e.expondResult=!1,e.expondInit=!0,e.expand_init="",e.expand_end="",e.expondInfo=[],e.finish_show=!1,e.finish_state="";var a="扩容",i=0;e.getFStatus(e.timer,s.job_id,i++,a),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,i++,a)}),2e3)}else"ongoing"==s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))},selAutoChangeHandle:function(t){this.autoexpandtemp.table_list=t},autoChangeShardName:function(t){for(var e=this,s=0;s<this.srcShardsList.length;s++)this.srcShardsList[s].id==t&&(this.autoexpandtemp.shard_name=this.srcShardsList[s].name,this.autoexpandtemp.list.shard_id=this.srcShardsList[s].id,this.autoexpandtemp.list.shard_name=this.srcShardsList[s].name);if(this.autoexpandtemp.shard_name){this.shardsList=[];var a={cluster_id:this.autoexpandtemp.list.cluster_id,shard_id:this.autoexpandtemp.list.shard_id};Object(p["ab"])(a).then((function(t){e.shardsList=t.list}))}var i={job_id:""};i.version=d["u"][0].ver,i.user_name=sessionStorage.getItem("login_username"),i.job_type="get_expand_table_list",i.timestamp=d["s"][0].time+"";var r={};r.cluster_id=this.autoexpandtemp.list.cluster_id,r.shard_id=t,r.policy=this.autoexpandtemp.policy,r.compute_ip=this.selectdbtemp.ip,r.compute_port=this.selectdbtemp.port,r.compute_database=this.selectdbtemp.database,i.paras=r,this.autoexpandtemp.policy&&(this.autoexpandtemp.tables=[],Object(p["O"])(i).then((function(t){if("0"==t.error_code)if(""!==t.attachment.table_list){for(var s=t.attachment.table_list.split(","),a=[],i=0;i<s.length;i++){var r=s[i].split("."),o={TABLE_SCHEMA:r[1],TABLE_NAME:r[2]};a.push(o)}e.autoexpandtemp.tables=a,e.autoexpandtemp.tables&&e.$nextTick((function(){e.autoexpandtemp.tables.forEach((function(t){e.$refs.dataTable.toggleAllSelection(t,!0)}))}))}else e.autoexpandtemp.tables=!1;else e.message_tips=t.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})))},autoChangePolicy:function(t){for(var e=this,s=0;s<this.policys.length;s++)this.policys[s].id==t&&(this.autoexpandtemp.policy_name=this.policys[s].label,this.autoexpandtemp.list.policy=this.policys[s].id);var a={job_id:""};a.version=d["u"][0].ver,a.user_name=sessionStorage.getItem("login_username"),a.job_type="get_expand_table_list",a.timestamp=d["s"][0].time+"";var i={};i.cluster_id=this.autoexpandtemp.list.cluster_id,i.shard_id=this.autoexpandtemp.auto_shard_id,i.policy=t,i.compute_ip=this.selectdbtemp.ip,i.compute_port=this.selectdbtemp.port,i.compute_database=this.selectdbtemp.database,a.paras=i,this.autoexpandtemp.auto_shard_id&&(this.autoexpandtemp.tables=[],Object(p["O"])(a).then((function(t){if("0"==t.error_code)if(""!==t.attachment.table_list){for(var s=t.attachment.table_list.split(","),a=[],i=0;i<s.length;i++){var r=s[i].split("."),o={TABLE_SCHEMA:r[1],TABLE_NAME:r[2]};a.push(o)}e.autoexpandtemp.tables=a,e.autoexpandtemp.tables&&e.$nextTick((function(){e.autoexpandtemp.tables.forEach((function(t){e.$refs.dataTable.toggleAllSelection(t,!0)}))}))}else e.autoexpandtemp.tables=!1;else e.message_tips=t.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})))},autoChangeDscShardName:function(t){for(var e=0;e<this.shardsList.length;e++)this.shardsList[e].id==t&&(this.autoexpandtemp.dst_shard_name=this.shardsList[e].name)},ChangeShardName:function(t){for(var e=0;e<this.shardsList.length;e++)this.shardsList[e].id==t&&(this.expandtemp.dst_shard_name=this.shardsList[e].name)},beforeExpandDestory:function(){clearInterval(this.timer),this.dialogExpondInfo=!1,this.timer=null},getFStatus:function(t,e,s,a){var i=this;setTimeout((function(){var r={job_type:"get_status"};r.version=d["u"][0].ver,r.job_id=e,r.timestamp=d["s"][0].time+"",r.paras={},i.job_id="任务ID:"+e,Object(p["N"])(r).then((function(e){"扩容"==a&&(null!==e.attachment?"failed"==e.status?(i.expand_end="集群扩容失败",i.expondInit=!1,i.expondSatus=!0,i.expondResult=!0,i.expondInfo=e.attachment.memo_info,console.log(e.attachment.memo_info),clearInterval(t)):"done"==e.status?(i.expand_end="集群扩容成功",i.expondInit=!1,i.expondSatus=!0,i.expondResult=!0,i.expondInfo=e.attachment.memo_info,clearInterval(t)):(i.expand_init="正在进行集群扩容",i.expondInit=!0,i.expondSatus=!1,i.expondResult=!1,i.expondInfo=e.attachment.memo_info):null==e.attachment&&"failed"==e.status&&(i.expondInit=!1,i.expondSatus=!1,i.expondResult=!0,i.expand_end="集群扩容失败",clearInterval(t)))})),s>=86400&&clearInterval(t)}),0)}}},nt=ot,lt=Object(f["a"])(nt,it,rt,!1,null,"2a9cf256",null),ct=lt.exports,dt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"原集群名称:",prop:"old_cluster_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择原集群名称"},model:{value:t.form.old_cluster_id,callback:function(e){t.$set(t.form,"old_cluster_id",e)},expression:"form.old_cluster_id"}},t._l(t.oldClusterList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"回档集群名称:",prop:"nick_name"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"回档业务名称:",prop:"nick_name"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"回档时间:",prop:"retreated_time"}},[s("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择回档时间"},model:{value:t.form.retreated_time,callback:function(e){t.$set(t.form,"retreated_time",e)},expression:"form.retreated_time"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("回档")])],1)],1),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeRestoreDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)])],1)},pt=[],ut={name:"List",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){var a=Object(l["d"])();e?e>a?s(new Error("回档时间不能晚于当前时间")):s():s(new Error("请选择回档时间"))},e=function(t,e,s){e?s():s(new Error("请选择原集群名称"))};return{form:{name:"",nick_name:"",id:"",old_cluster_id:"",retreated_time:""},oldClusterList:[],dialogStatusVisible:!1,activities:[],timer:null,rules:{retreated_time:[{required:!0,trigger:"blur",validator:t}],old_cluster_id:[{required:!0,trigger:"blur",validator:e}]}}},mounted:function(){var t=this;this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id;var e={cluster_id:this.listsent.id};Object(p["Y"])(e).then((function(e){t.oldClusterList=e.list})),this.$nextTick((function(){t.$refs["form"]&&t.$refs["form"].clearValidate()}))},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{beforeRestoreDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},onSubmit:function(t){var e=this;this.$refs["form"].validate((function(s){if(s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.version=d["u"][0].ver,a.job_type="cluster_restore",a.timestamp=d["s"][0].time+"";var i={};i.src_cluster_id=t.old_cluster_id,i.dst_cluster_id=t.id,i.restore_time=t.retreated_time,a.paras=i,Object(l["f"])(t.nick_name+"集群的数据将被覆盖，确定要进行回档操作么?").then((function(){Object(p["tb"])(a).then((function(t){var s=t;if("accept"===s.status){e.dialogRetreatedVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var a={content:"正在回档集群...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(a);var i=0;e.timer=null,e.timer=setInterval((function(){e.getStatus(e.timer,s.job_id,i++)}),1e3)}else"ongoing"===s.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))})).catch((function(){Object(l["g"])("已取消回档","info")}))}}))},getStatus:function(t,e,s){var a=this;setTimeout((function(){var i={job_type:"get_status"};i.version=d["u"][0].ver,i.job_id=e,i.timestamp=d["s"][0].time+"",i.paras={},Object(p["N"])(i).then((function(e){var s="";if(null!==e.attachment&&(s=""!==e.attachment.memo_info.error_info?e.attachment.memo_info.error_info:e.error_info),"done"===e.status||"failed"===e.status)if(clearInterval(t),"done"===e.status){var i={content:"集群回档成功",timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};a.activities.push(i),a.getList()}else{var r={content:s,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(r)}else if(s){var o={content:s,timestamp:Object(l["d"])(),color:"#0bbd87"};a.activities.push(o)}})),s>=86400&&clearInterval(t)}),0)}}},mt=ut,_t=Object(f["a"])(mt,dt,pt,!1,null,null,null),ht=_t.exports,ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("div",{staticClass:"table-list-search-wrap"},[s("el-date-picker",{staticStyle:{width:"200px","margin-right":"5px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"起始时间"},model:{value:t.listQuery.startTime,callback:function(e){t.$set(t.listQuery,"startTime",e)},expression:"listQuery.startTime"}}),t._v(" - "),s("el-date-picker",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"结束时间"},model:{value:t.listQuery.endTime,callback:function(e){t.$set(t.listQuery,"endTime",e)},expression:"listQuery.endTime"}}),s("el-input",{staticClass:"list_search_keyword",attrs:{placeholder:"可输入原IP地址搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.hostaddr,callback:function(e){t.$set(t.listQuery,"hostaddr",e)},expression:"listQuery.hostaddr"}}),s("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v(" 查询 ")]),s("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v(" 重置 ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.installStatus,expression:"installStatus===true"}],staticClass:"info",domProps:{textContent:t._s(t.info)}})],1),s("div",{staticClass:"table-list-wrap"})]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":""}},[s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{label:"taskid",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticClass:"link-type click_btn",on:{click:function(e){return t.handleDetail(a)}}},[t._v(t._s(a.taskid))])]}}])}),s("el-table-column",{attrs:{prop:"cluster_id",align:"center",label:"cluster_id"}}),s("el-table-column",{attrs:{prop:"shard_id",align:"center",label:"shard_id"}}),s("el-table-column",{attrs:{prop:"shard_name",align:"center",label:"shard_name"}}),s("el-table-column",{attrs:{prop:"host",align:"center",label:"原IP地址"}}),s("el-table-column",{attrs:{prop:"new_master_host",align:"center",label:"新IP地址"}}),s("el-table-column",{attrs:{prop:"start_time",align:"center",label:"开始时间"}}),s("el-table-column",{attrs:{prop:"count_time",align:"center",label:"耗时"}}),s("el-table-column",{attrs:{prop:"status",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["成功"===e.row.status?s("span",{staticStyle:{color:"#00ed37"}},[t._v("成功")]):"失败"===e.row.status?s("span",{staticStyle:{color:"red"}},[t._v("失败")]):t._e()]}}])}),s("el-table-column",{attrs:{prop:"err_msg",align:"center","show-overflow-tooltip":!0,label:"结果信息"}})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize,"page-sizes":[10,20,30,40,50]},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}}),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,"custom-class":"single_dal_view",width:"90%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"1200px"}},[s("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{height:"360",data:t.history,border:"","highlight-current-row":"",disabled:"detail"===t.dialogStatus}},[s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{prop:"host",align:"center",label:"host"}}),s("el-table-column",{attrs:{prop:"shard_id",align:"center",label:"shard_id"}}),s("el-table-column",{attrs:{prop:"step",align:"center",label:"step"}}),s("el-table-column",{attrs:{prop:"new_master_host",align:"center",label:"new_master_host"}}),s("el-table-column",{attrs:{prop:"consfailover_msg",align:"center",label:"consfailover_msg","show-overflow-tooltip":!0}}),s("el-table-column",{attrs:{prop:"timestamp",align:"center",label:"timestamp"}}),s("el-table-column",{attrs:{prop:"err_msg",align:"center",label:"err_msg"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("关闭")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.dialogDetail,expression:"!dialogDetail"}],attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData(t.row)}}},[t._v(" 确认 ")])],1)],1)],1)},gt=[],vt={name:"Switchover",components:{Pagination:c["a"]},props:{listsent:{typeof:Object}},data:function(){return{tableKey:0,list:null,history:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,hostaddr:"",startTime:"",endTime:"",id:""},temp:{hostaddr:"",rack_id:"",datadir:"",logdir:"",wal_log_dir:"",comp_datadir:"",total_cpu_cores:"",total_mem:""},dialogFormVisible:!1,dialogEditVisible:!1,dialogStatus:"",textMap:{detail:"详情"},dialogDetail:!1,message_tips:"",message_type:"",installStatus:!1,info:"",row:{},rules:{}}},created:function(){this.listQuery.id=this.listsent.id,this.getList()},methods:{handleFilter:function(){this.listQuery.pageNo=1,this.getList()},handleClear:function(){this.listQuery.hostaddr="",this.listQuery.startTime="",this.listQuery.endTime="",this.listQuery.pageNo=1,this.listQuery.id=this.listQuery.id,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);Object(p["kb"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},handleDetail:function(t){var e=this;this.dialogStatus="detail",this.dialogFormVisible=!0,this.dialogDetail=!0;var s={};s.taskid=t.taskid,Object(p["lb"])(s).then((function(t){e.history=t.list,setTimeout((function(){e.listLoading=!1}),500)}))}}},bt=vt,yt=Object(f["a"])(bt,ft,gt,!1,null,null,null),xt=yt.exports,wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("div",{staticClass:"table-list-search-wrap"},[s("el-select",{staticClass:"list_search_select",attrs:{placeholder:"请选择备份类型"},model:{value:t.listQuery.backup_type,callback:function(e){t.$set(t.listQuery,"backup_type",e)},expression:"listQuery.backup_type"}},[s("el-option",{attrs:{label:"存储",value:"storage"}}),s("el-option",{attrs:{label:"计算",value:"compute"}})],1),s("el-select",{staticClass:"list_search_select",attrs:{placeholder:"请选择状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[s("el-option",{attrs:{label:"not_started",value:"not_started"}}),s("el-option",{attrs:{label:"ongoing",value:"ongoing"}}),s("el-option",{attrs:{label:"done",value:"done"}}),s("el-option",{attrs:{label:"failed",value:"failed"}})],1),s("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("查询")]),s("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v("重置")])],1)]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":""}},[t._v(" > "),s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{label:"集群名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticClass:"link-type",on:{click:function(e){return t.handleDetail(a)}}},[t._v(t._s(a.cluster_name))])]}}])}),s("el-table-column",{attrs:{prop:"nick_name",align:"center",label:"业务名称"}}),s("el-table-column",{attrs:{prop:"shard_name",align:"center",label:"shard名称"}}),s("el-table-column",{attrs:{prop:"comp_name",align:"center",label:"计算节点名称"}}),s("el-table-column",{attrs:{prop:"backup_type",align:"center",label:"备份类型"},scopedSlots:t._u([{key:"default",fn:function(e){return["storage"===e.row.backup_type?s("span",[t._v("存储")]):"compute"===e.row.backup_type?s("span",[t._v("计算")]):s("span")]}}])}),s("el-table-column",{attrs:{prop:"status",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["failed"===e.row.status?s("span",{staticStyle:{color:"red"}},[t._v(t._s(e.row.status))]):s("span",[t._v(t._s(e.row.status))])]}}])}),s("el-table-column",{attrs:{prop:"info",align:"center","show-overflow-tooltip":!0,label:"结果信息"}}),s("el-table-column",{attrs:{prop:"start_ts",align:"center",label:"开始时间"}}),s("el-table-column",{attrs:{prop:"end_ts",align:"center",label:"结束时间"}})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}})],1)},kt=[],St={name:"Operation",components:{Pagination:c["a"]},props:{listsent:{typeof:Object}},data:function(){return{tableKey:0,list:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,username:"",backup_type:"",status:"",id:""},dialogFormVisible:!1,dialogEditVisible:!1,dialogStatus:"",textMap:{detail:"详情"},dialogDetail:!1,message_tips:"",message_type:"",row:{}}},created:function(){this.listQuery.id=this.listsent.id,this.getList()},methods:{handleFilter:function(){this.listQuery.pageNo=1,this.getList()},handleClear:function(){this.listQuery.username="",this.listQuery.backup_type="",this.listQuery.status="",this.listQuery.pageNo=1,this.listQuery.id=this.listQuery.id,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);Object(p["Z"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},handleDetail:function(t){this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},t),this.dialogDetail=!0}}},jt=St,Ot=Object(f["a"])(jt,wt,kt,!1,null,null,null),Lt=Ot.exports,It=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_id"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择shard名称"},model:{value:t.form.shard_id,callback:function(e){t.$set(t.form,"shard_id",e)},expression:"form.shard_id"}},t._l(t.shardList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id},nativeOn:{click:function(s){return t.ChangeSaler(e)}}})})),1)],1),s("el-form-item",{attrs:{label:"主节点:",prop:"primary_node"}},[s("span",[t._v(t._s(t.form.primary_node))])]),s("el-form-item",{attrs:{label:"备机节点:",prop:"replica"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择备机节点"},model:{value:t.form.replica,callback:function(e){t.$set(t.form,"replica",e)},expression:"form.replica"}},t._l(t.options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("保存")])],1)],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusFVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeSwitchDestory},on:{"update:visible":function(e){t.dialogStatusFVisible=e}}},[s("div",{staticStyle:{height:"400px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.active,"finish-status":"success"}},t._l(t.stepParams,(function(e,a){return s("el-step",{key:a,class:t.stepSuc.includes(a)?"stepSuc":"stepErr",attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(e){return t.handleStep(a)}}})})),1)],1)])],1)},Ct=[],$t={name:"List",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){e?s():s(new Error("请选择shard名称"))};return{form:{name:"",nick_name:"",id:"",primary_node:"",replica:"",shard_id:"",shard_name:""},shardList:[],options:[],dialogStatusFVisible:!1,active:0,stepSuc:[0],stepParams:[],job_id:"",timer:null,rules:{shard_id:[{required:!0,trigger:"blur",validator:t}]}}},created:function(){var t=this;Object(p["eb"])(this.listsent.id).then((function(e){var s=e;200==s.code&&(t.shardList=s.list)}))},mounted:function(){this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{onSubmit:function(t){var e=this;this.$refs["form"].validate((function(t){if(t){var s=Object(l["a"])(),a="将对"+e.form.shard_name+"进行主备切换,是否继续?code="+s;Object(l["e"])(a).then((function(t){if(t.value)if(t.value==s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="manual_switch",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i=e.form.primary_node.substring(0,e.form.primary_node.length-1).replace("(","_"),r={};if(e.form.replica.length){var o=e.form.replica.substring(0,e.form.replica.length-1).replace("(","_");r.shard_id=e.form.shard_id,r.cluster_id=e.form.id,r.master_hostaddr=i,r.assign_hostaddr=o}else r.shard_id=e.form.shard_id,r.cluster_id=e.form.id,r.master_hostaddr=i;r.nick_name=e.listsent.nick_name,a.paras=r,Object(p["Cb"])(a).then((function(t){var s=t;if("accept"==s.status){e.dialogSwitchOVisible=!1,e.stepParams=[];var a=0,i="主备切换";e.job_id="",e.timer=null,e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},ChangeSaler:function(t){var e=this;t||(this.form.primary_node=""),this.form.shard_name=t.name;var s={};s.cluster_id=this.listsent.id,s.shard_id=t.id,s.ha_mode=this.listsent.ha_mode,Object(p["cb"])(s).then((function(t){t.list.length>0&&(e.form.primary_node=t.list[0].ip+"("+t.list[0].port+")")}));var a={};a.cluster_id=this.listsent.id,a.shard_id=t.id,a.ha_mode=this.listsent.ha_mode,Object(p["ib"])(a).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))},beforeSwitchDestory:function(){clearInterval(this.timer),this.dialogStatusFVisible=!1,this.timer=null,this.resetform()},resetform:function(){this.form={name:this.listsent.name,nick_name:this.listsent.nick_name,id:this.listsent.id,primary_node:"",replica:"",shard_id:"",shard_name:""}},getFStatus:function(t,e,s,a,i){var r=this;setTimeout((function(){var i={job_type:"get_status"};i.version=d["u"][0].ver,i.timestamp=d["s"][0].time+"",i.job_id=e,i.paras={},r.job_id="任务ID:"+e,Object(p["N"])(i).then((function(e){if("主备切换"==a)if(null!==e.attachment){r.dialogStatusFVisible=!0;var i=e.attachment.job_step.replace(/\s+/g,"").split(",");if(0==r.stepParams.length)for(var o=0;o<i.length;o++){var n={};if(0==o?(n.title=i[o],n.icon="el-icon-loading",n.status="process",n.description=""):(n.title=i[o],n.icon="",n.status="wait",n.description=""),e.attachment.step==i[o]){if(o>r.active)for(var l=0;l<r.stepParams.length;l++)if(l==o&&"wait"==r.stepParams[l].status&&(r.stepParams[l].icon="el-icon-loading",r.stepParams[l].status="process"),l>0&&l<o)for(var c=0;c<l;c++)r.stepParams[c].icon="el-icon-circle-check",r.stepParams[c].status="success";r.active=o}r.stepParams.push(n)}else if("ongoing"==e.status){for(var d=0;d<r.stepParams.length;d++)if(e.attachment.step==r.stepParams[d].title&&(r.active=d,r.stepParams[d].icon="el-icon-loading",r.stepParams[d].status="process",d>0&&d<r.active+1))for(var p=0;p<d;p++)r.stepParams[p].icon="el-icon-circle-check",r.stepParams[p].status="success"}else if("done"===e.status){for(var u=0;u<r.stepParams.length;u++)r.active=r.stepParams.length,r.stepParams[u].icon="el-icon-circle-check",r.stepParams[u].status="success";clearInterval(t)}else if("failed"===e.status){for(var m=0;m<r.stepParams.length;m++)"process"===r.stepParams[m].status&&(r.active=m,r.stepParams[m].icon="el-icon-circle-close",r.stepParams[m].status="error",r.stepParams[m].description=e.error_info);clearInterval(t)}}else"70001"===e.error_code&&"failed"===e.status&&s>5&&clearInterval(t)})),s>=86400&&clearInterval(t)}),0)}}},Nt=$t,Vt=Object(f["a"])(Nt,It,Ct,!1,null,"8358f24e",null),Et=Vt.exports,Tt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("div",{staticClass:"table-list-search-wrap"},[s("el-input",{staticClass:"list_search_keyword",attrs:{placeholder:"可输入ip搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.hostaddr,callback:function(e){t.$set(t.listQuery,"hostaddr",e)},expression:"listQuery.hostaddr"}}),s("el-select",{staticClass:"list_search_select",staticStyle:{width:"150px"},attrs:{placeholder:"请选择主/备节点"},model:{value:t.listQuery.master,callback:function(e){t.$set(t.listQuery,"master",e)},expression:"listQuery.master"}},[s("el-option",{attrs:{label:"主节点",value:"source"}}),s("el-option",{attrs:{label:"备节点",value:"replica"}})],1),s("el-select",{staticClass:"list_search_select",staticStyle:{width:"150px"},attrs:{placeholder:"请选择状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[s("el-option",{attrs:{label:"运行中",value:"active"}}),s("el-option",{attrs:{label:"安装中",value:"creating"}}),s("el-option",{attrs:{label:"停止",value:"manual_stop"}}),s("el-option",{attrs:{label:"异常",value:"inactive"}})],1),s("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v(" 查询 ")]),s("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.handleClear}},[t._v(" 重置 ")]),"Y"===t.shard_create_priv?s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleCreate}},[t._v("添加shard ")]):t._e(),"Y"===t.storage_node_create_priv?s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleCreateStorage}},[t._v("添加储存节点 ")]):t._e()],1)]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,ref:"multipleTable",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.list,border:"","highlight-current-row":"","default-expand-all":""}},[s("el-table-column",{attrs:{type:"expand",align:"center",label:"",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-table",{staticClass:"sectable",staticStyle:{width:"100%"},attrs:{data:e.row.shardList,stripe:""}},[s("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"50"}}),s("el-table-column",{attrs:{prop:"hostaddr",label:"IP",align:"center",width:"120"}}),s("el-table-column",{attrs:{prop:"port",label:"端口",align:"center"}}),s("el-table-column",{attrs:{prop:"cpu_cores",label:"CPU个数",align:"center"}}),s("el-table-column",{attrs:{prop:"master",label:"主/备节点",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["true"===e.row.master?s("span",{staticStyle:{color:"#409eff"}},[t._v("主")]):"false"===e.row.master?s("span",[t._v("备")]):s("span")]}}],null,!0)}),s("el-table-column",{attrs:{prop:"delay",label:"延迟时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.delay+"s"))])]}}],null,!0)}),s("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["online"===e.row.status?s("span",{staticStyle:{color:"#00ed37"}},[t._v("运行中")]):t._e(),"creating"===e.row.status?s("span",[t._v("安装中")]):t._e(),"inactive"===e.row.status?s("span",{staticStyle:{color:"red"}},[t._v("异常")]):"offline"===e.row.status?s("span",{staticStyle:{color:"#c7c9d1"}},[t._v("停止")]):s("span")]}}],null,!0)}),s("el-table-column",{attrs:{prop:"install_proxysql_addr",label:"Proxy Address",align:"center",width:"120"}}),s("el-table-column",{attrs:{prop:"install_proxysql_port",label:"Proxy PORT",align:"center",width:"120"}}),s("el-table-column",{attrs:{label:"操作",align:"center",width:"380","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,i=e.$index;return["online"==a.status?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.nodeMonitor(a)}}},[t._v("节点监控 ")]):t._e(),"online"==a.status&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleSetCpu(a)}}},[t._v("设置 ")]):t._e(),"online"!==a.status&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleControlNode(a,"start")}}},[t._v("启用 ")]):t._e(),"true"!==a.master&&"offline"!==a.status&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleControlNode(a,"stop")}}},[t._v("禁用 ")]):t._e(),"true"!==a.master&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleControlNode(a,"restart")}}},[t._v("重启 ")]):t._e(),"true"==a.master&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleSwitch(a)}}},[t._v("主备切换 ")]):t._e(),"true"==a.master&&"super_dba"==t.user_name?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleReDo(a)}}},[t._v("重做备机节点 ")]):t._e(),"Y"===t.storage_node_drop_priv&&"true"!==a.master?s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDeleteStorage(a,i)}}},[t._v("删除 ")]):t._e()]}}],null,!0)})],1)]}}])}),s("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),s("el-table-column",{attrs:{prop:"shardID",label:"shardID",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticClass:"link-type",on:{click:function(e){return t.handleDetail(a)}}},[t._v(t._s(a.id))])]}}])}),s("el-table-column",{attrs:{prop:"db_cluster_id",align:"center",label:" 集群ID"}}),s("el-table-column",{attrs:{prop:"name",align:"center",label:"shard名称"}}),s("el-table-column",{attrs:{prop:"num_nodes",align:"center",label:"副本数"}}),s("el-table-column",{attrs:{prop:"degrade_conf_state",align:"center",label:"是否退化"},scopedSlots:t._u([{key:"default",fn:function(e){return["ON"===e.row.degrade_conf_state?s("span",[t._v("是")]):"OFF"===e.row.degrade_conf_state?s("span",[t._v("否")]):s("span")]}}])}),s("el-table-column",{attrs:{prop:"degrade_conf_time",align:"center",label:"退化时间"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"===e.row.degrade_conf_time?s("span"):s("span",[t._v(t._s(e.row.degrade_conf_time))])]}}])}),s("el-table-column",{attrs:{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,i=e.$index;return["Y"===t.shard_drop_priv?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleUpdate(a)}}},[t._v("编辑 ")]):t._e(),"Y"===t.shard_drop_priv?s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(a,i)}}},[t._v("删除 ")]):t._e()]}}])})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{total:t.total,page:t.listQuery.pageNo,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"pageNo",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.getList}}),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogNodeVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogNodeVisible=e}}},[s("el-form",{ref:"dataForm",attrs:{model:t.temp,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("el-form-item",{attrs:{label:"集群名称:",prop:"name"}},[s("span",[t._v(t._s(t.temp.name))])]),s("el-form-item",{attrs:{label:"业务名称:",prop:"nick_name"}},[s("span",[t._v(t._s(t.temp.nick_name))])]),s("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.temp.machinelist,callback:function(e){t.$set(t.temp,"machinelist",e)},expression:"temp.machinelist"}},t._l(t.strogemachines,(function(t){return s("el-option",{key:t.id,attrs:{label:t.hostaddr,value:t.hostaddr}})})),1)],1),"createstorage"===t.dialogStatus?s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},["createstorage"===t.dialogStatus?s("el-select",{attrs:{placeholder:"请选择shard名称"},model:{value:t.temp.shard_name,callback:function(e){t.$set(t.temp,"shard_name",e)},expression:"temp.shard_name"}},t._l(t.shard_arr,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1):t._e()],1):t._e(),"create"===t.dialogStatus?s("el-form-item",{attrs:{label:"shard个数:",prop:"shards_count"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入shard个数"},model:{value:t.temp.shards_count,callback:function(e){t.$set(t.temp,"shards_count",e)},expression:"temp.shards_count"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1):t._e(),s("el-form-item",{attrs:{label:t.label_node,prop:"nodes"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:t.placeholder_node},model:{value:t.temp.nodes,callback:function(e){t.$set(t.temp,"nodes",e)},expression:"temp.nodes"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"true"===t.if_show,expression:"if_show==='true'"}],staticStyle:{color:"red"}},[s("p",[t._v("该集群已建立RCR关系")])])],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogNodeVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.createStorageData()}}},[t._v("确认 ")])],1)],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusShowVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeDestory},on:{"update:visible":function(e){t.dialogStatusShowVisible=e}}},[s("div",{staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:t.percentage,status:t.progress_status,format:t.setText}}),s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},[t.init_show?s("el-step",{attrs:{title:t.init_title,icon:"el-icon-more"}}):t._e(),t.shard_show?s("el-step",{attrs:{title:t.shard_title,status:t.storage_state,icon:t.shard_icon,description:t.shard_description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(t.shard_description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.shard_active}},t._l(t.shard,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(s){return t.thisDetail(e.shard_id)}}})})),1)],1)])],2):t._e(),t.finish_show?s("el-step",{attrs:{title:t.finish_title,icon:t.finish_icon,description:t.finish_description,status:t.finish_state}}):t._e()],1)],1)]),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeSyncDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)]),s("el-dialog",{attrs:{title:t.dialogStatus,visible:t.dialogShardInfo,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogShardInfo=e}}},[s("json-viewer",{attrs:{value:t.shardInfo}})],1),s("el-dialog",{attrs:{title:"主备切换",visible:t.dialogSwitchOVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogSwitchOVisible=e}}},[s("el-form",{ref:"switchForm",attrs:{model:t.switchtemp,rules:t.rules,"label-position":"left","label-width":"100px"}},[s("el-form-item",{attrs:{label:"主节点:",prop:"primary_node"}},[s("span",[t._v(t._s(t.switchtemp.primary_node))])]),s("el-form-item",{attrs:{label:"备机节点:",prop:"replica"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择备机节点"},model:{value:t.switchtemp.replica,callback:function(e){t.$set(t.switchtemp,"replica",e)},expression:"switchtemp.replica"}},t._l(t.options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogSwitchOVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.switchData(t.switchtemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:"重做备机节点",visible:t.dialogRedoVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogRedoVisible=e}}},[s("el-form",{ref:"redoForm",attrs:{model:t.redotemp,rules:t.rules,"label-position":"left","label-width":"180px"}},[s("el-form-item",{attrs:{label:"需重做的备机节点:",prop:"redolist"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},on:{change:t.change},model:{value:t.redotemp.redolist,callback:function(e){t.$set(t.redotemp,"redolist",e)},expression:"redotemp.redolist"}},t._l(t.options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1),s("el-form-item",{attrs:{label:"是否从主节点上拉取数据:",prop:"allow_pull_from_master"}},[s("el-radio",{attrs:{label:"1"},model:{value:t.redotemp.allow_pull_from_master,callback:function(e){t.$set(t.redotemp,"allow_pull_from_master",e)},expression:"redotemp.allow_pull_from_master"}},[t._v("是")]),s("el-radio",{attrs:{label:"0"},model:{value:t.redotemp.allow_pull_from_master,callback:function(e){t.$set(t.redotemp,"allow_pull_from_master",e)},expression:"redotemp.allow_pull_from_master"}},[t._v("否")])],1),"0"==t.redotemp.allow_pull_from_master?s("el-form-item",{attrs:{label:"主备延迟:",prop:"allow_replica_delay"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"主备延迟"},model:{value:t.redotemp.allow_replica_delay,callback:function(e){t.$set(t.redotemp,"allow_replica_delay",e)},expression:"redotemp.allow_replica_delay"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("s")])])],1):t._e(),s("el-form-item",{attrs:{label:"是否备份:",prop:"need_backup"}},[s("el-radio",{attrs:{label:"1"},model:{value:t.redotemp.need_backup,callback:function(e){t.$set(t.redotemp,"need_backup",e)},expression:"redotemp.need_backup"}},[t._v("是")]),s("el-radio",{attrs:{label:"0"},model:{value:t.redotemp.need_backup,callback:function(e){t.$set(t.redotemp,"need_backup",e)},expression:"redotemp.need_backup"}},[t._v("否")])],1),"1"==t.redotemp.need_backup?s("el-form-item",{attrs:{label:"备份存储目标:",prop:"hdfs_host"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.redotemp.hdfs_host,callback:function(e){t.$set(t.redotemp,"hdfs_host",e)},expression:"redotemp.hdfs_host"}},t._l(t.hdfs_options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1):t._e(),s("el-form-item",{attrs:{label:"限速:",prop:"pv_limit"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"限速"},model:{value:t.redotemp.pv_limit,callback:function(e){t.$set(t.redotemp,"pv_limit",e)},expression:"redotemp.pv_limit"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("KB/s")])])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogRedoVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.redoData(t.redotemp)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusFVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeSwitchDestory},on:{"update:visible":function(e){t.dialogStatusFVisible=e}}},[s("div",{staticStyle:{height:"400px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.active,"finish-status":"success"}},t._l(t.stepParams,(function(e,a){return s("el-step",{key:a,class:t.stepSuc.includes(a)?"stepSuc":"stepErr",attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description},nativeOn:{click:function(e){return t.handleStep(a)}}})})),1)],1)]),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusRedoVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeRedoDestory},on:{"update:visible":function(e){t.dialogStatusRedoVisible=e}}},[s("div",{staticClass:"block",staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},t._l(t.statusList,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(e.description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.second_active}},t._l(t.statusList[a].second,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2)})),1)],1)]),s("el-dialog",{attrs:{title:"CPU资源设置",visible:t.dialogCpuVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(e){t.dialogCpuVisible=e}}},[s("el-form",{ref:"cpuForm",attrs:{model:t.cpu_paras,rules:t.rules,"label-position":"left","label-width":"100px"}},[s("el-form-item",{attrs:{label:"节点IP:",prop:"cpu_paras.hostaddr"}},[s("span",[t._v(t._s(t.cpu_paras.hostaddr))])]),s("el-form-item",{attrs:{label:"端口:",prop:"cpu_paras.port"}},[s("span",[t._v(t._s(t.cpu_paras.port))])]),s("el-form-item",{attrs:{label:"cpu 个数:",prop:"cpu_paras.cpu_cores"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入cpu个数"},model:{value:t.cpu_paras.cpu_cores,callback:function(e){t.$set(t.cpu_paras,"cpu_cores",e)},expression:"cpu_paras.cpu_cores"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("个")])])],1),s("el-form-item",{attrs:{label:"cpu模式:",prop:"cpu_paras.cgroup_mode"}},[s("el-select",{attrs:{clearable:"",placeholder:"资源限制模式"},model:{value:t.cpu_paras.cgroup_mode,callback:function(e){t.$set(t.cpu_paras,"cgroup_mode",e)},expression:"cpu_paras.cgroup_mode"}},t._l(t.cpu_paras_option,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogCpuVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.SaveCpuSetData(t.cpu_paras)}}},[t._v("确认")])],1)],1),s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogChangeVisible,"custom-class":"single_dal_view","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogChangeVisible=e}}},[s("el-form",{ref:"editForm",attrs:{model:t.shardEdit,rules:t.rules,"label-position":"left","label-width":"130px"}},[s("el-form-item",{attrs:{label:"集群ID:",prop:"db_cluster_id"}},[s("span",[t._v(t._s(t.shardEdit.db_cluster_id))])]),s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},[s("span",[t._v(t._s(t.shardEdit.shard_name))])]),s("el-form-item",{attrs:{label:"shard是否退化:",prop:"conf_degrade_state"}},[s("el-radio",{attrs:{label:"ON"},model:{value:t.shardEdit.conf_degrade_state,callback:function(e){t.$set(t.shardEdit,"conf_degrade_state",e)},expression:"shardEdit.conf_degrade_state"}},[t._v("是")]),s("el-radio",{attrs:{label:"OFF"},model:{value:t.shardEdit.conf_degrade_state,callback:function(e){t.$set(t.shardEdit,"conf_degrade_state",e)},expression:"shardEdit.conf_degrade_state"}},[t._v("否")])],1),"ON"==t.shardEdit.conf_degrade_state?s("el-form-item",{attrs:{label:"退化时间:",prop:"degrade_conf_time"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"退化时间范围为5-500s"},model:{value:t.shardEdit.degrade_conf_time,callback:function(e){t.$set(t.shardEdit,"degrade_conf_time",e)},expression:"shardEdit.degrade_conf_time"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("s")])])],1):t._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogChangeVisible=!1}}},[t._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateData()}}},[t._v("确认")])],1)],1)],1)},Dt=[],Ft={name:"Complist",components:{Pagination:c["a"],JsonViewer:m.a},props:{listsent:{typeof:Object}},data:function(){var t=this,e=function(e,s,a){if(s)/^[0-9]+$/.test(s)?s>256?a(new Error(string+"不能大于256")):a():a(new Error(string+"只能输入数字"));else{var i=t.label_node.substr(0,t.label_node.length-1);a(new Error("请输入"+i))}},s=function(t,e,s){e?/^[0-9]+$/.test(e)?e>256?s(new Error("shard个数不能大于256")):s():s(new Error("shard个数只能输入数字")):s(new Error("请输入shard个数"))},a=function(t,e,s){e?s():s(new Error("请选择shard名称"))},i=function(e,s,a){0===s.length?a(new Error("请选择需重做的备机节点")):s.length===t.options.length?(t.redotemp.allow_pull_from_master="1",a()):a()},r=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("主备延迟只能输入数字")):s(new Error("主备延迟不能为空"))},o=function(t,e,s){0===e.length?s(new Error("请选择备份存储目标")):s()},n=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("最大延迟时间只能输入数字")):s(new Error("最大延迟时间不能为空"))},l=function(t,e,s){0==e.length?s(new Error("请输入退化时间")):/^[0-9]+$/.test(e)?e>500?s(new Error("退化时间不能大于500")):e<5?s(new Error("退化时间不能小于5")):s():s(new Error("退化时间只能输入数字"))};return{tableKey:0,list:[],listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,hostaddr:"",id:"",ha_mode:"",master:"",status:""},temp:{nodes:"",name:"",nick_name:"",machinelist:"",cluster_id:"",shards_count:"",shard_name:""},redotemp:{redolist:[],allow_pull_from_master:"0",allow_replica_delay:"30",need_backup:"0",pv_limit:"10",hdfs_host:""},switchtemp:{replica:"",primary_node:"",shard_id:"",cluster_id:""},cpu_paras:{hostaddr:"",port:"",type:"mysql",cpu_cores:"5",cgroup_mode:"quota"},cpu_paras_option:[{value:"share",label:"share"},{value:"quota",label:"quota"}],options:[],hdfs_options:[],active:0,stepSuc:[0],stepParams:[],init_active:0,second_active:0,statusList:[],ipList:[],dialogFormVisible:!1,dialogEditVisible:!1,dialogUploadVisible:!1,dialogSwitchOVisible:!1,dialogCpuVisible:!1,dialogRedoVisible:!1,dialogStatusFVisible:!1,dialogStatusRedoVisible:!1,dialogStatus:"",textMap:{create:"添加shard",createstorage:"添加存储节点",detail:"详情",shardupdate:"编辑shard"},dialogDetail:!1,dialogNodeVisible:!1,dialogChangeVisible:!1,message_tips:"",message_type:"",installStatus:!1,info:"",row:{},shard_create_priv:JSON.parse(sessionStorage.getItem("priv")).shard_create_priv,shard_drop_priv:JSON.parse(sessionStorage.getItem("priv")).shard_drop_priv,storage_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_create_priv,storage_node_drop_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_drop_priv,user_name:sessionStorage.getItem("login_username"),storage_status:!1,comp_status:!1,comp_active:1,job_id:null,timer:null,strogemachines:[],shard:[],storage_state:"",finish_state:"",shard_icon:"",shard_title:"",shard_active:0,init_title:"",init_show:!0,finish_show:!1,computer_show:!0,shard_show:!0,finish_title:"",finish_icon:"",finish_description:"",shard_description:"",shardInfo:"",dialogShardInfo:!1,dialogStatusShowVisible:!1,shard_arr:[],label_node:"",placeholder_node:"",dialogStatusVisible:!1,activities:[],showInput:"",oldData:{},currentData:{},suppliers:[{value:"ON",label:"是"},{value:"OFF",label:"否"}],shardEdit:{shardid:"",db_cluster_id:"",shard_name:"",conf_degrade_state:"",degrade_conf_time:""},if_show:"false",percentage:0,progress_status:null,progress_format:"",rules:{nodes:[{required:!0,trigger:"blur",validator:e}],shards_count:[{required:!0,trigger:"blur",validator:s}],shard_name:[{required:!0,trigger:"blur",validator:a}],redolist:[{required:!0,trigger:"blur",validator:i}],allow_replica_delay:[{required:!0,trigger:"blur",validator:r}],hdfs_host:[{required:!0,trigger:"blur",validator:o}],maxtime:[{required:!0,trigger:"blur",validator:n}],conf_degrade_state:[{required:!0,trigger:"blur",message:"shard是否退化必选"}],conf_degrade_time:[{required:!0,trigger:"blur",validator:l}]}}},created:function(){this.listQuery.id=this.listsent.id,this.listQuery.ha_mode=this.listsent.ha_mode,this.getList()},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{setText:function(t){return this.progress_format+t+"%"},handleUpdate:function(t){var e=this;this.shardEdit.shardid=t.id,this.shardEdit.db_cluster_id=t.db_cluster_id,this.shardEdit.shard_name=t.name,this.shardEdit.conf_degrade_state=t.degrade_conf_state,this.shardEdit.degrade_conf_time=t.degrade_conf_time,"0"==t.degrade_conf_time&&(this.shardEdit.degrade_conf_time="25"),this.dialogStatus="shardupdate",this.dialogChangeVisible=!0,this.$nextTick((function(){e.$refs["editForm"].clearValidate()}))},updateData:function(){var t=this;this.$refs["editForm"].validate((function(e){if(e){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="update_shard_degrade_conf",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";var a={};a.cluster_id=t.shardEdit.db_cluster_id,a.shard_id=t.shardEdit.shardid,a.conf_degrade_state=t.shardEdit.conf_degrade_state,"OFF"==t.shardEdit.conf_degrade_state&&(t.shardEdit.degrade_conf_time="0"),a.conf_degrade_time=t.shardEdit.degrade_conf_time,s.paras=a,Object(p["Fb"])(s).then((function(e){var s=e;"done"==s.status?(t.dialogChangeVisible=!1,t.message_tips="编辑成功",t.message_type="success",Object(l["g"])(t.message_tips,t.message_type),t.getList()):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},tableDbEdit:function(t,e,s){this.showInput=e.property+t.inboundId,this.oldData[e.property]=t[e.property]},beforeSwitchDestory:function(){clearInterval(this.timer),this.dialogStatusFVisible=!1,this.timer=null},beforeRedoDestory:function(){clearInterval(this.timer),this.dialogStatusRedoVisible=!1,this.timer=null},redoData:function(t){var e=this;this.$refs["redoForm"].validate((function(t){if(t){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="rebuild_node",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";for(var a=[],i=[],r=0;r<e.redotemp.redolist.length;r++){var o=e.redotemp.redolist[r].substring(0,e.redotemp.redolist[r].length-1).split("("),n="";n=e.redotemp.pv_limit?e.redotemp.pv_limit:"10";var c={};if("1"==e.redotemp.need_backup){var u=e.redotemp.hdfs_host.substring(0,e.redotemp.hdfs_host.length-1).replace("(",":");c.hostaddr=o[0],c.port=o[1],c.need_backup=e.redotemp.need_backup,c.hdfs_host=u,c.pv_limit=n}else c.hostaddr=o[0],c.port=o[1],c.need_backup=e.redotemp.need_backup,c.pv_limit=n;a.push(c),i.push({title:o[0]+"_"+o[1],error_code:"0",error_info:"",status:"no_start",step:""})}var m={};"1"==e.redotemp.allow_pull_from_master?(m.shard_id=e.redotemp.shard_id,m.cluster_id=e.redotemp.cluster_id,m.allow_pull_from_master=e.redotemp.allow_pull_from_master,m.rb_nodes=a):(m.shard_id=e.redotemp.shard_id,m.cluster_id=e.redotemp.cluster_id,m.allow_pull_from_master=e.redotemp.allow_pull_from_master,m.allow_replica_delay=e.redotemp.allow_replica_delay,m.rb_nodes=a),s.paras=m,e.dialogStatusRedoVisible=!0,e.dialogRedoVisible=!1,Object(p["qb"])(s).then((function(t){var s=t;if("accept"==s.status){e.dialogRedoVisible=!1,e.stepParams=[];var a=0,r="重做备机节点";e.statusList=[],e.timer=null,e.init_active=0,e.second_active=0,e.getFStatus(e.timer,s.job_id,a++,r,i),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,r,i)}),5e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},SaveCpuSetData:function(t){var e=this;this.$refs["cpuForm"].validate((function(s){if(s){console.log(s);var a={version:"1.0",job_id:"",job_type:"update_instance_cgroup",timestamp:d["s"][0].time+"",user_name:sessionStorage.getItem("login_username"),paras:{ip:t.hostaddr,port:t.port,type:"mysql",cpu_cores:t.cpu_cores,cgroup_mode:t.cgroup_mode}};Object(p["b"])(a).then((function(t){var s=t;if("accept"==s.status){var a=0;e.dialogSwitchOVisible=!1,e.job_id="",e.timer=null;var i="重做备机节点";e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3),setTimeout((function(){e.dialogCpuVisible=!1,e.message_type="success",e.message_tips="修改成功",Object(l["g"])(e.message_tips,e.message_type),e.getList()}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},switchData:function(t){var e=this;this.$refs["switchForm"].validate((function(t){if(t){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="manual_switch",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";var a=e.switchtemp.primary_node.substring(0,e.switchtemp.primary_node.length-1).replace("(","_"),i={};if(e.switchtemp.replica.length){var r=e.switchtemp.replica.substring(0,e.switchtemp.replica.length-1).replace("(","_");i.shard_id=e.switchtemp.shard_id,i.cluster_id=e.switchtemp.cluster_id,i.master_hostaddr=a,i.assign_hostaddr=r}else i.shard_id=e.switchtemp.shard_id,i.cluster_id=e.switchtemp.cluster_id,i.master_hostaddr=a;s.paras=i,Object(p["Cb"])(s).then((function(t){var s=t;if("accept"==s.status){e.dialogSwitchOVisible=!1,e.stepParams=[];var a=0,i="主备切换";e.computer=[],e.shard=[],e.computer_state="",e.storage_state="",e.computer_title="",e.computer_icon="",e.shard_icon="",e.shard_title="",e.comp_active=0,e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.computer_description="",e.shard_description="",e.job_id="",e.timer=null,e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},change:function(){this.options.length==this.redotemp.redolist.length?this.redotemp.allow_pull_from_master="1":this.redotemp.allow_pull_from_master="0"},handleReDo:function(t){var e=this;this.resetReDoTemp(),this.dialogRedoVisible=!0,this.redotemp.shard_id=t.shard_id,this.redotemp.cluster_id=t.cluster_id,Object(p["A"])().then((function(t){if(e.hdfs_options=[],null!==t.list)for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].hostaddr+"("+t.list[s].port+")"};e.hdfs_options.push(a)}}));var s={};s.cluster_id=t.cluster_id,s.shard_id=t.shard_id,s.ha_mode=this.listsent.ha_mode,Object(p["ib"])(s).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))},handleSwitch:function(t){var e=this;this.resetSwitchTemp(),this.dialogSwitchOVisible=!0;var s={};s.cluster_id=t.cluster_id,s.shard_id=t.shard_id,s.ha_mode=this.listsent.ha_mode,this.switchtemp.shard_id=t.shard_id,this.switchtemp.cluster_id=t.cluster_id,Object(p["cb"])(s).then((function(t){t.list.length>0&&(e.switchtemp.primary_node=t.list[0].ip+"("+t.list[0].port+")")}));var a={};a.cluster_id=t.cluster_id,a.shard_id=t.shard_id,a.ha_mode=this.listsent.ha_mode,Object(p["ib"])(a).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))},handleSetCpu:function(t){console.log(t),this.dialogCpuVisible=!0,this.cpu_paras=Object.assign(this.cpu_paras,t),console.log(this.cpu_paras)},nodeMonitor:function(t){var e={};e["cluster_id"]=t.cluster_id,e["hostaddr"]=t.hostaddr,e["port"]=t.port,e["user_name"]=sessionStorage.getItem("login_username"),Object(S["a"])(e).then((function(t){"200"==t.code&&window.open(d["h"][0].ip+t.url+"?orgId=1&refresh=5s")}))},thisDetail:function(t){var e=this,s={id:t};Object(p["gb"])(s).then((function(s){e.dialogStatus="shard_"+t+"详细信息",e.dialogShardInfo=!0,e.shardInfo=s.shard_nodes}))},beforeDestory:function(){clearInterval(this.timer),this.dialogStatusShowVisible=!1,this.timer=null},beforeSyncDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},handleFilter:function(){this.listQuery.pageNo=1,this.getList()},handleClear:function(){this.listQuery.hostaddr="",this.listQuery.master="",this.listQuery.status="",this.listQuery.pageNo=1,this.listQuery.id=this.listsent.id,this.listQuery.ha_mode=this.listsent.ha_mode,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.listQuery);Object(p["xb"])(e).then((function(e){t.list=e.list,t.total=e.total,setTimeout((function(){t.listLoading=!1}),500)}))},resetTemp:function(){this.temp={nodes:"",name:"",nick_name:"",machinelist:"",cluster_id:"",shards_count:"1",shard_name:""}},resetSwitchTemp:function(){this.switchtemp={replica:"",primary_node:"",shard_id:"",cluster_id:""}},resetReDoTemp:function(){this.redotemp={redolist:[],allow_pull_from_master:"0",allow_replica_delay:"30",need_backup:"0",pv_limit:"10",hdfs_host:""}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",this.label_node="副本数:",this.placeholder_node="请输入副本数",this.temp.nodes="3",this.dialogNodeVisible=!0,this.temp.name=this.listsent.name,this.temp.nick_name=this.listsent.nick_name,this.temp.cluster_id=this.listsent.id,Object(p["jb"])().then((function(e){t.strogemachines=[],t.strogemachines=e.list}));var e={cluster_id:this.listsent.id};Object(G["o"])(e).then((function(e){0==e.total?t.if_show="false":t.if_show="true"})),this.$nextTick((function(){t.$refs.dataForm.clearValidate()}))},createData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="add_shards",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";var a=[];t.temp.machinelist.forEach((function(t){a.push(t)}));var i={};i.nodes=t.temp.nodes,i.cluster_id=t.temp.cluster_id,i.nick_name=t.temp.nick_name,i.shards=t.temp.shards_count,a.length>0&&(i.storage_iplists=a),s.paras=i,Object(p["f"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.shard=[],t.storage_state="",t.shard_icon="",t.shard_title="",t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0,t.finish_show=!1,t.finish_state="";var a="添加shard";t.percentage=0,t.progress_status=null,t.progress_format="";var i=0;t.getFStatus(t.timer,s.job_id,i++,a,""),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a,"")}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},handleCreateStorage:function(){var t=this;this.resetTemp(),this.dialogStatus="createstorage",this.label_node="存储节点个数:",this.placeholder_node="请输入存储节点个数",this.temp.nodes="1",this.dialogNodeVisible=!0,this.temp.name=this.listsent.name,this.temp.nick_name=this.listsent.nick_name,this.temp.cluster_id=this.listsent.id,Object(p["jb"])().then((function(e){t.strogemachines=[],t.strogemachines=e.list})),Object(p["eb"])(this.listsent.id).then((function(e){var s=e;200==s.code&&(t.shard_arr=s.list)})),this.$nextTick((function(){t.$refs.dataForm.clearValidate()}))},createStorageData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.job_type="add_nodes",s.version=d["u"][0].ver,s.timestamp=d["s"][0].time+"";var a=[];t.temp.machinelist.forEach((function(t){a.push(t)}));var i={};i.nodes=t.temp.nodes,i.cluster_id=t.temp.cluster_id,i.nick_name=t.temp.nick_name,i.shard_id=t.temp.shard_name,a.length>0&&(i.storage_iplists=a),s.paras=i,Object(p["e"])(s).then((function(e){var s=e;if("accept"==s.status){t.dialogNodeVisible=!1,t.dialogStatusShowVisible=!0,t.shard=[],t.storage_state="",t.shard_icon="",t.shard_title="",t.shard_active=0,t.strogemachines=[],t.init_title="",t.init_active=0,t.finish_title="",t.finish_icon="",t.finish_description="",t.shard_description="",t.job_id="",t.timer=null,t.init_show=!0,t.finish_show=!1,t.finish_state="";var a="添加存储节点";t.percentage=0,t.progress_status=null,t.progress_format="";var i=0;t.getFStatus(t.timer,s.job_id,i++,a,""),t.timer=setInterval((function(){t.getFStatus(t.timer,s.job_id,i++,a,"")}),5e3)}else"ongoing"==s.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error",Object(l["g"])(t.message_tips,t.message_type)):(t.message_tips=s.error_info,t.message_type="error",Object(l["g"])(t.message_tips,t.message_type))}))}}))},handleDetail:function(t){this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},t),this.dialogDetail=!0},handleDelete:function(t){var e=this,s={id:t.db_cluster_id};Object(p["fb"])(s).then((function(s){if(1==s.total)Object(l["g"])("该集群当前有且仅有一个shard,不能进行删除操作","error");else if(s.total>1){var a=Object(l["a"])(),i={cluster_id:e.listsent.id};Object(G["o"])(i).then((function(s){if(s.total>0)Object(l["g"])("该集群已建立rcr关系,请先前往RCR服务页面解除关系再进行删除操作","error");else{var i="此操作将永久删除"+t.name+",是否继续?code="+a;Object(l["e"])(i).then((function(s){if(s.value)if(s.value==a){var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.job_type="delete_shard",i.version=d["u"][0].ver,i.timestamp=d["s"][0].time+"";var r={};r.cluster_id=t.db_cluster_id,r.nick_name=e.listsent.nick_name,r.shard_id=t.id,i.paras=r,Object(p["q"])(i).then((function(t){var s=t;if("accept"==s.status){e.dialogStatusShowVisible=!0;var a=0;e.shard=[],e.storage_state="",e.shard_icon="",e.shard_title="",e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.shard_description="",e.job_id="",e.timer=null,e.init_show=!0,e.finish_show=!1,e.finish_state="";var i="删除shard";e.percentage=0,e.progress_status=null,e.progress_format="",e.getFStatus(e.timer,s.job_id,a++,i,""),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,"")}),1e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))}}))}}))},handleDeleteStorage:function(t){var e=this,s={id:t.cluster_id,shard_id:t.shard_id};Object(p["X"])(s).then((function(s){if(1==s.total)Object(l["g"])("该集群当前有且仅有一个储存节点,不能进行删除操作","error");else if(s.total>1){var a=Object(l["a"])(),i="此操作将永久删除存储节点"+t.hostaddr+"("+t.port+"),是否继续?code="+a;Object(l["e"])(i).then((function(s){if(s.value)if(s.value==a){var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.job_type="delete_node",i.version=d["u"][0].ver,i.timestamp=d["s"][0].time+"";var r={};r.cluster_id=t.cluster_id,r.nick_name=e.listsent.nick_name,r.shard_id=t.shard_id,r.hostaddr=t.hostaddr,r.port=t.port,i.paras=r,Object(p["r"])(i).then((function(s){var a=s;if("accept"==a.status){e.dialogStatusShowVisible=!0;var i=0;e.shard=[],e.storage_state="",e.shard_icon="",e.shard_title="",e.shard_active=0,e.strogemachines=[],e.init_title="",e.init_active=0,e.finish_title="",e.finish_icon="",e.finish_description="",e.shard_description="",e.job_id="",e.timer=null,e.init_show=!0,e.finish_show=!1,e.finish_state="";var r="删除存储节点";e.percentage=0,e.progress_status=null,e.progress_format="";var o=t.hostaddr+"_"+t.port;e.getFStatus(e.timer,a.job_id,i++,r,o),e.timer=setInterval((function(){e.getFStatus(e.timer,a.job_id,i++,r,o)}),3e3)}else e.message_tips=a.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))}}))},handleControlNode:function(t,e){var s=this,a="";"start"==e?a="启用":"stop"==e?a="禁用":"restart"==e&&(a="重启");var i=Object(l["a"])(),r="将对该存储节点"+t.hostaddr+"("+t.port+")进行"+a+"操作,是否继续?code="+i;Object(l["e"])(r).then((function(r){if(r.value)if(r.value==i){var o={};o.user_name=sessionStorage.getItem("login_username"),o.job_id="",o.job_type="control_instance",o.version=d["u"][0].ver,o.timestamp=d["s"][0].time+"";var n={};n.control=e,n.hostaddr=t.hostaddr,n.port=t.port,n.cluster_id=s.listsent.id,n.machine_type="storage",o.paras=n;var c={list:o,type:"mysql"};Object(p["l"])(c).then((function(e){var i=e;if("accept"==i.status){s.dialogStatusVisible=!0,s.activities=[];var r={content:"正在"+a+"储存节点"+t.hostaddr+"("+t.port+")",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};s.activities.push(r);var o=0;s.timer=setInterval((function(){s.getStatus(s.timer,i.job_id,o++,a)}),5e3)}else s.message_tips=i.error_info,s.message_type="error",Object(l["g"])(s.message_tips,s.message_type)}))}else s.message_tips="code输入有误",s.message_type="error",Object(l["g"])(s.message_tips,s.message_type);else s.message_tips="code不能为空！",s.message_type="error",Object(l["g"])(s.message_tips,s.message_type)})).catch((function(){console.log("quxiao"),Object(l["g"])("已取消删除","info")}))},getFStatus:function(t,e,s,a,i){var r=this;setTimeout((function(){var o={job_type:"get_status"};o.version=d["u"][0].ver,o.job_id=e,o.timestamp=d["s"][0].time+"",o.paras={},r.job_id="任务ID:"+e,Object(p["N"])(o).then((function(e){if("主备切换"==a)if(null!==e.attachment){r.dialogStatusFVisible=!0;var o=e.attachment.job_step.replace(/\s+/g,"").split(",");if(0==r.stepParams.length)for(var n=0;n<o.length;n++){var c={};if(0==n?(c.title=o[n],c.icon="el-icon-loading",c.status="process",c.description=""):(c.title=o[n],c.icon="",c.status="wait",c.description=""),e.attachment.step==o[n]){if(n>r.active)for(var d=0;d<r.stepParams.length;d++)if(d==n&&"wait"==r.stepParams[d].status&&(r.stepParams[d].icon="el-icon-loading",r.stepParams[d].status="process"),d>0&&d<n)for(var p=0;p<d;p++)r.stepParams[p].icon="el-icon-circle-check",r.stepParams[p].status="success";r.active=n}r.stepParams.push(c)}else if("ongoing"==e.status){for(var u=0;u<r.stepParams.length;u++)if(e.attachment.step==r.stepParams[u].title&&(r.active=u,r.stepParams[u].icon="el-icon-loading",r.stepParams[u].status="process",u>0&&u<r.active+1))for(var m=0;m<u;m++)r.stepParams[m].icon="el-icon-circle-check",r.stepParams[m].status="success"}else if("done"==e.status){for(var _=0;_<r.stepParams.length;_++)r.active=r.stepParams.length,r.stepParams[_].icon="el-icon-circle-check",r.stepParams[_].status="success";clearInterval(t),r.getList(),r.getOneCluster(r.temp_cluster)}else if("failed"==e.status){for(var h=0;h<r.stepParams.length;h++)"process"==r.stepParams[h].status&&(r.active=h,r.stepParams[h].icon="el-icon-circle-close",r.stepParams[h].status="error",r.stepParams[h].description=e.error_info);clearInterval(t)}}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status&&s>5&&clearInterval(t);else if("重做备机节点"==a)if(null!==e.attachment)if(0==r.statusList.length){var f={};if("failed"==e.status)f={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_info,second:[]},r.statusList.push(f),clearInterval(t);else for(var g=0;g<i.length;g++){for(var v=e.attachment.job_step.replace(/\s+/g,"").split(","),b={},y=[],x=0;x<v.length;x++)b={title:v[x],icon:"",status:"wait",description:""},y.push(b);if(0==g){if(f={title:i[g].title,icon:"el-icon-loading",status:"process",description:"",second:y},r.statusList.push(f),"done"==i[g].status){r.init_active=g+1,r.statusList[g].icon="el-icon-circle-check",r.statusList[g].status="success";for(var w=0;w<r.statusList[g].second.length;w++)r.statusList[g].second[w].icon="el-icon-circle-check",r.statusList[g].second[w].status="success"}else if("ongoing"==i[g].status){r.init_active=g,r.statusList[g].icon="el-icon-loading",r.statusList[g].status="process";for(var k=0;k<r.statusList[g].second.length;k++)if(i[g].step==r.statusList[g].second[k].title){r.statusList[g].second[k].icon="el-icon-loading",r.statusList[g].second[k].status="process";for(var S=0;S<k;S++)r.statusList[g].second[S].icon="el-icon-circle-check",r.statusList[g].second[S].status="success"}}else if("failed"==i[g].status){r.statusList[g].icon="el-icon-circle-close",r.statusList[g].status="error";for(var j=0;j<r.statusList[g].second.length;j++)if(i[g].step==r.statusList[g].second[j].title){r.statusList[g].second[j].icon="el-icon-circle-close",r.statusList[g].second[j].status="error";for(var O=0;O<j;O++)r.statusList[g].second[O].icon="el-icon-circle-check",r.statusList[g].second[O].status="success"}r.statusList[g].description=i[g].error_info}}else{for(var L=e.attachment.job_step.replace(/\s+/g,"").split(","),I={},C=[],$=0;$<L.length;$++)I={title:L[$],icon:"",status:"wait",description:""},C.push(I);if(0==r.init_active?(f={title:i[g].title,icon:"",status:"wait",description:"",second:C},r.statusList.push(f)):(f={title:i[g].title,icon:"el-icon-loading",status:"process",description:"",second:C},r.statusList.push(f)),"done"==i[g].status){r.init_active=g+1,r.statusList[g].icon="el-icon-circle-check",r.statusList[g].status="success";for(var N=0;N<r.statusList[g].second.length;N++)r.statusList[g].second[N].icon="el-icon-circle-check",r.statusList[g].second[N].status="success"}else if("ongoing"==i[g].status){r.init_active=g,r.statusList[g].icon="el-icon-loading",r.statusList[g].status="process";for(var V=0;V<r.statusList[g].second.length;V++)if(i[g].step==r.statusList[g].second[V].title){r.statusList[g].second[V].icon="el-icon-loading",r.statusList[g].second[V].status="process";for(var E=0;E<V;E++)r.statusList[g].second[E].icon="el-icon-circle-check",r.statusList[g].second[E].status="success"}}else if("failed"==i[g].status){r.statusList[g].icon="el-icon-circle-close",r.statusList[g].status="error";for(var T=0;T<r.statusList[g].second.length;T++)if(i[g].step==r.statusList[g].second[T].title){r.statusList[g].second[T].icon="el-icon-circle-close",r.statusList[g].second[T].status="error";for(var D=0;D<T;D++)r.statusList[g].second[D].icon="el-icon-circle-check",r.statusList[g].second[D].status="success"}r.statusList[g].description=i[g].error_info}}}}else if("ongoing"==e.status){var F=[];for(var P in e.attachment)if("job_step"!==P){var M=e.attachment[P];r.$set(M,"title",P),F.push(M)}for(var R=0;R<F.length;R++)if(0==R){if("done"==F[R].status){r.init_active=R+1,r.statusList[R].icon="el-icon-circle-check",r.statusList[R].status="success";for(var q=0;q<r.statusList[R].second.length;q++)r.statusList[R].second[q].icon="el-icon-circle-check",r.statusList[R].second[q].status="success"}else if("ongoing"==F[R].status){r.init_active=R,r.statusList[R].icon="el-icon-loading",r.statusList[R].status="process";for(var z=0;z<r.statusList[R].second.length;z++)if(F[R].step==r.statusList[R].second[z].title){r.statusList[R].second[z].icon="el-icon-loading",r.statusList[R].second[z].status="process";for(var B=0;B<z;B++)r.statusList[R].second[B].icon="el-icon-circle-check",r.statusList[R].second[B].status="success"}}else if("failed"==F[R].status){r.statusList[R].icon="el-icon-circle-close",r.statusList[R].status="error";for(var Q=0;Q<r.statusList[R].second.length;Q++)if(F[R].step==r.statusList[R].second[Q].title){r.statusList[R].second[Q].icon="el-icon-circle-close",r.statusList[R].second[Q].status="error";for(var A=0;A<Q;A++)r.statusList[R].second[A].icon="el-icon-circle-check",r.statusList[R].second[A].status="success"}r.statusList[R].description=F[R].error_info}}else if("done"==F[R].status){r.init_active=R+1,r.statusList[R].icon="el-icon-circle-check",r.statusList[R].status="success";for(var J=0;J<r.statusList[R].second.length;J++)r.statusList[R].second[J].icon="el-icon-circle-check",r.statusList[R].second[J].status="success"}else if("ongoing"==F[R].status){r.init_active=R,r.statusList[R].icon="el-icon-loading",r.statusList[R].status="process";for(var H=0;H<r.statusList[R].second.length;H++)if(F[R].step==r.statusList[R].second[H].title){r.statusList[R].second[H].icon="el-icon-loading",r.statusList[R].second[H].status="process";for(var G=0;G<H;G++)r.statusList[R].second[G].icon="el-icon-circle-check",r.statusList[R].second[G].status="success"}}else if("failed"==F[R].status){r.statusList[R].icon="el-icon-circle-close",r.statusList[R].status="error";for(var Y=0;Y<r.statusList[R].second.length;Y++)if(F[R].step==r.statusList[R].second[Y].title){r.statusList[R].second[Y].icon="el-icon-circle-close",r.statusList[R].second[Y].status="error";for(var U=0;U<Y;U++)r.statusList[R].second[U].icon="el-icon-circle-check",r.statusList[R].second[U].status="success"}r.statusList[R].description=F[R].error_info}}else if("failed"==e.status){var K=[];for(var X in e.attachment)if("job_step"!==X){var W=e.attachment[X];r.$set(W,"title",X),K.push(W)}for(var Z=0;Z<K.length;Z++)if(0==Z){if("done"==K[Z].status){r.init_active=Z+1,r.statusList[Z].icon="el-icon-circle-check",r.statusList[Z].status="success";for(var tt=0;tt<r.statusList[Z].second.length;tt++)r.statusList[Z].second[tt].icon="el-icon-circle-check",r.statusList[Z].second[tt].status="success"}else if("ongoing"==K[Z].status){r.init_active=Z,r.statusList[Z].icon="el-icon-loading",r.statusList[Z].status="process";for(var et=0;et<r.statusList[Z].second.length;et++)if(K[Z].step==r.statusList[Z].second[et].title){r.statusList[Z].second[et].icon="el-icon-loading",r.statusList[Z].second[et].status="process";for(var st=0;st<et;st++)r.statusList[Z].second[st].icon="el-icon-circle-check",r.statusList[Z].second[st].status="success"}}else if("failed"==K[Z].status){r.statusList[Z].icon="el-icon-circle-close",r.statusList[Z].status="error";for(var at=0;at<r.statusList[Z].second.length;at++)if(K[Z].step==r.statusList[Z].second[at].title){r.statusList[Z].second[at].icon="el-icon-circle-close",r.statusList[Z].second[at].status="error";for(var it=0;it<at;it++)r.statusList[Z].second[it].icon="el-icon-circle-check",r.statusList[Z].second[it].status="success"}r.statusList[Z].description=K[Z].error_info}}else if("done"==K[Z].status){r.init_active=Z+1,r.statusList[Z].icon="el-icon-circle-check",r.statusList[Z].status="success";for(var rt=0;rt<r.statusList[Z].second.length;rt++)r.statusList[Z].second[rt].icon="el-icon-circle-check",r.statusList[Z].second[rt].status="success"}else if("ongoing"==K[Z].status){r.init_active=Z,r.statusList[Z].icon="el-icon-loading",r.statusList[Z].status="process";for(var ot=0;ot<r.statusList[Z].second.length;ot++)if(K[Z].step==r.statusList[Z].second[ot].title){r.statusList[Z].second[ot].icon="el-icon-loading",r.statusList[Z].second[ot].status="process";for(var nt=0;nt<ot;nt++)r.statusList[Z].second[nt].icon="el-icon-circle-check",r.statusList[Z].second[nt].status="success"}}else if("failed"==K[Z].status){r.statusList[Z].icon="el-icon-circle-close",r.statusList[Z].status="error";for(var lt=0;lt<r.statusList[Z].second.length;lt++)if(K[Z].step==r.statusList[Z].second[lt].title){r.statusList[Z].second[lt].icon="el-icon-circle-close",r.statusList[Z].second[lt].status="error";for(var ct=0;ct<lt;ct++)r.statusList[Z].second[ct].icon="el-icon-circle-check",r.statusList[Z].second[ct].status="success"}r.statusList[Z].description=K[Z].error_info}var dt={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_info,second:""};r.statusList.push(dt),clearInterval(t)}else if("done"==e.status){var pt=[];for(var ut in e.attachment)if("job_step"!==ut){var mt=e.attachment[ut];r.$set(mt,"title",ut),pt.push(mt)}for(var _t=0;_t<pt.length;_t++)if(0==_t){if("done"==pt[_t].status){r.init_active=_t+1,r.statusList[_t].icon="el-icon-circle-check",r.statusList[_t].status="success";for(var ht=0;ht<r.statusList[_t].second.length;ht++)r.statusList[_t].second[ht].icon="el-icon-circle-check",r.statusList[_t].second[ht].status="success"}else if("ongoing"==pt[_t].status){r.init_active=_t,r.statusList[_t].icon="el-icon-loading",r.statusList[_t].status="process";for(var ft=0;ft<r.statusList[_t].second.length;ft++)if(pt[_t].step==r.statusList[_t].second[ft].title){r.statusList[_t].second[ft].icon="el-icon-loading",r.statusList[_t].second[ft].status="process";for(var gt=0;gt<ft;gt++)r.statusList[_t].second[gt].icon="el-icon-circle-check",r.statusList[_t].second[gt].status="success"}}else if("failed"==pt[_t].status){r.statusList[_t].icon="el-icon-circle-close",r.statusList[_t].status="error";for(var vt=0;vt<r.statusList[_t].second.length;vt++)if(pt[_t].step==r.statusList[_t].second[vt].title){r.statusList[_t].second[vt].icon="el-icon-circle-close",r.statusList[_t].second[vt].status="error";for(var bt=0;bt<vt;bt++)r.statusList[_t].second[bt].icon="el-icon-circle-check",r.statusList[_t].second[bt].status="success"}r.statusList[_t].description=pt[_t].error_info}}else if("done"==pt[_t].status){r.init_active=_t+1,r.statusList[_t].icon="el-icon-circle-check",r.statusList[_t].status="success";for(var yt=0;yt<r.statusList[_t].second.length;yt++)r.statusList[_t].second[yt].icon="el-icon-circle-check",r.statusList[_t].second[yt].status="success"}else if("ongoing"==pt[_t].status){r.init_active=_t,r.statusList[_t].icon="el-icon-loading",r.statusList[_t].status="process";for(var xt=0;xt<r.statusList[_t].second.length;xt++)if(pt[_t].step==r.statusList[_t].second[xt].title){r.statusList[_t].second[xt].icon="el-icon-loading",r.statusList[_t].second[xt].status="process";for(var wt=0;wt<xt;wt++)r.statusList[_t].second[wt].icon="el-icon-circle-check",r.statusList[_t].second[wt].status="success"}}else if("failed"==pt[_t].status){r.statusList[_t].icon="el-icon-circle-close",r.statusList[_t].status="error";for(var kt=0;kt<r.statusList[_t].second.length;kt++)if(pt[_t].step==r.statusList[_t].second[kt].title){r.statusList[_t].second[kt].icon="el-icon-circle-close",r.statusList[_t].second[kt].status="error";for(var St=0;St<kt;St++)r.statusList[_t].second[St].icon="el-icon-circle-check",r.statusList[_t].second[St].status="success"}r.statusList[_t].description=pt[_t].error_info}var jt={title:a+"成功",icon:"el-icon-circle-check",status:"success",description:"",second:""};r.statusList.push(jt),clearInterval(t),r.getList()}else r.message_tips=e.error_info,r.message_type="error",Object(l["g"])(r.message_tips,r.message_type);else if(null==e.attachment&&"70001"==e.error_code&&"failed"==e.status){if(s>5){var Ot={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_code,second:[]};r.statusList.push(Ot),clearInterval(t)}}else if(null==e.attachment&&"ongoing"==e.status){r.statusList=[];var Lt={};Lt={title:"正在"+a,icon:"el-icon-loading",status:"process",description:"",second:[]},r.statusList.push(Lt)}else if(null==e.attachment&&"done"==e.status){r.statusList=[];var It={};It={title:a+"成功",icon:"el-icon-circle-check",status:"success",description:"",second:[]},r.statusList.push(It),clearInterval(t)}else{r.statusList=[];var Ct={};Ct={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_code,second:[]},r.statusList.push(Ct),clearInterval(t)}else if("添加shard"==a||"添加存储节点"==a||"删除shard"==a||"删除存储节点"==a)if(null!==e.attachment){if("添加shard"!=a&&"添加存储节点"!=a&&"删除shard"!=a&&"删除存储节点"!=a||(r.shard_show=!0,r.init_show=!1,r.computer_show=!1),e.attachment.hasOwnProperty("storage_state"))if("ongoing"==e.attachment.storage_state)r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a;else if("done"==e.attachment.storage_state){if(r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功",r.shard.length>0)for(var $t=0;$t<r.shard.length;$t++){var Nt="";if("添加shard"==a){Nt=e.attachment.shard_ids;for(var Vt=0;Vt<Nt.length;Vt++)for(var Et in Nt[Vt]){var Tt=Nt[Vt][Et];r.shard[$t].shard_id,r.shard[$t].icon="el-icon-circle-check",r.shard[$t].status="success"}}else if("添加存储节点"==a){Nt=e.attachment.shard_hosts;for(var Dt=0;Dt<Nt.length;Dt++)for(var Et in Nt[Dt]){Tt=Nt[Dt][Et];r.shard[$t].shard_id,r.shard[$t].icon="el-icon-circle-check",r.shard[$t].status="success"}}else if("删除shard"==a){var Ft=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);Nt=Ft.split(";");for(var Pt=0;Pt<Nt.length;Pt++)r.shard[$t].shard_id==Nt[Pt]&&(r.shard[$t].icon="el-icon-circle-check",r.shard[$t].status="success")}else Nt=e.attachment.shard_id,r.shard[$t].shard_id==Nt&&(r.shard[$t].icon="el-icon-circle-check",r.shard[$t].status="success")}}else if("failed"==e.attachment.storage_state){if(console.log(5),r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",r.shard.length>0){for(var Mt=0;Mt<r.shard.length;Mt++){var Rt="";if("添加shard"==a){Rt=e.attachment.shard_ids;for(var qt=0;qt<Rt.length;qt++)for(var Et in Rt[qt]){Tt=Rt[qt][Et];r.shard[Mt].shard_id,r.shard[Mt].icon="el-icon-circle-close",r.shard[Mt].status="error"}}else if("添加存储节点"==a){Rt=e.attachment.shard_hosts;for(var zt=0;zt<Rt.length;zt++)for(var Et in Rt[zt]){Tt=Rt[zt][Et];r.shard[Mt].shard_id,r.shard[Mt].icon="el-icon-circle-close",r.shard[Mt].status="error"}}else if("删除shard"==a){var Bt=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);Rt=Bt.split(";");for(var Qt=0;Qt<Rt.length;Qt++)r.shard[Mt].shard_id==Rt[Qt]&&(r.shard[Mt].icon="el-icon-circle-close",r.shard[Mt].status="error")}else Rt=e.attachment.shard_id,r.shard[Mt].shard_id==Rt&&(r.shard[Mt].icon="el-icon-circle-close",r.shard[Mt].status="error")}r.shard_description=e.error_info}}else r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a;if(r.init_title="正在"+a,r.init_active=1,0==r.shard.length){if(console.log(1),"ongoing"==e.status){if(r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a,e.attachment.hasOwnProperty("storage_state")){var At="";if("添加shard"==a){At=e.attachment.shard_ids;for(var Jt=0;Jt<At.length;Jt++)for(var Et in At[Jt]){var Ht={};Tt=At[Jt][Et];console.log(Tt);var Gt=Et+":"+Tt;console.log(Gt),Ht.title=""!==Tt?Gt:"正在"+a,Ht.icon="el-icon-loading",Ht.status="process",Ht.description="",Ht.shard_id=Tt,r.shard.push(Ht)}}else if("添加存储节点"==a){At=e.attachment.shard_hosts;for(var Yt=0;Yt<At.length;Yt++)for(var Et in At[Yt]){var Ut={};Tt=At[Yt][Et];console.log(Tt);var Kt=Et+":"+Tt;console.log(Kt),Ut.title=""!==Tt?Kt:"正在"+a,Ut.icon="el-icon-loading",Ut.status="process",Ut.description="",Ut.shard_id=Tt,r.shard.push(Ut)}}else if("删除shard"==a){var Xt=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);At=Xt.split(";");for(var Wt=0;Wt<At.length;Wt++){var Zt={};Zt.title=""!==At[Wt]?At[Wt]:"正在"+a,Zt.icon="el-icon-loading",Zt.status="process",Zt.description="",Zt.shard_id=At[Wt],r.shard.push(Zt)}}else{At=e.attachment.shard_id;var te={};te.title=At,te.icon="el-icon-loading",te.status="process",te.description="",te.shard_id=At,r.shard.push(te)}}}else if("failed"==e.status){if(console.log(2),r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",r.init_show=!1,r.shard_description=e.error_info,r.finish_title=a+"失败",r.finish_icon="el-icon-circle-close",r.finish_state="error",r.init_active=1,r.finish_description=e.error_info,r.shard.length>0){for(var ee=0;ee<r.shard.length;ee++){var se="";if(e.attachment.hasOwnProperty("shard_hosts"))if("添加shard"==a){se=e.attachment.shard_ids;for(var ae=0;ae<se.length;ae++)for(var Et in se[ae]){Tt=se[ae][Et];r.shard[ee].shard_id,r.shard[ee].icon="el-icon-circle-close",r.shard[ee].status="error"}}else if("添加存储节点"==a){se=e.attachment.shard_hosts;for(var ie=0;ie<se.length;ie++)for(var Et in se[ie]){Tt=se[ie][Et];r.shard[ee].shard_id,r.shard[ee].icon="el-icon-circle-close",r.shard[ee].status="error"}}else if("删除shard"==a){var re=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);se=re.split(";");for(var oe=0;oe<se.length;oe++)r.shard[ee].shard_id==se[oe]&&(r.shard[ee].icon="el-icon-circle-close",r.shard[ee].status="error")}else se=e.attachment.shard_id,r.shard[ee].shard_id==se&&(r.shard[ee].icon="el-icon-circle-close",r.shard[ee].status="error")}r.shard_description=e.error_info}else if(e.attachment.hasOwnProperty("storage_state")){var ne="";if("添加shard"==a){ne=e.attachment.shard_ids;for(var le=0;le<ne.length;le++)for(var Et in ne[le]){var ce={};Tt=ne[le][Et];console.log(Tt);var de=Et+":"+Tt;console.log(de),ce.title=""!==Tt?de:"正在"+a,ce.icon="el-icon-circle-close",ce.status="error",ce.description="",ce.shard_id=Tt,r.shard.push(ce)}}else if("添加存储节点"==a){ne=e.attachment.shard_hosts;for(var pe=0;pe<ne.length;pe++)for(var Et in ne[pe]){var ue={};Tt=ne[pe][Et];console.log(Tt);var me=Et+":"+Tt;console.log(me),ue.title=""!==Tt?me:"正在"+a,ue.icon="el-icon-circle-close",ue.status="error",ue.description="",ue.shard_id=Tt,r.shard.push(ue)}}else if("删除shard"==a){var _e=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);ne=_e.split(";");for(var he=0;he<ne.length;he++){var fe={};fe.title=""!==ne[he]?ne[he]:"正在"+a,fe.icon="el-icon-circle-close",fe.status="error",fe.description="",fe.shard_id=ne[he],r.shard.push(fe)}}else{ne=e.attachment.shard_id;var ge={};ge.title=""!==ne?ne:"正在"+a,ge.icon="el-icon-circle-close",ge.status="error",ge.description="",ge.shard_id=ne,r.shard.push(ge)}}clearInterval(t),console.log(7)}else if("done"==e.status){if(console.log(3),r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功",r.finish_title=a+"成功",r.finish_icon="el-icon-circle-check",r.finish_state="success",r.init_active=1,r.finish_description=e.error_info,r.shard.length>0)for(var ve=0;ve<r.shard.length;ve++){var be="";if(e.attachment.hasOwnProperty("shard_hosts"))if("添加shard"==a){be=e.attachment.shard_ids;for(var ye=0;ye<be.length;ye++)for(var Et in be[ye]){Tt=be[ye][Et];r.shard[ve].shard_id,r.shard[ve].icon="el-icon-circle-check",r.shard[ve].status="success"}}else if("添加存储节点"==a){be=e.attachment.shard_hosts;for(var xe=0;xe<be.length;xe++)for(var Et in be[xe]){Tt=be[xe][Et];r.shard[ve].shard_id,r.shard[ve].icon="el-icon-circle-check",r.shard[ve].status="success"}}else if("删除shard"==a){var we=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);be=we.split(";");for(var ke=0;ke<be.length;ke++)r.shard[ve].shard_id==be[ke]&&(r.shard[ve].icon="el-icon-circle-check",r.shard[ve].status="success")}else be=e.attachment.shard_id,r.shard[ve].shard_id==be&&(r.shard[ve].icon="el-icon-circle-check",r.shard[ve].status="success")}else if(e.attachment.hasOwnProperty("storage_state")){var Se="";if("添加shard"==a){Se=e.attachment.shard_ids;for(var je=0;je<Se.length;je++)for(var Et in Se[je]){var Oe={};Tt=Se[je][Et];console.log(Tt);var Le=Et+":"+Tt;console.log(Le),Oe.title=""!==Tt?Le:"正在"+a,Oe.icon="el-icon-circle-check",Oe.status="success",Oe.description="",Oe.shard_id=Tt,r.shard.push(Oe)}}else if("添加存储节点"==a){Se=e.attachment.shard_hosts;for(var Ie=0;Ie<Se.length;Ie++)for(var Et in Se[Ie]){var Ce={};Tt=Se[Ie][Et];console.log(Tt);var $e=Et+":"+Tt;console.log($e),Ce.title=""!==Tt?$e:"正在"+a,Ce.icon="el-icon-circle-check",Ce.status="success",Ce.description="",Ce.shard_id=Tt,r.shard.push(Ce)}}else if("删除shard"==a){var Ne=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);Se=Ne.split(";");for(var Ve=0;Ve<Se.length;Ve++){var Ee={};Ee.title=""!==Se[Ve]?Se[Ve]:"正在"+a,Ee.icon="el-icon-circle-check",Ee.status="success",Ee.description="",Ee.shard_id=Se[Ve],r.shard.push(Ee)}}else{Se=e.attachment.shard_id;var Te={};Te.title=""!==Se?Se:"正在"+a,Te.icon="el-icon-circle-check",Te.status="success",Te.description="",Te.shard_id=Se,r.shard.push(Te)}}clearInterval(t),r.getList()}}else if("ongoing"==e.status){if(e.attachment.hasOwnProperty("storage_state"))if("done"==e.attachment.storage_state){if(r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功",r.shard.length>0)for(var De=0;De<r.shard.length;De++){var Fe="";if("添加shard"==a){Fe=e.attachment.shard_ids;for(var Pe=0;Pe<Fe.length;Pe++)for(var Et in Fe[Pe]){Tt=Fe[Pe][Et];r.shard[De].shard_id,r.shard[De].icon="el-icon-circle-check",r.shard[De].status="success"}}else if("添加存储节点"==a){Fe=e.attachment.shard_hosts;for(var Me=0;Me<Fe.length;Me++)for(var Et in Fe[Me]){Tt=Fe[Me][Et];r.shard[De].shard_id,r.shard[De].icon="el-icon-circle-check",r.shard[De].status="success"}}else if("删除shard"==a){var Re=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);Fe=Re.split(";");for(var qe=0;qe<Fe.length;qe++)r.shard[De].shard_id==Fe[qe]&&(r.shard[De].icon="el-icon-circle-check",r.shard[De].status="success")}else Fe=e.attachment.shard_id,r.shard[De].shard_id==Fe&&(r.shard[De].icon="el-icon-circle-check",r.shard[De].status="success")}}else if("failed"==e.attachment.storage_state){if(r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",r.shard.length>0){for(var ze=0;ze<r.shard.length;ze++){var Be="";if("添加shard"===a){Be=e.attachment.shard_ids;for(var Qe=0;Qe<Be.length;Qe++)for(var Et in Be[Qe]){Tt=Be[Qe][Et];r.shard[ze].shard_id,r.shard[ze].icon="el-icon-circle-close",r.shard[ze].status="error"}}else if("添加存储节点"==a){Be=e.attachment.shard_hosts;for(var Ae=0;Ae<Be.length;Ae++)for(var Et in Be[Ae]){Tt=Be[Ae][Et];r.shard[ze].shard_id,r.shard[ze].icon="el-icon-circle-close",r.shard[ze].status="error"}}else if("删除shard"==a){var Je=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);Be=Je.split(";");for(var He=0;He<Be.length;He++)r.shard[ze].shard_id==Be[He]&&(r.shard[ze].icon="el-icon-circle-close",r.shard[ze].status="error")}else Be=e.attachment.shard_id,r.shard[ze].shard_id==Be&&(r.shard[ze].icon="el-icon-circle-close",r.shard[ze].status="error")}r.shard_description=e.error_info}}else r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a}else if("failed"==e.status){if(console.log(7),r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",r.init_show=!1,r.finish_title=a+"失败",r.finish_icon="el-icon-circle-close",r.finish_state="error",r.init_active=1,r.finish_description=e.error_info,r.shard.length>0){for(var Ge=0;Ge<r.shard.length;Ge++){var Ye="";if(e.attachment.hasOwnProperty("shard_hosts"))if("添加shard"==a){Ye=e.attachment.shard_ids;for(var Ue=0;Ue<Ye.length;Ue++)for(var Et in Ye[Ue]){Tt=Ye[Ue][Et];r.shard[Ge].shard_id,r.shard[Ge].icon="el-icon-circle-close",r.shard[Ge].status="error"}}else if("添加存储节点"==a){Ye=e.attachment.shard_hosts;for(var Ke=0;Ke<Ye.length;Ke++)for(var Et in Ye[Ke]){Tt=Ye[Ke][Et];r.shard[Ge].shard_id,r.shard[Ge].icon="el-icon-circle-close",r.shard[Ge].status="error"}}else if("删除shard"==a){var Xe=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);Ye=Xe.split(";");for(var We=0;We<Ye.length;We++)r.shard[Ge].shard_id===Ye[We]&&(r.shard[Ge].icon="el-icon-circle-close",r.shard[Ge].status="error")}else Ye=e.attachment.shard_id,r.shard[Ge].shard_id===Ye&&(r.shard[Ge].icon="el-icon-circle-close",r.shard[Ge].status="error")}r.shard_description=e.error_info}clearInterval(t)}else if("done"==e.status){if(r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功",r.finish_title=a+"成功",r.finish_icon="el-icon-circle-check",r.finish_state="success",r.init_active=1,r.finish_description=e.error_info,r.shard.length>0)for(var Ze=0;Ze<r.shard.length;Ze++){var ts="";if(e.attachment.hasOwnProperty("shard_hosts"))if("添加shard"==a){ts=e.attachment.shard_ids;for(var es=0;es<ts.length;es++)for(var Et in ts[es]){Tt=ts[es][Et];r.shard[Ze].shard_id,r.shard[Ze].icon="el-icon-circle-check",r.shard[Ze].status="success"}}else if("添加存储节点"==a){ts=e.attachment.shard_hosts;for(var ss=0;ss<ts.length;ss++)for(var Et in ts[ss]){Tt=ts[ss][Et];r.shard[Ze].shard_id,r.shard[Ze].icon="el-icon-circle-check",r.shard[Ze].status="success"}}else if("删除shard"==a){var as=e.attachment.storage_hosts.substr(0,e.attachment.storage_hosts.length-1);ts=as.split(";");for(var is=0;is<ts.length;is++)r.shard[Ze].shard_id==ts[is]&&(r.shard[Ze].icon="el-icon-circle-check",r.shard[Ze].status="success")}else ts=e.attachment.shard_id,r.shard[Ze].shard_id==ts&&(r.shard[Ze].icon="el-icon-circle-check",r.shard[Ze].status="success")}clearInterval(t),r.getList()}"ongoing"==e.status?"prepare"==e.attachment.storage_state?(r.percentage=20,r.progress_format="正在"+a):"failed"==e.attachment.storage_state?r.progress_format=a+"失败":"done"==e.attachment.storage_state?(r.percentage=100,r.progress_format=a+"完成"):(r.percentage<70&&r.percentage>=30?r.percentage+=10:r.percentage<30&&r.percentage>=0&&(r.percentage=30),r.progress_format="正在"+a):"failed"==e.status?(r.progress_status="exception","prepare"==e.attachment.storage_state?(r.percentage=20,r.progress_format="正在"+a):"failed"==e.attachment.storage_state?r.progress_format=a+"失败":"done"==e.attachment.storage_state?(r.percentage=100,r.progress_format=a+"完成"):(r.percentage<70&&r.percentage>=30?r.percentage+=10:r.percentage<30&&r.percentage>=0&&(r.percentage=30),r.progress_format="正在"+a)):(r.progress_status="success",r.percentage=100,r.progress_format=a+"完成")}else null==e.attachment&&"70001"==e.error_code&&"failed"==e.status?"添加shard"!=a&&"添加存储节点"!=a&&"删除shard"!=a&&"删除存储节点"!=a||(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a,s>5&&(r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",r.percentage<30&&(r.percentage+=10),r.progress_format=a+"失败",clearInterval(t))):null==e.attachment&&"ongoing"==e.status?"添加shard"!=a&&"添加存储节点"!=a&&"删除shard"!=a&&"删除存储节点"!=a||(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="process",r.shard_icon="el-icon-loading",r.shard_title="正在"+a,r.percentage<30&&(r.percentage+=10),r.progress_format="正在"+a):null==e.attachment&&"done"==e.status?("添加shard"!=a&&"添加存储节点"!=a||(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="success",r.shard_icon="el-icon-circle-check",r.shard_title=a+"成功",r.percentage<30&&(r.percentage+=10),r.progress_format=a+"成功"),clearInterval(t)):("添加shard"!=a&&"添加存储节点"!=a&&"删除shard"!=a&&"删除存储节点"!=a||(r.shard_show=!0,r.init_show=!1,r.computer_show=!1,r.storage_state="error",r.shard_icon="el-icon-circle-close",r.shard_title=a+"失败",r.percentage<30&&(r.percentage+=10),r.progress_format=a+"失败"),clearInterval(t))})),s>=86400&&clearInterval(t)}),0)},getStatus:function(t,e,s,a){var i=this;setTimeout((function(){var r={job_type:"get_status"};r.version=d["u"][0].ver,r.job_id=e,r.timestamp=d["s"][0].time+"",r.paras={},Object(p["N"])(r).then((function(e){if("done"==e.status||"failed"==e.status)if("done"==e.status){var r={content:a+"成功",timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};i.activities.push(r),i.getList(),clearInterval(t)}else if(null==e.attachment&&"70001"==e.error_code&&"failed"==e.status){if(s>5){var o={content:e.error_info,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};i.activities.push(o),clearInterval(t)}}else{var n={content:e.error_info,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};i.activities.push(n),clearInterval(t)}})),s>=86400&&clearInterval(t)}),0)},beforeDestroy:function(){clearInterval(this.timer),this.timer=null}}},Pt=Ft,Mt=(s("d13a"),s("65fa"),Object(f["a"])(Pt,Tt,Dt,!1,null,"d46c1c10",null)),Rt=Mt.exports,qt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"180px",rules:t.rules}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_id"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择shard名称"},model:{value:t.form.shard_id,callback:function(e){t.$set(t.form,"shard_id",e)},expression:"form.shard_id"}},t._l(t.shardList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id},nativeOn:{click:function(s){return t.ChangeSaler(e)}}})})),1)],1),s("el-form-item",{attrs:{label:"需重做的备机节点:",prop:"redolist"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择需重做的备机节点"},on:{change:t.change},model:{value:t.form.redolist,callback:function(e){t.$set(t.form,"redolist",e)},expression:"form.redolist"}},t._l(t.options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1),s("el-form-item",{attrs:{label:"是否从主节点上拉取数据:",prop:"allow_pull_from_master"}},[s("el-radio",{attrs:{label:"1"},model:{value:t.form.allow_pull_from_master,callback:function(e){t.$set(t.form,"allow_pull_from_master",e)},expression:"form.allow_pull_from_master"}},[t._v("是")]),s("el-radio",{attrs:{label:"0"},model:{value:t.form.allow_pull_from_master,callback:function(e){t.$set(t.form,"allow_pull_from_master",e)},expression:"form.allow_pull_from_master"}},[t._v("否")])],1),"0"==t.form.allow_pull_from_master?s("el-form-item",{attrs:{label:"主备延迟:",prop:"allow_replica_delay"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"主备延迟"},model:{value:t.form.allow_replica_delay,callback:function(e){t.$set(t.form,"allow_replica_delay",e)},expression:"form.allow_replica_delay"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("s")])])],1):t._e(),s("el-form-item",{attrs:{label:"是否备份:",prop:"need_backup"}},[s("el-radio",{attrs:{label:"1"},model:{value:t.form.need_backup,callback:function(e){t.$set(t.form,"need_backup",e)},expression:"form.need_backup"}},[t._v("是")]),s("el-radio",{attrs:{label:"0"},model:{value:t.form.need_backup,callback:function(e){t.$set(t.form,"need_backup",e)},expression:"form.need_backup"}},[t._v("否")])],1),"1"==t.form.need_backup?s("el-form-item",{attrs:{label:"备份存储目标:",prop:"hdfs_host"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.hdfs_host,callback:function(e){t.$set(t.form,"hdfs_host",e)},expression:"form.hdfs_host"}},t._l(t.hdfs_options,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1):t._e(),s("el-form-item",{attrs:{label:"限速:",prop:"pv_limit"}},[s("el-input",{staticClass:"right_input",attrs:{placeholder:"限速"},model:{value:t.form.pv_limit,callback:function(e){t.$set(t.form,"pv_limit",e)},expression:"form.pv_limit"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("KB/s")])])],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("保存")])],1)],1),s("el-dialog",{attrs:{title:t.job_id,visible:t.dialogStatusRedoVisible,"custom-class":"single_dal_view","close-on-click-modal":!1,"before-close":t.beforeRedoDestory},on:{"update:visible":function(e){t.dialogStatusRedoVisible=e}}},[s("div",{staticClass:"block",staticStyle:{width:"100%",background:"#fff",padding:"0 20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.init_active}},t._l(t.statusList,(function(e,a){return s("el-step",{key:a,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description}},[s("template",{slot:"description"},[s("span",[t._v(t._s(e.description))]),s("div",{staticStyle:{padding:"20px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.second_active}},t._l(t.statusList[a].second,(function(t,e){return s("el-step",{key:e,attrs:{title:t.title,icon:t.icon,status:t.status,description:t.description}})})),1)],1)])],2)})),1)],1)])],1)},zt=[],Bt={name:"List",props:{listsent:{typeof:Object}},data:function(){var t=this,e=function(t,e,s){e?s():s(new Error("请选择shard名称"))},s=function(e,s,a){0===s.length?a(new Error("请选择需重做的备机节点")):s.length==t.options.length?(t.form.allow_pull_from_master="1",a()):a()},a=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("主备延迟只能输入数字")):s(new Error("主备延迟不能为空"))},i=function(t,e,s){0===e.length?s(new Error("请选择备份存储目标")):s()},r=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("最大延迟时间只能输入数字")):s(new Error("最大延迟时间不能为空"))};return{form:{name:"",nick_name:"",id:"",shard_id:"",shard_name:"",redolist:[],allow_pull_from_master:"0",allow_replica_delay:"30",need_backup:"0",pv_limit:"10",hdfs_host:""},shardList:[],options:[],hdfs_options:[],dialogStatusRedoVisible:!1,active:0,job_id:"",timer:null,statusList:[],init_active:0,second_active:0,rules:{shard_id:[{required:!0,trigger:"blur",validator:e}],redolist:[{required:!0,trigger:"blur",validator:s}],allow_replica_delay:[{required:!0,trigger:"blur",validator:a}],hdfs_host:[{required:!0,trigger:"blur",validator:i}],maxtime:[{required:!0,trigger:"blur",validator:r}]}}},created:function(){var t=this;Object(p["eb"])(this.listsent.id).then((function(e){var s=e;200==s.code&&(t.shardList=s.list)})),Object(p["A"])().then((function(e){if(t.hdfs_options=[],null!==e.list)for(var s=0;s<e.list.length;s++){var a={value:s,label:e.list[s].hostaddr+"("+e.list[s].port+")"};t.hdfs_options.push(a)}}))},mounted:function(){this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{change:function(){this.options.length==this.form.redolist.length?this.form.allow_pull_from_master="1":this.form.allow_pull_from_master="0"},onSubmit:function(t){var e=this;this.$refs["form"].validate((function(s){if(s){var a=Object(l["a"])(),i="将对"+e.form.shard_name+"进行重做备机节点,是否继续?code="+a;Object(l["e"])(i).then((function(s){if(s.value)if(s.value==a){var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.job_type="rebuild_node",i.version=d["u"][0].ver,i.timestamp=d["s"][0].time+"";for(var r=[],o=[],n=0;n<t.redolist.length;n++){var c=t.redolist[n].substring(0,t.redolist[n].length-1).split("("),u="";u=t.pv_limit?t.pv_limit:"10";var m={};if("1"==t.need_backup){var _=t.hdfs_host.substring(0,t.hdfs_host.length-1).replace("(",":");m.hostaddr=c[0],m.port=c[1],m.need_backup=t.need_backup,m.hdfs_host=_,m.pv_limit=u}else m.hostaddr=c[0],m.port=c[1],m.need_backup=t.need_backup,m.pv_limit=u;r.push(m),o.push({title:c[0]+"_"+c[1],error_code:"0",error_info:"",status:"no_start",step:""})}var h={};"1"==t.allow_pull_from_master?(h.shard_id=t.shard_id,h.cluster_id=e.form.id,h.allow_pull_from_master=t.allow_pull_from_master,h.rb_nodes=r):(h.shard_id=t.shard_id,h.cluster_id=e.form.id,h.allow_pull_from_master=t.allow_pull_from_master,h.allow_replica_delay=t.allow_replica_delay,h.rb_nodes=r),i.paras=h,e.dialogStatusRedoVisible=!0,Object(p["qb"])(i).then((function(t){var s=t;if("accept"==s.status){e.stepParams=[];var a=0,i="重做备机节点";e.statusList=[],e.timer=null,e.init_active=0,e.second_active=0,e.getFStatus(e.timer,s.job_id,a++,i,o),e.timer=setInterval((function(){e.getFStatus(e.timer,s.job_id,a++,i,o)}),5e3)}else e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}else e.message_tips="code输入有误",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type);else e.message_tips="code不能为空！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)}))}}))},ChangeSaler:function(t){var e=this;t||(this.form.primary_node=""),this.form.shard_name=t.name;var s={};s.cluster_id=this.listsent.id,s.shard_id=t.id,s.ha_mode=this.listsent.ha_mode,Object(p["ib"])(s).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))},beforeRedoDestory:function(){clearInterval(this.timer),this.dialogStatusRedoVisible=!1,this.timer=null},resetform:function(){this.form={name:"",nick_name:"",id:"",shard_id:"",shard_name:"",redolist:[],allow_pull_from_master:"0",allow_replica_delay:"30",need_backup:"0",pv_limit:"10",hdfs_host:""}},getFStatus:function(t,e,s,a,i){var r=this;setTimeout((function(){var o={job_type:"get_status"};o.version=d["u"][0].ver,o.timestamp=d["s"][0].time+"",o.job_id=e,o.paras={},r.job_id="任务ID:"+e,Object(p["N"])(o).then((function(e){if("重做备机节点"==a)if(null!==e.attachment)if(0==r.statusList.length){var o={};if("failed"==e.status)o={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_code,second:[]},r.statusList.push(o),clearInterval(t);else for(var n=0;n<i.length;n++){for(var c=e.attachment.job_step.replace(/\s+/g,"").split(","),d={},p=[],u=0;u<c.length;u++)d={title:c[u],icon:"",status:"wait",description:""},p.push(d);if(0==n){if(o={title:i[n].title,icon:"el-icon-loading",status:"process",description:"",second:p},r.statusList.push(o),"done"==i[n].status){r.init_active=n+1,r.statusList[n].icon="el-icon-circle-check",r.statusList[n].status="success";for(var m=0;m<r.statusList[n].second.length;m++)r.statusList[n].second[m].icon="el-icon-circle-check",r.statusList[n].second[m].status="success"}else if("ongoing"==i[n].status){r.init_active=n,r.statusList[n].icon="el-icon-loading",r.statusList[n].status="process";for(var _=0;_<r.statusList[n].second.length;_++)if(i[n].step==r.statusList[n].second[_].title){r.statusList[n].second[_].icon="el-icon-loading",r.statusList[n].second[_].status="process";for(var h=0;h<_;h++)r.statusList[n].second[h].icon="el-icon-circle-check",r.statusList[n].second[h].status="success"}}else if("failed"==i[n].status){r.statusList[n].icon="el-icon-circle-close",r.statusList[n].status="error";for(var f=0;f<r.statusList[n].second.length;f++)if(i[n].step==r.statusList[n].second[f].title){r.statusList[n].second[f].icon="el-icon-circle-close",r.statusList[n].second[f].status="error";for(var g=0;g<f;g++)r.statusList[n].second[g].icon="el-icon-circle-check",r.statusList[n].second[g].status="success"}r.statusList[n].description=i[n].error_info}}else{for(var v=e.attachment.job_step.replace(/\s+/g,"").split(","),b={},y=[],x=0;x<v.length;x++)b={title:v[x],icon:"",status:"wait",description:""},y.push(b);if(0==r.init_active?(o={title:i[n].title,icon:"",status:"wait",description:"",second:y},r.statusList.push(o)):(o={title:i[n].title,icon:"el-icon-loading",status:"process",description:"",second:y},r.statusList.push(o)),"done"==i[n].status){r.init_active=n+1,r.statusList[n].icon="el-icon-circle-check",r.statusList[n].status="success";for(var w=0;w<r.statusList[n].second.length;w++)r.statusList[n].second[w].icon="el-icon-circle-check",r.statusList[n].second[w].status="success"}else if("ongoing"==i[n].status){r.init_active=n,r.statusList[n].icon="el-icon-loading",r.statusList[n].status="process";for(var k=0;k<r.statusList[n].second.length;k++)if(i[n].step==r.statusList[n].second[k].title){r.statusList[n].second[k].icon="el-icon-loading",r.statusList[n].second[k].status="process";for(var S=0;S<k;S++)r.statusList[n].second[S].icon="el-icon-circle-check",r.statusList[n].second[S].status="success"}}else if("failed"==i[n].status){r.statusList[n].icon="el-icon-circle-close",r.statusList[n].status="error";for(var j=0;j<r.statusList[n].second.length;j++)if(i[n].step==r.statusList[n].second[j].title){r.statusList[n].second[j].icon="el-icon-circle-close",r.statusList[n].second[j].status="error";for(var O=0;O<j;O++)r.statusList[n].second[O].icon="el-icon-circle-check",r.statusList[n].second[O].status="success"}r.statusList[n].description=i[n].error_info}}}}else if("ongoing"==e.status){var L=[];for(var I in e.attachment)if("job_step"!==I){var C=e.attachment[I];r.$set(C,"title",I),L.push(C)}for(var $=0;$<L.length;$++)if(0==$){if("done"==L[$].status){r.init_active=$+1,r.statusList[$].icon="el-icon-circle-check",r.statusList[$].status="success";for(var N=0;N<r.statusList[$].second.length;N++)r.statusList[$].second[N].icon="el-icon-circle-check",r.statusList[$].second[N].status="success"}else if("ongoing"==L[$].status){r.init_active=$,r.statusList[$].icon="el-icon-loading",r.statusList[$].status="process";for(var V=0;V<r.statusList[$].second.length;V++)if(L[$].step==r.statusList[$].second[V].title){r.statusList[$].second[V].icon="el-icon-loading",r.statusList[$].second[V].status="process";for(var E=0;E<V;E++)r.statusList[$].second[E].icon="el-icon-circle-check",r.statusList[$].second[E].status="success"}}else if("failed"==L[$].status){r.statusList[$].icon="el-icon-circle-close",r.statusList[$].status="error";for(var T=0;T<r.statusList[$].second.length;T++)if(L[$].step==r.statusList[$].second[T].title){r.statusList[$].second[T].icon="el-icon-circle-close",r.statusList[$].second[T].status="error";for(var D=0;D<T;D++)r.statusList[$].second[D].icon="el-icon-circle-check",r.statusList[$].second[D].status="success"}r.statusList[$].description=L[$].error_info}}else if("done"==L[$].status){r.init_active=$+1,r.statusList[$].icon="el-icon-circle-check",r.statusList[$].status="success";for(var F=0;F<r.statusList[$].second.length;F++)r.statusList[$].second[F].icon="el-icon-circle-check",r.statusList[$].second[F].status="success"}else if("ongoing"==L[$].status){r.init_active=$,r.statusList[$].icon="el-icon-loading",r.statusList[$].status="process";for(var P=0;P<r.statusList[$].second.length;P++)if(L[$].step==r.statusList[$].second[P].title){r.statusList[$].second[P].icon="el-icon-loading",r.statusList[$].second[P].status="process";for(var M=0;M<P;M++)r.statusList[$].second[M].icon="el-icon-circle-check",r.statusList[$].second[M].status="success"}}else if("failed"==L[$].status){r.statusList[$].icon="el-icon-circle-close",r.statusList[$].status="error";for(var R=0;R<r.statusList[$].second.length;R++)if(L[$].step==r.statusList[$].second[R].title){r.statusList[$].second[R].icon="el-icon-circle-close",r.statusList[$].second[R].status="error";for(var q=0;q<R;q++)r.statusList[$].second[q].icon="el-icon-circle-check",r.statusList[$].second[q].status="success"}r.statusList[$].description=L[$].error_info}}else if("failed"==e.status){var z=[];for(var B in e.attachment)if("job_step"!==B){var Q=e.attachment[B];r.$set(Q,"title",B),z.push(Q)}for(var A=0;A<z.length;A++)if(0==A){if("done"==z[A].status){r.init_active=A+1,r.statusList[A].icon="el-icon-circle-check",r.statusList[A].status="success";for(var J=0;J<r.statusList[A].second.length;J++)r.statusList[A].second[J].icon="el-icon-circle-check",r.statusList[A].second[J].status="success"}else if("ongoing"==z[A].status){r.init_active=A,r.statusList[A].icon="el-icon-loading",r.statusList[A].status="process";for(var H=0;H<r.statusList[A].second.length;H++)if(z[A].step==r.statusList[A].second[H].title){r.statusList[A].second[H].icon="el-icon-loading",r.statusList[A].second[H].status="process";for(var G=0;G<H;G++)r.statusList[A].second[G].icon="el-icon-circle-check",r.statusList[A].second[G].status="success"}}else if("failed"==z[A].status){r.statusList[A].icon="el-icon-circle-close",r.statusList[A].status="error";for(var Y=0;Y<r.statusList[A].second.length;Y++)if(z[A].step==r.statusList[A].second[Y].title){r.statusList[A].second[Y].icon="el-icon-circle-close",r.statusList[A].second[Y].status="error";for(var U=0;U<Y;U++)r.statusList[A].second[U].icon="el-icon-circle-check",r.statusList[A].second[U].status="success"}r.statusList[A].description=z[A].error_info}}else if("done"==z[A].status){r.init_active=A+1,r.statusList[A].icon="el-icon-circle-check",r.statusList[A].status="success";for(var K=0;K<r.statusList[A].second.length;K++)r.statusList[A].second[K].icon="el-icon-circle-check",r.statusList[A].second[K].status="success"}else if("ongoing"==z[A].status){r.init_active=A,r.statusList[A].icon="el-icon-loading",r.statusList[A].status="process";for(var X=0;X<r.statusList[A].second.length;X++)if(z[A].step==r.statusList[A].second[X].title){r.statusList[A].second[X].icon="el-icon-loading",r.statusList[A].second[X].status="process";for(var W=0;W<X;W++)r.statusList[A].second[W].icon="el-icon-circle-check",r.statusList[A].second[W].status="success"}}else if("failed"==z[A].status){r.statusList[A].icon="el-icon-circle-close",r.statusList[A].status="error";for(var Z=0;Z<r.statusList[A].second.length;Z++)if(z[A].step==r.statusList[A].second[Z].title){r.statusList[A].second[Z].icon="el-icon-circle-close",r.statusList[A].second[Z].status="error";for(var tt=0;tt<Z;tt++)r.statusList[A].second[tt].icon="el-icon-circle-check",r.statusList[A].second[tt].status="success"}r.statusList[A].description=z[A].error_info}var et={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_info,second:""};r.statusList.push(et),clearInterval(t)}else if("done"==e.status){var st=[];for(var at in e.attachment)if("job_step"!==at){var it=e.attachment[at];r.$set(it,"title",at),st.push(it)}for(var rt=0;rt<st.length;rt++)if(0==rt){if("done"==st[rt].status){r.init_active=rt+1,r.statusList[rt].icon="el-icon-circle-check",r.statusList[rt].status="success";for(var ot=0;ot<r.statusList[rt].second.length;ot++)r.statusList[rt].second[ot].icon="el-icon-circle-check",r.statusList[rt].second[ot].status="success"}else if("ongoing"==st[rt].status){r.init_active=rt,r.statusList[rt].icon="el-icon-loading",r.statusList[rt].status="process";for(var nt=0;nt<r.statusList[rt].second.length;nt++)if(st[rt].step==r.statusList[rt].second[nt].title){r.statusList[rt].second[nt].icon="el-icon-loading",r.statusList[rt].second[nt].status="process";for(var lt=0;lt<nt;lt++)r.statusList[rt].second[lt].icon="el-icon-circle-check",r.statusList[rt].second[lt].status="success"}}else if("failed"==st[rt].status){r.statusList[rt].icon="el-icon-circle-close",r.statusList[rt].status="error";for(var ct=0;ct<r.statusList[rt].second.length;ct++)if(st[rt].step==r.statusList[rt].second[ct].title){r.statusList[rt].second[ct].icon="el-icon-circle-close",r.statusList[rt].second[ct].status="error";for(var dt=0;dt<ct;dt++)r.statusList[rt].second[dt].icon="el-icon-circle-check",r.statusList[rt].second[dt].status="success"}r.statusList[rt].description=st[rt].error_info}}else if("done"==st[rt].status){r.init_active=rt+1,r.statusList[rt].icon="el-icon-circle-check",r.statusList[rt].status="success";for(var pt=0;pt<r.statusList[rt].second.length;pt++)r.statusList[rt].second[pt].icon="el-icon-circle-check",r.statusList[rt].second[pt].status="success"}else if("ongoing"==st[rt].status){r.init_active=rt,r.statusList[rt].icon="el-icon-loading",r.statusList[rt].status="process";for(var ut=0;ut<r.statusList[rt].second.length;ut++)if(st[rt].step==r.statusList[rt].second[ut].title){r.statusList[rt].second[ut].icon="el-icon-loading",r.statusList[rt].second[ut].status="process";for(var mt=0;mt<ut;mt++)r.statusList[rt].second[mt].icon="el-icon-circle-check",r.statusList[rt].second[mt].status="success"}}else if("failed"==st[rt].status){r.statusList[rt].icon="el-icon-circle-close",r.statusList[rt].status="error";for(var _t=0;_t<r.statusList[rt].second.length;_t++)if(st[rt].step==r.statusList[rt].second[_t].title){r.statusList[rt].second[_t].icon="el-icon-circle-close",r.statusList[rt].second[_t].status="error";for(var ht=0;ht<_t;ht++)r.statusList[rt].second[ht].icon="el-icon-circle-check",r.statusList[rt].second[ht].status="success"}r.statusList[rt].description=st[rt].error_info}var ft={title:a+"成功",icon:"el-icon-circle-check",status:"success",description:"",second:""};r.statusList.push(ft),clearInterval(t)}else r.message_tips=e.error_info,r.message_type="error",Object(l["g"])(r.message_tips,r.message_type);else if(null==e.attachment&&"70001"==e.error_code&&"failed"==e.status){if(s>5){var gt={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_info,second:[]};r.statusList.push(gt),clearInterval(t)}}else if(null==e.attachment&&"ongoing"==e.status){r.statusList=[];var vt={};vt={title:"正在"+a,icon:"el-icon-loading",status:"process",description:"",second:[]},r.statusList.push(vt)}else if(null==e.attachment&&"done"==e.status){r.statusList=[];var bt={};bt={title:a+"成功",icon:"el-icon-circle-check",status:"success",description:"",second:[]},r.statusList.push(bt),clearInterval(t)}else{r.statusList=[];var yt={};yt={title:a+"失败",icon:"el-icon-circle-close",status:"error",description:e.error_code,second:[]},r.statusList.push(yt),clearInterval(t)}})),s>=86400&&clearInterval(t)}),0)}}},Qt=Bt,At=(s("e019"),Object(f["a"])(Qt,qt,zt,!1,null,"20bbc3ce",null)),Jt=At.exports,Ht=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"120px",rules:t.rules}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"shard名称:",prop:"shard_id"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择shard名称"},on:{change:t.ChangeSaler},model:{value:t.form.shard_id,callback:function(e){t.$set(t.form,"shard_id",e)},expression:"form.shard_id"}},t._l(t.shardList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"最大延迟时间:",prop:"maxtime"}},[s("el-input",{attrs:{placeholder:"请输入最大延迟时间"},model:{value:t.form.maxtime,callback:function(e){t.$set(t.form,"maxtime",e)},expression:"form.maxtime"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("s")])])],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("保存")])],1)],1)],1)},Gt=[],Yt={name:"list",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){e?s():s(new Error("请选择shard名称"))},e=function(t,e,s){e?/^[0-9]+$/.test(e)?s():s(new Error("最大延迟时间只能输入数字")):s(new Error("最大延迟时间不能为空"))};return{form:{name:"",nick_name:"",id:"",shard_id:"",maxtime:""},shardList:[],options:[],dialogStatusFVisible:!1,active:0,stepSuc:[0],stepParams:[],job_id:"",timer:null,rules:{shard_id:[{required:!0,trigger:"blur",validator:t}],maxtime:[{required:!0,trigger:"blur",validator:e}]}}},created:function(){var t=this;Object(p["eb"])(this.listsent.id).then((function(e){var s=e;200==s.code&&(t.shardList=s.list)}))},mounted:function(){this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id},methods:{onSubmit:function(t){var e=this;this.$refs["form"].validate((function(s){if(s){var a={};a.cluster_id=t.id,a.shard_id=t.shard_id,a.maxtime=t.maxtime,a.user_name=sessionStorage.getItem("login_username"),Object(p["ub"])(a).then((function(t){var s=t;200==s.code?(e.dialogDalayVisible=!1,e.message_tips=s.message,e.message_type="success",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.message,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},ChangeSaler:function(t){var e=this,s={};s.cluster_id=this.listsent.id,s.shard_id=t,s.user_name=sessionStorage.getItem("login_username"),Object(p["S"])(s).then((function(t){200==t.code&&(0==t.list?e.form.maxtime="100":e.form.maxtime=t.list[0].max_delay_time)}))},resetform:function(){this.form={name:"",nick_name:"",id:"",shard_id:"",maxtime:""}}}},Ut=Yt,Kt=(s("8250"),Object(f["a"])(Ut,Ht,Gt,!1,null,"590d649e",null)),Xt=Kt.exports,Wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"设置变量:",prop:"variable"}},[s("el-input",{attrs:{placeholder:"set global fullsync_timeout = 1200"},model:{value:t.form.variable,callback:function(e){t.$set(t.form,"variable",e)},expression:"form.variable"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("保存")])],1)],1)],1)},Zt=[],te={name:"list",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){e?s():s(new Error("请选择shard名称"))},e=function(t,e,s){e?s():s(new Error("请选择节点"))},s=function(t,e,s){0===e.length?s(new Error("请选择变量类型")):s()},a=function(t,e,s){e?s():s(new Error("变量名不能为空"))},i=function(t,e,s){e?s():s(new Error("变量值不能为空"))};return{form:{name:"",nick_name:"",id:"",replica:"",shard_id:"",vartype:"",variable:"",varvalue:""},shardList:[],options:[],dialogStatusFVisible:!1,active:0,stepSuc:[0],stepParams:[],job_id:"",timer:null,typeOptions:[{value:"int",label:"int"},{value:"string",label:"string"}],rules:{shard_id:[{required:!0,trigger:"blur",validator:t}],replica:[{required:!0,trigger:"blur",validator:e}],vartype:[{required:!0,trigger:"blur",validator:s}],variable:[{required:!0,trigger:"blur",validator:a}],varvalue:[{required:!0,trigger:"blur",validator:i}]}}},created:function(){var t=this;Object(p["eb"])(this.listsent.id).then((function(e){var s=e;200==s.code&&(t.shardList=s.list)}))},mounted:function(){this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id},methods:{onSubmit:function(t){var e=this;this.$refs["form"].validate((function(s){if(s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="set_variable",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i={},r=t.replica.substring(0,t.replica.length-1).split("(");i.hostaddr=r[0],i.port=r[1],i.type=t.vartype,i.variable=t.variable,i.value=t.varvalue,a.paras=i,Object(p["wb"])(a).then((function(t){e.isShowNodeMenuPanel=!1;var s=t;e.message_tips="正在设置实例变量...",e.message_type="success",Object(l["g"])(e.message_tips,e.message_type),"0"==s.error_code&&"done"==s.status?(e.message_tips="设置实例变量成功",e.message_type="success",e.variableVisible=!1,Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},ChangeSaler:function(t){var e=this,s={};s.cluster_id=this.listsent.id,s.shard_id=t,s.ha_mode=this.listsent.ha_mode,Object(p["mb"])(s).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))},resetform:function(){this.form={name:"",nick_name:"",id:"",replica:"",shard_id:"",vartype:"",variable:"",varvalue:""}}}},ee=te,se=Object(f["a"])(ee,Wt,Zt,!1,null,"da1d038c",null),ae=se.exports,ie=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"获取变量名:",prop:"variable"}},[s("el-input",{attrs:{placeholder:"show variables like 'fullsync_timeout'"},model:{value:t.form.variable,callback:function(e){t.$set(t.form,"variable",e)},expression:"form.variable"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("保存")])],1)],1)],1)},re=[],oe={name:"list",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){e?s():s(new Error("请选择shard名称"))},e=function(t,e,s){e?s():s(new Error("请选择节点"))},s=function(t,e,s){e?s():s(new Error("变量名不能为空"))};return{form:{name:"",nick_name:"",id:"",replica:"",shard_id:"",variable:""},shardList:[],options:[],dialogStatusFVisible:!1,rules:{shard_id:[{required:!0,trigger:"blur",validator:t}],replica:[{required:!0,trigger:"blur",validator:e}],variable:[{required:!0,trigger:"blur",validator:s}]}}},created:function(){var t=this;Object(p["eb"])(this.listsent.id).then((function(e){var s=e;200==s.code&&(t.shardList=s.list)}))},mounted:function(){this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id},methods:{onSubmit:function(t){var e=this;this.$refs["form"].validate((function(s){if(s){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="get_variable",a.version=d["u"][0].ver,a.timestamp=d["s"][0].time+"";var i={},r=t.replica.substring(0,t.replica.length-1).split("(");i.hostaddr=r[0],i.port=r[1],i.variable=t.variable,a.paras=i,Object(p["nb"])(a).then((function(t){var s=t;e.message_tips="正在获取实例变量...",e.message_type="success",Object(l["g"])(e.message_tips,e.message_type),"0"==s.error_code&&"done"==s.status?(e.message_tips="获取实例变量成功,value="+s.list[0].Value,e.message_type="success",e.variableVisible=!1,Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=s.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},ChangeSaler:function(t){var e=this,s={};s.cluster_id=this.listsent.id,s.shard_id=t,s.ha_mode=this.listsent.ha_mode,Object(p["mb"])(s).then((function(t){if(200==t.code&&(e.options=[],t.list.length>0))for(var s=0;s<t.list.length;s++){var a={value:s,label:t.list[s].ip+"("+t.list[s].port+")"};e.options.push(a)}}))},resetform:function(){this.form={name:"",nick_name:"",id:"",replica:"",shard_id:"",variable:""}}}},ne=oe,le=Object(f["a"])(ne,ie,re,!1,null,"7847a85a",null),ce=le.exports,de=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{id:"form",model:t.form,rules:t.rules,"label-width":"140px"}},[s("el-form-item",{attrs:{label:"原表集群:",prop:"nick_name"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"目标表集群:",prop:"dst_cluster_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择目标表集群"},on:{change:t.onDstClusterChange},model:{value:t.form.dst_cluster_id,callback:function(e){t.$set(t.form,"dst_cluster_id",e)},expression:"form.dst_cluster_id"}},t._l(t.clusterOptions,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t._l(t.form.repartition_tables,(function(e,a){return s("el-row",{key:e.key},[s("el-col",{attrs:{span:10}},[s("el-form-item",{attrs:{label:"源表:",prop:"repartition_tables."+a+".srcTable",rules:{required:!0,message:"源表不能为空",trigger:"blur"}}},[s("el-cascader",{key:"srcTable"+a,staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择 库名/模式/表",options:t.srcTableOptions,filterable:""},model:{value:t.form.repartition_tables[a].srcTable,callback:function(e){t.$set(t.form.repartition_tables[a],"srcTable",e)},expression:"form.repartition_tables[index].srcTable"}})],1)],1),s("el-col",{attrs:{span:10}},[s("el-form-item",{attrs:{label:"目标表:",prop:"repartition_tables."+a+".ditTable",rules:{required:!0,message:"目标表不能为空",trigger:"blur"}}},[s("el-cascader",{key:"ditTable"+a,staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择 库名/模式/表",options:t.ditTableOptions,filterable:""},model:{value:t.form.repartition_tables[a].ditTable,callback:function(e){t.$set(t.form.repartition_tables[a],"ditTable",e)},expression:"form.repartition_tables[index].ditTable"}})],1)],1)],1)})),s("el-form-item",{attrs:{label:"删除源表:",prop:"del_table"},on:{change:t.agreeChange}},[s("el-radio",{attrs:{label:"0"},model:{value:t.form.del_table,callback:function(e){t.$set(t.form,"del_table",e)},expression:"form.del_table"}},[t._v("自动")]),s("el-radio",{attrs:{label:"1"},model:{value:t.form.del_table,callback:function(e){t.$set(t.form,"del_table",e)},expression:"form.del_table"}},[t._v("手动")]),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.btnstatus,expression:"!btnstatus"}],staticStyle:{color:"red"}},[t._v("请前往操作记录中进行删除源表操作！")])],1),"0"==t.form.del_table?s("el-form-item",{attrs:{label:"保留天数:",prop:"del_day"}},[s("el-input",{attrs:{placeholder:"请输入保留天数"},model:{value:t.form.del_day,callback:function(e){t.$set(t.form,"del_day",e)},expression:"form.del_day"}},[s("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("天")])])],1):t._e(),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("提交")])],1)],2),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeRestoreDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)])],1)},pe=[],ue=(s("a434"),s("a15b"),s("5c96")),me={name:"TableRepartition",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){e?/^[0-9]+$/.test(e)?e<1?s(new Error("保留天数不能小于1")):s():s(new Error("保留天数只能输入大于0的正整数")):s(new Error("保留天数不能为空"))};return{form:{src_cluster_id:"",dst_cluster_id:"",repartition_tables:[{srcTable:[],ditTable:[]}],name:"",nick_name:"",id:"",del_table:"0",del_day:"7",rename_table:"1"},dialogStatusVisible:!1,activities:[],clusterOptions:[],srcTable:[],srcTableOptions:[],ditTableOptions:[],btnstatus:!1,rules:{dst_cluster_id:[{required:!0,trigger:"blur",message:"目标集群不能为空"}],del_table:[{required:!0,trigger:"blur"}],del_day:[{required:!0,trigger:"blur",validator:t}]}}},mounted:function(){var t=this;this.form.src_cluster_id=this.listsent.id,this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name;var e=sessionStorage.getItem("login_username");Object(p["j"])({}).then((function(e){t.clusterOptions=e.list})),Object(p["bb"])({name:e,cluster_id:this.form.src_cluster_id}).then((function(e){t.srcTableOptions=e.list})),this.$nextTick((function(){t.$refs["form"]&&t.$refs["form"].clearValidate()}))},destroyed:function(){clearInterval(this.timer),this.timer=null},methods:{agreeChange:function(t){this.btnstatus="1"===t},onPush:function(t){this.form.repartition_tables.push({srcTable:[],ditTable:[]})},onRemove:function(t){this.form.repartition_tables.splice(t,1)},onDstClusterChange:function(t){var e=this;if(""===t)this.ditTableOptions=[];else{var s=ue["Loading"].service({target:"form"});Object(p["bb"])({cluster_id:t}).then((function(t){e.ditTableOptions=t.list})).finally((function(){s.close()}))}this.form.repartition_tables.forEach((function(t,s){e.form.repartition_tables[s].ditTable=[]}))},beforeRestoreDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},onSubmit:function(t){var e=this;console.info(this.srcTable),this.$refs["form"].validate((function(t){if(t){var s={};s.user_name=sessionStorage.getItem("login_username"),s.job_id="",s.version=d["u"][0].ver,s.job_type="table_repartition",s.timestamp=d["s"][0].time+"";var a={},i=e.form.repartition_tables.map((function(t){return t.srcTable[0]+"_$$_"+t.srcTable[1]+"."+t.srcTable[2]+"=>"+t.ditTable[0]+"_$$_"+t.ditTable[1]+"."+t.ditTable[2]})).join(",");a.src_cluster_id=e.form.src_cluster_id,a.dst_cluster_id=e.form.dst_cluster_id,a.del_src_table=e.form.del_table,a.del_resv_day=e.form.del_day,a.repartition_tables=i,s.paras=a,Object(p["Db"])(s).then((function(t){if(200===t.code&&(console.log(t),e.$message.info("提交成功"),e.$refs["form"].resetFields()),"accept"===t.status){e.dialogRetreatedVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var s={content:"表重分中...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(s);var a=0;e.timer=null,e.timer=setInterval((function(){e.getStatus(e.timer,t.job_id,a++)}),1e3)}else"ongoing"===t.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=t.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},getStatus:function(t,e,s){var a=this;setTimeout((function(){var i={job_type:"get_status"};i.version=d["u"][0].ver,i.job_id=e,i.timestamp=d["s"][0].time+"",i.paras={},Object(p["N"])(i).then((function(e){var s=e.error_info;if("done"===e.status||"failed"===e.status)if(clearInterval(t),"done"===e.status){var i={content:"表重分成功",timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};a.activities.push(i),a.getList()}else{var r={content:s,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(r)}})),s>=86400&&clearInterval(t)}),0)}}},_e=me,he=Object(f["a"])(_e,de,pe,!1,null,null,null),fe=he.exports,ge=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{id:"form",model:t.form,rules:t.rules,"label-width":"140px"}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"备份类型"}},[s("el-select",{attrs:{placeholder:"选择备份类型"},on:{change:function(e){return t.setbackupType(e)}},model:{value:t.backup_type,callback:function(e){t.backup_type=e},expression:"backup_type"}},t._l(t.backup_type_items,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._l(t.form.backup,(function(e,a){return s("el-row",{key:e.key},[s("el-col",{attrs:{span:10}},[s("el-form-item",{attrs:{label:"备份表:",prop:"backup."+a+".db_table",rules:{required:!0,message:"备份表不能为空",trigger:"blur"}}},[s("el-cascader",{key:"srcTable"+a,staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择 库名/模式/表",options:t.tableOptions,filterable:""},model:{value:t.form.backup[a].db_table,callback:function(e){t.$set(t.form.backup[a],"db_table",e)},expression:"form.backup[index].db_table"}})],1)],1),s("el-col",{attrs:{span:8}},[s("el-form-item",{attrs:{label:"备份时间范围:",prop:"backup."+a,rules:t.rules.time}},[s("el-time-select",{key:"startTime"+a,staticStyle:{width:"48%"},attrs:{placeholder:"起始时间","arrow-control":!0,"picker-options":{start:"00:00",step:"00:30",end:"24:00"}},model:{value:t.form.backup[a].startTime,callback:function(e){t.$set(t.form.backup[a],"startTime",e)},expression:"form.backup[index].startTime"}}),s("span",[t._v("-")]),s("el-time-select",{key:"endTime"+a,staticStyle:{width:"48%"},attrs:{placeholder:"结束时间","picker-options":{start:"00:00",step:"00:30",end:"24:00",minTime:t.form.backup[a].startTime}},model:{value:t.form.backup[a].endTime,callback:function(e){t.$set(t.form.backup[a],"endTime",e)},expression:"form.backup[index].endTime"}})],1)],1),s("el-col",{staticStyle:{"margin-top":"4px"},attrs:{span:4}},[s("div",{staticStyle:{"margin-left":"3px"}},[s("el-button",0===a?{attrs:{icon:"el-icon-plus",size:"small"},on:{click:function(e){return t.onPush(a)}}}:{attrs:{icon:"el-icon-minus",size:"small"},on:{click:function(e){return t.onRemove(a)}}})],1)])],1)})),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("保存")])],1)],2),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeRestoreDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)])],1)},ve=[],be={name:"LogicalBackup",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){if(""===e.startTime||""===e.endTime)return s(new Error("请选择备份时间范围"));s()};return{backup_type:"table",backup_type_items:[{item:"db",label:"db",value:"db"},{item:"schema",label:"schema",value:"schema"},{item:"table",label:"table",value:"table"}],form:{name:"",nick_name:"",backup:[{db_table:[],backup_time:"",startTime:"",endTime:""}],id:""},dialogStatusVisible:!1,activities:[],rules:{time:[{validator:t,trigger:"blur"}]},tableOptions:[],tableOptionsSource:[]}},mounted:function(){var t=this;this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id,Object(p["bb"])({cluster_id:this.form.id,all:"1"}).then((function(e){t.tableOptions=e.list,t.tableOptionsSource=JSON.stringify(e.list)}))},methods:{setbackupType:function(t){var e=this;switch(console.log(t),t){case"db":try{var s=JSON.parse(this.tableOptionsSource);this.tableOptions=[],s.forEach((function(t){t.children=null,e.tableOptions.push(t)}))}catch(i){}console.log(this.tableOptions);break;case"schema":try{var a=JSON.parse(this.tableOptionsSource);this.tableOptions=[],a.forEach((function(t){t.children.length>0&&t.children.forEach((function(t){t.children=null})),e.tableOptions.push(t),console.log(e.tableOptions)}))}catch(i){}break;case"table":try{this.tableOptions=JSON.parse(this.tableOptionsSource)}catch(i){}break}},beforeRestoreDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},onPush:function(t){this.form.backup.push({db_table:[],backup_time:"",startTime:"",endTime:""})},onRemove:function(t){this.form.backup.splice(t,1)},onSubmit:function(t){var e=this;console.info(this.form);var s=this;this.$refs["form"].validate((function(t){if(t){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.version=d["u"][0].ver,a.job_type="logical_backup",a.timestamp=d["s"][0].time+"";var i={},r=e.form.backup.map((function(t){return"table"==s.backup_type?{db_table:t.db_table[0]+"_$$_"+t.db_table[1]+"."+t.db_table[2],backup_time:t.startTime+":00-"+t.endTime+":00"}:"db"==s.backup_type?{db_table:t.db_table[0],backup_time:t.startTime+":00-"+t.endTime+":00"}:"schema"==s.backup_type?{db_table:t.db_table[0]+"_$$_"+t.db_table[1],backup_time:t.startTime+":00-"+t.endTime+":00"}:void 0}));i.cluster_id=e.form.id,i.backup_type=s.backup_type,i.backup=r,a.paras=i,console.info(a),Object(p["Db"])(a).then((function(t){if(200===t.code)if(e.$message.info("保存"),e.form.backup=[{db_table:[],backup_time:"",startTime:"",endTime:""}],"accept"===t.status){e.dialogRetreatedVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var s={content:"逻辑备份中...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(s);var a=0;e.timer=null,e.timer=setInterval((function(){e.getStatus(e.timer,t.job_id,a++)}),1e3)}else"ongoing"===t.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=t.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},getStatus:function(t,e,s){var a=this;setTimeout((function(){var i={job_type:"get_status",job_keyword:"logical_backup"};i.version=d["u"][0].ver,i.job_id=e,i.timestamp=d["s"][0].time+"",i.paras={},Object(p["N"])(i).then((function(e){var s=e.error_info;if("done"===e.status||"failed"===e.status)if(clearInterval(t),"done"===e.status){var i={content:"逻辑备份成功",timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};a.activities.push(i)}else{var r={content:s,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(r)}})),s>=86400&&clearInterval(t)}),0)}}},ye=be,xe=Object(f["a"])(ye,ge,ve,!1,null,null,null),we=xe.exports,ke=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{id:"form",model:t.form,rules:t.rules,"label-width":"140px"}},[s("el-form-item",{attrs:{label:"集群名称"}},[s("span",[t._v(t._s(t.form.name))])]),s("el-form-item",{attrs:{label:"业务名称"}},[s("span",[t._v(t._s(t.form.nick_name))])]),s("el-form-item",{attrs:{label:"恢复类型"}},[s("el-select",{attrs:{placeholder:"选择恢复类型"},on:{change:function(e){return t.setbackupType(e)}},model:{value:t.backup_type,callback:function(e){t.backup_type=e},expression:"backup_type"}},t._l(t.backup_type_items,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),s("el-form-item",{attrs:{label:"目标表集群:",prop:"dst_cluster_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择目标表集群"},on:{change:t.onDstClusterChange},model:{value:t.form.dst_cluster_id,callback:function(e){t.$set(t.form,"dst_cluster_id",e)},expression:"form.dst_cluster_id"}},t._l(t.clusterOptions,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t._l(t.form.backup,(function(e,a){return s("el-row",{key:e.key},[s("el-col",{attrs:{span:8}},[s("el-form-item",{attrs:{label:"备份记录:",prop:"backup."+a+".db_table",rules:{required:!0,message:"备份表不能为空",trigger:"blur"}}},[s("el-cascader",{key:"srcTable"+a,staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择 库名/模式/表",options:t.backupList,filterable:""},model:{value:t.form.backup[a].db_table,callback:function(e){t.$set(t.form.backup[a],"db_table",e)},expression:"form.backup[index].db_table"}})],1)],1),s("el-col",{attrs:{span:8}},[s("el-form-item",{attrs:{label:"开始时间:",prop:"backup."+a,rules:t.rules.time}},[s("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"起始时间"},model:{value:t.form.backup[a].startTime,callback:function(e){t.$set(t.form.backup[a],"startTime",e)},expression:"form.backup[index].startTime"}})],1)],1),"table"==t.backup_type||"schema"==t.backup_type?s("el-col",{attrs:{span:2}},[s("el-button",0===a?{attrs:{icon:"el-icon-plus",size:"small"},on:{click:function(e){return t.onPush(a)}}}:{attrs:{icon:"el-icon-minus",size:"small"},on:{click:function(e){return t.onRemove(a)}}})],1):t._e()],1)})),s("el-form-item",{staticStyle:{color:"red"},attrs:{label:"温馨提示:"}},[s("p",[t._v("1.开始时间不能大于当前系统时间。")]),s("p",[t._v("2.目标集群不存在和备份集群相同的table和schema。")])]),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit(t.form)}}},[t._v("保存")])],1)],2),s("el-dialog",{attrs:{visible:t.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px","close-on-click-modal":!1,"before-close":t.beforeRestoreDestory},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[s("div",{staticClass:"block"},[s("el-timeline",t._l(t.activities,(function(e,a){return s("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size,timestamp:e.timestamp}},[t._v(" "+t._s(e.content)+" ")])})),1)],1)])],1)},Se=[];function je(t){throw new TypeError('"'+t+'" is read-only')}var Oe={name:"LogicalBackup",props:{listsent:{typeof:Object}},data:function(){var t=function(t,e,s){if(""===e.startTime)return s(new Error("请选择备份时间范围"));s()},e=function(t,e,s){e?s():s(new Error("目标表集群不能为空"))};return{backup_type:"table",backup_type_items:[{item:"db",label:"db",value:"db"},{item:"schema",label:"schema",value:"schema"},{item:"table",label:"table",value:"table"}],form:{src_cluster_id:"",dst_cluster_id:"",name:"",nick_name:"",backup:[{db_table:[],backup_time:"",new_db_table:"",startTime:"",endTime:""}],id:"",clusterOptions:[]},dst_cluster_id:0,dialogStatusVisible:!1,activities:[],rules:{time:[{validator:t,trigger:"blur"}],dst_cluster_id:[{required:!0,validator:e,trigger:"blur"}]},tableOptions:[],backupList:[],backupListStr:null}},mounted:function(){var t=this;this.form.name=this.listsent.name,this.form.nick_name=this.listsent.nick_name,this.form.id=this.listsent.id,Object(p["bb"])({cluster_id:this.form.id,all:"1"}).then((function(e){t.tableOptions=e.list,t.tableOptionsSource=JSON.stringify(e.list)}));var e={cluster_id:this.form.id};Object(p["j"])(e).then((function(e){t.clusterOptions=e.list})),this.toGetLogicalBackUpRecordList(this.backup_type)},methods:{toGetLogicalBackUpRecordList:function(t){var e=this;Object(p["R"])({cluster_id:this.form.id,type:t}).then((function(t){console.log(t),e.backupListStr=JSON.stringify(t.list);try{e.backupList=t.list["table"]}catch(s){}}))},setbackupType:function(t){this.toGetLogicalBackUpRecordList(t)},beforeRestoreDestory:function(){clearInterval(this.timer),this.dialogStatusVisible=!1,this.timer=null},onDstClusterChange:function(t){console.log(t),this.dst_cluster_id=t},onPush:function(t){this.form.backup.push({db_table:[],backup_time:"",startTime:"",endTime:""})},onRemove:function(t){this.form.backup.splice(t,1)},onSubmit:function(t){var e=this;console.info(this.form);var s=this;this.$refs["form"].validate((function(t){if(t){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.version=d["u"][0].ver,a.job_type="logical_restore",a.timestamp=d["s"][0].time+"";var i={},r=e.repeatObject(e.form.backup,"db_table");if(null!==r)return e.message_tips="备份记录不能重复选择",e.message_type="error",void Object(l["g"])(e.message_tips,e.message_type);var o=e.form.backup.map((function(t){return"table"==s.backup_type||"db"==s.backup_type||"schema"==s.backup_type?{db_table:t.db_table[0].substr(0,t.db_table[0].indexOf("(")),restore_time:t.startTime}:void 0}));i.cluster_id=e.form.id,i.restore_type=s.backup_type,i.src_cluster_id=e.form.id,i.dst_cluster_id=s.form.dst_cluster_id,i.restore=o,a.paras=i,console.info(a),Object(p["Db"])(a).then((function(t){if(200===t.code&&(e.form.backup=[{db_table:[],backup_time:"",startTime:"",endTime:""}]),"accept"===t.status){e.dialogRetreatedVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var s={content:"逻辑恢复中...",timestamp:Object(l["d"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(s);var a=0;e.timer=null,e.timer=setInterval((function(){e.getStatus(e.timer,t.job_id,a++)}),1e3)}else"ongoing"===t.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error",Object(l["g"])(e.message_tips,e.message_type)):(e.message_tips=t.error_info,e.message_type="error",Object(l["g"])(e.message_tips,e.message_type))}))}}))},repeatObject:function(t,e){for(var s=0,a=t.length,i=new Array,r=new Array,o=0,n=0;o<a;o++){var l=t[o][e];i[l]?(r[n]=l,s=1,n++):i[l]=1}return 1==s?r:null},getStatus:function(t,e,s){var a=this;setTimeout((function(){var i={job_type:"get_status"};i.version=d["u"][0].ver,i.job_id=e,i.timestamp=d["s"][0].time+"",i.paras={},Object(p["N"])(i).then((function(e){var s=e.error_info;if("done"===e.status||"failed"===e.status)if(clearInterval(t),"done"===e.status){var i={content:"逻辑恢复成功",timestamp:Object(l["d"])(),color:"#0bbd87",icon:"el-icon-circle-check"};a.activities.push(i)}else{if(e.attachment.fail_dts){for(var r=0;r<e.attachment.fail_dts.length;r++)e.attachment.fail_dts[r].host+e.attachment.fail_dts[r].db_table+e.attachment.fail_dts[r].errmsg+";";je("error_info")}var o={content:s,timestamp:Object(l["d"])(),color:"red",icon:"el-icon-circle-close"};a.activities.push(o)}})),s>=86400&&clearInterval(t)}),0)}}},Le=Oe,Ie=Object(f["a"])(Le,ke,Se,!1,null,null,null),Ce=Ie.exports,$e=s("8cdb"),Ne={components:{CompList:A,CommonSet:X,AllBackeUp:at,Expansion:ct,Restore:ht,SwitchOver:xt,BackUp:Lt,StandbySwitch:Et,ShardList:Rt,RedoMachine:Jt,SetAlarmTime:Xt,SetVariable:ae,GetVariable:ce,TableRepartition:fe,LogicalBackup:we,LogicalRecv:Ce,Error:$e["default"]},props:{oneList:{typeof:Object}},data:function(){return{listsent:[],componted:"CommonSet",restore_priv:JSON.parse(sessionStorage.getItem("priv")).restore_priv,expand_cluster_priv:JSON.parse(sessionStorage.getItem("priv")).expand_cluster_priv,user_name:sessionStorage.getItem("login_username")}},created:function(){this.listsent=this.oneList},methods:{selected:function(t){this.componted="1"===t?"CommonSet":"2"===t?"AllBackeUp":"3"===t?"BackUp":"4"===t?"Restore":"5"===t?"Expansion":"6"===t?"StandbySwitch":"7"===t?"SwitchOver":"8"===t?"RedoMachine":"9"===t?"ShardList":"10"===t?"CompList":"11"===t?"SetAlarmTime":"12"===t?"SetVariable":"13"===t?"GetVariable":"14"===t?"TableRepartition":"15"===t?"LogicalBackup":"16"===t?"LogicalRecv":"Error"},clusterId:function(t){this.$emit("getId",t)}}},Ve=Ne,Ee=(s("53c6"),Object(f["a"])(Ve,P,M,!1,null,null,null)),Te=Ee.exports,De={components:{List:v,Cshow:$,ErrorList:F,OneClusterList:Te},data:function(){return{activeName:"second",tabs:{first:!1,second:!0,three:!1,four:!1},InfoList:[],cluster_id:"",editableTabs:[],active:"",clusterTab:{editableTabs:[],active:""}}},methods:{removeTab:function(t){var e=this.editableTabs,s=this.activeName;s===t&&e.forEach((function(a,i){if(a.name===t){var r=e[i+1]||e[i-1];s=r?r.name:"second"}})),this.activeName=s,this.editableTabs=e.filter((function(e){return e.name!==t})),"second"==this.activeName&&(this.tabs.second=!0),this.clusterTab={active:this.active,editableTabs:this.editableTabs}},handleClick:function(t){switch(this.activeName=t.name,this.activeName){case"first":this.switchTab("first");break;case"second":this.switchTab("second");break;case"three":this.switchTab("three");break;default:this.switchTab(this.activeName)}},switchTab:function(t){for(var e in this.tabs)this.tabs[e]=e===t},updateActiveName:function(t){this.activeName=t.activeName,this.InfoList=t.list,this.cluster_id=t.list.id+"集群设置","four"==this.activeName&&(this.tabs.four=!0,this.tabs.second=!1);var e=0;t.tab.forEach((function(s,a){s.name===t.list.id+""&&(e=a)})),this.activeName=t.tab[e].name,this.editableTabs=t.tab,this.clusterTab={active:this.active,editableTabs:this.editableTabs},console.log(this.editableTabs)},clusterId:function(t){this.removeTab(t),this.tabs.second=!0,this.active="delcluster"}}},Fe=De,Pe=(s("6a4f"),Object(f["a"])(Fe,a,i,!1,null,"14f00ef4",null));e["default"]=Pe.exports},"40e9":function(t,e,s){"use strict";s("ca45")},"43ab":function(t,e,s){},"466d":function(t,e,s){"use strict";var a=s("d784"),i=s("825a"),r=s("50c4"),o=s("1d80"),n=s("8aa5"),l=s("14c3");a("match",1,(function(t,e,s){return[function(e){var s=o(this),a=void 0==e?void 0:e[t];return void 0!==a?a.call(e,s):new RegExp(e)[t](String(s))},function(t){var a=s(e,t,this);if(a.done)return a.value;var o=i(t),c=String(this);if(!o.global)return l(o,c);var d=o.unicode;o.lastIndex=0;var p,u=[],m=0;while(null!==(p=l(o,c))){var _=String(p[0]);u[m]=_,""===_&&(o.lastIndex=n(c,r(o.lastIndex),d)),m++}return 0===m?null:u}]}))},5339:function(t,e,s){},"53c6":function(t,e,s){"use strict";s("cd59")},"578c":function(t,e,s){},"5b64":function(t,e,s){},"5fdc":function(t,e,s){},"65fa":function(t,e,s){"use strict";s("34a1")},"6a4f":function(t,e,s){"use strict";s("5b64")},"7d36":function(t,e,s){},8250:function(t,e,s){"use strict";s("5339")},"8cdb":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wscn-http404-container"},[s("div",{staticClass:"wscn-http404"},[t._m(0),s("div",{staticClass:"bullshit"},[s("div",{staticClass:"bullshit__oops"},[t._v("OOPS!")]),t._m(1),s("div",{staticClass:"bullshit__headline"},[t._v(t._s(t.message))]),s("div",{staticClass:"bullshit__info"},[t._v("Please check that the URL you entered is correct, or click the button below to return to the homepage.")]),s("a",{staticClass:"bullshit__return-home",attrs:{href:""}},[t._v("Back to home")])])])])},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pic-404"},[a("img",{staticClass:"pic-404__parent",attrs:{src:s("a36b"),alt:"404"}}),a("img",{staticClass:"pic-404__child left",attrs:{src:s("26fc"),alt:"404"}}),a("img",{staticClass:"pic-404__child mid",attrs:{src:s("26fc"),alt:"404"}}),a("img",{staticClass:"pic-404__child right",attrs:{src:s("26fc"),alt:"404"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bullshit__info"},[t._v("All rights reserved "),s("a",{staticStyle:{color:"#20a0ff"},attrs:{href:"https://wallstreetcn.com",target:"_blank"}},[t._v("wallstreetcn")])])}],r={name:"Page404",computed:{message:function(){return"The webmaster said that you can not enter this page..."}}},o=r,n=(s("0a5f"),s("2877")),l=Object(n["a"])(o,a,i,!1,null,"c095f994",null);e["default"]=l.exports},"9c15":function(t,e,s){"use strict";s("578c")},a15b:function(t,e,s){"use strict";var a=s("23e7"),i=s("44ad"),r=s("fc6a"),o=s("a640"),n=[].join,l=i!=Object,c=o("join",",");a({target:"Array",proto:!0,forced:l||!c},{join:function(t){return n.call(r(this),void 0===t?",":t)}})},a1fa:function(t,e,s){"use strict";s("7d36")},a36b:function(t,e,s){t.exports=s.p+"static/img/404.1685410821547.png"},bde3:function(t,e,s){},ca45:function(t,e,s){},cd59:function(t,e,s){},d026:function(t,e,s){"use strict";s("161c")},d13a:function(t,e,s){"use strict";s("5fdc")},de65:function(t,e,s){"use strict";s.d(e,"n",(function(){return i})),s.d(e,"m",(function(){return r})),s.d(e,"p",(function(){return o})),s.d(e,"c",(function(){return n})),s.d(e,"r",(function(){return l})),s.d(e,"e",(function(){return c})),s.d(e,"d",(function(){return d})),s.d(e,"l",(function(){return p})),s.d(e,"a",(function(){return u})),s.d(e,"q",(function(){return m})),s.d(e,"j",(function(){return _})),s.d(e,"b",(function(){return h})),s.d(e,"g",(function(){return f})),s.d(e,"i",(function(){return g})),s.d(e,"h",(function(){return v})),s.d(e,"o",(function(){return b})),s.d(e,"k",(function(){return y})),s.d(e,"f",(function(){return x}));var a=s("b775");function i(t){return Object(a["a"])({url:"/user/RCR/getRCRList",method:"get",params:t})}function r(){return Object(a["a"])({url:"/user/RCR/getMetaMachine",method:"get",params:""})}function o(t){return Object(a["a"])({url:"/user/RCR/getStandbyMeta",method:"post",data:t})}function n(t){return Object(a["a"])({url:"/user/RCR/createRCR",method:"post",data:t})}function l(t){return Object(a["a"])({url:"/user/RCR/editMachine",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/user/RCR/deleteMachine",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/user/RCR/createMetaTable",method:"post",data:t})}function p(t){return Object(a["a"])({url:"/user/RCR/getMetaList",method:"get",params:t})}function u(t){return Object(a["a"])({url:"/user/RCR/deleteMachine",method:"post",data:t})}function m(t){return Object(a["a"])({url:"/user/RCR/setRCRMaxDalay",method:"post",data:t})}function _(t){return Object(a["a"])({url:"/user/RCR/findName",method:"get",params:t})}function h(t){return Object(a["a"])({url:"/user/RCR/addMetaList",method:"post",data:t})}function f(t){return Object(a["a"])({url:"/user/RCR/deleteMeta",method:"post",data:t})}function g(t){return Object(a["a"])({url:"/user/RCR/findMetaDB",method:"get",params:t})}function v(t){return Object(a["a"])({url:"/user/RCR/findMetaCluster",method:"post",data:t})}function b(t){return Object(a["a"])({url:"/user/RCR/getRCRRelater",method:"get",params:t})}function y(t){return Object(a["a"])({url:"/user/RCR/findRcrRelat",method:"get",params:t})}function x(t){return Object(a["a"])({url:"/user/RCR/delRCRMaxDalayInfo",method:"post",data:t})}},e019:function(t,e,s){"use strict";s("3086")},e9c4:function(t,e,s){var a=s("23e7"),i=s("d066"),r=s("d039"),o=i("JSON","stringify"),n=/[\uD800-\uDFFF]/g,l=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,d=function(t,e,s){var a=s.charAt(e-1),i=s.charAt(e+1);return l.test(t)&&!c.test(i)||c.test(t)&&!l.test(a)?"\\u"+t.charCodeAt(0).toString(16):t},p=r((function(){return'"\\udf06\\ud834"'!==o("\udf06\ud834")||'"\\udead"'!==o("\udead")}));o&&a({target:"JSON",stat:!0,forced:p},{stringify:function(t,e,s){var a=o.apply(null,arguments);return"string"==typeof a?a.replace(n,d):a}})},efdb:function(t,e,s){},f828:function(t,e,s){"use strict";s("bde3")}}]);