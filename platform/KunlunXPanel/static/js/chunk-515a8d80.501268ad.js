(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-515a8d80"],{"0ccb":function(e,t,r){var a=r("50c4"),i=r("1148"),n=r("1d80"),o=Math.ceil,s=function(e){return function(t,r,s){var l,c,u=String(n(t)),d=u.length,p=void 0===s?" ":String(s),f=a(r);return f<=d||""==p?u:(l=f-d,c=i.call(p,o(l/p.length)),c.length>l&&(c=c.slice(0,l)),e?u+c:c+u)}};e.exports={start:s(!1),end:s(!0)}},"105c":function(e,t,r){},1148:function(e,t,r){"use strict";var a=r("a691"),i=r("1d80");e.exports="".repeat||function(e){var t=String(i(this)),r="",n=a(e);if(n<0||n==1/0)throw RangeError("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r}},"333d":function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[r("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},i=[];r("a9e3");Math.easeInOutQuad=function(e,t,r,a){return e/=a/2,e<1?r/2*e*e+t:(e--,-r/2*(e*(e-2)-1)+t)};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function o(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function s(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function l(e,t,r){var a=s(),i=e-a,l=20,c=0;t="undefined"===typeof t?500:t;var u=function e(){c+=l;var s=Math.easeInOutQuad(c,a,i,t);o(s),c<t?n(e):r&&"function"===typeof r&&r()};u()}var c={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&l(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&l(0,800)}}},u=c,d=(r("c3ac"),r("2877")),p=Object(d["a"])(u,a,i,!1,null,"65877abe",null);t["a"]=p.exports},"4d90":function(e,t,r){"use strict";var a=r("23e7"),i=r("0ccb").start,n=r("9a0c");a({target:"String",proto:!0,forced:n},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"53ca":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0");function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}},"9a0c":function(e,t,r){var a=r("342f");e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a)},a15b:function(e,t,r){"use strict";var a=r("23e7"),i=r("44ad"),n=r("fc6a"),o=r("a640"),s=[].join,l=i!=Object,c=o("join",",");a({target:"Array",proto:!0,forced:l||!c},{join:function(e){return s.call(n(this),void 0===e?",":e)}})},a9e3:function(e,t,r){"use strict";var a=r("83ab"),i=r("da84"),n=r("94ca"),o=r("6eeb"),s=r("5135"),l=r("c6b6"),c=r("7156"),u=r("c04e"),d=r("d039"),p=r("7c73"),f=r("241c").f,g=r("06cf").f,m=r("9bf2").f,h=r("58a8").trim,v="Number",_=i[v],b=_.prototype,y=l(p(b))==v,w=function(e){var t,r,a,i,n,o,s,l,c=u(e,!1);if("string"==typeof c&&c.length>2)if(c=h(c),t=c.charCodeAt(0),43===t||45===t){if(r=c.charCodeAt(2),88===r||120===r)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:a=2,i=49;break;case 79:case 111:a=8,i=55;break;default:return+c}for(n=c.slice(2),o=n.length,s=0;s<o;s++)if(l=n.charCodeAt(s),l<48||l>i)return NaN;return parseInt(n,a)}return+c};if(n(v,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var k,S=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof S&&(y?d((function(){b.valueOf.call(r)})):l(r)!=v)?c(new _(w(t)),r,S):w(t)},N=a?f(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Y=0;N.length>Y;Y++)s(_,k=N[Y])&&!s(S,k)&&m(S,k,g(_,k));S.prototype=b,b.constructor=S,o(i,v,S)}},b85c:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0"),r("fb6a"),r("b0c0"),r("a630"),r("ac1f"),r("00b4");function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function i(e,t){if(e){if("string"===typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function n(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r["return"]||r["return"]()}finally{if(l)throw o}}}}},c3ac:function(e,t,r){"use strict";r("105c")},ed08:function(e,t,r){"use strict";r.d(t,"e",(function(){return i})),r.d(t,"d",(function(){return n})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return l}));r("53ca"),r("ac1f"),r("00b4"),r("5319"),r("4d63"),r("2c3e"),r("25f0"),r("d3b7"),r("4d90"),r("1276"),r("159b");var a=r("5c96");function i(e,t){return Object(a["Message"])({message:e,type:t,duration:2e3})}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"确定执行此操作吗？",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";return a["MessageBox"].confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:t,center:!0})}function o(e){var t=e.split("T");return t[0]+" "+t[1]}function s(){var e=new Date,t="-",r=":",a=e.getFullYear(),i=e.getMonth()+1,n=e.getDate(),o=e.getHours(),s=e.getMinutes(),l=e.getSeconds(),c=["星期一","星期二","星期三","星期四","星期五","星期六","星期天"];c[e.getDay()];i>=1&&i<=9&&(i="0"+i),n>=0&&n<=9&&(n="0"+n),o>=0&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s),l>=0&&l<=9&&(l="0"+l);var u=a+t+i+t+n+" "+o+r+s+r+l;return u}function l(e){var t=e.split("-"),r=t[0],a=t[1],i=t[2],n=new Date(r,a,0);n=n.getDate();var o=r,s=parseInt(a)+1;13==s&&(o=parseInt(o)+1,s=1);var l=i,c=new Date(o,s,0);c=c.getDate(),l>c&&(l=c),s<10&&(s="0"+s);var u=o+"-"+s+"-"+l;return u}},f982:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"filter-container"},[r("div",{directives:[{name:"show",rawName:"v-show",value:"Y"===e.role_add_priv,expression:"role_add_priv==='Y'"}],staticClass:"table-list-wrap"},[r("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v("新增")])],1)]),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.list,border:"","highlight-current-row":""}},[e._v(" > "),r("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),r("el-table-column",{attrs:{label:"角色名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("span",{staticClass:"link-type",on:{click:function(t){return e.handleDetail(a)}}},[e._v(e._s(a.role_name))])]}}])}),r("el-table-column",{attrs:{prop:"priv",align:"center","show-overflow-tooltip":!0,label:"拥有权限"}}),r("el-table-column",{attrs:{prop:"update_time",align:"center",label:"更新时间"}}),"Y"===e.role_edit_priv&&"Y"===e.role_drop_priv?r("el-table-column",{attrs:{label:"操作",align:"center",width:"230","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,i=t.$index;return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:"Y"===e.role_edit_priv&&"super_dba"!==a.role_name,expression:"role_edit_priv==='Y'&&row.role_name!=='super_dba'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleUpdate(a)}}},[e._v("编辑")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:"Y"===e.role_drop_priv&&"super_dba"!==a.role_name,expression:"role_drop_priv==='Y'&&row.role_name!=='super_dba'"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a,i)}}},[e._v("删除")])]}}],null,!1,1309684686)}):e._e()],1),r("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.pageNo,limit:e.listQuery.pageSize},on:{"update:page":function(t){return e.$set(e.listQuery,"pageNo",t)},"update:limit":function(t){return e.$set(e.listQuery,"pageSize",t)},pagination:e.getList}}),r("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"dataForm",attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"110px"}},[r("el-form-item",{attrs:{label:"角色名称:",prop:"role_name"}},[r("el-input",{attrs:{placeholder:"请输入角色名称",disabled:"detail"===e.dialogStatus||"super_dba"==e.temp.role_name},model:{value:e.temp.role_name,callback:function(t){e.$set(e.temp,"role_name",t)},expression:"temp.role_name"}})],1),r("el-form-item",{attrs:{label:"拥有权限:",prop:"checkkeys",disabled:"detail"===e.dialogStatus}},[r("el-tree",{ref:"tree",attrs:{data:e.datatree,"show-checkbox":"","node-key":"id","default-expanded-keys":[3],"default-checked-keys":e.checkkeys,props:e.defaultProps1}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.dialogDetail,expression:"!dialogDetail"}],on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("关闭")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.dialogDetail,expression:"!dialogDetail"}],attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createData():e.updateData(e.row)}}},[e._v("确认")])],1)],1)],1)},i=[],n=r("b85c"),o=r("1da1"),s=(r("96cf"),r("a15b"),r("d3b7"),r("25f0"),r("ed08")),l=r("3528"),c=r("333d"),u=r("578a"),d={name:"role",components:{Pagination:c["a"]},data:function(){return{tableKey:0,list:null,listLoading:!0,total:0,listQuery:{pageNo:1,pageSize:10},temp:{role_name:"",priv:{}},dialogFormVisible:!1,dialogEditVisible:!1,dialogStatus:"",textMap:{update:"编辑角色",create:"新增角色",detail:"详情",grant:"授权"},dialogDetail:!1,message_tips:"",message_type:"",role_type_data:u["h"],valid_period_data:u["l"],priv_type_arr:u["g"],checkedGrant:[],rolesData:[],role_add_priv:JSON.parse(sessionStorage.getItem("priv")).role_add_priv,role_drop_priv:JSON.parse(sessionStorage.getItem("priv")).role_drop_priv,role_edit_priv:JSON.parse(sessionStorage.getItem("priv")).role_edit_priv,row:{},datatree:u["a"],defaultProps1:{children:"children",label:"label"},rules:{role_name:[{required:!0,message:"请输入角色名称!",trigger:"blur"}]},rolId:"",routesData:[],checkedNodes:[],defaultProps:{children:"children",label:"slotTitle"},routes:[],checkkeys:[]}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.listLoading=!0;var t=Object.assign({},this.listQuery);t.user_name=sessionStorage.getItem("login_username"),t.roleName="*".concat(this.listQuery.roleName,"*"),Object(l["f"])(t).then((function(t){for(var r=t.list,a=0;a<r.length;a++){var i="";"Y"==r[a].backup_priv&&(i+="备份集群,"),"Y"==r[a].cluster_creata_priv&&(i+="新增集群,"),"Y"==r[a].cluster_drop_priv&&(i+="删除集群,"),"Y"==r[a].compute_disable_priv&&"Y"==r[a].compute_enable_priv&&(i+="启/禁用计算节点,"),"Y"==r[a].compute_node_create_priv&&(i+="新增计算节点,"),"Y"==r[a].compute_node_drop_priv&&(i+="删除计算节点,"),"Y"==r[a].machine_add_priv&&(i+="新增计算机,"),"Y"==r[a].machine_drop_priv&&(i+="删除计算机,"),"Y"==r[a].machine_priv&&(i+="编辑计算机,"),"Y"==r[a].restore_priv&&(i+="恢复集群,"),"Y"==r[a].role_add_priv&&(i+="新增角色,"),"Y"==r[a].role_drop_priv&&(i+="删除角色,"),"Y"==r[a].role_edit_priv&&(i+="编辑角色,"),"Y"==r[a].shard_create_priv&&(i+="新增存储shard,"),"Y"==r[a].shard_drop_priv&&(i+="删除存储shard,"),"Y"==r[a].shrink_cluster_priv&&(i+="集群缩容,"),"Y"==r[a].expand_cluster_priv&&(i+="集群扩容,"),"Y"==r[a].backup_service_disable_priv&&"Y"==r[a].backup_service_enable_priv&&(i+="启/禁用备份服务,"),"Y"==r[a].storage_disable_priv&&"Y"==r[a].storage_enable_priv&&(i+="启/禁用存储节点,"),"Y"==r[a].storage_node_create_priv&&(i+="新增存储节点,"),"Y"==r[a].storage_node_drop_priv&&(i+="删除存储节点,"),"Y"==r[a].user_add_priv&&(i+="新增用户,"),"Y"==r[a].user_drop_priv&&(i+="删除用户,"),"Y"==r[a].user_edit_priv&&(i+="编辑用户,"),"Y"==r[a].user_grant_priv&&(i+="用户授权,"),i=i.substring(0,i.length-1),e.$set(r[a],"priv",i)}e.list=r,e.total=t.total,setTimeout((function(){e.listLoading=!1}),500)}))},resetTemp:function(){this.temp={role_name:"",priv:{}}},handleCreate:function(){var e=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.dialogDetail=!1,this.$nextTick((function(){e.$refs.dataForm.clearValidate(),e.$refs.tree.setCheckedKeys([])}))},createData:function(){var e=this,t=this.$refs.tree.getCheckedKeys(),r={permissionIds:t.join(",")};this.temp.priv=r,this.$refs["dataForm"].validate((function(t){t&&Object(l["a"])(e.temp).then((function(t){var r=t;200==r.code?(e.getList(),e.dialogFormVisible=!1,e.message_tips="新增成功",e.message_type="success"):(e.message_tips=r.message,e.message_type="error"),Object(s["e"])(e.message_tips,e.message_type)}))}))},handleDetail:function(e){var t=this;this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},e),this.dialogDetail=!0,Object(l["e"])(e.id).then((function(e){t.checkkeys=e.list[0].checkkeys,t.$nextTick((function(){t.$refs.tree.setCheckedKeys(t.checkkeys)}))}))},handleUpdate:function(e){var t=this;Object(l["e"])(e.id).then((function(e){t.checkkeys=e.list[0].checkkeys,t.dialogEditVisible=!0,t.$nextTick((function(){t.$refs.tree.setCheckedKeys(t.checkkeys)}))})),this.temp=Object.assign({},e),this.temp.id=e.id,this.dialogStatus="update",this.dialogFormVisible=!0,this.dialogDetail=!1,this.$nextTick((function(){t.$refs["dataForm"].clearValidate()}))},updateData:function(e){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var r=t.$refs.tree.getCheckedKeys(),a={permissionIds:r.join(",")};t.temp.priv=a;var i=Object.assign({},t.temp);console.log(i),Object(l["g"])(i).then((function(e){var r=e;200==r.code?(t.dialogFormVisible=!1,t.message_tips="编辑成功",t.message_type="success",t.getList()):(t.message_tips=r.message,t.message_type="error"),Object(s["e"])(t.message_tips,t.message_type)}))}}))},handleDelete:function(e){var t=this;Object(s["d"])("此操作将永久删除该数据, 是否继续?").then((function(){Object(l["b"])(e.id).then((function(e){var r=e;200==r.code?(t.dialogFormVisible=!1,t.message_tips="删除成功",t.message_type="success",t.getList()):(t.message_tips=r.message,t.message_type="error"),Object(s["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(s["e"])("已取消删除","info")}))},handleEdit:function(e){var t=this;this.resetTemp(),this.dialogStatus="grant",this.dialogFormVisible=!0,this.dialogDetail=!1,this.$nextTick((function(){t.$refs.dataForm.clearValidate()}))},savePermission:function(){var e=this,t=this.$refs.tree.getCheckedKeys(),r={roleId:this.rolId,permissionIds:t.join(","),lastpermissionIds:this.checkedNodes.join(",")};console.log(r),saveRolePermission(r).then((function(t){var r=t;200==r.code?(e.getList(),e.dialogEditVisible=!1,e.message_tips="编辑成功",e.message_type="success"):(e.message_tips=r.message,e.message_type="error"),Object(s["e"])(e.message_tips,e.message_type)}))},getRoutes:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,getRoutes();case 2:r=t.sent,e.routesData=getTreeData(r.result.treeList);case 4:case"end":return t.stop()}}),t)})))()})),handleRoleType:function(e){var t,r="",a=Object(n["a"])(u["h"]);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(e.role_name==i["value"]){r=i["label"];break}r=e.role_name}}catch(o){a.e(o)}finally{a.f()}return r},handleEffectTime:function(e){var t,r="",a=Object(n["a"])(u["l"]);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(e.valid_period==i["value"]){r=i["label"];break}r=e.valid_period}}catch(o){a.e(o)}finally{a.f()}return r},handleStartTime:function(e){var t="";return t="0000-00-00 00:00:00"==e.start_ts?"":e.start_ts,t},handleEndTime:function(e){var t="";return t="0000-00-00 00:00:00"==e.end_ts?"":e.end_ts,t},formatDataTimeTotime:function(e){return Object(s["a"])(e)}}},p=d,f=r("2877"),g=Object(f["a"])(p,a,i,!1,null,null,null);t["default"]=g.exports}}]);