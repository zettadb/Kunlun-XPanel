(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8dd1f68a"],{"0ccb":function(e,t,a){var r=a("50c4"),i=a("1148"),s=a("1d80"),o=Math.ceil,n=function(e){return function(t,a,n){var l,c,d=String(s(t)),u=d.length,p=void 0===n?" ":String(n),m=r(a);return m<=u||""==p?d:(l=m-u,c=i.call(p,o(l/p.length)),c.length>l&&(c=c.slice(0,l)),e?d+c:c+d)}};e.exports={start:n(!1),end:n(!0)}},"105c":function(e,t,a){},1148:function(e,t,a){"use strict";var r=a("a691"),i=a("1d80");e.exports="".repeat||function(e){var t=String(i(this)),a="",s=r(e);if(s<0||s==1/0)throw RangeError("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(t+=t))1&s&&(a+=t);return a}},"333d":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[a("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},i=[];a("a9e3");Math.easeInOutQuad=function(e,t,a,r){return e/=r/2,e<1?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t)};var s=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function o(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function n(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function l(e,t,a){var r=n(),i=e-r,l=20,c=0;t="undefined"===typeof t?500:t;var d=function e(){c+=l;var n=Math.easeInOutQuad(c,r,i,t);o(n),c<t?s(e):a&&"function"===typeof a&&a()};d()}var c={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&l(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&l(0,800)}}},d=c,u=(a("c3ac"),a("2877")),p=Object(u["a"])(d,r,i,!1,null,"65877abe",null);t["a"]=p.exports},3520:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"icons-container"},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"集群展示",name:"first"}},[e.tabs.first?a("Cshow"):e._e()],1),a("el-tab-pane",{attrs:{label:"集群列表信息",name:"second"}},[e.tabs.second?a("List"):e._e()],1)],1)],1)},i=[],s=(a("b0c0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("div",{staticClass:"table-list-search-wrap"},[a("el-input",{staticClass:"list_search_keyword",attrs:{placeholder:"可输入集群名称搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}}),a("el-button",{attrs:{icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v(" 查询 ")]),a("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:e.handleClear}},[e._v(" 重置 ")]),"Y"===e.cluster_creata_priv?a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v("新增")]):e._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:!0===e.installStatus,expression:"installStatus===true"}],staticClass:"info",domProps:{textContent:e._s(e.info)}})],1)]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.list,border:"","highlight-current-row":""}},[a("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"50"}}),a("el-table-column",{attrs:{label:"集群名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticClass:"link-type",on:{click:function(t){return e.handleDetail(r)}}},[e._v(e._s(r.nick_name))])]}}])}),a("el-table-column",{attrs:{prop:"ha_mode",align:"center",label:"高可用模式"}}),a("el-table-column",{attrs:{prop:"comptotal",align:"center",label:"计算节点总数"}}),a("el-table-column",{attrs:{prop:"shardtotal",align:"center",label:"shard分配","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"back_up",align:"center",label:"最近备份时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[""===t.row.first_backup?a("span",[e._v("无备份")]):""!==t.row.first_backup?a("span",[e._v(e._s(t.row.first_backup))]):e._e()]}}])}),"Y"===e.storage_node_create_priv||"Y"===e.shard_create_priv||"Y"===e.compute_node_create_priv||"Y"===e.restore_priv||"Y"===e.backup_priv||"Y"===e.cluster_drop_priv||"rbr"===e.row.ha_mode?a("el-table-column",{attrs:{label:"操作",align:"center",width:"350","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,i=t.$index;return["Y"===e.storage_node_create_priv&&"Y"===e.shard_create_priv&&"Y"===e.compute_node_create_priv?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleUpdate(r)}}},[e._v("+")]):e._e(),"Y"===e.restore_priv?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleRestore(r)}}},[e._v("恢复")]):e._e(),"Y"===e.backup_priv?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleBackUp(r,i)}}},[e._v("备份")]):e._e(),"rbr"===r.ha_mode?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleSwitchOver(r,i)}}},[e._v("主备切换")]):e._e(),"Y"===e.cluster_drop_priv?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r,i)}}},[e._v("删除")]):e._e()]}}],null,!1,1218546990)}):e._e()],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.pageNo,limit:e.listQuery.pageSize},on:{"update:page":function(t){return e.$set(e.listQuery,"pageNo",t)},"update:limit":function(t){return e.$set(e.listQuery,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"250px"}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===e.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"集群名称:",prop:"nick_name"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入集群名称",disabled:"detail"===e.dialogStatus},model:{value:e.temp.nick_name,callback:function(t){e.$set(e.temp,"nick_name",t)},expression:"temp.nick_name"}})],1),"create"===e.dialogStatus?a("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[a("el-checkbox-group",{attrs:{min:e.minMachine,max:e.machineTotal},model:{value:e.temp.machinelist,callback:function(t){e.$set(e.temp,"machinelist",t)},expression:"temp.machinelist"}},e._l(e.machines,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.hostaddr}},[e._v(e._s(t.hostaddr))])})),1)],1):e._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===e.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"高可用模式:",prop:"ha_mode"}},[a("el-select",{attrs:{placeholder:"请选择高可用模式",disabled:"detail"===e.dialogStatus},model:{value:e.temp.ha_mode,callback:function(t){e.$set(e.temp,"ha_mode",t)},expression:"temp.ha_mode"}},e._l(e.hamodeData,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"create"===e.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}]},[a("el-form-item",{attrs:{label:"shard个数:",prop:"shards_count"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入shard个数",disabled:"detail"===e.dialogStatus},model:{value:e.temp.shards_count,callback:function(t){e.$set(e.temp,"shards_count",t)},expression:"temp.shards_count"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("个")])])],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===e.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"副本数:",prop:"snode_count"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"副本数至少是3，且不能大于所选计算机数",disabled:"detail"===e.dialogStatus},model:{value:e.temp.snode_count,callback:function(t){e.$set(e.temp,"snode_count",t)},expression:"temp.snode_count"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("个")])])],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"create"===e.dialogStatus||"detail",expression:"dialogStatus==='create'||'detail'"}],attrs:{label:"缓冲池大小:",prop:"buffer_pool"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"缓冲池大小单位为GB",disabled:"detail"===e.dialogStatus},model:{value:e.temp.buffer_pool,callback:function(t){e.$set(e.temp,"buffer_pool",t)},expression:"temp.buffer_pool"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("GB")])])],1),"create"===e.dialogStatus?a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}]},[a("el-form-item",{attrs:{label:"每个计算节点最大连接数:",prop:"max_connections"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点最大连接数"},model:{value:e.temp.max_connections,callback:function(t){e.$set(e.temp,"max_connections",t)},expression:"temp.max_connections"}})],1),a("el-form-item",{attrs:{label:"每个计算节点的cpu核数:",prop:"per_computing_node_cpu_cores"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点的cpu核数"},model:{value:e.temp.per_computing_node_cpu_cores,callback:function(t){e.$set(e.temp,"per_computing_node_cpu_cores",t)},expression:"temp.per_computing_node_cpu_cores"}})],1),a("el-form-item",{attrs:{label:"每个计算节点最大的存储值:",prop:"per_computing_node_max_mem_size"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个计算节点最大的存储值"},model:{value:e.temp.per_computing_node_max_mem_size,callback:function(t){e.$set(e.temp,"per_computing_node_max_mem_size",t)},expression:"temp.per_computing_node_max_mem_size"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("MB")])])],1),a("el-form-item",{attrs:{label:"每个存储节点的cpu核数:",prop:"per_storage_node_cpu_cores"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点的cpu核数"},model:{value:e.temp.per_storage_node_cpu_cores,callback:function(t){e.$set(e.temp,"per_storage_node_cpu_cores",t)},expression:"temp.per_storage_node_cpu_cores"}})],1),a("el-form-item",{attrs:{label:"每个存储节点innodb缓冲池大小:",prop:"per_storage_node_innodb_buffer_pool_size"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点innodb缓冲池大小"},model:{value:e.temp.per_storage_node_innodb_buffer_pool_size,callback:function(t){e.$set(e.temp,"per_storage_node_innodb_buffer_pool_size",t)},expression:"temp.per_storage_node_innodb_buffer_pool_size"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("MB")])])],1),a("el-form-item",{attrs:{label:"每个存储节点rocksdb缓冲池大小:",prop:"per_storage_node_rocksdb_buffer_pool_size"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点rocksdb缓冲池大小"},model:{value:e.temp.per_storage_node_rocksdb_buffer_pool_size,callback:function(t){e.$set(e.temp,"per_storage_node_rocksdb_buffer_pool_size",t)},expression:"temp.per_storage_node_rocksdb_buffer_pool_size"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("MB")])])],1),a("el-form-item",{attrs:{label:"每个存储节点初始化存储值:",prop:"per_storage_node_initial_storage_size"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点初始化存储值"},model:{value:e.temp.per_storage_node_initial_storage_size,callback:function(t){e.$set(e.temp,"per_storage_node_initial_storage_size",t)},expression:"temp.per_storage_node_initial_storage_size"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("GB")])])],1),a("el-form-item",{attrs:{label:"每个存储节点最大存储值:",prop:"per_storage_node_max_storage_size"}},[a("el-input",{staticClass:"right_input",attrs:{placeholder:"请输入每个存储节点最大存储值"},model:{value:e.temp.per_storage_node_max_storage_size,callback:function(t){e.$set(e.temp,"per_storage_node_max_storage_size",t)},expression:"temp.per_storage_node_max_storage_size"}},[a("i",{staticStyle:{"font-style":"normal","margin-right":"10px","line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("GB")])])],1)],1):e._e(),"create"===e.dialogStatus?a("div",{class:!1===e.isShow?"ro-90":"ro90",on:{click:e.toggle}},[a("i",{staticClass:"el-icon-d-arrow-left"})]):e._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.dialogDetail,expression:"!dialogDetail"}],on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("关闭")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.dialogDetail,expression:"!dialogDetail"}],attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createData():e.updateData(e.row)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{title:"添加节点",visible:e.dialogNodeVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogNodeVisible=t}}},[a("el-form",{ref:"nodeForm",attrs:{model:e.nodetemp,rules:e.rules,"label-position":"left","label-width":"110px"}},["update"===e.dialogStatus?a("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[a("el-checkbox-group",{attrs:{min:e.minMachine,max:e.machineTotal},model:{value:e.nodetemp.machinelist,callback:function(t){e.$set(e.nodetemp,"machinelist",t)},expression:"nodetemp.machinelist"}},e._l(e.machines,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.hostaddr}},[e._v(e._s(t.hostaddr))])})),1)],1):e._e(),"update"===e.dialogStatus?a("el-form-item",{attrs:{label:"集群名称:",prop:"nick_name"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.nodetemp.nick_name,callback:function(t){e.$set(e.nodetemp,"nick_name",t)},expression:"nodetemp.nick_name"}})],1):e._e(),"update"===e.dialogStatus?a("el-form-item",{attrs:{label:"类型:",prop:"node_type"}},["update"===e.dialogStatus?a("el-select",{attrs:{placeholder:"请选择类型"},model:{value:e.nodetemp.node_type,callback:function(t){e.$set(e.nodetemp,"node_type",t)},expression:"nodetemp.node_type"}},e._l(e.node_types,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1):e._e()],1):e._e(),"add_nodes"==e.nodetemp.node_type&&"update"===e.dialogStatus?a("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},["update"===e.dialogStatus?a("el-select",{attrs:{placeholder:"请选择shard名称"},model:{value:e.nodetemp.shard_name,callback:function(t){e.$set(e.nodetemp,"shard_name",t)},expression:"nodetemp.shard_name"}},e._l(e.shardList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1):e._e()],1):e._e(),"update"===e.dialogStatus?a("el-form-item",{attrs:{label:"个数:",prop:"shards"}},[a("el-select",{attrs:{placeholder:"请选择个数",disabled:"detail"===e.dialogStatus},model:{value:e.nodetemp.shards,callback:function(t){e.$set(e.nodetemp,"shards",t)},expression:"nodetemp.shards"}},e._l(e.shardsDate,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1):e._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogNodeVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateData(e.row)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{title:"恢复集群",visible:e.dialogRestoreVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogRestoreVisible=t}}},[a("el-form",{ref:"restoreForm",attrs:{model:e.restoretemp,rules:e.rules,"label-position":"left","label-width":"110px"}},["restore"===e.dialogStatus?a("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[a("el-checkbox-group",{attrs:{min:e.minMachine,max:e.machineTotal},model:{value:e.restoretemp.machinelist,callback:function(t){e.$set(e.restoretemp,"machinelist",t)},expression:"restoretemp.machinelist"}},e._l(e.machines,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.hostaddr}},[e._v(e._s(t.hostaddr))])})),1)],1):e._e(),a("el-form-item",{attrs:{label:"原集群名称:",prop:"old_cluster_name"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.restoretemp.old_cluster_name,callback:function(t){e.$set(e.restoretemp,"old_cluster_name",t)},expression:"restoretemp.old_cluster_name"}})],1),a("el-form-item",{attrs:{label:"新集群名称:",prop:"nick_name"}},[a("el-input",{attrs:{placeholder:"请输入新集群名称"},model:{value:e.restoretemp.nick_name,callback:function(t){e.$set(e.restoretemp,"nick_name",t)},expression:"restoretemp.nick_name"}})],1),a("el-form-item",{attrs:{label:"回档时间:",prop:"now"}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择回档时间"},model:{value:e.restoretemp.now,callback:function(t){e.$set(e.restoretemp,"now",t)},expression:"restoretemp.now"}})],1),a("el-form-item",{attrs:{label:"最早备份时间:",prop:"end_ts"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.restoretemp.end_ts,callback:function(t){e.$set(e.restoretemp,"end_ts",t)},expression:"restoretemp.end_ts"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogRestoreVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.restoreData(e.restoretemp)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{visible:e.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px"},on:{"update:visible":function(t){e.dialogStatusVisible=t}}},[a("div",{staticClass:"block"},[a("el-timeline",e._l(e.activities,(function(t,r){return a("el-timeline-item",{key:r,attrs:{icon:t.icon,type:t.type,color:t.color,size:t.size,timestamp:t.timestamp}},[e._v(" "+e._s(t.content)+" ")])})),1)],1)])],1)}),o=[],n=(a("ac1f"),a("00b4"),a("d3b7"),a("159b"),a("ed08")),l=a("333d"),c=a("578a"),d=a("82b0"),u=a("a665"),p={name:"list",components:{Pagination:l["a"]},data:function(){var e=this,t=function(e,t,a){0===t.length?a(new Error("请选择计算机")):a()},a=function(e,t,a){t?a():a(new Error("请选择高可用模式"))},r=function(e,t,a){t?a():a(new Error("请输入shard个数"))},i=function(e,t,a){t?/^[0-9_]+$/.test(t)?t<3?a(new Error("副本数不能小于3")):a():a(new Error("副本数只能输入数字")):a(new Error("请输入副本数"))},s=function(e,t,a){t?/^[0-9]+$/.test(t)?a():a(new Error("计算节点总个数只能输入数字")):a(new Error("请输入计算节点总个数"))},o=function(e,t,a){t?/^[0-9]+$/.test(t)?a():a(new Error("缓冲池大小只能输入数字")):a(new Error("请输入缓冲池大小"))},l=function(t,a,r){var i=Object(n["c"])(),s=Object(n["b"])(i);e.restoretemp.now?e.restoretemp.nowlue<e.restoretemp.end_ts?r(new Error("回档时间不能早于最早备份时间")):e.restoretemp.now>s?r(new Error("回档时间选择范围应在当前系统时间开始一个月之内")):r():r(new Error("请选择回档时间"))},d=function(e,t,a){t?a():a(new Error("请选择类型"))},u=function(t,a,r){"add_nodes"===e.temp.node_type?a?r():r(new Error("请选择shard名称")):r()},p=function(e,t,a){t?a():a(new Error("请选择个数"))},m=function(e,t,a){t?a():a(new Error("请输入新集群名称"))};return{tableKey:0,list:null,listLoading:!0,searchLoading:!1,total:0,listQuery:{pageNo:1,pageSize:10,name:""},temp:{ha_mode:"",shards_count:"0",snode_count:"3",comp_count:"",buffer_pool:"1",max_connections:"6",per_computing_node_cpu_cores:"8",per_computing_node_max_mem_size:"",per_storage_node_cpu_cores:"8",per_storage_node_innodb_buffer_pool_size:"",per_storage_node_rocksdb_buffer_pool_size:"",per_storage_node_initial_storage_size:"20",per_storage_node_max_storage_size:"20",nick_name:"",machinelist:[],node_type:"",shard_name:"",shards:""},restoretemp:{old_cluster_name:"",now:"",end_ts:"",machinelist:[],backup_cluster_name:"",nick_name:""},nodetemp:{machinelist:[],node_type:"",shard_name:"",shards:"",name:"",nick_name:""},dialogFormVisible:!1,dialogRestoreVisible:!1,dialogNodeVisible:!1,dialogStatusVisible:!1,dialogStatus:"",textMap:{update:"添加节点",create:"新增集群",detail:"详情",restore:"恢复集群"},dialogDetail:!1,message_tips:"",message_type:"",user_add_priv:"",user_drop_priv:"",user_edit_priv:"",row:{},hamodeData:c["b"],shardsDate:c["i"],norepshardsDate:c["e"],pershardDate:c["f"],isShow:!1,machinelist:[],machines:[],minMachine:0,machineTotal:0,node_types:c["d"],shardList:[],backup_priv:JSON.parse(sessionStorage.getItem("priv")).backup_priv,restore_priv:JSON.parse(sessionStorage.getItem("priv")).restore_priv,cluster_creata_priv:JSON.parse(sessionStorage.getItem("priv")).cluster_creata_priv,cluster_drop_priv:JSON.parse(sessionStorage.getItem("priv")).cluster_drop_priv,shard_create_priv:JSON.parse(sessionStorage.getItem("priv")).shard_create_priv,storage_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_create_priv,compute_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_create_priv,timer:null,installStatus:!1,info:"",activities:[],rules:{machinelist:[{required:!0,trigger:"blur",validator:t}],ha_mode:[{required:!0,trigger:"blur",validator:a}],shards_count:[{required:!0,trigger:"blur",validator:r}],snode_count:[{required:!0,trigger:"blur",validator:i}],comp_count:[{required:!0,trigger:"blur",validator:s}],buffer_pool:[{required:!0,trigger:"blur",validator:o}],now:[{required:!0,trigger:"blur",validator:l}],node_type:[{required:!0,trigger:"blur",validator:d}],shard_name:[{required:!0,trigger:"blur",validator:u}],shards:[{required:!0,trigger:"blur",validator:p}],nick_name:[{required:!0,trigger:"blur",validator:m}]}}},created:function(){this.getList()},watch:{"temp.machinelist":{handler:function(e,t){this.temp.shards_count=this.temp.machinelist.length}}},methods:{toggle:function(){this.isShow=!this.isShow},handleFilter:function(){this.listQuery.pageNo=1,this.getList()},handleClear:function(){this.listQuery.name="",this.listQuery.pageNo=1,this.getList()},getList:function(){var e=this;this.listLoading=!0;var t=Object.assign({},this.listQuery);t.effectCluster=sessionStorage.getItem("affected_clusters"),t.apply_all_cluster=sessionStorage.getItem("apply_all_cluster"),Object(d["c"])(t).then((function(t){e.list=t.list,e.total=t.total,setTimeout((function(){e.listLoading=!1}),500)}))},resetTemp:function(){this.temp={ha_mode:"",shards_count:"0",snode_count:"3",comp_count:"",buffer_pool:"1",max_connections:"6",per_computing_node_cpu_cores:"8",per_computing_node_max_mem_size:"",per_storage_node_cpu_cores:"8",per_storage_node_innodb_buffer_pool_size:"",per_storage_node_rocksdb_buffer_pool_size:"",per_storage_node_initial_storage_size:"20",per_storage_node_max_storage_size:"20",nick_name:"",machinelist:[],node_type:"",shard_name:"",shards:""}},handleCreate:function(){var e=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.dialogDetail=!1,Object(d["a"])().then((function(t){e.machines=t.list,e.minMachine=0,e.machineTotal=t.total})),this.$nextTick((function(){e.$refs.dataForm.clearValidate()}))},createData:function(){var e=this;this.$refs["dataForm"].validate((function(t){if(t){var a=Object.assign({},e.temp),r=[];a.machinelist.forEach((function(e){var t={hostaddr:e};r.push(t)}));var i={},s={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.version=c["m"][0].ver,i.timestamp=c["k"][0].time+"",i.job_type="create_cluster",s.comps=a.machinelist.length+"",s.shards=a.shards_count+"",s.nodes=a.snode_count,s.max_storage_size=a.per_storage_node_max_storage_size,s.max_connections=a.max_connections,s.innodb_size=a.buffer_pool,s.cpu_cores=a.per_computing_node_cpu_cores,s.ha_mode=a.ha_mode,s.machinelist=r,s.nick_name=a.nick_name,s.dbcfg="1",i.paras=s,Object(u["f"])(i).then((function(t){var a=t;if("accept"==a.status){e.dialogFormVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var r={content:"正在新增集群...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(r);var i=0,s=setInterval((function(){setTimeout((function(){var t={job_type:"get_status"};t.version=c["m"][0].ver,t.job_id=a.job_id,t.timestamp=c["k"][0].time+"",t.paras={},Object(u["o"])(t).then((function(t){if("done"==t.status||"failed"==t.status)if(clearInterval(s),"done"==t.status){var a={content:t.error_info,timestamp:Object(n["c"])(),color:"#0bbd87",icon:"el-icon-circle-check"};e.activities.push(a);var r=sessionStorage.getItem("apply_all_cluster");if(2==r){var i={};i.effectCluster=sessionStorage.getItem("affected_clusters"),i.cluster_name=t.attachment.cluster_name,i.username=sessionStorage.getItem("login_username"),i.type="add",Object(d["p"])(i).then((function(t){var a=t;200==a.code&&(e.dialogFormVisible=!1,sessionStorage.setItem("affected_clusters",a.effectCluster))}))}setTimeout((function(){e.getList(),e.dialogStatusVisible=!1}),3e3)}else{var o={content:t.error_info,timestamp:Object(n["c"])(),color:"red",icon:"el-icon-circle-close"};e.activities.push(o)}else{var l={content:t.error_info,timestamp:Object(n["c"])(),color:"#0bbd87"};e.activities.push(l)}})),i>=86400&&clearInterval(s),i++}),0)}),1e3)}else"ongoing"==a.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error"):(e.message_tips=a.error_info,e.message_type="error");Object(n["e"])(e.message_tips,e.message_type)}))}}))},handleDetail:function(e){this.dialogStatus="detail",this.dialogFormVisible=!0,this.temp=Object.assign({},e),this.dialogDetail=!0},handleUpdate:function(e){var t=this;this.temp=Object.assign({},e),this.nodetemp.nick_name=this.temp.nick_name,this.nodetemp.name=this.temp.name,this.dialogStatus="update",this.dialogNodeVisible=!0,this.dialogDetail=!1,Object(d["a"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total})),Object(d["k"])(e.id).then((function(e){var a=e;200==a.code&&(t.shardList=a.list)})),this.$nextTick((function(){t.$refs["nodeForm"].clearValidate()}))},updateData:function(){var e=this;this.$refs["nodeForm"].validate((function(t){if(t){var a=Object.assign({},e.nodetemp),r=[];a.machinelist.forEach((function(e){var t={hostaddr:e};r.push(t)})),a.job_id="",a.version=c["m"][0].ver,a.user_name=sessionStorage.getItem("login_username"),a.job_type=a.node_type,a.timestamp=c["k"][0].time+"";var i={};i.machinelist=r,i.cluster_name=a.name,i.nick_name=a.nick_name,e.$delete(a,"node_type"),e.$delete(a,"name"),e.$delete(a,"nick_name"),e.$delete(a,"machinelist"),"add_shards"==a.job_type?(i.shards=a.shards,e.$delete(a,"shard_name"),e.$delete(a,"shards"),a.paras=i,Object(u["c"])(a).then((function(t){var a=t;if("accept"==a.status){e.dialogNodeVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var r={content:"正在新增shard...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(r);var i=0,s=setInterval((function(){e.getStatus(s,a.job_id,i++)}),1e3)}else"ongoing"==a.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error"):(e.message_tips=a.error_info,e.message_type="error");Object(n["e"])(e.message_tips,e.message_type)}))):"add_comps"==a.job_type?(i.comps=a.shards,a.paras=i,e.$delete(a,"shards"),e.$delete(a,"shard_name"),Object(u["a"])(a).then((function(t){var a=t;if("accept"==a.status){e.dialogNodeVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var r={content:"正在新增计算节点...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(r);var i=0,s=setInterval((function(){e.getStatus(s,a.job_id,i++)}),1e3)}else"ongoing"==a.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error"):(e.message_tips=a.error_info,e.message_type="error");Object(n["e"])(e.message_tips,e.message_type)}))):"add_nodes"==a.job_type&&(i.nodes=a.shards,i.shard_name=a.shard_name,a.paras=i,e.$delete(a,"shards"),e.$delete(a,"shard_name"),Object(u["b"])(a).then((function(t){var a=t;if("accept"==a.status){e.dialogNodeVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var r={content:"正在新增存储节点...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(r);var i=0,s=setInterval((function(){e.getStatus(s,a.job_id,i++)}),1e3)}else"ongoing"==a.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error"):(e.message_tips=a.error_info,e.message_type="error");Object(n["e"])(e.message_tips,e.message_type)})))}}))},handleDelete:function(e){var t=this;Object(n["d"])("此操作将永久删除该数据, 是否继续?").then((function(){var a={};a.effectCluster=sessionStorage.getItem("affected_clusters"),a.cluster_name=e.name,a.username=sessionStorage.getItem("login_username"),a.type="del",Object(d["p"])(a).then((function(e){var a=e;200==a.code&&(t.dialogFormVisible=!1,sessionStorage.setItem("affected_clusters",a.effectCluster))}));var r={};r.user_name=sessionStorage.getItem("login_username"),r.job_id="",r.version=c["m"][0].ver,r.job_type="delete_cluster",r.timestamp=c["k"][0].time+"",r.paras={cluster_name:e.name,nick_name:e.nick_name},Object(u["g"])(r).then((function(e){var a=e;if("accept"==a.status){t.dialogFormVisible=!1,t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在删除集群...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r);var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else"ongoing"==a.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error"):(t.message_tips=a.error_info,t.message_type="error");Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")}))},handleBackUp:function(e){var t=this,a={};a.version=c["m"][0].ver,a.job_id="",a.job_type="get_backup_storage",a.timestamp=c["k"][0].time+"",a.paras={},Object(u["m"])(a).then((function(a){null!==a.attachment.list_backup_storage?Object(n["d"])("确定要备份"+e.nick_name+"这个集群么?").then((function(){var a=Object.assign({},e),r={};r.user_name=sessionStorage.getItem("login_username"),r.job_id="",r.paras={backup_cluster_name:a.name,nick_name:a.nick_name},r.version=c["m"][0].ver,r.timestamp=c["k"][0].time+"",r.job_type="backup_cluster",Object(u["e"])(r).then((function(e){var a=e;if("accept"==a.status){t.dialogFormVisible=!1,t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在备份集群...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r);var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else"ongoing"==a.status?(t.message_tips="系统正在操作中，请等待一会！",t.message_type="error"):(t.message_tips=a.error_info,t.message_type="error");Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){Object(n["e"])("已取消备份","info")})):Object(n["e"])("请先添加备份存储目标!","error")}))},handleRestore:function(e){var t=this;this.restoretempDate=Object.assign({},e),this.dialogStatus="restore",this.dialogFormVisible=!1,this.dialogDetail=!1,Object(d["o"])(e.id).then((function(a){var r=a;200==r.code?(t.dialogRestoreVisible=!0,t.restoretemp.end_ts=a.list[0].end_ts,t.restoretemp.old_cluster_name=e.nick_name,t.restoretemp.backup_cluster_name=e.name,t.restoretemp.now=Object(n["c"])(),Object(d["a"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total}))):(t.message_tips=r.message,t.message_type="error",Object(n["e"])(t.message_tips,t.message_type))})),this.$nextTick((function(){t.$refs["dataForm"]&&t.$refs["dataForm"].clearValidate()}))},restoreData:function(){var e=this;this.$refs["restoreForm"].validate((function(t){if(t){var a=Object.assign({},e.restoretemp),r=[];a.machinelist.forEach((function(e){var t={hostaddr:e};r.push(t)}));var i={};i.user_name=sessionStorage.getItem("login_username"),i.job_id="",i.version=c["m"][0].ver,i.job_type="restore_new_cluster",i.timestamp=c["k"][0].time+"";var s={};s.nick_name=a.nick_name,s.backup_cluster_name=a.backup_cluster_name,s.timestamp=a.now,s.machinelist=r,i.paras=s,Object(u["v"])(i).then((function(t){var a=t;if("accept"==a.status){e.dialogRestoreVisible=!1,e.dialogStatusVisible=!0,e.activities=[];var r={content:"正在恢复集群...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};e.activities.push(r);var i=0,s=setInterval((function(){e.getStatus(s,a.job_id,i++)}),1e3)}else"ongoing"==a.status?(e.message_tips="系统正在操作中，请等待一会！",e.message_type="error"):(e.message_tips=a.error_info,e.message_type="error");Object(n["e"])(e.message_tips,e.message_type)}))}}))},handleSwitchOver:function(e){this.$router.push({path:"/cluster/switchover",query:{id:e.id}})},getStatus:function(e,t,a){var r=this;setTimeout((function(){var i={job_type:"get_status"};i.version=c["m"][0].ver,i.job_id=t,i.timestamp=c["k"][0].time+"",i.paras={},Object(u["o"])(i).then((function(t){if("done"==t.status||"failed"==t.status)if(clearInterval(e),"done"==t.status){var a={content:t.error_info,timestamp:Object(n["c"])(),color:"#0bbd87",icon:"el-icon-circle-check"};r.activities.push(a),r.getList(),r.dialogStatusVisible=!1}else{var i={content:t.error_info,timestamp:Object(n["c"])(),color:"red",icon:"el-icon-circle-close"};r.activities.push(i)}else{var s={content:t.error_info,timestamp:Object(n["c"])(),color:"#0bbd87"};r.activities.push(s)}})),a>=86400&&clearInterval(e)}),0)}}},m=p,_=(a("432c"),a("2877")),h=Object(_["a"])(m,s,o,!1,null,"52d62040",null),f=h.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:e.g_loading,expression:"g_loading"}],attrs:{size:"small"},on:{change:e.agreeChange},model:{value:e.currentCase,callback:function(t){e.currentCase=t},expression:"currentCase"}},e._l(e.clusters,(function(t){return a("el-radio",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.nick_name))])})),1),a("div",{directives:[{name:"show",rawName:"v-show",value:!0===e.installStatus,expression:"installStatus===true"}],staticClass:"info",domProps:{textContent:e._s(e.info)}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.nodataShow,expression:"nodataShow"}],staticClass:"nodata"},[e._v("暂无数据")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.g_loading,expression:"g_loading"}],ref:"myPage",staticStyle:{"margin-top":"0px",width:"calc(100(100% - 10px)",height:"calc(100vh - 160px)"},on:{click:function(t){e.isShowNodeMenuPanel=!1}}},[a("SeeksRelationGraph",{ref:"seeksRelationGraph",attrs:{options:e.graphOptions,"on-node-click":e.onNodeClick,"on-line-click":e.onLineClick,"on-node-expand":e.onNodeExpand,"on-node-collapse":e.onNodeCollapse},scopedSlots:e._u([{key:"node",fn:function(t){var r=t.node;return a("div",{on:{click:function(t){return e.showNodeMenus(r,t)},contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.showNodeMenus(r,t)}}},[a("div",[a("i",{class:r.data.icon,style:{color:r.data.color,fontSize:"40px"}}),a("p",{staticStyle:{"word-wrap":"break-word","word-break":"break-all"},domProps:{textContent:e._s(r.text)}})])])}}])})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowNodeMenuPanel&&e.g_loading,expression:"isShowNodeMenuPanel&&g_loading"}],staticStyle:{"z-index":"999",padding:"10px","background-color":"#ffffff",border:"#eeeeee solid 1px","box-shadow":"0px 0px 8px #cccccc",position:"absolute"},style:{left:e.nodeMenuPanelPosition.x+"px",top:e.nodeMenuPanelPosition.y+"px"}},[a("div",{staticStyle:{"line-height":"25px","padding-left":"10px",color:"#888888","font-size":"10px"}},[e._v("对"+e._s(e.nodeName)+"进行操作：")]),"shard"===e.type?a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("主备切换")}}},[e._v("主备切换")]):e._e(),"cluster"===e.type&&"Y"===e.shard_create_priv?a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("新增存储集群")}}},[e._v("新增存储集群")]):e._e(),"cluster"===e.type&&"Y"===e.compute_node_create_priv?a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("新增计算节点")}}},[e._v("新增计算节点")]):e._e(),"cnode"!==e.type&&"snode"!==e.type||"super_dba"!=e.user_name?e._e():a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("启用")}}},[e._v("启用")]),"cnode"!==e.type&&"snode"!==e.type||"super_dba"!=e.user_name?e._e():a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("禁用")}}},[e._v("禁用")]),"cnode"!==e.type&&"snode"!==e.type||"super_dba"!=e.user_name?e._e():a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("重启")}}},[e._v("重启")]),"cnode"===e.type&&"Y"===e.compute_node_drop_priv||"snode"===e.type&&"Y"===e.storage_node_drop_priv?a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("删除")}}},[e._v("删除")]):e._e(),"cnode"===e.type||"snode"===e.type?a("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),e.doAction("进入")}}},[e._v("进入")]):e._e()]),a("el-dialog",{attrs:{title:"新增存储集群",visible:e.dialogShardVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogShardVisible=t}}},[a("el-form",{ref:"restoreForm",attrs:{model:e.shardtemp,rules:e.rules,"label-position":"left","label-width":"110px"}},[a("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[a("el-checkbox-group",{attrs:{min:e.minMachine,max:e.machineTotal},model:{value:e.shardtemp.machinelist,callback:function(t){e.$set(e.shardtemp,"machinelist",t)},expression:"shardtemp.machinelist"}},e._l(e.machines,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.hostaddr}},[e._v(e._s(t.hostaddr))])})),1)],1),a("el-form-item",{attrs:{label:"集群名称:",prop:"old_cluster_name"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.shardtemp.old_cluster_name,callback:function(t){e.$set(e.shardtemp,"old_cluster_name",t)},expression:"shardtemp.old_cluster_name"}})],1),a("el-form-item",{attrs:{label:"副本数:",prop:"snode_count"}},[a("el-input",{attrs:{placeholder:"副本数至少是3，且不能大于所选计算机数",disabled:"detail"===e.dialogStatus},model:{value:e.shardtemp.snode_count,callback:function(t){e.$set(e.shardtemp,"snode_count",t)},expression:"shardtemp.snode_count"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogShardVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.shardData(e.shardtemp)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{title:"新增计算节点",visible:e.dialogCompVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogCompVisible=t}}},[a("el-form",{ref:"compForm",attrs:{model:e.comptemp,rules:e.rules,"label-position":"left","label-width":"110px"}},[a("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[a("el-checkbox-group",{attrs:{min:e.minMachine,max:e.machineTotal},model:{value:e.comptemp.machinelist,callback:function(t){e.$set(e.comptemp,"machinelist",t)},expression:"comptemp.machinelist"}},e._l(e.machines,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.hostaddr}},[e._v(e._s(t.hostaddr))])})),1)],1),a("el-form-item",{attrs:{label:"集群名称:",prop:"old_cluster_name"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.comptemp.old_cluster_name,callback:function(t){e.$set(e.comptemp,"old_cluster_name",t)},expression:"comptemp.old_cluster_name"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogCompVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.compData(e.comptemp)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{title:"新增存储节点",visible:e.dialogSnodeVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogSnodeVisible=t}}},[a("el-form",{ref:"compForm",attrs:{model:e.comptemp,rules:e.rules,"label-position":"left","label-width":"110px"}},[a("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[a("el-checkbox-group",{attrs:{min:e.minMachine,max:e.machineTotal},model:{value:e.snodetemp.machinelist,callback:function(t){e.$set(e.snodetemp,"machinelist",t)},expression:"snodetemp.machinelist"}},e._l(e.machines,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.hostaddr}},[e._v(e._s(t.hostaddr))])})),1)],1),a("el-form-item",{attrs:{label:"集群名称:",prop:"old_cluster_name"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.snodetemp.old_cluster_name,callback:function(t){e.$set(e.snodetemp,"old_cluster_name",t)},expression:"snodetemp.old_cluster_name"}})],1),a("el-form-item",{attrs:{label:"shard名称:",prop:"shard_name"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.snodetemp.shard_name,callback:function(t){e.$set(e.snodetemp,"shard_name",t)},expression:"snodetemp.shard_name"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogSnodeVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.snodeData(e.snodetemp)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{title:"重做备机节点",visible:e.dialogRedoVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogRedoVisible=t}}},[a("el-form",{ref:"redoForm",attrs:{model:e.redotemp,rules:e.rules,"label-position":"left","label-width":"130px"}},[a("el-form-item",{attrs:{label:"选择计算机:",prop:"machinelist"}},[a("el-checkbox-group",{attrs:{min:e.minMachine,max:e.machineTotal},model:{value:e.redotemp.machinelist,callback:function(t){e.$set(e.redotemp,"machinelist",t)},expression:"redotemp.machinelist"}},e._l(e.machines,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.hostaddr}},[e._v(e._s(t.hostaddr))])})),1)],1),a("el-form-item",{attrs:{label:"需重做的备机节点:",prop:"redoList"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.redotemp.redoList,callback:function(t){e.$set(e.redotemp,"redoList",t)},expression:"redotemp.redoList"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogRedoVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.snodeData(e.snodetemp)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{title:"主备切换",visible:e.dialogSwitchOVisible,"custom-class":"single_dal_view"},on:{"update:visible":function(t){e.dialogSwitchOVisible=t}}},[a("el-form",{ref:"switchForm",attrs:{model:e.switchtemp,rules:e.rules,"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"主节点:",prop:"primary_node"}},[a("span",[e._v(e._s(e.switchtemp.primary_node))])]),a("el-form-item",{attrs:{label:"备机节点:",prop:"replica"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择备机节点"},model:{value:e.switchtemp.replica,callback:function(t){e.$set(e.switchtemp,"replica",t)},expression:"switchtemp.replica"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.label}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogSwitchOVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.switchData(e.switchtemp)}}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{visible:e.dialogStatusVisible,"custom-class":"single_dal_view",width:"400px"},on:{"update:visible":function(t){e.dialogStatusVisible=t}}},[a("div",{staticClass:"block"},[a("el-timeline",e._l(e.activities,(function(t,r){return a("el-timeline-item",{key:r,attrs:{icon:t.icon,type:t.type,color:t.color,size:t.size,timestamp:t.timestamp}},[e._v(" "+e._s(t.content)+" ")])})),1)],1)])],1)},b=[],v=a("1da1"),y=a("ade3"),S=(a("96cf"),a("5319"),a("466d"),a("0491")),k=a.n(S),j={name:"Demo",components:{SeeksRelationGraph:k.a},data:function(){var e;return e={currentCase:1,clusters:[],nodeName:"",type:"",message_tips:"",message_type:"",nodataShow:!1,timer:null,installStatus:!1,info:"",row:{},snode:{},shard_create_priv:JSON.parse(sessionStorage.getItem("priv")).shard_create_priv,shard_drop_priv:JSON.parse(sessionStorage.getItem("priv")).shard_drop_priv,storage_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_create_priv,storage_node_drop_priv:JSON.parse(sessionStorage.getItem("priv")).storage_node_drop_priv,compute_node_create_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_create_priv,compute_node_drop_priv:JSON.parse(sessionStorage.getItem("priv")).compute_node_drop_priv,storage_enable_priv:JSON.parse(sessionStorage.getItem("priv")).storage_enable_priv,storage_disable_priv:JSON.parse(sessionStorage.getItem("priv")).storage_disable_priv,compute_enable_priv:JSON.parse(sessionStorage.getItem("priv")).compute_enable_priv,compute_disable_priv:JSON.parse(sessionStorage.getItem("priv")).compute_disable_priv,user_name:sessionStorage.getItem("login_username"),isShowCodePanel:!1,isShowNodeTipsPanel:!1,isShowNodeMenuPanel:!1,nodeMenuPanelPosition:{x:0,y:0},currentNode:{},dialogShardVisible:!1,dialogCompVisible:!1,dialogSnodeVisible:!1,dialogRedoVisible:!1,dialogSwitchOVisible:!1,shardtemp:{old_cluster_name:"",cluster_name:"",snode_count:"",machinelist:[]},comptemp:{old_cluster_name:"",machinelist:[]},snodetemp:{old_cluster_name:"",shard_name:"",machinelist:[]},redotemp:{redolist:[]},switchtemp:{replica:"",primary_node:"",shard_id:"",cluster_id:""},machinelist:[],machines:[],minMachine:0,machineTotal:0,rules:{},options:[],status:[],dialogStatus:"",textMap:{update:"新增计算节点",create:"新增存储集群",detail:"新增存储节点",restore:"重做备机节点"},delpriv:""},Object(y["a"])(e,"user_name",sessionStorage.getItem("login_username")),Object(y["a"])(e,"g_loading",!1),Object(y["a"])(e,"dialogStatusVisible",!1),Object(y["a"])(e,"demoname","---"),Object(y["a"])(e,"range_horizontal",[100,300]),Object(y["a"])(e,"range_vertical",[20,100]),Object(y["a"])(e,"activities",[]),Object(y["a"])(e,"graphOptions",{debug:!0,backgrounImageNoRepeat:!0,layouts:[{label:"树",layoutName:"tree",layoutClassName:"seeks-layout-center",defaultNodeShape:0,defaultLineShape:1,from:"left",min_per_width:void 0,max_per_width:"300",min_per_height:"40",max_per_height:void 0,levelDistance:""}],defaultLineMarker:{markerWidth:12,markerHeight:12,refX:6,refY:6,data:"M2,2 L10,6 L2,10 L6,6 L2,2"},defaultExpandHolderPosition:"right",defaultNodeShape:1,defaultNodeWidth:"100",defaultLineShape:4,defaultJunctionPoint:"lr",defaultNodeBorderWidth:0,defaultLineColor:"rgba(149, 195, 243, 1)",defaultNodeColor:"rgba(176, 210, 237, 1)",defaultNodeFontColor:"rgba(0, 0, 0, 1)",defaultNodeBorderColor:"rgba(255, 255, 255, 1)"}),e},created:function(){this.getCluster()},methods:{switchData:function(e){var t=this;this.$refs["switchForm"].validate((function(e){if(e){var a={};a.user_name=sessionStorage.getItem("login_username"),a.job_id="",a.job_type="manual_switch",a.version=c["m"][0].ver,a.timestamp=c["k"][0].time+"";var r=t.switchtemp.replica.substring(0,t.switchtemp.replica.length-1).replace("(","_"),i=t.switchtemp.primary_node.substring(0,t.switchtemp.primary_node.length-1).replace("(","_"),s={shard_id:t.switchtemp.shard_id,cluster_id:t.switchtemp.cluster_id,master_hostaddr:i,assign_hostaddr:r};a.paras=s,Object(u["A"])(a).then((function(e){var a=e;if("accept"==a.status){t.dialogSwitchOVisible=!1,t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在进行主备切换...",timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r);var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))}}))},matchState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return!!String(e).match(t)},onNodeCollapse:function(e,t){this.$refs.seeksRelationGraph.refresh()},onNodeExpand:function(e,t){var a=this;if(!e.data.isNeedLoadDataFromRemoteServer)return console.log("这个节点的子节点已经加载过了"),void this.$refs.seeksRelationGraph.refresh();if(e.data.childrenLoaded)return console.log("这个节点的子节点已经加载过了"),void this.$refs.seeksRelationGraph.refresh();e.data.childrenLoaded=!0;var r={};r.shard_id=e.data.shard_id,r.cluster_id=e.data.cluster_id,r.tree_id=e.id,Object(d["i"])(r).then((function(e){var t=e;if(200==t.code){var r=[],i=e.list,s={job_id:"",paras:{cluster_name:i.nodes[0].data.cluster_name},version:c["m"][0].ver,timestamp:c["k"][0].time+"",job_type:"get_cluster_detail"};Object(u["n"])(s).then((function(e){r=e.attachment.list_shard;for(var t=0;t<i.nodes.length;t++){var s=i.nodes[t];if(-1!=s.id.indexOf("snode")){a.$set(s.data,"icon","iconfont icon-snode");for(var o=0;o<r.length;o++)for(var n=r[o].shard_name,l=0;l<r[o].list_node.length;l++){var c=r[o].list_node[l].hostaddr,d=r[o].list_node[l].port;n===s.data.shard_name&&c===s.data.hostaddr&&d===s.text&&(a.$set(s.data,"status",r[o].list_node[l].status),a.$set(s.data,"master",r[o].list_node[l].master))}"true"==s.data.master?a.$set(s.data,"color","#ff0000"):"false"==s.data.master?a.$set(s.data,"color","#e98f36"):a.$set(s.data,"color","#acacac")}console.log(s)}})),a.snode=i,a.g_loading=!0,a.$refs.seeksRelationGraph.appendJsonData(a.snode,(function(e){}))}else a.message_tips=t.message,a.message_type="error",Object(n["e"])(a.message_tips,a.message_type)}))},agreeChange:function(e){this.getOneCluster(e)},getCluster:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={},a.effectCluster=sessionStorage.getItem("affected_clusters"),a.apply_all_cluster=sessionStorage.getItem("apply_all_cluster"),t.next=5,Object(d["f"])(a);case 5:r=t.sent,r.total>0?(e.currentCase=r.list[0].id,e.clusters=r.list,e.getOneCluster(e.currentCase),e.nodataShow=!1,e.g_loading=!0):(e.g_loading=!1,e.nodataShow=!0);case 7:case"end":return t.stop()}}),t)})))()},getOneCluster:function(e){var t=this;Object(d["d"])(e).then((function(e){for(var a=e.list,r=0;r<a.nodes.length;r++){var i=a.nodes[r];"cluster"==i.id&&t.$set(i,"data",{icon:"iconfont  icon-cluster",color:"#533ade"}),-1!=i.id.indexOf("shard")&&(t.$set(i,"expandHolderPosition","right"),t.$set(i,"expanded",!1),t.$set(i.data,"isNeedLoadDataFromRemoteServer",!0),t.$set(i.data,"childrenLoaded",!1),t.$set(i.data,"icon","iconfont icon-shard"),t.$set(i.data,"color","#e98f36")),-1!=i.id.indexOf("cnode")&&(t.$set(i.data,"icon","iconfont icon-compnode"),"inactive"==i.data.status?t.$set(i.data,"color","#acacac"):t.$set(i.data,"color","#1196db")),-1!=i.id.indexOf("snode")&&(t.$set(i.data,"icon","iconfont icon-snode"),t.$set(i.data,"color","#e98f36"))}t.list=a,t.showSeeksGraph(t.list),setTimeout((function(){t.listLoading=!1}),500)}))},showSeeksGraph:function(e){var t=this,a=e;this.$refs.seeksRelationGraph.setJsonData(a,(function(e){t.graphOptions.layouts[0].levelDistance=t.levelDistance,t.$refs.seeksRelationGraph.setOptions(t.graphOptions,(function(e){console.log("setOptions:callback:",e)}))}))},onNodeClick:function(e,t){this.currentNode=e;var a=this.$refs.myPage.getBoundingClientRect();"cluster"!=this.currentNode.id&&-1==this.currentNode.text.indexOf("shard")||("shard"==this.currentNode.data.name&&"Y"!==this.shard_drop_priv||"cluster"==this.currentNode.id?this.isShowNodeMenuPanel=!1:(this.isShowNodeMenuPanel=!0,this.nodeName=this.currentNode.text,-1!=this.currentNode.text.indexOf("shard")?this.type="shard":"cluster"==this.currentNode.id&&(this.type="cluster"),this.nodeMenuPanelPosition.x=t.clientX-a.x,this.nodeMenuPanelPosition.y=t.clientY-a.y))},onLineClick:function(e,t){console.log("onLineClick:",e)},showNodeTips:function(e,t){this.currentNode=e;var a=this.$refs.myPage.getBoundingClientRect();this.isShowNodeTipsPanel=!0,this.nodeMenuPanelPosition.x=t.clientX-a.x+10,this.nodeMenuPanelPosition.y=t.clientY-a.y+10},hideNodeTips:function(e,t){this.isShowNodeTipsPanel=!1},showNodeMenus:function(e,t){this.currentNode=e;var a=this.$refs.myPage.getBoundingClientRect();-1==this.currentNode.id.indexOf("cnode")&&-1==this.currentNode.id.indexOf("snode")||(this.isShowNodeMenuPanel=!0,this.nodeName=this.currentNode.text,-1!=this.currentNode.id.indexOf("cnode")?this.type="cnode":-1!=this.currentNode.id.indexOf("snode")&&(this.type="snode"),this.nodeMenuPanelPosition.x=t.clientX-a.x,this.nodeMenuPanelPosition.y=t.clientY-a.y)},doAction:function(e){var t=this;if("进入"===e){var a={job_id:"",job_type:"postgres_exporter"};a["version"]=c["m"][0].ver,a["timestamp"]=c["k"][0].time+"",a["user_name"]=sessionStorage.getItem("login_username");var r={};r["hostaddr"]=this.currentNode.data.hostaddr,r["port"]=this.currentNode.data.port,a["paras"]=r;var i={job_id:"",job_type:"mysqld_exporter"};i["version"]=c["m"][0].ver,i["timestamp"]=c["k"][0].time+"",i["user_name"]=sessionStorage.getItem("login_username");var s={};s["hostaddr"]=this.currentNode.data.hostaddr,s["port"]=this.currentNode.data.port,i["paras"]=s;var o={job_id:"",job_type:"update_prometheus"};o["version"]=c["m"][0].ver,o["timestamp"]=c["k"][0].time+"",o["user_name"]=sessionStorage.getItem("login_username"),o["paras"]={},"pgsql"===this.currentNode.data.name?Object(u["s"])(a).then((function(e){if("accept"==e.status)var a=0,r=setInterval((function(){setTimeout((function(){var i={job_type:"get_status"};i.version=c["m"][0].ver,i.job_id=e.job_id,i.timestamp=c["k"][0].time+"",i.paras={},Object(u["o"])(i).then((function(e){if("done"==e.status||"failed"==e.status)if(clearInterval(r),t.dialogStatusVisible=!0,t.activities=[],"done"==e.status){var a={content:e.error_info,timestamp:Object(n["c"])(),color:"#0bbd87",icon:"el-icon-circle-check"};t.activities.push(a),t.dialogStatusVisible=!1,window.open("http://"+c["c"][0].ip+"/d/postgresql/postgresql?orgId=1&refresh=5s")}else{var i={content:e.error_info,timestamp:Object(n["c"])(),color:"red",icon:"el-icon-circle-close"};t.activities.push(i)}else{var s={content:e.error_info,timestamp:Object(n["c"])(),color:"#0bbd87"};t.activities.push(s)}})),a>=86400&&clearInterval(r),a++}),0)}),1e3)})):"mysql"===this.currentNode.data.name&&Object(u["r"])(i).then((function(e){if(e.status="accept")var a=0,r=setInterval((function(){setTimeout((function(){var i={job_type:"get_status"};i.version=c["m"][0].ver,i.job_id=e.job_id,i.timestamp=c["k"][0].time+"",i.paras={},Object(u["o"])(i).then((function(e){if("done"==e.status||"failed"==e.status)if(clearInterval(r),t.dialogStatusVisible=!0,t.activities=[],"done"==e.status){var a={content:e.error_info,timestamp:Object(n["c"])(),color:"#0bbd87",icon:"el-icon-circle-check"};t.activities.push(a),t.dialogStatusVisible=!1,window.open("http://"+c["c"][0].ip+"/d/mysql/mysql?orgId=1&refresh=5s")}else{var i={content:e.error_info,timestamp:Object(n["c"])(),color:"red",icon:"el-icon-circle-close"};t.activities.push(i)}else{var s={content:e.error_info,timestamp:Object(n["c"])(),color:"#0bbd87"};t.activities.push(s)}})),a>=86400&&clearInterval(r),a++}),0)}),1e3)}))}if("删除"===e&&("shard"===this.currentNode.data.name?Object(n["d"])("此操作将永久删除"+this.currentNode.text+", 是否继续?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="delete_shard",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={};a.cluster_name=t.currentNode.data.cluster_name,a.shard_name=t.currentNode.text,e.paras=a,Object(u["i"])(e).then((function(e){var a=e;if(a.status="accept"){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在删除"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r),t.isShowNodeMenuPanel=!1;var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")})):"pgsql"===this.currentNode.data.name?Object(n["d"])("此操作将永久删除计算节点"+this.currentNode.text+", 是否继续?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="delete_comp",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={};a.cluster_name=t.currentNode.data.cluster_name,a.nick_name=t.currentNode.data.nick_name,a.comp_name=t.currentNode.data.comp,e.paras=a,Object(u["h"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在删除计算节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r),t.isShowNodeMenuPanel=!1;var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")})):"mysql"===this.currentNode.data.name&&Object(n["d"])("此操作将永久删除存储节点"+this.currentNode.text+", 是否继续?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="delete_node",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={};a.cluster_name=t.currentNode.data.cluster_name,a.shard_name=t.currentNode.data.shard_name,a.hostaddr=t.currentNode.data.hostaddr,a.port=t.currentNode.data.port,a.nick_name=t.currentNode.data.nick_name,e.paras=a,Object(u["j"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在删除存储节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r),t.isShowNodeMenuPanel=!1;var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")}))),"启用"===e&&("pgsql"===this.currentNode.data.name&&Object(n["d"])("是否继续启用"+this.currentNode.text+"该计算节点?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="control_instance",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={control:"start"};a.hostaddr=t.currentNode.data.hostaddr,a.port=t.currentNode.data.port,e.paras=a,Object(u["w"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在启动计算节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r);var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3);t.isShowNodeMenuPanel=!1}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")})),"mysql"===this.currentNode.data.name&&Object(n["d"])("是否继续启用"+this.currentNode.text+"该存储节点?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="control_instance",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={control:"start"};a.hostaddr=t.currentNode.data.hostaddr,a.port=t.currentNode.data.port,e.paras=a,Object(u["x"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在启动存储节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r);var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3);t.isShowNodeMenuPanel=!1}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")}))),"禁用"===e&&("pgsql"===this.currentNode.data.name&&Object(n["d"])("是否继续禁用"+this.currentNode.text+"该计算节点?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="control_instance",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={control:"stop"};a.hostaddr=t.currentNode.data.hostaddr,a.port=t.currentNode.data.port,e.paras=a,Object(u["y"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在禁用计算节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r);var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3);t.isShowNodeMenuPanel=!1}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")})),"mysql"===this.currentNode.data.name&&Object(n["d"])("是否继续禁用"+this.currentNode.text+"该存储节点?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="control_instance",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={control:"stop"};a.hostaddr=t.currentNode.data.hostaddr,a.port=t.currentNode.data.port,e.paras=a,Object(u["z"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在禁用存储节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r),t.isShowNodeMenuPanel=!1;var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")}))),"重启"===e&&("pgsql"===this.currentNode.data.name&&Object(n["d"])("是否继续重启"+this.currentNode.text+"该计算节点?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="control_instance",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={control:"restart"};a.hostaddr=t.currentNode.data.hostaddr,a.port=t.currentNode.data.port,e.paras=a,Object(u["t"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在重启计算节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r);var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3);t.isShowNodeMenuPanel=!1}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")})),"mysql"===this.currentNode.data.name&&Object(n["d"])("是否继续重启"+this.currentNode.text+"该存储节点?").then((function(){var e={};e.user_name=sessionStorage.getItem("login_username"),e.job_id="",e.job_type="control_instance",e.version=c["m"][0].ver,e.timestamp=c["k"][0].time+"";var a={control:"restart"};a.hostaddr=t.currentNode.data.hostaddr,a.port=t.currentNode.data.port,e.paras=a,Object(u["u"])(e).then((function(e){var a=e;if("accept"==a.status){t.dialogStatusVisible=!0,t.activities=[];var r={content:"正在重启存储节点"+t.currentNode.text,timestamp:Object(n["c"])(),size:"large",type:"primary",icon:"el-icon-more"};t.activities.push(r),t.isShowNodeMenuPanel=!1;var i=0,s=setInterval((function(){t.getStatus(s,a.job_id,i++)}),1e3)}else t.message_tips=a.error_info,t.message_type="error";Object(n["e"])(t.message_tips,t.message_type)}))})).catch((function(){console.log("quxiao"),Object(n["e"])("已取消删除","info")}))),"新增存储集群"===e&&(this.shardtemp.old_cluster_name=this.currentNode.text,this.shardtemp.cluster_name=this.currentNode.data.cluster_name,this.dialogShardVisible=!0,Object(d["a"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total}))),"新增计算节点"===e&&(this.comptemp.old_cluster_name=this.currentNode.text,this.dialogCompVisible=!0,Object(d["a"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total}))),"新增存储节点"===e&&(this.snodetemp.shard_name=this.currentNode.text,this.snodetemp.old_cluster_name=this.currentNode.data.cluster_name,this.dialogSnodeVisible=!0,Object(d["a"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total}))),"重做备机节点"===e&&(this.redotemp.shard_name=this.currentNode.text,this.dialogRedoVisible=!0,Object(d["a"])().then((function(e){t.machines=e.list,t.minMachine=0,t.machineTotal=e.total}))),"主备切换"===e){this.redotemp.shard_name=this.currentNode.text,this.dialogSwitchOVisible=!0;var l={};l.cluster_id=this.currentNode.data.cluster_id,l.shard_id=this.currentNode.data.shard_id,l.ha_mode=this.currentNode.data.ha_mode,this.switchtemp.shard_id=this.currentNode.data.shard_id,this.switchtemp.cluster_id=this.currentNode.data.cluster_id,Object(d["j"])(l).then((function(e){e.list.length>0&&(t.switchtemp.primary_node=e.list[0].ip+"("+e.list[0].port+")")}))}var p={};p.cluster_id=this.currentNode.data.cluster_id,p.shard_id=this.currentNode.data.shard_id,p.ha_mode=this.currentNode.data.ha_mode,Object(d["l"])(p).then((function(e){if(200==e.code&&(t.options=[],e.list.length>0))for(var a=0;a<e.list.length;a++){var r={value:a,label:e.list[a].ip+"("+e.list[a].port+")"};t.options.push(r)}}))},getStatus:function(e,t,a){var r=this;setTimeout((function(){var i={job_type:"get_status"};i.version=c["m"][0].ver,i.timestamp=c["k"][0].time+"",i.job_id=t,i.paras={},Object(u["o"])(i).then((function(t){if("done"==t.status||"failed"==t.status)if(clearInterval(e),r.info=t.error_info,"done"==t.status){var a={content:t.error_info,timestamp:Object(n["c"])(),color:"#0bbd87",icon:"el-icon-circle-check"};r.activities.push(a),r.dialogStatusVisible=!1,r.getCluster()}else{var i={content:t.error_info,timestamp:Object(n["c"])(),color:"red",icon:"el-icon-circle-close"};r.activities.push(i)}else{var s={content:t.error_info,timestamp:Object(n["c"])(),color:"#0bbd87"};r.activities.push(s)}})),a>=86400&&clearInterval(e)}),0)}}},x=j,O=(a("5928"),Object(_["a"])(x,g,b,!1,null,"1eea71d2",null)),w=O.exports,N={components:{List:f,Cshow:w},data:function(){return{activeName:"first",tabs:{first:!0,second:!1}}},methods:{handleClick:function(e){switch(this.activeName=e.name,this.activeName){case"first":this.switchTab("first");break;case"second":this.switchTab("second");break}},switchTab:function(e){for(var t in this.tabs)this.tabs[t]=t===e}}},C=N,I=(a("743b"),Object(_["a"])(C,r,i,!1,null,"7a058b5b",null));t["default"]=I.exports},"432c":function(e,t,a){"use strict";a("ad5d")},"466d":function(e,t,a){"use strict";var r=a("d784"),i=a("825a"),s=a("50c4"),o=a("1d80"),n=a("8aa5"),l=a("14c3");r("match",1,(function(e,t,a){return[function(t){var a=o(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,a):new RegExp(t)[e](String(a))},function(e){var r=a(t,e,this);if(r.done)return r.value;var o=i(e),c=String(this);if(!o.global)return l(o,c);var d=o.unicode;o.lastIndex=0;var u,p=[],m=0;while(null!==(u=l(o,c))){var _=String(u[0]);p[m]=_,""===_&&(o.lastIndex=n(c,s(o.lastIndex),d)),m++}return 0===m?null:p}]}))},"4d90":function(e,t,a){"use strict";var r=a("23e7"),i=a("0ccb").start,s=a("9a0c");r({target:"String",proto:!0,forced:s},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"4f8c":function(e,t,a){},"53ca":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}},5928:function(e,t,a){"use strict";a("4f8c")},"743b":function(e,t,a){"use strict";a("e502")},"82b0":function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"g",(function(){return s})),a.d(t,"h",(function(){return o})),a.d(t,"b",(function(){return n})),a.d(t,"o",(function(){return l})),a.d(t,"a",(function(){return c})),a.d(t,"k",(function(){return d})),a.d(t,"d",(function(){return u})),a.d(t,"f",(function(){return p})),a.d(t,"p",(function(){return m})),a.d(t,"i",(function(){return _})),a.d(t,"l",(function(){return h})),a.d(t,"e",(function(){return f})),a.d(t,"m",(function(){return g})),a.d(t,"n",(function(){return b})),a.d(t,"j",(function(){return v}));var r=a("b775");function i(e){return Object(r["a"])({url:"/user/Cluster/clusterList",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/user/Cluster/getEffectComp",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/user/Cluster/getExperience",method:"post",data:e})}function n(e){return Object(r["a"])({url:"/user/Cluster/getBackUpList",method:"get",params:e})}function l(e){return Object(r["a"])({url:"/user/Cluster/ifBackUp",method:"post",data:{id:e}})}function c(){return Object(r["a"])({url:"/user/Cluster/getAllMachine",method:"get",params:""})}function d(e){return Object(r["a"])({url:"/user/Cluster/getShards",method:"post",data:{id:e}})}function u(e){return Object(r["a"])({url:"/user/Cluster/getClusterNodesList",method:"post",data:{id:e}})}function p(e){return Object(r["a"])({url:"/user/Cluster/getEffectCluster",method:"post",data:e})}function m(e){return Object(r["a"])({url:"/user/Cluster/updateAssign",method:"post",data:e})}function _(e){return Object(r["a"])({url:"/user/Cluster/getNode",method:"post",data:e})}function h(e){return Object(r["a"])({url:"/user/Cluster/getStandbyNode",method:"post",data:e})}function f(e){return Object(r["a"])({url:"/user/Cluster/getClusterShards",method:"post",data:{id:e}})}function g(e){return Object(r["a"])({url:"/user/Cluster/getSwitcheOverList",method:"get",params:e})}function b(e){return Object(r["a"])({url:"/user/Cluster/getTaskList",method:"get",params:e})}function v(e){return Object(r["a"])({url:"/user/Cluster/getShardPrimary",method:"post",data:e})}},"9a0c":function(e,t,a){var r=a("342f");e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(r)},a665:function(e,t,a){"use strict";a.d(t,"l",(function(){return i})),a.d(t,"f",(function(){return s})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return l})),a.d(t,"o",(function(){return c})),a.d(t,"g",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"v",(function(){return p})),a.d(t,"s",(function(){return m})),a.d(t,"r",(function(){return _})),a.d(t,"i",(function(){return h})),a.d(t,"h",(function(){return f})),a.d(t,"j",(function(){return g})),a.d(t,"w",(function(){return b})),a.d(t,"x",(function(){return v})),a.d(t,"y",(function(){return y})),a.d(t,"z",(function(){return S})),a.d(t,"t",(function(){return k})),a.d(t,"u",(function(){return j})),a.d(t,"m",(function(){return x})),a.d(t,"q",(function(){return O})),a.d(t,"d",(function(){return w})),a.d(t,"B",(function(){return N})),a.d(t,"k",(function(){return C})),a.d(t,"p",(function(){return I})),a.d(t,"n",(function(){return $})),a.d(t,"A",(function(){return V}));var r=a("c2b2");function i(e){return Object(r["a"])({url:"/user/allMachineStatus",method:"post",data:e})}function s(e){return Object(r["a"])({url:"/user/Cluster/createCluster",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/user/Cluster/addShards",method:"post",data:e})}function n(e){return Object(r["a"])({url:"/user/Cluster/addComps",method:"post",data:e})}function l(e){return Object(r["a"])({url:"/user/Cluster/addNodes",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/user/Cluster/getStatus",method:"post",data:e})}function d(e){return Object(r["a"])({url:"/user/Cluster/delCluster",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/user/Cluster/backUpCluster",method:"post",data:e})}function p(e){return Object(r["a"])({url:"/user/Cluster/restoreCluster",method:"post",data:e})}function m(e){return Object(r["a"])({url:"/user/Cluster/postgresEnable",method:"post",data:e})}function _(e){return Object(r["a"])({url:"/user/Cluster/mysqlEnable",method:"post",data:e})}function h(e){return Object(r["a"])({url:"/user/Cluster/delShard",method:"post",data:e})}function f(e){return Object(r["a"])({url:"/user/Cluster/delComp",method:"post",data:e})}function g(e){return Object(r["a"])({url:"/user/Cluster/delSnode",method:"post",data:e})}function b(e){return Object(r["a"])({url:"/user/Cluster/controlInstance",method:"post",data:e})}function v(e){return Object(r["a"])({url:"/user/Cluster/controlInstance",method:"post",data:e})}function y(e){return Object(r["a"])({url:"/user/Cluster/controlInstance",method:"post",data:e})}function S(e){return Object(r["a"])({url:"/user/Cluster/controlInstance",method:"post",data:e})}function k(e){return Object(r["a"])({url:"/user/Cluster/controlInstance",method:"post",data:e})}function j(e){return Object(r["a"])({url:"/user/Cluster/controlInstance",method:"post",data:e})}function x(e){return Object(r["a"])({url:"/user/Cluster/getBackUpStorage",method:"post",data:e})}function O(e){return Object(r["a"])({url:"/user/Cluster/getStorageList",method:"post",data:e})}function w(e){return Object(r["a"])({url:"/user/Cluster/addStorage",method:"post",data:e})}function N(e){return Object(r["a"])({url:"/user/Cluster/updateStorage",method:"post",data:e})}function C(e){return Object(r["a"])({url:"/user/Cluster/delStorage",method:"post",data:e})}function I(e){return Object(r["a"])({url:"/Meta/getMetaPrimary",method:"POST",data:e})}function $(e){return Object(r["a"])({url:"/Meta/getClusterDetail",method:"post",data:e})}function V(e){return Object(r["a"])({url:"/Meta/switchShard",method:"post",data:e})}},a9e3:function(e,t,a){"use strict";var r=a("83ab"),i=a("da84"),s=a("94ca"),o=a("6eeb"),n=a("5135"),l=a("c6b6"),c=a("7156"),d=a("c04e"),u=a("d039"),p=a("7c73"),m=a("241c").f,_=a("06cf").f,h=a("9bf2").f,f=a("58a8").trim,g="Number",b=i[g],v=b.prototype,y=l(p(v))==g,S=function(e){var t,a,r,i,s,o,n,l,c=d(e,!1);if("string"==typeof c&&c.length>2)if(c=f(c),t=c.charCodeAt(0),43===t||45===t){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(s=c.slice(2),o=s.length,n=0;n<o;n++)if(l=s.charCodeAt(n),l<48||l>i)return NaN;return parseInt(s,r)}return+c};if(s(g,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var k,j=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof j&&(y?u((function(){v.valueOf.call(a)})):l(a)!=g)?c(new b(S(t)),a,j):S(t)},x=r?m(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),O=0;x.length>O;O++)n(b,k=x[O])&&!n(j,k)&&h(j,k,_(b,k));j.prototype=v,v.constructor=j,o(i,g,j)}},ad5d:function(e,t,a){},c2b2:function(e,t,a){"use strict";a("d3b7");var r=a("bc3a"),i=a.n(r),s=a("5c96"),o=(a("4360"),a("5f87"),JSON.parse(sessionStorage.getItem("response")).API_URL),n=i.a.create({baseURL:o+"/HttpService/Emit",timeout:6e4});n.interceptors.request.use((function(e){sessionStorage.getItem("zettadb_vue_token");return e}),(function(e){return console.log(e),Promise.reject(e)})),n.interceptors.response.use((function(e){var t=e.data;return t.code+="",t}),(function(e){return Object(s["Message"])({message:e.message,type:"error",duration:5e3}),Promise.reject(e)})),t["a"]=n},c3ac:function(e,t,a){"use strict";a("105c")},e502:function(e,t,a){},ed08:function(e,t,a){"use strict";a.d(t,"e",(function(){return i})),a.d(t,"d",(function(){return s})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return n})),a.d(t,"b",(function(){return l}));a("53ca"),a("ac1f"),a("00b4"),a("5319"),a("4d63"),a("2c3e"),a("25f0"),a("d3b7"),a("4d90"),a("1276"),a("159b");var r=a("5c96");function i(e,t){return Object(r["Message"])({message:e,type:t,duration:2e3})}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"确定执行此操作吗？",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";return r["MessageBox"].confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:t,center:!0})}function o(e){var t=e.split("T");return t[0]+" "+t[1]}function n(){var e=new Date,t="-",a=":",r=e.getFullYear(),i=e.getMonth()+1,s=e.getDate(),o=e.getHours(),n=e.getMinutes(),l=e.getSeconds(),c=["星期一","星期二","星期三","星期四","星期五","星期六","星期天"];c[e.getDay()];i>=1&&i<=9&&(i="0"+i),s>=0&&s<=9&&(s="0"+s),o>=0&&o<=9&&(o="0"+o),n>=0&&n<=9&&(n="0"+n),l>=0&&l<=9&&(l="0"+l);var d=r+t+i+t+s+" "+o+a+n+a+l;return d}function l(e){var t=e.split("-"),a=t[0],r=t[1],i=t[2],s=new Date(a,r,0);s=s.getDate();var o=a,n=parseInt(r)+1;13==n&&(o=parseInt(o)+1,n=1);var l=i,c=new Date(o,n,0);c=c.getDate(),l>c&&(l=c),n<10&&(n="0"+n);var d=o+"-"+n+"-"+l;return d}}}]);